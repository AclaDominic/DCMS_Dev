import{r,a as x,j as e}from"./index-CQFMzYRj.js";const M=[{value:"full_time",label:"Full-time"},{value:"part_time",label:"Part-time"},{value:"locum",label:"Locum"}],$=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],N=[{key:"sun",label:"Sun"},{key:"mon",label:"Mon"},{key:"tue",label:"Tue"},{key:"wed",label:"Wed"},{key:"thu",label:"Thu"},{key:"fri",label:"Fri"},{key:"sat",label:"Sat"}];function H(){const _={id:null,dentist_code:"",dentist_name:"",is_pseudonymous:!0,employment_type:"full_time",status:"active",contract_end_date:"",email:"",temporary_password:"",email_verified:!1,password_changed:!1,sun:!1,mon:!0,tue:!0,wed:!0,thu:!0,fri:!0,sat:!1},[j,L]=r.useState([]),[P,v]=r.useState(!0),[w,k]=r.useState(!1),[f,q]=r.useState(""),[t,m]=r.useState(_),[c,y]=r.useState({}),[Y,p]=r.useState(!1),[b,C]=r.useState(!1),[W,g]=r.useState(!1),[i,V]=r.useState(null),[o,S]=r.useState({email:"",name:""}),[A,E]=r.useState(!1);r.useEffect(()=>{h()},[]);const h=async()=>{try{v(!0);const s=await x.get("/api/dentists");L(s.data)}catch(s){console.error(s),alert("Failed to load dentists. Check admin auth and routes.")}finally{v(!1)}},D=r.useMemo(()=>{const s=f.trim().toLowerCase();return s?j.filter(a=>(a.dentist_code||"").toLowerCase().includes(s)||(a.dentist_name||"").toLowerCase().includes(s)||(a.employment_type||"").toLowerCase().includes(s)||(a.status||"").toLowerCase().includes(s)):j},[j,f]),I=()=>{m(_),y({}),C(!1),p(!0)},T=s=>{m({id:s.id,dentist_code:s.dentist_code||"",dentist_name:s.dentist_name||"",is_pseudonymous:!!s.is_pseudonymous,employment_type:s.employment_type||"full_time",status:s.status||"active",contract_end_date:s.contract_end_date||"",email:s.email||"",temporary_password:s.temporary_password||"",email_verified:!!s.email_verified,password_changed:!!s.password_changed,sun:!!s.sun,mon:!!s.mon,tue:!!s.tue,wed:!!s.wed,thu:!!s.thu,fri:!!s.fri,sat:!!s.sat}),y({}),C(!0),p(!0)},R=()=>{const s={};return t.dentist_code.trim()||(s.dentist_code="Dentist code is required."),M.find(l=>l.value===t.employment_type)||(s.employment_type="Invalid employment type."),$.find(l=>l.value===t.status)||(s.status="Invalid status."),N.some(l=>!!t[l.key])||(s.weekdays="Select at least one working day."),t.contract_end_date&&!/^\d{4}-\d{2}-\d{2}$/.test(t.contract_end_date)&&(s.contract_end_date="Use YYYY-MM-DD format."),!t.email||!t.email.trim()?s.email="Email address is required.":/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email.trim())||(s.email="Please enter a valid email address."),y(s),Object.keys(s).length===0},U=async s=>{var a,l,n;if(s.preventDefault(),!!R()){k(!0);try{const d={dentist_code:t.dentist_code.trim(),dentist_name:((a=t.dentist_name)==null?void 0:a.trim())||null,is_pseudonymous:!!t.is_pseudonymous,employment_type:t.employment_type,status:t.status,contract_end_date:t.contract_end_date||null,email:(l=t.email)==null?void 0:l.trim(),sun:!!t.sun,mon:!!t.mon,tue:!!t.tue,wed:!!t.wed,thu:!!t.thu,fri:!!t.fri,sat:!!t.sat};b&&t.id?(await x.put(`/api/dentists/${t.id}`,d),alert("Dentist updated.")):(await x.post("/api/dentists",d),alert("Dentist created.")),p(!1),h()}catch(d){const u=(n=d==null?void 0:d.response)==null?void 0:n.data;u!=null&&u.errors?y(u.errors):alert((u==null?void 0:u.message)||"Save failed")}finally{k(!1)}}},z=async s=>{var a,l;if(confirm(`Delete dentist ${s.dentist_code}? This cannot be undone.`))try{await x.delete(`/api/dentists/${s.id}`),alert("Deleted."),h()}catch(n){alert(((l=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:l.message)||"Delete failed.")}},O=async()=>{var s,a,l,n;if(i){if(!o.email||!o.email.trim()){alert("Email address is required.");return}if(!o.name||!o.name.trim()){alert("Full name is required.");return}E(!0);try{const d=await x.post("/api/dentist/create-account",{dentist_schedule_id:i.id,email:o.email.trim(),name:o.name.trim()});alert(`Account created successfully! Temporary password: ${d.data.temporary_password}`),g(!1),h()}catch(d){const u=((a=(s=d==null?void 0:d.response)==null?void 0:s.data)==null?void 0:a.message)||"Failed to create account.",F=(n=(l=d==null?void 0:d.response)==null?void 0:l.data)==null?void 0:n.errors;if(F){const K=Object.values(F).flat().join(`
`);alert(`Validation errors:
${K}`)}else alert(u)}finally{E(!1)}}},B=async s=>{var a,l;if(!s.email){alert(`Please add an email address for ${s.dentist_code} first.`);return}if(confirm(`Create account for ${s.dentist_code}? This will send a temporary password to ${s.email}.`))try{const n=await x.post("/api/dentist/create-account",{dentist_schedule_id:s.id,email:s.email,name:s.dentist_name||s.dentist_code});alert(`Account created successfully! Temporary password: ${n.data.temporary_password}`),h()}catch(n){alert(((l=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:l.message)||"Failed to create account.")}},J=({on:s,label:a})=>e.jsx("span",{className:`inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-xs border ${s?"bg-green-50 border-green-300":"bg-gray-50 border-gray-200 text-gray-400"}`,children:a});return e.jsxs("div",{className:"p-4 max-w-6xl mx-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Dentists"}),e.jsx("button",{onClick:I,className:"rounded-xl px-3 py-2 border bg-white hover:bg-gray-50",children:"+ Add Dentist"})]}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{className:"w-full md:w-80 border rounded-lg px-3 py-2",placeholder:"Search code / name / type / status",value:f,onChange:s=>q(s.target.value)})}),P?e.jsx("div",{children:"Loading…"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full border text-sm",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"Code"}),e.jsx("th",{className:"p-2 border",children:"Name"}),e.jsx("th",{className:"p-2 border",children:"Email"}),e.jsx("th",{className:"p-2 border",children:"Account Status"}),e.jsx("th",{className:"p-2 border",children:"Pseudonymous"}),e.jsx("th",{className:"p-2 border",children:"Employment"}),e.jsx("th",{className:"p-2 border",children:"Status"}),e.jsx("th",{className:"p-2 border",children:"Weekdays"}),e.jsx("th",{className:"p-2 border",children:"Contract End"}),e.jsx("th",{className:"p-2 border",children:"Actions"})]})}),e.jsxs("tbody",{children:[D.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border font-medium",children:s.dentist_code}),e.jsx("td",{className:"p-2 border",children:s.dentist_name||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2 border",children:s.email?e.jsxs("div",{children:[e.jsx("div",{className:"text-sm",children:s.email}),s.temporary_password&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Temp: ",s.temporary_password]})]}):e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2 border",children:e.jsx("div",{className:"flex flex-col gap-1",children:s.email?e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs ${s.password_changed?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"}`,children:s.password_changed?"✓ Password Changed":"⚠ Temp Password"}):e.jsx("span",{className:"text-gray-400 text-xs",children:"No Account"})})}),e.jsx("td",{className:"p-2 border",children:s.is_pseudonymous?"Yes":"No"}),e.jsx("td",{className:"p-2 border",children:s.employment_type}),e.jsx("td",{className:"p-2 border",children:s.status}),e.jsx("td",{className:"p-2 border",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:N.map(a=>e.jsx(J,{on:!!s[a.key],label:a.label},a.key))})}),e.jsx("td",{className:"p-2 border",children:s.contract_end_date||e.jsx("span",{className:"text-gray-400",children:"—"})}),e.jsx("td",{className:"p-2 border",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>T(s),children:"Edit"}),e.jsx("button",{className:"px-2 py-1 rounded border text-xs",onClick:()=>z(s),children:"Delete"})]}),s.email?s.temporary_password?e.jsx("span",{className:"text-xs text-gray-500",children:"Account Created"}):e.jsx("button",{className:"px-2 py-1 rounded border bg-green-500 text-white text-xs",onClick:()=>B(s),children:"Create Account"}):e.jsx("button",{className:"px-2 py-1 rounded border bg-blue-500 text-white text-xs",onClick:()=>T(s),children:"Add Email"})]})})]},s.id)),D.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"p-3 text-center text-gray-500",colSpan:10,children:"No dentists found."})})]})]})}),Y&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-2xl p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h2",{className:"text-lg font-semibold",children:b?"Edit Dentist":"Add Dentist"}),e.jsx("button",{onClick:()=>p(!1),className:"text-gray-500",children:"✕"})]}),e.jsxs("form",{onSubmit:U,className:"space-y-3",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm",children:["Dentist Code",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:t.dentist_code,onChange:s=>m({...t,dentist_code:s.target.value})}),c.dentist_code&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(c.dentist_code)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Dentist Name (optional)"}),e.jsx("input",{className:"w-full border rounded px-3 py-2",value:t.dentist_name,onChange:s=>m({...t,dentist_name:s.target.value})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{id:"isPseudo",type:"checkbox",checked:!!t.is_pseudonymous,onChange:s=>m({...t,is_pseudonymous:s.target.checked})}),e.jsx("label",{htmlFor:"isPseudo",className:"text-sm",children:"Use pseudonymous identity?"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm",children:["Employment Type",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{className:"w-full border rounded px-3 py-2",value:t.employment_type,onChange:s=>m({...t,employment_type:s.target.value}),children:M.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),c.employment_type&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(c.employment_type)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm",children:["Status",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{className:"w-full border rounded px-3 py-2",value:t.status,onChange:s=>m({...t,status:s.target.value}),children:$.map(s=>e.jsx("option",{value:s.value,children:s.label},s.value))}),c.status&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(c.status)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Contract End (optional)"}),e.jsx("input",{type:"date",className:"w-full border rounded px-3 py-2",value:t.contract_end_date||"",onChange:s=>m({...t,contract_end_date:s.target.value})}),c.contract_end_date&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(c.contract_end_date)})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm",children:["Email Address",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"email",className:"w-full border rounded px-3 py-2",value:t.email||"",onChange:s=>m({...t,email:s.target.value}),placeholder:"dentist@example.com",required:!0}),c.email&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(c.email)})]}),b&&t.temporary_password&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm",children:"Temporary Password"}),e.jsxs("div",{className:"w-full border rounded px-3 py-2 bg-gray-50 text-sm",children:[t.temporary_password,e.jsx("span",{className:"text-gray-500 ml-2",children:"(Auto-generated)"})]})]})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm mb-1",children:["Working Days",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:N.map(s=>e.jsxs("label",{className:"inline-flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!!t[s.key],onChange:a=>m({...t,[s.key]:a.target.checked})}),e.jsx("span",{children:s.label})]},s.key))}),c.weekdays&&e.jsx("p",{className:"text-xs text-red-600 mt-1",children:String(c.weekdays)})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-2",children:[e.jsx("button",{type:"button",className:"px-3 py-2 rounded border",onClick:()=>p(!1),children:"Cancel"}),e.jsx("button",{disabled:w,type:"submit",className:"px-3 py-2 rounded border bg-black text-white disabled:opacity-50",children:w?"Saving…":b?"Save Changes":"Create"})]})]})]})}),W&&e.jsx("div",{className:"fixed inset-0 bg-black/30 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-md p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Create Dentist Account"}),e.jsx("button",{onClick:()=>g(!1),className:"text-gray-500",children:"✕"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Dentist"}),e.jsxs("div",{className:"p-2 bg-gray-50 rounded border",children:[i==null?void 0:i.dentist_code," - ",i==null?void 0:i.dentist_name]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email Address"}),e.jsx("input",{type:"email",className:"w-full border rounded px-3 py-2",value:o.email,onChange:s=>S({...o,email:s.target.value}),placeholder:"dentist@example.com",required:!0}),(i==null?void 0:i.email)&&o.email!==i.email&&e.jsxs("p",{className:"text-xs text-orange-600 mt-1",children:["⚠️ Email differs from schedule email (",i.email,") - this will be logged as an email change"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Full Name"}),e.jsx("input",{type:"text",className:"w-full border rounded px-3 py-2",value:o.name,onChange:s=>S({...o,name:s.target.value}),placeholder:"Dr. John Doe",required:!0})]}),e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded p-3",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:[e.jsx("strong",{children:"Note:"})," A temporary password will be generated and sent to the email address. The dentist will need to verify their email and change their password on first login."]})})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",className:"px-3 py-2 rounded border",onClick:()=>g(!1),children:"Cancel"}),e.jsx("button",{disabled:A,onClick:O,className:"px-3 py-2 rounded border bg-blue-500 text-white disabled:opacity-50",children:A?"Creating...":"Create Account"})]})]})})]})}export{H as default};
