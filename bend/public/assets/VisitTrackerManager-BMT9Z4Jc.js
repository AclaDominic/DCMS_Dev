import{r as n,j as e}from"./react-vendor-D3yaKSZ_.js";import{a as k}from"./index-CjLdHRDN.js";import"./chart-vendor-BsnJAHr2.js";import"./bootstrap-vendor-CM53U_Of.js";import"./vendor-axios-ngrFHoWO.js";import"./pdf-vendor-BZobkf7J.js";import"./vendor-utils-DLELI0UM.js";import"./excel-vendor-6kUf8nhb.js";function Ke({visit:o,onClose:S,onComplete:D}){var je,fe,ge,ne,Ne;const[i,_]=n.useState(1),[$,T]=n.useState([]),[h,C]=n.useState([]),[O,P]=n.useState(!1),[R,V]=n.useState(!1),[A,w]=n.useState([]),[B,v]=n.useState(""),[f,se]=n.useState(""),[t,g]=n.useState(""),[F,Z]=n.useState(""),[b,u]=n.useState(null),[p,x]=n.useState("paid"),[M,Q]=n.useState(""),[H,K]=n.useState("");n.useEffect(()=>{z(),Y()},[]);const z=async()=>{try{const l=await k.get("/api/inventory/items");T(l.data.data||[])}catch(l){console.error("Failed to load inventory items",l)}},Y=async()=>{var l,j;try{const y=(await k.get(`/api/visits/${o.id}/dentist-notes`)).data;y.dentist_notes&&v(y.dentist_notes),y.findings&&se(y.findings),y.treatment_plan&&g(y.treatment_plan),y.teeth_treated&&Z(y.teeth_treated),(y.created_by||y.created_at)&&u({created_by:y.created_by,created_at:y.created_at,updated_by:y.updated_by,updated_at:y.updated_at})}catch(m){console.log("No dentist notes found or error fetching notes:",(j=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:j.message)}},ce=()=>{C([...h,{item_id:"",quantity:0,notes:""}])},E=(l,j,m)=>{const y=[...h];if(j==="quantity")if(m==="")y[l][j]="";else{const le=Math.max(0,Math.floor(Number(m)||0));y[l][j]=le}else y[l][j]=m;C(y)},L=l=>{C(h.filter((j,m)=>m!==l))},G=(l,j)=>{const m=A.some(y=>y.item_id===l);w(m?A.filter(y=>y.item_id!==l):[...A,{item_id:l,quantity:1,unit_price:Number(j.patient_price)||0}])},ie=(l,j)=>{w(A.map(m=>m.item_id===l?{...m,quantity:Math.max(1,Number(j)||1)}:m))},de=async()=>{var l,j;V(!0);try{const m=h.some(I=>Number(I.quantity)>0&&I.item_id),y=A.length>0;if(!m&&!y&&!window.confirm(`No stock items or additional charges were recorded for this visit.

Are you sure you want to complete the visit without consuming any stock?`)){V(!1);return}const le={stock_items:h.filter(I=>I.item_id&&I.quantity),billable_items:A.map(I=>({item_id:I.item_id,quantity:Number(I.quantity)||1,unit_price:Number(I.unit_price)||0})),dentist_notes:B,findings:f,treatment_plan:t,teeth_treated:F,payment_status:X?"paid":p,onsite_payment_amount:X?null:M?Number(M):null,payment_method_change:X?null:H||null};await k.post(`/api/visits/${o.id}/complete-with-details`,le);try{const I=await k.post(`/api/receipts/visit/${o.id}/email`,{},{skip401Handler:!0});I.data.note?alert(`Visit completed successfully!

${I.data.message}

${I.data.note}`):alert(`Visit completed successfully!

Receipt sent to: ${I.data.email}`)}catch(I){console.error("Failed to send receipt email:",I),alert(`Visit completed successfully!

Note: Receipt email could not be sent. Patient can download receipt from their appointments page.`)}D(),S()}catch(m){alert(((j=(l=m==null?void 0:m.response)==null?void 0:l.data)==null?void 0:j.message)||"Failed to complete visit")}finally{V(!1)}},be=((je=o.payments)==null?void 0:je.reduce((l,j)=>l+(Number(j.amount_paid)||0),0))||0,me=Number((fe=o.service)==null?void 0:fe.price)||0,ae=A.reduce((l,j)=>{const m=Number(j.unit_price)||0,y=Number(j.quantity)||1;return l+m*y},0),he=me+ae,te=he-be,pe=n.useMemo(()=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:2,maximumFractionDigits:2}),[]),U=l=>pe.format(Number(l)||0),re=(ge=o.payments)==null?void 0:ge.find(l=>l.method==="maya"&&l.status==="paid"),X=!!re;return e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-lg",role:"document",style:{maxWidth:"800px",maxHeight:"calc(100vh - 2rem)",margin:"0 auto",width:"100%"},children:e.jsxs("div",{className:"modal-content d-flex flex-column",style:{maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-primary text-white py-2 flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title fw-bold mb-0",children:[e.jsx("i",{className:"fas fa-check-circle me-2"}),"Complete Visit"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:S,"aria-label":"Close",style:{fontSize:"1.2rem"}})]}),e.jsxs("div",{className:"modal-body p-3 flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsx("div",{className:"d-flex justify-content-center mb-3",children:e.jsx("div",{className:"progress w-100",style:{height:"4px"},children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${i/3*100}%`},"aria-valuenow":i,"aria-valuemin":"0","aria-valuemax":"3"})})}),e.jsx("div",{className:"d-flex justify-content-between mb-3",children:[1,2,3].map(l=>e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("div",{className:`rounded-circle d-flex align-items-center justify-content-center mb-1 ${i>=l?"bg-primary text-white shadow-sm":"bg-light text-muted border"}`,style:{width:"36px",height:"36px",fontSize:"14px"},children:e.jsx("i",{className:`fas ${l===1?"fa-boxes":l===2?"fa-sticky-note":"fa-credit-card"}`})}),e.jsxs("small",{className:`text-center ${i>=l?"text-primary fw-bold":"text-muted"}`,style:{fontSize:"12px"},children:[l===1&&"Stock",l===2&&"Notes",l===3&&"Payment"]})]},l))}),i===1&&e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-gradient bg-light py-2",children:e.jsxs("h6",{className:"card-title mb-0",children:[e.jsx("i",{className:"fas fa-boxes text-primary me-2"}),"Consume Stock Items"]})}),e.jsxs("div",{className:"card-body p-3",children:[h.length>0?e.jsx("div",{className:"row g-2",children:h.map((l,j)=>e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border border-primary border-opacity-25",children:e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"row g-2 align-items-end",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("select",{className:"form-select",value:l.item_id,onChange:m=>E(j,"item_id",m.target.value),children:[e.jsx("option",{value:"",children:"Item"}),$.map(m=>e.jsxs("option",{value:m.id,children:[m.name," (Stock: ",m.total_on_hand||0,")"]},m.id))]})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"number",step:"1",min:"0",className:"form-control",inputMode:"numeric",value:l.quantity,onChange:m=>E(j,"quantity",m.target.value),placeholder:"Quantity"})}),e.jsx("div",{className:"col-md-4",children:e.jsx("input",{type:"text",className:"form-control",value:l.notes,onChange:m=>E(j,"notes",m.target.value),placeholder:"Notes"})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("button",{type:"button",onClick:()=>L(j),className:"btn btn-outline-danger w-100",title:"Remove item",style:{minHeight:"38px"},children:[e.jsx("i",{className:"fas fa-trash me-1"}),"Remove Item"]})})]})})})},j))}):e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx("i",{className:"fas fa-boxes fa-3x mb-3 text-primary opacity-50"}),e.jsx("p",{className:"mb-0",children:"No stock items added yet"}),e.jsx("small",{children:'Click "Add Item" to start consuming stock'})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("button",{type:"button",onClick:ce,className:"btn btn-primary",style:{minWidth:"120px"},children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Add Item"]})}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"alert alert-info py-2 mb-3",children:[e.jsx("i",{className:"fas fa-info-circle me-2"}),e.jsx("strong",{children:"Additional Items:"})," Select items that patients can purchase separately (not included in procedure)"]}),e.jsx("div",{className:"card border-warning",children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("div",{className:"row",children:$.filter(l=>l.is_sellable&&l.patient_price).map(l=>{var j;return e.jsxs("div",{className:"col-12 mb-2",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:A.some(m=>m.item_id===l.id),onChange:()=>G(l.id,l),id:`billable-${l.id}`}),e.jsxs("label",{className:"form-check-label",htmlFor:`billable-${l.id}`,children:[l.name," - ",U(l.patient_price)]})]}),A.some(m=>m.item_id===l.id)&&e.jsx("div",{className:"ms-4 mt-1",children:e.jsxs("div",{className:"input-group input-group-sm",style:{width:"150px"},children:[e.jsx("span",{className:"input-group-text",children:"Qty:"}),e.jsx("input",{type:"number",className:"form-control",min:"1",value:((j=A.find(m=>m.item_id===l.id))==null?void 0:j.quantity)||1,onChange:m=>ie(l.id,m.target.value)})]})})]},l.id)})}),$.filter(l=>l.is_sellable&&l.patient_price).length===0&&e.jsx("p",{className:"text-muted mb-0 small",children:"No billable items available. Configure items as sellable in inventory settings."})]})})]})]}),i===2&&e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-gradient bg-light py-2",children:e.jsxs("h6",{className:"card-title mb-0",children:[e.jsx("i",{className:"fas fa-sticky-note text-primary me-2"}),"Visit Documentation"]})}),e.jsxs("div",{className:"card-body p-3",children:[b&&e.jsxs("div",{className:"alert alert-info mb-3 py-2 border-0",children:[e.jsxs("h6",{className:"alert-heading small",children:[e.jsx("i",{className:"fas fa-info-circle me-2"}),"Original Notes Information"]}),e.jsxs("p",{className:"mb-1 small",children:[e.jsx("strong",{children:"Created by:"})," ",b.created_by," on ",new Date(b.created_at).toLocaleString()]}),b.updated_by&&b.updated_at&&e.jsxs("p",{className:"mb-1 small",children:[e.jsx("strong",{children:"Last updated by:"})," ",b.updated_by," on ",new Date(b.updated_at).toLocaleString()]}),e.jsx("hr",{className:"my-2"}),e.jsx("p",{className:"mb-0 small",children:"You can edit these notes as needed for the final documentation."})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-user-md text-primary me-1"}),"Dentist Notes"]}),e.jsx("textarea",{className:"form-control",rows:"3",value:B,onChange:l=>v(l.target.value),placeholder:"Enter dentist's notes about the visit..."})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-search text-primary me-1"}),"Findings"]}),e.jsx("textarea",{className:"form-control",rows:"3",value:f,onChange:l=>se(l.target.value),placeholder:"Document any findings or observations..."})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-clipboard-list text-primary me-1"}),"Treatment Plan"]}),e.jsx("textarea",{className:"form-control",rows:"3",value:t,onChange:l=>g(l.target.value),placeholder:"Outline the treatment plan or follow-up instructions..."})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-tooth text-primary me-1"}),"Teeth Treated"]}),e.jsx("input",{type:"text",className:"form-control",value:F,onChange:l=>Z(l.target.value),placeholder:"e.g., 1,2,3,4,5 or leave blank if not applicable"}),e.jsx("div",{className:"form-text",children:"Enter tooth numbers separated by commas (e.g., 1,2,3,4,5). Use the Universal Numbering System."})]})]})]})]}),i===3&&e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-gradient bg-light py-2",children:e.jsxs("h6",{className:"card-title mb-0",children:[e.jsx("i",{className:"fas fa-credit-card text-primary me-2"}),"Payment Verification"]})}),e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)"},children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("h6",{className:"card-title text-dark mb-3",children:[e.jsx("i",{className:"fas fa-receipt text-primary me-2"}),"Payment Summary"]}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Service"}),e.jsx("div",{className:"fw-semibold text-dark",children:((ne=o.service)==null?void 0:ne.name)||"N/A"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Service Price"}),e.jsxs("div",{className:"fw-semibold text-primary",children:[U(me),((Ne=o.service)==null?void 0:Ne.per_teeth_service)&&e.jsx("small",{className:"text-info d-block",children:"per tooth"})]})]})}),ae>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-12",children:[e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"fw-semibold mb-2",children:"Additional Items:"}),A.map(l=>{const j=$.find(m=>m.id===l.item_id);return e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsxs("small",{children:[j==null?void 0:j.name," (x",l.quantity,")"]}),e.jsx("small",{className:"fw-semibold",children:U(l.unit_price*l.quantity)})]},l.item_id)}),e.jsx("hr",{className:"my-2"})]}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Additional Charges"}),e.jsx("div",{className:"fw-semibold text-warning",children:U(ae)})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Total Price"}),e.jsx("div",{className:"fw-bold text-primary",children:U(he)})]})})]}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Total Paid"}),e.jsx("div",{className:"fw-semibold text-success",children:U(be)})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Balance"}),e.jsx("div",{className:`fw-bold ${te>0?"text-warning":"text-success"}`,children:U(te)})]})})]})]})})}),X&&e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"alert alert-success border-0 shadow-sm",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"fas fa-check-circle fa-2x text-success me-3"}),e.jsxs("div",{children:[e.jsxs("h6",{className:"alert-heading mb-1",children:[e.jsx("i",{className:"fas fa-credit-card me-2"}),"Maya Payment Completed"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Amount Paid:"})," ",U(re.amount_paid||0)]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Payment Date:"})," ",new Date(re.paid_at).toLocaleString()]}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-lock me-1"}),"Payment information is read-only as the Maya payment has been successfully completed."]})]})]})})}),ae>0&&!X&&e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"alert alert-warning border-0 shadow-sm",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-2x text-warning me-3"}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("h6",{className:"alert-heading mb-1",children:[e.jsx("i",{className:"fas fa-info-circle me-2"}),"Additional Items Selected"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Additional Charges:"})," ",U(ae)]}),e.jsxs("p",{className:"mb-0 small",children:[e.jsx("i",{className:"fas fa-lightbulb me-1"}),e.jsx("strong",{children:"HMO/Maya payments only cover the service amount."}),` If the patient's HMO/Maya payment doesn't cover additional charges, select "Partially Paid" and enter the on-site payment amount for the additional items.`]})]})]})})}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-credit-card text-primary me-1"}),"Payment Status"]}),e.jsxs("select",{className:"form-select",value:p,onChange:l=>x(l.target.value),disabled:X,children:[e.jsx("option",{value:"paid",children:"Fully Paid"}),e.jsx("option",{value:"hmo_fully_covered",children:"HMO Fully Covered"}),e.jsx("option",{value:"partial",children:"Partially Paid (HMO didn't cover all)"}),e.jsx("option",{value:"unpaid",children:"Unpaid (Maya failed)"})]}),X&&e.jsxs("div",{className:"form-text text-muted",children:[e.jsx("i",{className:"fas fa-lock me-1"}),"Payment status cannot be changed as Maya payment is already completed."]})]}),p==="partial"&&!X&&e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-money-bill text-primary me-1"}),"On-site Payment Amount (₱)"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"₱"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:te,className:"form-control",value:M,onChange:l=>Q(l.target.value),placeholder:`Maximum: ${te.toLocaleString()}`})]}),e.jsxs("div",{className:"form-text",children:["Maximum amount: ",U(te)]})]}),p==="unpaid"&&!X&&e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-exchange-alt text-primary me-1"}),"Payment Method Change"]}),e.jsxs("select",{className:"form-select",value:H,onChange:l=>K(l.target.value),children:[e.jsx("option",{value:"",children:"Select change"}),e.jsx("option",{value:"maya_to_cash",children:"Change Maya to Cash Payment"})]})]})]})})]})]}),e.jsx("div",{className:"modal-footer bg-light border-top flex-shrink-0 py-3",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[e.jsx("div",{children:i>1&&e.jsxs("button",{type:"button",onClick:()=>_(i-1),className:"btn btn-outline-secondary",style:{minWidth:"100px"},children:[e.jsx("i",{className:"fas fa-arrow-left me-2"}),"Previous"]})}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("small",{className:"text-muted me-3",children:["Step ",i," of 3"]}),i<3?e.jsxs("button",{type:"button",onClick:()=>_(i+1),className:"btn btn-primary",style:{minWidth:"100px"},children:["Next",e.jsx("i",{className:"fas fa-arrow-right ms-2"})]}):e.jsx("button",{type:"button",onClick:de,disabled:R,className:"btn btn-success",style:{minWidth:"140px"},children:R?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check me-2"}),"Complete Visit"]})})]})]})})]})})})}function Ge({visit:o,onClose:S}){var V,A;const[D,i]=n.useState(""),[_,$]=n.useState(!1),[T,h]=n.useState(""),[C,O]=n.useState(null),P=async w=>{var B,v;w.preventDefault(),$(!0),h("");try{const f=await k.post(`/api/visits/${o.id}/view-notes`,{password:D});O(f.data.notes)}catch(f){h(((v=(B=f==null?void 0:f.response)==null?void 0:B.data)==null?void 0:v.message)||"Invalid password or failed to decrypt notes")}finally{$(!1)}},R=w=>w?e.jsxs("div",{className:"space-y-4",children:[w.dentist_notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Dentist Notes:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:w.dentist_notes})})]}),w.findings&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Findings:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:w.findings})})]}),w.treatment_plan&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Treatment Plan:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:w.treatment_plan})})]}),e.jsxs("div",{className:"text-sm text-gray-600 border-t pt-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Completed by:"})," Staff ID #",w.completed_by]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Completed at:"})," ",new Date(w.completed_at).toLocaleString()]})]})]}):null;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",style:{padding:"1rem"},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-6 flex-shrink-0 sticky top-0 bg-white border-b z-10",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Visit Notes - ",(V=o.patient)==null?void 0:V.first_name," ",(A=o.patient)==null?void 0:A.last_name]}),e.jsx("button",{onClick:S,className:"text-gray-500 hover:text-gray-700",children:"✕"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-6",style:{minHeight:0},children:C?e.jsx("div",{children:R(C)}):e.jsxs("form",{onSubmit:P,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Enter your password to view encrypted notes:"}),e.jsx("input",{type:"password",className:"w-full border rounded px-3 py-2",value:D,onChange:w=>i(w.target.value),placeholder:"Enter your account password",required:!0}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action will be logged for security purposes."})]}),T&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded",children:T}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:S,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:_||!D.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:_?"Verifying...":"View Notes"})]})]})}),C&&e.jsx("div",{className:"p-6 flex-shrink-0 sticky bottom-0 bg-white border-t z-10",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:S,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Close"})})})]})})}function Je({visit:o,onClose:S,onSuccess:D}){var g,F,Z;const[i,_]=n.useState([]),[$,T]=n.useState(!0),[h,C]=n.useState(null),[O,P]=n.useState(!1),[R,V]=n.useState(""),[A,w]=n.useState({}),B=30;n.useEffect(()=>{v()},[]);const v=async()=>{var b,u;T(!0),V(""),w({});try{const p=new Date,x=p.getDay(),Q=["sun","mon","tue","wed","thu","fri","sat"][x],[H,K]=await Promise.all([k.get("/api/dentists",{params:{status:"active"}}),k.get("/api/staff/today-time-blocks",{skip401Handler:!0})]),z=H.data.filter(E=>E[Q]===!0&&E.status==="active"&&(!E.contract_end_date||new Date(E.contract_end_date)>=p));console.log("Available dentists:",z),_(z);const Y={};if((((b=K.data)==null?void 0:b.blocks)??[]).forEach(E=>{(E.appointments||[]).forEach(L=>{if(!L.dentist_schedule_id||!L.time_slot)return;const[G]=L.time_slot.split("-",2);G&&(Y[L.dentist_schedule_id]||(Y[L.dentist_schedule_id]=[]),Y[L.dentist_schedule_id].push({appointment:L,startString:G.trim()}))})}),w(Y),!h&&((u=o==null?void 0:o.appointment)!=null&&u.dentist_schedule_id)){const E=z.find(L=>L.id===o.appointment.dentist_schedule_id);E&&C(E)}}catch(p){console.error("Failed to fetch dentists:",p),V("Failed to load available dentists. Please try again."),w({})}finally{T(!1)}},f=b=>{if(!b)return null;const u=b.trim().split(":");if(u.length<2)return null;const p=parseInt(u[0],10),x=parseInt(u[1],10);if(Number.isNaN(p)||Number.isNaN(x))return null;const M=new Date;return M.setHours(p,x,0,0),M},se=b=>{var Q;const u=A[b]||[];if(!u.length)return null;const p=new Date,x=((Q=o==null?void 0:o.appointment)==null?void 0:Q.id)??null;let M=null;return u.forEach(({appointment:H,startString:K})=>{if(x&&H.id===x)return;const z=f(K);if(!z)return;const Y=(z-p)/6e4;Y>=-30&&Y<B&&(!M||Math.abs(Y)<Math.abs(M.diffMinutes))&&(M={diffMinutes:Y,appointment:H,start:z})}),M},t=async()=>{var b,u;if(!h){V("Please select a dentist to send the visit code to.");return}if(!h.email){V("Selected dentist does not have an email address configured.");return}P(!0),V("");try{console.log("Sending visit code to dentist:",h);const p=await k.post("/api/visits/send-visit-code",{visit_id:o.id,dentist_id:h.id,dentist_email:h.email});alert(`Visit code sent successfully to Dr. ${h.dentist_name||h.dentist_code}!`),D&&D(h),S()}catch(p){console.error("Failed to send visit code:",p);let x="Failed to send visit code. Please try again.";(u=(b=p.response)==null?void 0:b.data)!=null&&u.message?x=p.response.data.message:p.message&&(x=p.message),V(x)}finally{P(!1)}};return e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-lg",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Visit Code to Dentist"]}),e.jsx("button",{className:"btn-close",onClick:S,disabled:O})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"alert alert-info mb-4",children:[e.jsxs("h6",{className:"alert-heading",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Visit Information"]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Patient:"})," ",(g=o.patient)==null?void 0:g.first_name," ",(F=o.patient)==null?void 0:F.last_name]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Visit Code:"}),e.jsx("span",{className:"badge bg-primary ms-2 fs-6",children:o.visit_code})]}),e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Service:"})," ",((Z=o.service)==null?void 0:Z.name)||"Not specified"]}),e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Started:"})," ",new Date(o.start_time).toLocaleString()]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-person-badge me-2"}),"Select Available Dentist Today"]}),$?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"mt-2 text-muted",children:"Loading available dentists..."})]}):R&&!i.length?e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),R]}):i.length===0?e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No dentists are scheduled to work today. Please check the dentist schedule."]}):e.jsx("div",{className:"row",children:i.map(b=>{var K;const u=(h==null?void 0:h.id)===b.id,p=((K=o==null?void 0:o.appointment)==null?void 0:K.dentist_schedule_id)===b.id,x=se(b.id),M=!!x,Q=u?"border-primary bg-light":p?"border-success":"border-light",H=x?x.diffMinutes>=0?`Appointment at ${x.appointment.time_slot} begins in ${Math.max(1,Math.round(x.diffMinutes))} min.`:`Appointment at ${x.appointment.time_slot} started ${Math.abs(Math.round(x.diffMinutes))} min ago.`:"";return e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("div",{className:`card h-100 position-relative border-2 ${Q} ${M?"opacity-50":"cursor-pointer"}`,role:"button","aria-disabled":M,onClick:()=>{M||C(b)},title:M?H:void 0,style:{transition:"all 0.2s ease"},children:[p&&e.jsx("span",{className:"badge bg-success position-absolute top-0 start-0 m-2",children:"Preferred"}),u&&e.jsx("span",{className:"badge bg-primary position-absolute top-0 end-0 m-2",children:"Selected"}),e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx("div",{className:"bg-primary text-white rounded-circle d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px"},children:e.jsx("i",{className:"bi bi-person-fill"})})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("h6",{className:"card-title mb-1",children:["Dr. ",b.dentist_name||b.dentist_code]}),e.jsxs("small",{className:"text-muted",children:[b.dentist_code&&e.jsx("span",{className:"badge bg-secondary me-2",children:b.dentist_code}),b.employment_type&&e.jsx("span",{className:"text-capitalize",children:b.employment_type.replace("_"," ")})]}),b.email&&e.jsx("div",{className:"mt-1",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-envelope me-1"}),b.email]})})]}),u&&e.jsx("div",{className:"text-primary",children:e.jsx("i",{className:"bi bi-check-circle-fill fs-5"})})]}),H&&e.jsxs("div",{className:"alert alert-warning small mt-3 mb-0",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),H]})]})]})},b.id)})})]}),R&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),R]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:S,disabled:O,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:t,disabled:O||!h||i.length===0,children:O?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Visit Code"]})})]})]})})})}const es=o=>{if(!o)return null;const S=new Date(o);if(Number.isNaN(S.getTime()))return null;const D=new Date;let i=D.getFullYear()-S.getFullYear();const _=D.getMonth()-S.getMonth();return(_<0||_===0&&D.getDate()<S.getDate())&&(i-=1),i<0?0:i};function ss({visit:o,onClose:S,onSuccess:D}){const[i,_]=n.useState({}),[$,T]=n.useState(!0),[h,C]=n.useState(!1),[O,P]=n.useState(""),[R,V]=n.useState(!1),[A,w]=n.useState(null);n.useEffect(()=>{B()},[o]),n.useEffect(()=>{if(!(i!=null&&i.date_of_birth)){i!=null&&i.age&&_(g=>({...g,age:""}));return}const t=es(i.date_of_birth);t!==null&&t!==i.age&&_(g=>({...g,age:t}))},[i==null?void 0:i.date_of_birth]);const B=async()=>{var t,g;T(!0),P("");try{const F=await k.get(`/api/visits/${o.id}/medical-history-form`);_(F.data.form_data||{}),V(F.data.previous_history_exists||!1),w(F.data.previous_history_date||null)}catch(F){console.error("Failed to load medical history form:",F),P(((g=(t=F.response)==null?void 0:t.data)==null?void 0:g.message)||"Failed to load form data. Please try again.")}finally{T(!1)}},v=(t,g)=>{_(F=>({...F,[t]:g}))},f=(t,g)=>{_(F=>({...F,[t]:g}))},se=async t=>{var g,F,Z,b;t.preventDefault(),C(!0),P("");try{const u=await k.post(`/api/visits/${o.id}/medical-history`,i);alert(`Medical history completed successfully!

Visit Code: ${u.data.visit.visit_code}

You can now send this code to the dentist.`),D&&D(u.data),S()}catch(u){if(console.error("Failed to submit medical history:",u),(F=(g=u.response)==null?void 0:g.data)!=null&&F.errors){const p=Object.values(u.response.data.errors).flat().join(`
`);P(p)}else P(((b=(Z=u.response)==null?void 0:Z.data)==null?void 0:b.message)||"Failed to submit medical history. Please try again.")}finally{C(!1)}};return $?e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050},children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",style:{margin:"1rem auto",maxHeight:"calc(100vh - 2rem)"},children:e.jsx("div",{className:"modal-content",children:e.jsxs("div",{className:"modal-body text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"mt-3",children:"Loading medical history form..."})]})})})}):e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",style:{margin:"1rem auto",maxHeight:"calc(100vh - 2rem)"},children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"calc(100vh - 2rem)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-file-medical me-2"}),"Dental and Medical History Form"]}),e.jsx("button",{className:"btn-close",onClick:S,disabled:h})]}),e.jsxs("form",{onSubmit:se,style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"modal-body",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[R&&e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"Previous medical history found."})," Please review and update all information if the patient has visited other clinics or if there have been any changes.",A&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{children:["Last completed: ",new Date(A).toLocaleDateString()]})})]}),O&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),O]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person me-2"}),"Patient Information"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Full Name *"}),e.jsx("input",{type:"text",className:"form-control",value:i.full_name||"",onChange:t=>v("full_name",t.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-3 mb-3",children:[e.jsx("label",{className:"form-label",children:"Age"}),e.jsx("input",{type:"number",className:"form-control",value:i.age||"",onChange:t=>v("age",t.target.value),min:"0",max:"150"})]}),e.jsxs("div",{className:"col-md-3 mb-3",children:[e.jsx("label",{className:"form-label",children:"Sex"}),e.jsxs("select",{className:"form-select",value:i.sex||"",onChange:t=>v("sex",t.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("input",{type:"text",className:"form-control",value:i.address||"",onChange:t=>v("address",t.target.value)})]}),e.jsxs("div",{className:"col-md-3 mb-3",children:[e.jsx("label",{className:"form-label",children:"Contact Number"}),e.jsx("input",{type:"text",className:"form-control",value:i.contact_number||"",onChange:t=>v("contact_number",t.target.value)})]}),e.jsxs("div",{className:"col-md-3 mb-3",children:[e.jsx("label",{className:"form-label",children:"Date of Birth"}),e.jsx("input",{type:"date",className:"form-control",value:i.date_of_birth||"",onChange:t=>v("date_of_birth",t.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Occupation"}),e.jsx("input",{type:"text",className:"form-control",value:i.occupation||"",onChange:t=>v("occupation",t.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:"form-control",value:i.email||"",onChange:t=>v("email",t.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Previous Dentist"}),e.jsx("input",{type:"text",className:"form-control",value:i.previous_dentist||"",onChange:t=>v("previous_dentist",t.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Dental Visit"}),e.jsx("input",{type:"date",className:"form-control",value:i.last_dental_visit||"",onChange:t=>v("last_dental_visit",t.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Physician Name"}),e.jsx("input",{type:"text",className:"form-control",value:i.physician_name||"",onChange:t=>v("physician_name",t.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Physician Address"}),e.jsx("input",{type:"text",className:"form-control",value:i.physician_address||"",onChange:t=>v("physician_address",t.target.value)})]})]})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-heart-pulse me-2"}),"Health Questions"]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.in_good_health||!1,onChange:t=>f("in_good_health",t.target.checked)}),"Are you in good health?"]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.under_medical_treatment||!1,onChange:t=>f("under_medical_treatment",t.target.checked)}),"Are you under medical treatment now?"]}),i.under_medical_treatment&&e.jsx("textarea",{className:"form-control mt-2",rows:"2",placeholder:"Please provide details...",value:i.medical_treatment_details||"",onChange:t=>v("medical_treatment_details",t.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.serious_illness_surgery||!1,onChange:t=>f("serious_illness_surgery",t.target.checked)}),"Have you had any serious illness or operation?"]}),i.serious_illness_surgery&&e.jsx("textarea",{className:"form-control mt-2",rows:"2",placeholder:"Please provide details...",value:i.illness_surgery_details||"",onChange:t=>v("illness_surgery_details",t.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.hospitalized||!1,onChange:t=>f("hospitalized",t.target.checked)}),"Have you been hospitalized in the past 2 years?"]}),i.hospitalized&&e.jsx("textarea",{className:"form-control mt-2",rows:"2",placeholder:"Please provide details...",value:i.hospitalization_details||"",onChange:t=>v("hospitalization_details",t.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.taking_medications||!1,onChange:t=>f("taking_medications",t.target.checked)}),"Are you taking any medications?"]}),i.taking_medications&&e.jsx("textarea",{className:"form-control mt-2",rows:"2",placeholder:"Please list all medications...",value:i.medications_list||"",onChange:t=>v("medications_list",t.target.value)})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.uses_tobacco||!1,onChange:t=>f("uses_tobacco",t.target.checked)}),"Do you use tobacco?"]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.uses_alcohol_drugs||!1,onChange:t=>f("uses_alcohol_drugs",t.target.checked)}),"Do you use alcohol or drugs?"]})})]})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-danger text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Allergies"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_local_anesthetic||!1,onChange:t=>f("allergic_local_anesthetic",t.target.checked)}),"Local Anesthetic"]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_penicillin||!1,onChange:t=>f("allergic_penicillin",t.target.checked)}),"Penicillin"]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_sulfa||!1,onChange:t=>f("allergic_sulfa",t.target.checked)}),"Sulfa Drugs"]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_aspirin||!1,onChange:t=>f("allergic_aspirin",t.target.checked)}),"Aspirin"]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_latex||!1,onChange:t=>f("allergic_latex",t.target.checked)}),"Latex"]})}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Other Allergies"}),e.jsx("textarea",{className:"form-control",rows:"2",placeholder:"Please specify...",value:i.allergic_others||"",onChange:t=>v("allergic_others",t.target.value)})]})]})})]}),i.sex==="female"&&e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-info text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-gender-female me-2"}),"For Women Only"]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.is_pregnant||!1,onChange:t=>f("is_pregnant",t.target.checked)}),"Are you pregnant?"]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.is_nursing||!1,onChange:t=>f("is_nursing",t.target.checked)}),"Are you nursing?"]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.taking_birth_control||!1,onChange:t=>f("taking_birth_control",t.target.checked)}),"Are you taking birth control pills?"]})})]})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-success text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-clipboard-pulse me-2"}),"Vital Information"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("label",{className:"form-label",children:"Blood Type"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"e.g., O+, A-, etc.",value:i.blood_type||"",onChange:t=>v("blood_type",t.target.value)})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("label",{className:"form-label",children:"Blood Pressure"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"e.g., 120/80",value:i.blood_pressure||"",onChange:t=>v("blood_pressure",t.target.value)})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("label",{className:"form-label",children:"Bleeding Time"}),e.jsx("input",{type:"text",className:"form-control",value:i.bleeding_time||"",onChange:t=>v("bleeding_time",t.target.value)})]})]})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-warning text-dark",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-clipboard2-pulse me-2"}),"Medical Conditions"]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"row",children:["high_blood_pressure","low_blood_pressure","heart_disease","heart_murmur","chest_pain","stroke","diabetes","hepatitis","tuberculosis","kidney_disease","cancer","asthma","anemia","arthritis","epilepsy","aids_hiv","stomach_troubles","thyroid_problems","hay_fever","head_injuries","rapid_weight_loss","joint_replacement","radiation_therapy","swollen_ankles"].map(t=>e.jsx("div",{className:"col-md-6 mb-2",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i[t]||!1,onChange:g=>f(t,g.target.checked)}),t.split("_").map(g=>g.charAt(0).toUpperCase()+g.slice(1)).join(" ")]})},t))}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Other Conditions"}),e.jsx("textarea",{className:"form-control",rows:"3",placeholder:"Please specify any other medical conditions...",value:i.other_conditions||"",onChange:t=>v("other_conditions",t.target.value)})]})]})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:S,disabled:h,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Submit Medical History"]})})]})]})]})})})}function as({show:o,onClose:S}){const[D,i]=n.useState(!1),[_,$]=n.useState(null);n.useEffect(()=>{o&&T()},[o]);const T=async()=>{i(!0);try{const h=await k.get("/api/staff/today-time-blocks");$(h.data)}catch(h){console.error("Failed to fetch time blocks:",h),alert("Failed to load time blocks")}finally{i(!1)}};return o?e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-primary text-white",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Today's Appointment Schedule"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:S})]}),e.jsx("div",{className:"modal-body",children:D?e.jsx("div",{className:"text-center py-5",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):_!=null&&_.is_open?e.jsxs("div",{children:[e.jsxs("div",{className:"alert alert-info mb-4",children:[e.jsx("strong",{children:"Clinic Hours:"})," ",_.open_time," - ",_.close_time," |",e.jsx("strong",{className:"ms-3",children:"Capacity:"})," ",_.capacity," per slot"]}),e.jsx("div",{className:"time-block-container",children:_.blocks.map(h=>e.jsxs("div",{className:`card mb-3 ${h.count>0?"border-primary":"border-secondary"}`,children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-clock me-2"}),h.time]}),e.jsxs("span",{className:`badge ${h.count>0?"bg-primary":"bg-secondary"}`,children:[h.count," appointment",h.count!==1?"s":""]})]}),h.count>0&&e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"list-group list-group-flush",children:h.appointments.map(C=>e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:C.patient_name}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-bandaid me-1"}),C.service_name]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-tag me-1"}),"Ref: ",C.reference_code]})]}),e.jsx("span",{className:`badge ${C.status==="completed"?"bg-success":"bg-info"}`,children:C.status})]})},C.id))})})]},h.time))})]}):e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Clinic is closed today"]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:S,children:"Close"}),e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:T,disabled:D,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh"]})]})]})})}):null}function ms(){const[o,S]=n.useState([]),[D,i]=n.useState(!1),[_,$]=n.useState(!1),[T,h]=n.useState("walkin"),[C,O]=n.useState(""),[P,R]=n.useState(null),[V,A]=n.useState(!1),[w,B]=n.useState(""),[v,f]=n.useState(!1),[se,t]=n.useState(null),[g,F]=n.useState(""),[Z,b]=n.useState(!1),[u,p]=n.useState(null),[x,M]=n.useState({first_name:"",last_name:"",contact:"",service_id:""}),[Q,H]=n.useState([]),[K,z]=n.useState(!1),[Y,ce]=n.useState(""),[E,L]=n.useState([]),[G,ie]=n.useState(null),[de,be]=n.useState(!1),[me,ae]=n.useState(null),[he,te]=n.useState(null),[pe,U]=n.useState(null),[re,X]=n.useState(null),[je,fe]=n.useState([]),[ge,ne]=n.useState(!1),[Ne,l]=n.useState(!1),[j,m]=n.useState(!1),[y,le]=n.useState(null),[I,Se]=n.useState(!1),[c,W]=n.useState({patient_id:"",first_name:"",last_name:"",contact_number:"",email:"",birthdate:"",service_id:"",date:"",start_time:"",payment_method:"cash",patient_hmo_id:"",teeth_count:"",linkToExisting:!1}),[Ce,oe]=n.useState([]),[Ee,Pe]=n.useState(!1),[Me,Ae]=n.useState(!1),[q,ke]=n.useState(null),[xe,ve]=n.useState([]),[$e,Fe]=n.useState(!1),ye=n.useCallback(s=>{if(s==null||s==="")return"";const a=Number(s);return Number.isFinite(a)?new Intl.NumberFormat("en-PH",{minimumFractionDigits:2,maximumFractionDigits:2}).format(a):""},[]),ue=n.useMemo(()=>{if(!q)return null;const s=q.price??q.promo_price;if(s==null||s==="")return null;const a=Number(s);return Number.isFinite(a)?a:null},[q]),we=n.useMemo(()=>{if(ue===null)return null;const s=parseInt(c.teeth_count??"",10);return!Number.isFinite(s)||s<=0?null:ue*s},[ue,c.teeth_count]);n.useEffect(()=>{J()},[]),n.useEffect(()=>{console.log("🔄 Visits state updated:",o),console.log("📊 Visit counts:",{total:o.length,pending:o.filter(s=>s.status==="pending").length,completed:o.filter(s=>s.status==="completed").length,rejected:o.filter(s=>s.status==="rejected").length})},[o]);const J=async()=>{i(!0);try{console.log("🌐 Fetching visits from API...");const s=await k.get("/api/visits");console.log("📥 API response received:",s.data),console.log("📈 Number of visits received:",s.data.length),console.log("⏳ Visits with pending status:",s.data.filter(a=>a.status==="pending")),console.log("🔍 Visit IDs:",s.data.map(a=>{var d,r;return{id:a.id,status:a.status,patient:((d=a.patient)==null?void 0:d.first_name)+" "+((r=a.patient)==null?void 0:r.last_name)}})),S(s.data)}catch(s){console.error("❌ Failed to load visits",s)}finally{i(!1)}},He=async()=>{var s,a;$(!0);try{let d;if(T==="walkin")d={visit_type:"walkin"};else if(T==="appointment"){if(!P){alert("Search and select a valid appointment first."),$(!1);return}d={visit_type:"appointment",reference_code:(C||"").toUpperCase().replace(/[^A-Z0-9]/g,"")}}console.log("🚀 Creating visit with payload:",d);const r=await k.post("/api/visits",d),N=r.data.visit||r.data;console.log("✅ Visit created successfully:",N),console.log("📋 Visit details:",{id:N.id,status:N.status,visit_code:N.visit_code,patient_id:N.patient_id,patient_name:((s=N.patient)==null?void 0:s.first_name)+" "+((a=N.patient)==null?void 0:a.last_name),start_time:N.start_time}),r.data.requires_medical_history?alert("Visit created. Please complete the medical history form before sending the visit code to the dentist."):N.visit_code&&alert(`Visit started successfully!

Visit Code: ${N.visit_code}

Share this code with the dentist to begin consultation.`),console.log("➕ Adding new visit to state:",N),S(ee=>{const _e=[N,...ee];return console.log("🔄 Updated visits state with new visit:",_e),console.log("🎯 New visit should now be visible in the list"),_e}),O(""),R(null),console.log("🔄 Fetching visits after creation to ensure consistency..."),await new Promise(ee=>setTimeout(ee,200)),await J(),console.log("✅ Visit creation process completed")}catch(d){console.error("Error creating visit:",d),alert("Failed to start visit.")}finally{$(!1)}},Le=async(s,a)=>{{const d=o.find(r=>r.id===s);if(!d.service_id){alert("Please select a service for this patient before finishing the visit. Use the 'Edit' button to assign a service.");return}ae(d);return}},Re=async()=>{await J()},qe=async s=>{var a,d;U(s);try{const r=await k.post(`/api/receipts/visit/${s}/email`,{},{skip401Handler:!0});r.data.note?alert(`${r.data.message}

${r.data.note}`):alert(`Receipt sent successfully to ${r.data.email}`)}catch(r){console.error("Failed to send receipt email",r);const N=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to send receipt email. Please try again.";alert(N)}finally{U(null)}},Oe=async()=>{A(!0),R(null),B("");try{const s=(C||"").toUpperCase().replace(/[^A-Z0-9]/g,"");if(s.length!==8){B("Enter the full 8-character code.");return}const a=await k.get(`/api/appointment/resolve/${s}`);R(a.data)}catch{B("Invalid or used reference code.")}finally{A(!1)}},Be=async s=>{var a,d,r;p(s),M({first_name:((a=s.patient)==null?void 0:a.first_name)||"",last_name:((d=s.patient)==null?void 0:d.last_name)||"",contact:((r=s.patient)==null?void 0:r.contact)||"",service_id:s.service_id||""});try{const N=new Date().toISOString().slice(0,10),ee=await k.get(`/api/appointment/available-services?date=${N}`);H(Array.isArray(ee.data)?ee.data:ee.data.data||[])}catch{alert("Failed to load services.")}},ze=async()=>{var s;try{const a=await k.put(`/api/visits/${u.id}/update-patient`,{first_name:x.first_name,last_name:x.last_name,contact_number:x.contact.trim()!==""?x.contact.trim():(s=u.patient)==null?void 0:s.contact_number,service_id:x.service_id||null});if(a.data.potential_matches&&a.data.potential_matches.length>0)fe(a.data.potential_matches),ne(!0);else{const d=u;if(p(null),await J(),!d.appointment_id&&x.service_id)try{const r=await k.get(`/api/visits/${d.id}`);r.data.medical_history_status==="pending"&&(le(r.data),m(!0))}catch(r){console.error("Failed to fetch updated visit for medical history:",r)}}}catch{alert("Failed to update patient.")}},Ye=s=>{le(s),m(!0)},We=async s=>{await J(),m(!1),le(null)},Ue=async()=>{W({patient_id:"",first_name:"",last_name:"",contact_number:"",email:"",birthdate:"",service_id:"",date:"",start_time:"",payment_method:"cash",patient_hmo_id:"",teeth_count:"",linkToExisting:!1}),ke(null),oe([]),ve([]),H([]),l(!0)},Qe=async s=>{if(W(a=>({...a,date:s,start_time:"",service_id:""})),oe([]),ke(null),s){Fe(!0);try{const a=await k.get(`/api/dentists/available-for-date?date=${s}`);ve(a.data.dentists||[])}catch(a){console.error("Failed to load dentists for date:",a),ve([])}finally{Fe(!1)}try{const a=await k.get(`/api/appointment/available-services?date=${s}`);H(Array.isArray(a.data)?a.data:a.data.data||[])}catch(a){console.error("Failed to load services for new date:",a),H([])}}else ve([]),H([])},Xe=async s=>{const a=Q.find(d=>d.id==s);ke(a),W(d=>({...d,service_id:s,start_time:"",teeth_count:""})),oe([]),s&&c.date&&a&&!a.per_teeth_service&&await Ie(c.date,s,c.teeth_count)},De=async s=>{W(a=>({...a,teeth_count:s,start_time:""})),oe([]),c.date&&c.service_id&&s&&s>0&&await Ie(c.date,c.service_id,s)},Ie=async(s,a,d=null)=>{Pe(!0);try{const r={date:s,service_id:a};d&&(r.teeth_count=d);const N=await k.get("/api/appointment/available-slots",{params:r});oe(N.data.slots||N.data)}catch(r){console.error("Failed to fetch available slots:",r),oe([])}finally{Pe(!1)}},Te=s=>{if(!s)return null;const a=new Date(s),d=new Date,r=new Date;return r.setFullYear(d.getFullYear()-4),a>d?"Birthdate cannot be in the future.":a>r?"Patient must be at least 4 years old.":null},Ve=()=>{const s=new Date;return s.setFullYear(s.getFullYear()-4),s.toISOString().split("T")[0]},Ze=async()=>{var a,d;if(!c.service_id||!c.date||!c.start_time){alert("Please select service, date, and time.");return}if(q&&q.per_teeth_service&&!c.teeth_count){alert("Please enter the number of teeth for this per-teeth service.");return}const s=Te(c.birthdate);if(s){alert(s);return}if(!c.linkToExisting&&(!c.first_name||!c.last_name||!c.contact_number)){alert("Please fill in patient details including contact number (required for SMS reminders) or link to existing patient.");return}if(c.linkToExisting&&!c.patient_id){alert("Please select an existing patient.");return}Ae(!0);try{const r={service_id:c.service_id,date:c.date,start_time:c.start_time,payment_method:c.payment_method};c.linkToExisting?r.patient_id=c.patient_id:(r.first_name=c.first_name,r.last_name=c.last_name,r.contact_number=c.contact_number,c.email&&(r.email=c.email),c.birthdate&&(r.birthdate=c.birthdate)),c.payment_method==="hmo"&&c.patient_hmo_id&&(r.patient_hmo_id=c.patient_hmo_id),c.teeth_count&&(r.teeth_count=parseInt(c.teeth_count));const N=await k.post("/api/appointments/staff-create",r);alert(`Appointment created successfully!
Reference Code: ${N.data.appointment.reference_code}`),l(!1)}catch(r){const N=((d=(a=r.response)==null?void 0:a.data)==null?void 0:d.message)||"Failed to create appointment.";alert(N)}finally{Ae(!1)}};return e.jsxs("div",{className:"h-100 d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h3",{children:"📝 Patient Visit Tracker"}),e.jsxs("button",{className:"btn btn-outline-primary",onClick:()=>Se(!0),children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"View Today's Schedule"]})]}),e.jsxs("div",{className:"card p-3 mb-4",children:[e.jsx("label",{children:"Visit Type"}),e.jsxs("select",{className:"form-select mb-2",value:T,onChange:s=>{h(s.target.value),R(null),O(""),B("")},children:[e.jsx("option",{value:"walkin",children:"Walk-in"}),e.jsx("option",{value:"appointment",children:"Appointment"})]}),T==="appointment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Enter Appointment Reference Code",value:C,onChange:s=>O(s.target.value.toUpperCase())}),e.jsx("button",{className:"btn btn-outline-primary",onClick:Oe,disabled:V||!C,children:V?"Searching...":"Search"})]}),w&&e.jsx("div",{className:"text-danger",children:w}),P&&e.jsxs("div",{className:"alert alert-success",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:P.patient_name})," —"," ",P.service_name," @ ",P.date," /"," ",P.time_slot]}),P.last_visit&&e.jsxs("div",{className:"mt-2 p-2 bg-light rounded",children:[e.jsx("small",{className:"text-muted",children:"📋 Last Visit:"}),e.jsxs("div",{className:"small",children:[e.jsx("strong",{children:"Date:"})," ",new Date(P.last_visit.visit_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})," |"," ",e.jsx("strong",{children:"Service:"})," ",P.last_visit.service_name||"N/A",P.last_visit.teeth_treated&&e.jsxs(e.Fragment,{children:[" | ",e.jsx("strong",{children:"Teeth Treated:"})," ",P.last_visit.teeth_treated]})]})]}),!P.last_visit&&e.jsx("div",{className:"mt-2 p-2 bg-light rounded",children:e.jsx("small",{className:"text-muted",children:"📋 No previous visits found"})})]})]}),e.jsxs("div",{className:"d-flex gap-2 mt-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:He,disabled:_,children:_?"Saving...":"Start Visit"}),e.jsx("button",{className:"btn btn-success",onClick:Ue,children:"📅 Make Appointment"})]})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:["Ongoing Visits (",o.length," total, ",o.filter(s=>s.status==="pending").length," pending)"]}),D&&e.jsxs("div",{className:"d-flex align-items-center text-muted ms-3",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("small",{children:"Loading visits..."})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:J,children:"🔄 Refresh"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>be(s=>!s),children:de?"🔽 Hide Completed/Rejected":"🔼 Show All Today's Visits"})]})]}),e.jsx("div",{className:"table-responsive flex-grow-1",children:e.jsxs("table",{className:"table table-bordered table-hover mb-0",children:[e.jsx("thead",{className:"table-light sticky-top",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Visit Code"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Note"}),e.jsx("th",{children:"Started At"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Medical History"}),e.jsx("th",{style:{minWidth:"200px"},children:"Actions"})]})}),e.jsx("tbody",{children:(()=>{const s=o.filter(a=>de||a.status==="pending");return console.log("All visits:",o),console.log("Show all visits:",de),console.log("Filtered visits:",s),s})().map(s=>{var a,d,r;return console.log("Rendering visit:",s.id,"Patient:",s.patient),e.jsxs("tr",{children:[e.jsxs("td",{children:[(a=s.patient)==null?void 0:a.first_name," ",(d=s.patient)==null?void 0:d.last_name]}),e.jsx("td",{children:((r=s.patient)==null?void 0:r.contact_number)||"—"}),e.jsx("td",{children:s.visit_code?e.jsx("span",{className:"badge bg-primary",children:s.visit_code}):"—"}),e.jsx("td",{children:s.service?e.jsx("span",{className:"badge bg-info",children:s.service.name}):e.jsxs("span",{className:"badge bg-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"No Service"]})}),e.jsx("td",{children:s.status==="completed"&&s.visit_notes?e.jsx("button",{className:"btn btn-sm btn-outline-info",onClick:()=>te(s),children:"🔒 View Notes"}):"—"}),e.jsx("td",{children:s.start_time?new Date(s.start_time).toLocaleString("en-PH",{dateStyle:"medium",timeStyle:"short"}):"—"}),e.jsx("td",{children:s.status}),e.jsx("td",{children:s.medical_history_status==="completed"?e.jsxs("span",{className:"badge bg-success",children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),"Completed"]}):e.jsxs("span",{className:"badge bg-warning text-dark",children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Pending"]})}),e.jsxs("td",{children:[s.status==="pending"&&e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx("button",{className:"btn btn-warning btn-sm",onClick:()=>Be(s),children:"Edit"}),e.jsxs("button",{className:`btn btn-sm ${s.medical_history_status==="completed"?"btn-success":"btn-info"}`,onClick:()=>Ye(s),title:s.medical_history_status==="completed"?"View/Edit Medical History":"Complete Medical History",children:[e.jsx("i",{className:`bi ${s.medical_history_status==="completed"?"bi-check-circle":"bi-file-medical"} me-1`}),"Medical History"]}),s.visit_code?e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>X(s),disabled:s.medical_history_status==="pending",title:s.medical_history_status==="pending"?"Complete medical history first":"Send visit code to dentist",children:[e.jsx("i",{className:"bi bi-send me-1"}),"Send Visit Code to Dentist"]}):e.jsxs("span",{className:"badge bg-warning text-dark",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"Medical History Required"]}),e.jsx("button",{className:`btn btn-sm ${s.service_id?"btn-success":"btn-outline-secondary"}`,onClick:()=>Le(s.id),disabled:!s.service_id,title:s.service_id?"Complete this visit":"Please select a service first",children:s.service_id?"Finish":e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"Finish"]})}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>{t(s.id),F(""),b(!1),f(!0)},children:"Reject"})]}),s.status==="completed"&&e.jsx("div",{className:"d-flex gap-1 flex-wrap",children:e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>qe(s.id),disabled:pe===s.id,title:"Send Receipt Email",children:pe===s.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-envelope me-1"}),"Send Receipt"]})})})]})]},s.id)})})]})})]}),v&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:g==="inquiry_only"?"Mark as Inquiry":"Reject Visit"}),e.jsx("button",{className:"btn-close",onClick:()=>f(!1)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("label",{className:"form-label",children:g==="inquiry_only"?"Reason for inquiry:":"Reason for rejection:"}),e.jsxs("select",{className:"form-select",value:g,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"",children:"Select reason"}),e.jsx("option",{value:"human_error",children:"Human Error"}),e.jsx("option",{value:"left",children:"Patient Left"}),e.jsx("option",{value:"line_too_long",children:"Line Too Long"}),e.jsx("option",{value:"inquiry_only",children:"Inquiry Only"})]}),g==="line_too_long"&&e.jsxs("div",{className:"form-check mt-2",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",checked:Z,onChange:s=>b(s.target.checked),id:"offerAppt"}),e.jsx("label",{htmlFor:"offerAppt",className:"form-check-label",children:"Patient was offered an appointment"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-danger",disabled:!g,onClick:async()=>{await k.post(`/api/visits/${se}/reject`,{reason:g,offered_appointment:Z}),f(!1),t(null),await J()},children:g==="inquiry_only"?"Mark as Inquiry":"Confirm Reject"})]})]})})}),u&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Edit Patient Info"}),e.jsx("button",{className:"btn-close",onClick:()=>p(null)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("label",{className:"form-label",children:"First Name"}),e.jsx("input",{className:"form-control mb-2",value:x.first_name,onChange:s=>M({...x,first_name:s.target.value})}),e.jsx("label",{className:"form-label",children:"Last Name"}),e.jsx("input",{className:"form-control mb-2",value:x.last_name,onChange:s=>M({...x,last_name:s.target.value})}),e.jsx("label",{className:"form-label",children:"Contact"}),e.jsx("input",{className:"form-control mb-2",value:x.contact,onChange:s=>M({...x,contact:s.target.value})}),e.jsx("label",{className:"form-label",children:"Service"}),e.jsxs("select",{className:"form-select",value:x.service_id,onChange:s=>M({...x,service_id:s.target.value}),children:[e.jsx("option",{value:"",children:"— Select —"}),Q.map(s=>e.jsxs("option",{value:s.id,children:[s.name," –"," ",s.type==="promo"?`₱${Number(s.promo_price).toLocaleString()} (${s.discount_percent}% off)`:s.type==="special"?`₱${Number(s.price).toLocaleString()} Special Service`:`₱${Number(s.price).toLocaleString()}`]},s.id))]}),e.jsx("hr",{}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{z(!0),ce(""),L([]),ie(null)},children:"🔗 Link to Existing Patient"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>p(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:ze,children:"Save"})]})]})})}),K&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Link to Existing Patient"}),e.jsx("button",{className:"btn-close",onClick:()=>z(!1)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("input",{className:"form-control mb-2",placeholder:"Search by name or contact (min 2 characters)",value:Y,onChange:async s=>{const a=s.target.value;if(ce(a),L([]),ie(null),a.length>=2)try{const d=await k.get("/api/patients/search",{params:{q:a.trim()}});L(d.data)}catch{alert("Search failed.")}}}),E.filter(s=>{var a;return s.id!==((a=u==null?void 0:u.patient)==null?void 0:a.id)}).length>0?e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Birthdate"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:E.filter(s=>{var a;return s.id!==((a=u==null?void 0:u.patient)==null?void 0:a.id)}).map(s=>e.jsxs("tr",{children:[e.jsxs("td",{children:[s.first_name," ",s.last_name]}),e.jsx("td",{children:s.contact_number||"—"}),e.jsx("td",{children:s.birthdate?new Date(s.birthdate).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):"—"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>ie(s),children:"Select"})})]},s.id))})]}):e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Birthdate"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-muted text-center",children:"No matching patients found."})})})]}),G&&e.jsxs("div",{className:"alert alert-info mt-3",children:["Link current visit to"," ",e.jsxs("strong",{children:[G.first_name," ",G.last_name]}),"?"]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>z(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",disabled:!G,onClick:async()=>{try{const s={target_patient_id:G.id};x.service_id&&(s.service_id=x.service_id),await k.post(`/api/visits/${u.id}/link-existing`,s),z(!1),p(null),await J()}catch{alert("Failed to link to patient.")}},children:"Confirm Link"})]})]})})}),ge&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-warning",children:[e.jsx("h5",{className:"modal-title",children:"⚠️ Potential Duplicate Patient Found"}),e.jsx("button",{className:"btn-close",onClick:()=>{ne(!1),p(null)}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"Warning:"})," We found existing patient(s) with the same name. This might be a duplicate entry. Please review and link if this is the same patient."]}),e.jsx("h6",{children:"Matching Patients:"}),je.map(s=>e.jsx("div",{className:"card mb-2 p-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[s.first_name," ",s.last_name]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["Contact: ",s.contact_number||"N/A",e.jsx("br",{}),"Birthdate: ",s.birthdate?new Date(s.birthdate).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):"N/A",e.jsx("br",{}),s.has_user_account&&e.jsxs("span",{className:"badge bg-success",children:["Has Online Account (",s.user_email,")"]})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(window.confirm(`Link this visit to ${s.first_name} ${s.last_name}?`))try{const a={target_patient_id:s.id};x.service_id&&(a.service_id=x.service_id),await k.post(`/api/visits/${u.id}/link-existing`,a),ne(!1),p(null),await J(),alert("Visit successfully linked to existing patient!")}catch{alert("Failed to link visit to patient.")}},children:"Link to This Patient"})]})},s.id)),e.jsx("hr",{}),e.jsx("p",{className:"text-muted",children:e.jsx("small",{children:"If none of these patients match, you can close this dialog and the walk-in patient record will remain separate."})})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:()=>{ne(!1),p(null)},children:"Keep as Separate Patient"})})]})})}),me&&e.jsx(Ke,{visit:me,onClose:()=>ae(null),onComplete:Re}),he&&e.jsx(Ge,{visit:he,onClose:()=>te(null)}),re&&e.jsx(Je,{visit:re,onClose:()=>X(null),onSuccess:s=>{console.log(`Visit code sent to Dr. ${s.dentist_name||s.dentist_code}`)}}),j&&y&&e.jsx(ss,{visit:y,onClose:()=>{m(!1),le(null)},onSuccess:We}),Ne&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"📅 Create Appointment for Walk-in Patient"}),e.jsx("button",{className:"btn-close",onClick:()=>l(!1)})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Patient Information"}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"linkToExisting",checked:c.linkToExisting,onChange:s=>W(a=>({...a,linkToExisting:s.target.checked,patient_id:s.target.checked?a.patient_id:"",first_name:s.target.checked?"":a.first_name,last_name:s.target.checked?"":a.last_name,contact_number:s.target.checked?"":a.contact_number,email:s.target.checked?"":a.email,birthdate:s.target.checked?"":a.birthdate}))}),e.jsx("label",{className:"form-check-label",htmlFor:"linkToExisting",children:"Link to existing patient"})]}),c.linkToExisting?e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Search Existing Patient"}),e.jsx("input",{className:"form-control",placeholder:"Search by name or contact (min 2 characters)",value:Y,onChange:async s=>{const a=s.target.value;if(ce(a),L([]),ie(null),a.length>=2)try{const d=await k.get("/api/patients/search",{params:{q:a.trim()}});L(d.data)}catch{alert("Search failed.")}}}),E.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Select a patient:"}),E.map(s=>e.jsx("div",{className:"card p-2 mb-1 cursor-pointer",onClick:()=>{W(a=>({...a,patient_id:s.id})),ie(s)},style:{cursor:"pointer",backgroundColor:c.patient_id===s.id?"#e3f2fd":"white"},children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[s.first_name," ",s.last_name]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["Contact: ",s.contact_number||"N/A"," | Birthdate: ",s.birthdate?new Date(s.birthdate).toLocaleDateString():"N/A"]})]}),c.patient_id===s.id&&e.jsx("span",{className:"badge bg-primary",children:"Selected"})]})},s.id))]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"First Name *"}),e.jsx("input",{className:"form-control",value:c.first_name,onChange:s=>W(a=>({...a,first_name:s.target.value}))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Name *"}),e.jsx("input",{className:"form-control",value:c.last_name,onChange:s=>W(a=>({...a,last_name:s.target.value}))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Contact Number *"}),e.jsx("input",{className:"form-control",value:c.contact_number,onChange:s=>W(a=>({...a,contact_number:s.target.value})),placeholder:"Required for SMS reminders"}),e.jsxs("div",{className:"form-text",children:[e.jsx("i",{className:"bi bi-phone me-1"}),"Required for SMS appointment reminders"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Email (Optional)"}),e.jsx("input",{type:"email",className:"form-control",value:c.email,onChange:s=>W(a=>({...a,email:s.target.value}))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Birthdate (Optional)"}),e.jsx("input",{type:"date",className:"form-control",value:c.birthdate,onChange:s=>{const a=s.target.value;W(r=>({...r,birthdate:a}));const d=Te(a);d&&alert(d)},max:Ve()}),e.jsxs("div",{className:"form-text",children:["Must be at least 4 years old (dates after ",Ve()," are not selectable)."]})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Appointment Details"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Date *"}),e.jsx("input",{type:"date",className:"form-control",value:c.date,onChange:s=>Qe(s.target.value),min:new Date().toISOString().slice(0,10),max:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,10),placeholder:"Select a date"}),e.jsxs("div",{className:"form-text",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),c.date?"You can only select dates up to 7 days from today":"Please select a date first to see available dentists and services"]})]}),c.date&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Available Dentists"}),$e?e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-hourglass-split me-1"}),"Loading available dentists..."]}):xe.length>0?e.jsxs("div",{className:"alert alert-info border-0 shadow-sm",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("i",{className:"bi bi-person-check me-2"}),e.jsxs("strong",{children:[xe.length," dentist",xe.length!==1?"s":""," available"]})]}),e.jsx("span",{className:"badge bg-primary",children:xe.length})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Available dentists:"}),e.jsx("div",{className:"mt-1",children:xe.map((s,a)=>e.jsxs("span",{className:"badge bg-light text-dark me-1 mb-1",children:[s.dentist_name," (",s.dentist_code,")"]},a))})]})]}):e.jsxs("div",{className:"alert alert-warning border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No dentists available on this date"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Service *"}),e.jsxs("select",{className:"form-select",value:c.service_id,onChange:s=>Xe(s.target.value),disabled:!c.date,children:[e.jsx("option",{value:"",children:c.date?"Select a service":"Please select a date first"}),Q.map(s=>{const a=ye(s.price),d=ye(s.promo_price),r=s.discount_percent&&Number(s.discount_percent)>0?` (${s.discount_percent}% off)`:"";let N="Price unavailable";return s.type==="promo"&&d?N=`₱${d}${r}`:s.type==="special"&&a?N=`₱${a} Special Service`:a&&(N=`₱${a}`),e.jsxs("option",{value:s.id,children:[s.name,N?` – ${N}`:"",s.per_teeth_service?" per tooth":""]},s.id)})]}),!c.date&&e.jsxs("div",{className:"form-text text-muted",children:[e.jsx("i",{className:"bi bi-lock me-1"}),"Please select a date first to enable service selection"]})]}),q&&e.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",role:"alert",children:e.jsx("div",{className:"d-flex align-items-center justify-content-between flex-wrap",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service Selected:"}),e.jsx("br",{}),e.jsx("span",{className:"fs-5",children:q.name}),e.jsx("br",{}),ue!==null&&e.jsxs("span",{className:"text-info fw-semibold",children:["₱",ye(ue),q.per_teeth_service?" per tooth":""]}),q.per_teeth_service&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})})]})]})})}),q&&q.per_teeth_service&&e.jsx("div",{className:"alert alert-warning border-0 shadow-sm mb-4",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-lightbulb me-3 fs-4 text-warning"}),e.jsxs("div",{children:[e.jsxs("h6",{className:"alert-heading text-warning mb-2",children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Per-Teeth Service Information"]}),e.jsx("p",{className:"mb-2",children:"For per-teeth services, please enter the number of teeth that need treatment. This will determine:"}),e.jsxs("ul",{className:"mb-2 ps-3",children:[e.jsx("li",{children:"Appointment duration"}),e.jsx("li",{children:"Available time slots"}),e.jsx("li",{children:"Accurate cost calculation"})]})]})]})}),q&&q.per_teeth_service&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Number of Teeth to be Treated *",e.jsx("span",{className:"text-muted ms-1",children:"(Required for per-teeth services)"})]}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"number",min:"1",max:"32",className:"form-control",value:c.teeth_count,onChange:s=>{const a=s.target.value;(a===""||parseInt(a)>=1&&parseInt(a)<=32)&&De(a)},placeholder:"Select or enter number of teeth",style:{paddingRight:"60px"}}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary position-absolute top-50 end-0 translate-middle-y me-2",onClick:()=>{const s=document.getElementById("teethCountModal");s&&(new bootstrap.Modal(s).show(),setTimeout(()=>{const d=s.querySelector(".teeth-roulette"),r=s.querySelector(`[data-teeth="${c.teeth_count}"]`);if(d&&r&&c.teeth_count){const N=r.offsetTop,ee=d.clientHeight,_e=r.clientHeight;d.scrollTop=N-ee/2+_e/2}},300))},style:{height:"32px",width:"40px",padding:"0"},children:e.jsx("i",{className:"bi bi-chevron-down"})})]}),e.jsx("div",{className:"modal fade",id:"teethCountModal",tabIndex:"-1","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Select Number of Teeth"]}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal"})]}),e.jsx("div",{className:"modal-body p-0",children:e.jsx("div",{className:"teeth-roulette",style:{height:"200px",overflowY:"auto",padding:"10px",scrollBehavior:"smooth",touchAction:"pan-y",WebkitOverflowScrolling:"touch"},onScroll:s=>{s.target.scrollTop=Math.round(s.target.scrollTop/50)*50},onTouchStart:s=>{s.target.style.backgroundColor="#f8f9fa"},onTouchEnd:s=>{setTimeout(()=>{s.target.style.backgroundColor="transparent"},150)},children:Array.from({length:32},(s,a)=>a+1).map(s=>e.jsx("div",{"data-teeth":s,className:`teeth-option d-flex align-items-center justify-content-center p-3 border-bottom cursor-pointer ${c.teeth_count==s?"bg-primary text-white":"bg-light"}`,onClick:()=>{De(s.toString());const a=document.getElementById("teethCountModal");a&&bootstrap.Modal.getInstance(a).hide()},style:{minHeight:"50px",cursor:"pointer",transition:"all 0.2s ease",userSelect:"none"},onMouseEnter:a=>{c.teeth_count!=s&&(a.target.style.backgroundColor="#e9ecef")},onMouseLeave:a=>{c.teeth_count!=s&&(a.target.style.backgroundColor="#f8f9fa")},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"fs-4 fw-bold",children:s}),e.jsx("div",{className:"small",children:s===1?"tooth":"teeth"}),c.teeth_count==s&&e.jsx("div",{className:"small",children:e.jsx("i",{className:"bi bi-check-circle-fill"})})]})},s))})}),e.jsx("div",{className:"modal-footer",children:e.jsx("div",{className:"w-100 text-center",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Swipe to scroll • Tap to select • Max 32 teeth"]})})})]})})}),e.jsxs("div",{className:"form-text",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Enter the number of teeth that need treatment. Time slots will be calculated based on this.",we!==null&&e.jsxs("div",{className:"mt-1",children:[e.jsx("strong",{children:"Estimated cost:"})," ",we>0?`₱${ye(we)}`:"Add at least one tooth to display an estimate."]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Time Slot *"}),Ee?e.jsx("div",{className:"text-muted",children:"Loading available slots..."}):Ce.length>0?e.jsxs("select",{className:"form-select",value:c.start_time,onChange:s=>W(a=>({...a,start_time:s.target.value})),children:[e.jsx("option",{value:"",children:"Select time slot"}),Ce.map(s=>e.jsx("option",{value:s,children:s},s))]}):c.service_id&&c.date?e.jsx("div",{className:"text-muted",children:q&&q.per_teeth_service&&!c.teeth_count?"Please enter number of teeth first to see available time slots.":"No available slots for this service on this date."}):e.jsx("div",{className:"text-muted",children:c.date?c.service_id?"Please select service and date first.":"Please select a service first.":"Please select a date first."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Method *"}),e.jsxs("select",{className:"form-select",value:c.payment_method,onChange:s=>W(a=>({...a,payment_method:s.target.value})),disabled:!c.date||!c.service_id,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"maya",children:"Maya Payment"}),e.jsx("option",{value:"hmo",children:"HMO"})]}),(!c.date||!c.service_id)&&e.jsxs("div",{className:"form-text text-muted",children:[e.jsx("i",{className:"bi bi-lock me-1"}),"Please select date and service first to enable payment method selection"]})]}),c.payment_method==="hmo"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"HMO (Optional)"}),e.jsx("select",{className:"form-select",value:c.patient_hmo_id,onChange:s=>W(a=>({...a,patient_hmo_id:s.target.value})),children:e.jsx("option",{value:"",children:"No HMO selected"})})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>l(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:Ze,disabled:Me,children:Me?"Creating...":"Create Appointment"})]})]})})}),e.jsx(as,{show:I,onClose:()=>Se(!1)})]})}export{ms as default};
