const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/StaffAppointmentManager-tQSv9cXv.js","assets/react-vendor-D3yaKSZ_.js","assets/chart-vendor-BsnJAHr2.js","assets/bootstrap-vendor-CM53U_Of.js","assets/bootstrap-vendor-BJ1jyr7P.css","assets/vendor-axios-ngrFHoWO.js","assets/pdf-vendor-BZobkf7J.js","assets/vendor-utils-DLELI0UM.js","assets/excel-vendor-6kUf8nhb.js","assets/AppointmentFinder-BO-cDC1V.js","assets/DentistScheduleManager-uRJQXa5X.js"])))=>i.map(i=>d[i]);
import{r as t,j as e,u as Se,a as ss,L as ye,b as da,N as oa,F as ks,z as Ge,c as Ms,d as qs,e as je,O as fs,$ as ma,B as Hs,P as Ha,f as Wa,g as zs,M as vs,h as Ts,i as Js,k as Ba,R as Oa,l as ee,m as qa}from"./react-vendor-D3yaKSZ_.js";import"./bootstrap-vendor-CM53U_Of.js";import{a as ha}from"./vendor-axios-ngrFHoWO.js";import{_ as Ke}from"./pdf-vendor-BZobkf7J.js";import{i as Ua}from"./vendor-utils-DLELI0UM.js";import{E as xa}from"./excel-vendor-6kUf8nhb.js";import{m as Ss,i as ys,a as Ya,e as Ka,c as ua,r as De,v as Ga,t as Xa,d as Qa,b as Ja,A as pa,f as Us,g as Ys,C as ba,h as fa,j as ga,k as ja,p as va,l as Na,n as ya,o as Za}from"./chart-vendor-BsnJAHr2.js";(function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function a(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=a(n);fetch(n.href,o)}})();const M=ha.create({baseURL:"/",withCredentials:!0,headers:{"X-Requested-With":"XMLHttpRequest","ngrok-skip-browser-warning":"true"}});M.interceptors.request.use(s=>{const l=document.cookie.match(/XSRF-TOKEN=([^;]+)/);return l&&(s.headers["X-XSRF-TOKEN"]=decodeURIComponent(l[1])),s});M.interceptors.response.use(s=>s,s=>{var m,b,f,y;const l=(m=s.response)==null?void 0:m.status,a=((b=s.config)==null?void 0:b.url)||"";let i=a;try{i=new URL(a,window.location.origin).pathname}catch{}if((f=s.config)!=null&&f.skip401Handler||l===401&&new Set(["/api/user","/user"]).has(i)||l===403)return Promise.reject(s);const o=["/app/admin","/app/staff","/app/patient"],r=window.location.pathname,c=o.some(h=>r.startsWith(h));if(l===401&&c){(y=M.setToken)==null||y.call(M,null),window.location.href="/app/login";return}return Promise.reject(s)});M.logout=()=>M.post("/logout");const wa=t.createContext();function et({children:s}){const[l,a]=t.useState(null),[i,n]=t.useState(!0);t.useEffect(()=>{let r=!0;return M.get("/api/user",{skip401Handler:!0}).then(c=>r&&a(c.data)).catch(()=>r&&a(null)).finally(()=>r&&n(!1)),()=>{r=!1}},[]);const o=async()=>{try{await M.post("/api/logout")}catch(r){console.error("Logout error:",r)}finally{a(null)}};return e.jsx(wa.Provider,{value:{user:l,setUser:a,authLoading:i,logout:o},children:s})}function Me(){return t.useContext(wa)}const _a=t.createContext(null);function st({children:s}){const[l,a]=t.useState([]),[i,n]=t.useState(0),[o,r]=t.useState(!1),[c,m]=t.useState(""),b=t.useRef(!1),f=g=>(g||[]).map(_=>({..._,data:typeof _.data=="string"?y(_.data):_.data||null}));function y(g){try{return JSON.parse(g)}catch{return null}}const h=t.useCallback(async()=>{var g;try{const _=await M.get("/api/notifications/unread-count");n(((g=_==null?void 0:_.data)==null?void 0:g.unread)??0)}catch{}},[]),j=t.useCallback(async()=>{var g,_;if(!b.current){b.current=!0,r(!0),m("");try{const N=await M.get("/api/notifications");a(f(N.data))}catch(N){m(((_=(g=N==null?void 0:N.response)==null?void 0:g.data)==null?void 0:_.message)||"Failed to load notifications."),a([])}finally{r(!1),b.current=!1}}},[]),u=t.useCallback(async()=>{try{await M.post("/api/notifications/mark-all-read"),n(0)}catch{}},[]);t.useEffect(()=>{h();const g=setInterval(()=>{h()},12e4);return()=>clearInterval(g)},[h]);const P=t.useMemo(()=>({items:l,unread:i,loading:o,error:c,loadList:j,loadUnread:h,markAllRead:u}),[l,i,o,c,j,h,u]);return e.jsx(_a.Provider,{value:P,children:s})}function Sa(){const s=t.useContext(_a);if(!s)throw new Error("useNotifications must be used inside <NotificationsProvider>");return s}const ka=t.createContext({loading:!1,accepting:!1,error:null,policy:null,needsAcceptance:!1,acceptedPolicyId:null,acceptedAt:null,hasDismissed:!1,shouldShowModal:!1,refresh:()=>{},accept:async()=>{},dismissModal:()=>{},reopenModal:()=>{}});function at({children:s}){const{user:l,authLoading:a}=Me(),[i,n]=t.useState(!1),[o,r]=t.useState(!1),[c,m]=t.useState(null),[b,f]=t.useState(!1),[y,h]=t.useState(null),[j,u]=t.useState(null),[P,g]=t.useState(null),[_,N]=t.useState(!1),x=t.useRef(null),p=t.useCallback(()=>{f(!1),h(null),u(null),g(null),N(!1),m(null),x.current=null},[]),C=t.useCallback(async()=>{var S,d;if(!a){if(!l||(l==null?void 0:l.role)!=="patient"){p();return}n(!0),m(null);try{const{data:R}=await M.get("/api/policy/consent"),H=(R==null?void 0:R.active_policy)??null,G=(H==null?void 0:H.id)??null;x.current!==G&&(N(!1),x.current=G),h(H),f(!!(R!=null&&R.needs_acceptance)),u((R==null?void 0:R.accepted_policy_id)??null),g((R==null?void 0:R.accepted_at)??null)}catch(R){const H=((d=(S=R==null?void 0:R.response)==null?void 0:S.data)==null?void 0:d.message)||(R==null?void 0:R.message)||"Unable to load policy consent status.";m(H)}finally{n(!1)}}},[a,p,l]);t.useEffect(()=>{C()},[C]);const v=t.useCallback(async()=>{var S,d;if(!(!l||(l==null?void 0:l.role)!=="patient")){r(!0),m(null);try{await M.post("/api/policy/consent/accept"),N(!1),await C()}catch(R){const H=((d=(S=R==null?void 0:R.response)==null?void 0:S.data)==null?void 0:d.message)||(R==null?void 0:R.message)||"Failed to accept the updated policy. Please try again.";m(H)}finally{r(!1)}}},[C,l]),A=t.useCallback(()=>{N(!0)},[]),z=t.useCallback(()=>{N(!1)},[]),T=t.useMemo(()=>({loading:i,accepting:o,error:c,policy:y,needsAcceptance:b,acceptedPolicyId:j,acceptedAt:P,hasDismissed:_,shouldShowModal:!!((l==null?void 0:l.role)==="patient"&&b&&!_),refresh:C,accept:v,dismissModal:A,reopenModal:z}),[v,P,j,o,A,C,_,i,b,y,c,z,l==null?void 0:l.role]);return e.jsx(ka.Provider,{value:T,children:s})}function Ca(){return t.useContext(ka)}class tt extends t.Component{constructor(l){super(l),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(l){return{hasError:!0}}componentDidCatch(l,a){console.error("ErrorBoundary caught an error:",l,a),this.setState({error:l,errorInfo:a})}render(){return this.state.hasError?e.jsxs("div",{style:{padding:"20px",fontFamily:"Arial, sans-serif"},children:[e.jsx("h1",{children:"Something went wrong."}),e.jsxs("details",{style:{whiteSpace:"pre-wrap"},children:[this.state.error&&this.state.error.toString(),e.jsx("br",{}),this.state.errorInfo.componentStack]})]}):this.props.children}}function ze({message:s="Loading..."}){return e.jsx("div",{className:"position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark bg-opacity-50",style:{zIndex:1050},children:e.jsxs("div",{className:"bg-white p-4 rounded shadow text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status"}),e.jsx("div",{children:s})]})})}function it(){const{user:s,authLoading:l}=Me(),a=Se(),i=ss();return t.useEffect(()=>{if(l)return;const n=i.pathname||"/",o=["/","/login","/register","/forgot-password"],r=o.some(m=>n===m)||n.startsWith("/password-reset/")||n.startsWith("/verify-email")||n.startsWith("/verify-success")||n.startsWith("/pay/"),c=m=>{switch(m){case"admin":return"/admin";case"staff":return"/staff";case"patient":return"/patient";case"dentist":return"/dentist";default:return"/"}};if(s){const m=c(s.role);if(o.includes(n)){a(m,{replace:!0});return}const b={admin:["/admin"],staff:["/staff"],patient:["/patient"],dentist:["/dentist"]};for(const[f,y]of Object.entries(b))if(s.role!==f){for(const h of y)if(n.startsWith(h)){a(m,{replace:!0});return}}}!s&&!r&&n!=="/notifications"&&a("/",{replace:!0})},[s,l,i.pathname,a]),l?e.jsx(ze,{message:"Checking session..."}):null}const lt=`
  .promo-card {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 15px;
    overflow: hidden;
  }
  
  .discount-circle {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #dc3545, #c82333);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
  }
  
  .discount-text {
    color: white;
    font-size: 1.5rem;
    font-weight: bold;
    text-shadow: 0 1px 3px rgba(0,0,0,0.3);
  }
  
  .promo-highlight {
    position: relative;
  }
  
  .carousel-control-prev,
  .carousel-control-next {
    width: 50px;
    height: 50px;
    background: rgba(0, 0, 0, 0.5);
    border-radius: 50%;
    top: 50%;
    transform: translateY(-50%);
    border: none;
  }
  
  .carousel-control-prev {
    left: -25px;
  }
  
  .carousel-control-next {
    right: -25px;
  }
  
  .carousel-indicators {
    bottom: -50px;
  }
  
  .carousel-indicators button {
    background-color: #6c757d;
    border-radius: 50%;
    width: 12px;
    height: 12px;
    margin: 0 5px;
  }
  
  .carousel-indicators button.active {
    background-color: #198754;
  }
  
  .promo-card .card-body {
    position: relative;
  }
  
  .promo-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #dc3545, #ffc107, #198754);
  }
`,Es=s=>s===!0||s===1||s==="1";function Zs(){const[s,l]=t.useState([]),[a,i]=t.useState([]),[n,o]=t.useState(!0),[r,c]=t.useState(""),m=Se(),{user:b}=Me();t.useEffect(()=>{f()},[]);const f=async()=>{var x;try{o(!0);const p=await M.get("/api/public/services"),C=Array.isArray(p.data)?p.data:Array.isArray((x=p.data)==null?void 0:x.data)?p.data.data:[],v={};C.forEach(A=>{const z=Array.isArray(A==null?void 0:A.discounts)?A.discounts:[];v[A.id]=z}),l(C),i(v)}catch(p){console.error("Failed to fetch services and promos:",p),c("Failed to load services and promotions")}finally{o(!1)}},y=x=>{if(!b){m("/login",{state:{message:"Please log in to book an appointment",redirectTo:"/patient/appointment",preselectedService:x}});return}m("/patient/appointment",{state:{preselectedService:x}})},h=x=>{const p=a[x.id]||[],C=new Date().toISOString().split("T")[0],v=p.find(A=>A.status==="launched"&&A.start_date<=C&&A.end_date>=C);return v?{price:v.discounted_price,originalPrice:x.price,isPromo:!0,promoEndDate:v.end_date}:{price:x.price,originalPrice:null,isPromo:!1,promoEndDate:null}},j=x=>{const p=new Date().toISOString().split("T")[0];return x.is_special&&x.special_start_date&&x.special_end_date?x.special_start_date<=p&&x.special_end_date>=p:!(a[x.id]||[]).find(A=>A.status==="planned"&&A.start_date>p)},u=(x,p=!1)=>{const C=`â‚±${Number(x).toFixed(2)}`;return Es(p)?`${C} per tooth`:C},P=x=>new Date(x).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),g=()=>{const x=new Date().toISOString().split("T")[0],p=[];return s.forEach(C=>{const A=(a[C.id]||[]).find(z=>z.status==="launched"&&z.start_date<=x&&z.end_date>=x);A&&p.push({...A,service:C})}),p.sort((C,v)=>new Date(C.start_date)-new Date(v.start_date))},_=(x,p)=>{if(!x||!p)return 0;const C=(x-p)/x*100;return Math.round(C)},N=()=>e.jsx("div",{className:"col-lg-4 col-md-6",children:e.jsx("div",{className:"card h-100 shadow-sm border-0 service-card",children:e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("div",{className:"placeholder-glow",children:e.jsx("span",{className:"placeholder col-8 placeholder-lg"})}),e.jsx("div",{className:"placeholder-glow",children:e.jsx("span",{className:"placeholder col-3 placeholder-sm"})})]}),e.jsx("div",{className:"placeholder-glow mt-2",children:e.jsx("span",{className:"placeholder col-4 placeholder-sm"})})]}),e.jsxs("div",{className:"placeholder-glow mb-3",children:[e.jsx("span",{className:"placeholder col-12"}),e.jsx("span",{className:"placeholder col-8"})]}),e.jsxs("div",{className:"placeholder-glow mb-3",children:[e.jsx("span",{className:"placeholder col-6 placeholder-lg"}),e.jsx("div",{className:"placeholder-glow mt-1",children:e.jsx("span",{className:"placeholder col-4 placeholder-sm"})})]}),e.jsx("div",{className:"mt-auto",children:e.jsx("div",{className:"placeholder-glow",children:e.jsx("span",{className:"placeholder col-12 placeholder-lg"})})})]})})});return n?e.jsx("section",{className:"services-promos-section py-5 bg-light",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("h2",{className:"display-5 fw-bold text-primary mb-3",children:"Our Services & Promotions"}),e.jsx("p",{className:"lead text-muted",children:"Professional dental care with special offers and packages"})]}),e.jsx("div",{className:"row g-4",children:Array.from({length:6},(x,p)=>e.jsx(N,{},`skeleton-${p}`))})]})}):r?e.jsxs("div",{className:"alert alert-warning text-center",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),r]}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:lt}),e.jsx("section",{className:"services-promos-section py-5 bg-light",children:e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("h2",{className:"display-5 fw-bold text-primary mb-3",children:"Our Services & Promotions"}),e.jsx("p",{className:"lead text-muted",children:"Professional dental care with special offers and packages"})]}),g().length>0?e.jsxs("div",{className:"mb-5",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h3",{className:"h4 fw-bold text-success mb-2",children:[e.jsx("i",{className:"bi bi-percent me-2"}),"Current Promotions"]}),e.jsx("p",{className:"text-muted",children:"Limited time offers - Book now!"})]}),e.jsxs("div",{id:"promotionsCarousel",className:"carousel slide","data-bs-ride":"carousel",children:[e.jsx("div",{className:"carousel-inner",children:g().map((x,p)=>{const C=_(x.service.price,x.discounted_price),v=Es(x.service.per_teeth_service);return e.jsx("div",{className:`carousel-item ${p===0?"active":""}`,children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-lg-10",children:e.jsx("div",{className:"card border-0 shadow-lg promo-card",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-lg-8",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsxs("span",{className:"badge bg-danger fs-6 me-3",children:[e.jsx("i",{className:"bi bi-percent me-1"}),C,"% OFF"]}),e.jsxs("span",{className:"badge bg-warning text-dark",children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Limited Time"]})]}),e.jsx("h4",{className:"card-title text-primary fw-bold mb-3",children:x.service.name}),e.jsx("p",{className:"card-text text-muted mb-3",children:x.service.description||"Professional dental service with special pricing"}),e.jsxs("div",{className:"d-flex align-items-center gap-4 mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"h3 text-success fw-bold mb-0",children:u(x.discounted_price,v)}),e.jsx("span",{className:"text-decoration-line-through text-muted ms-2",children:u(x.service.price,v)})]}),e.jsx("div",{className:"text-muted",children:e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),"Valid until: ",P(x.end_date)]})})]})]}),e.jsx("div",{className:"col-lg-4 text-center",children:e.jsxs("div",{className:"promo-highlight",children:[e.jsx("div",{className:"discount-circle mx-auto mb-3",children:e.jsxs("span",{className:"discount-text",children:[C,"%"]})}),e.jsxs("button",{className:"btn btn-success btn-lg w-100",onClick:()=>y(x.service),children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book This Offer"]})]})})]})})})})})})},x.id)})}),g().length>1&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{className:"carousel-control-prev",type:"button","data-bs-target":"#promotionsCarousel","data-bs-slide":"prev",children:[e.jsx("span",{className:"carousel-control-prev-icon","aria-hidden":"true"}),e.jsx("span",{className:"visually-hidden",children:"Previous"})]}),e.jsxs("button",{className:"carousel-control-next",type:"button","data-bs-target":"#promotionsCarousel","data-bs-slide":"next",children:[e.jsx("span",{className:"carousel-control-next-icon","aria-hidden":"true"}),e.jsx("span",{className:"visually-hidden",children:"Next"})]}),e.jsx("div",{className:"carousel-indicators",children:g().map((x,p)=>e.jsx("button",{type:"button","data-bs-target":"#promotionsCarousel","data-bs-slide-to":p,className:p===0?"active":"","aria-current":p===0?"true":"false","aria-label":`Slide ${p+1}`},p))})]})]})]}):e.jsx("div",{className:"mb-5",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"card border-0 bg-light",children:e.jsxs("div",{className:"card-body py-4",children:[e.jsx("i",{className:"bi bi-calendar-x text-muted",style:{fontSize:"3rem"}}),e.jsx("h5",{className:"text-muted mt-3 mb-2",children:"No Active Promotions"}),e.jsx("p",{className:"text-muted mb-0",children:"Check back soon for special offers and discounts on our services!"})]})})})}),e.jsx("div",{className:"row g-4",children:Array.isArray(s)&&s.map(x=>{var A;const p=h(x),C=j(x),v=Es(x.per_teeth_service);return e.jsx("div",{className:"col-lg-4 col-md-6",children:e.jsx("div",{className:"card h-100 shadow-sm border-0 service-card",children:e.jsxs("div",{className:"card-body d-flex flex-column",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsx("h5",{className:"card-title fw-bold text-primary mb-2",children:x.name}),x.is_special?e.jsxs("span",{className:"badge bg-warning text-dark",children:[e.jsx("i",{className:"bi bi-star-fill me-1"}),"Special"]}):e.jsx("span",{})]}),x.category&&e.jsx("span",{className:"badge bg-secondary mb-2",children:typeof x.category=="string"?x.category:((A=x.category)==null?void 0:A.name)||""})]}),e.jsx("p",{className:"card-text text-muted flex-grow-1",children:x.description||"Professional dental service"}),e.jsx("div",{className:"mb-3",children:p.isPromo?e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"h4 text-success fw-bold mb-0",children:u(p.price,v)}),e.jsx("span",{className:"text-decoration-line-through text-muted",children:u(p.originalPrice,v)}),e.jsxs("span",{className:"badge bg-danger",children:[e.jsx("i",{className:"bi bi-percent me-1"}),"Sale"]})]}),e.jsxs("small",{className:"text-muted",children:["Promo ends: ",P(p.promoEndDate)]})]}):e.jsxs("div",{children:[e.jsx("div",{className:"h4 text-primary fw-bold mb-0",children:u(p.price,v)}),v&&e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})]})}),e.jsx("div",{className:"mt-auto",children:C?e.jsxs("button",{className:"btn btn-primary w-100",onClick:()=>y(x),children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book Now"]}):e.jsxs("div",{className:"text-center",children:[e.jsxs("button",{className:"btn btn-outline-secondary w-100",disabled:!0,children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Coming Soon"]}),x.is_special&&x.special_start_date&&x.special_end_date?e.jsxs("small",{className:"text-muted d-block mt-2",children:["Available: ",P(x.special_start_date)," - ",P(x.special_end_date)]}):e.jsx("span",{})]})})]})})},x.id)})}),e.jsx("div",{className:"text-center mt-5",children:e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-md-8",children:e.jsx("div",{className:"card bg-primary text-white",children:e.jsxs("div",{className:"card-body py-4",children:[e.jsxs("h4",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-heart-pulse me-2"}),"Ready to Book Your Appointment?"]}),e.jsx("p",{className:"card-text mb-4",children:"Choose from our professional services and take advantage of our current promotions. Book online for a convenient and seamless experience."}),e.jsxs("button",{className:"btn btn-light btn-lg",onClick:()=>y(null),children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Book Appointment Now"]})]})})})})})]})})]})}const us="/assets/logo-CRfANuD7.png";function nt(){const{user:s,authLoading:l}=Me();return l?e.jsx(ze,{message:"Checking session..."}):s&&s.role==="patient"?e.jsxs("div",{className:"container mt-5 px-3 px-md-4",children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsxs("h2",{className:"mb-3",children:["Welcome, ",s.name||"Patient"," ðŸ¦·"]}),e.jsx("p",{className:"lead",children:"Select an action below or browse our services:"}),e.jsxs("div",{className:"mb-4 d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2 flex-wrap",children:[e.jsx(ye,{to:"/patient/appointment",className:"btn btn-primary",children:"Book Appointment"}),e.jsx(ye,{to:"/patient/appointments",className:"btn btn-outline-secondary",children:"View Appointments"}),e.jsx(ye,{to:"/patient/profile",className:"btn btn-outline-info",children:"Profile"})]})]}),e.jsx(Zs,{})]}):e.jsxs("div",{className:"landing-page",children:[e.jsxs("header",{className:"site-header shadow-sm",children:[e.jsxs("div",{className:"container d-flex justify-content-between align-items-center py-2 py-md-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:us,alt:"Kreative Dental Logo",className:"site-logo me-2"}),e.jsx("span",{className:"logo-text",children:"Kreative Dental Clinic"})]}),e.jsx("button",{className:"navbar-toggler d-md-none border-0 p-2",type:"button",onClick:()=>{const a=document.getElementById("mobile-nav");a&&a.classList.toggle("show")},"aria-label":"Toggle navigation",style:{background:"transparent"},children:e.jsx("i",{className:"bi bi-list fs-4",style:{color:"var(--brand-dark)"}})}),e.jsx("nav",{className:"d-none d-md-block",children:e.jsxs("ul",{className:"nav-list d-flex gap-2 gap-lg-3 mb-0",children:[e.jsx("li",{children:e.jsx("a",{href:"#home",className:"nav-link",children:"Home"})}),e.jsx("li",{children:e.jsx("a",{href:"#services",className:"nav-link",children:"Services"})}),e.jsx("li",{children:e.jsx("a",{href:"#about",className:"nav-link",children:"About"})}),e.jsx("li",{children:e.jsx("a",{href:"#contact",className:"nav-link",children:"Contact"})})]})})]}),e.jsx("nav",{id:"mobile-nav",className:"d-md-none mobile-nav",children:e.jsxs("ul",{className:"nav-list flex-column mb-0 p-3",children:[e.jsx("li",{children:e.jsx("a",{href:"#home",className:"nav-link",onClick:()=>{var a;return(a=document.getElementById("mobile-nav"))==null?void 0:a.classList.remove("show")},children:"Home"})}),e.jsx("li",{children:e.jsx("a",{href:"#services",className:"nav-link",onClick:()=>{var a;return(a=document.getElementById("mobile-nav"))==null?void 0:a.classList.remove("show")},children:"Services"})}),e.jsx("li",{children:e.jsx("a",{href:"#about",className:"nav-link",onClick:()=>{var a;return(a=document.getElementById("mobile-nav"))==null?void 0:a.classList.remove("show")},children:"About"})}),e.jsx("li",{children:e.jsx("a",{href:"#contact",className:"nav-link",onClick:()=>{var a;return(a=document.getElementById("mobile-nav"))==null?void 0:a.classList.remove("show")},children:"Contact"})})]})})]}),e.jsx("section",{id:"home",className:"hero-section d-flex align-items-center text-white",children:e.jsxs("div",{className:"container text-center px-3 px-md-4",children:[e.jsxs("h1",{className:"hero-title mb-3 mb-md-4",children:["Your Smile, Our Passion ",e.jsx("br",{className:"d-none d-sm-inline"}),e.jsx("span",{className:"d-inline d-sm-none",children:e.jsx("br",{})}),e.jsx("span",{className:"d-block d-sm-inline",children:"Kreative Dental & Orthodontics"})]}),e.jsx("p",{className:"hero-subtitle mb-4 mb-md-5",children:"Trusted dental care for families and individuals."}),e.jsxs("div",{className:"hero-buttons mt-4 d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2 gap-md-3",children:[e.jsx(ye,{to:"/login",className:"btn btn-light btn-lg shadow w-100 w-sm-auto px-4",children:"Login"}),e.jsx(ye,{to:"/register",className:"btn btn-outline-light btn-lg w-100 w-sm-auto px-4",children:"Register"})]})]})}),e.jsx("section",{id:"services",children:e.jsx(Zs,{})}),e.jsx("section",{className:"features-section py-4 py-md-5",children:e.jsx("div",{className:"container px-3 px-md-4",children:e.jsxs("div",{className:"row text-center g-3 g-md-4",children:[e.jsx("div",{className:"col-12 col-sm-6 col-md-4 mb-2 mb-md-0",children:e.jsxs("div",{className:"feature-box p-3 p-md-4 h-100 shadow-sm rounded",children:[e.jsx("i",{className:"bi bi-shield-check fs-1 text-primary"}),e.jsx("h5",{className:"mt-3",children:"Safe & Secure"}),e.jsx("p",{className:"mb-0",children:"We ensure a sterile and hygienic environment in all treatments."})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4 mb-2 mb-md-0",children:e.jsxs("div",{className:"feature-box p-3 p-md-4 h-100 shadow-sm rounded",children:[e.jsx("i",{className:"bi bi-calendar2-check fs-1 text-success"}),e.jsx("h5",{className:"mt-3",children:"Easy Appointment"}),e.jsx("p",{className:"mb-0",children:"Book your slot online and avoid waiting queues."})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4 mb-2 mb-md-0",children:e.jsxs("div",{className:"feature-box p-3 p-md-4 h-100 shadow-sm rounded",children:[e.jsx("i",{className:"bi bi-person-heart fs-1 text-danger"}),e.jsx("h5",{className:"mt-3",children:"Caring Dentists"}),e.jsx("p",{className:"mb-0",children:"Experienced, friendly professionals to guide your oral care."})]})})]})})}),e.jsx("section",{id:"about",className:"about-section py-4 py-md-5 bg-primary",children:e.jsxs("div",{className:"container text-center px-3 px-md-4",children:[e.jsx("h2",{className:"mb-3 mb-md-4",children:"About Us"}),e.jsx("p",{className:"lead mb-0",children:"Kreative Dental Clinic is committed to providing high-quality dental care in a friendly, safe, and comfortable environment. Our team of professionals ensures that every patient receives the best oral health solutions tailored to their needs."})]})}),e.jsx("section",{id:"contact",className:"contact-section py-4 py-md-5 bg-light",children:e.jsxs("div",{className:"container text-center px-3 px-md-4",children:[e.jsx("h2",{className:"mb-3 mb-md-4 fw-bold",children:"Contact Us"}),e.jsx("p",{className:"lead text-muted mb-4 mb-md-5",children:"We'd love to hear from you! Reach out through any of the options below."}),e.jsxs("div",{className:"row justify-content-center mb-4 g-3",children:[e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsxs("div",{className:"p-3 p-md-4 bg-white shadow-sm rounded h-100",children:[e.jsx("i",{className:"bi bi-geo-alt-fill fs-2 text-danger"}),e.jsx("h5",{className:"mt-2",children:"Location"}),e.jsx("p",{className:"mb-0",children:"Cabuyao | Calamba"})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsxs("div",{className:"p-3 p-md-4 bg-white shadow-sm rounded h-100",children:[e.jsx("i",{className:"bi bi-telephone-fill fs-2 text-success"}),e.jsx("h5",{className:"mt-2",children:"Call Us"}),e.jsx("p",{className:"mb-0",children:"0927 759 2845"})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4",children:e.jsxs("div",{className:"p-3 p-md-4 bg-white shadow-sm rounded h-100",children:[e.jsx("i",{className:"bi bi-envelope-fill fs-2 text-primary"}),e.jsx("h5",{className:"mt-2",children:"Email"}),e.jsx("p",{className:"mb-0",children:"kreativedent@gmail.com"})]})})]}),e.jsx("div",{className:"row justify-content-center mt-4 mb-4",children:e.jsx("div",{className:"col-12 col-lg-10",children:e.jsx("div",{className:"map-container shadow-sm rounded overflow-hidden",children:e.jsx("iframe",{src:"https://www.google.com/maps?q=14.2540966,121.1284223&hl=en&z=14&output=embed",width:"100%",height:"450",style:{border:0},allowFullScreen:!0,loading:"lazy",referrerPolicy:"no-referrer-when-downgrade",title:"Kreative Dental Clinic Location - Cabuyao, Calamba"})})})}),e.jsxs("div",{className:"d-flex justify-content-center gap-2 gap-md-3 flex-wrap mt-4",children:[e.jsxs("a",{href:"mailto:kreativedent@gmail.com",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-envelope-fill me-2"})," Email"]}),e.jsxs("a",{href:"https://www.facebook.com/kreativedent",target:"_blank",rel:"noopener noreferrer",className:"btn btn-outline-primary",children:[e.jsx("i",{className:"bi bi-facebook me-2"})," Facebook"]}),e.jsxs("a",{href:"https://www.instagram.com/kreativedental/",target:"_blank",rel:"noopener noreferrer",className:"btn btn-outline-danger",children:[e.jsx("i",{className:"bi bi-instagram me-2"})," Instagram"]}),e.jsxs("a",{href:"https://www.tiktok.com/@kreativedental",target:"_blank",rel:"noopener noreferrer",className:"btn btn-dark",children:[e.jsx("i",{className:"bi bi-tiktok me-2"})," TikTok"]}),e.jsxs("a",{href:"https://www.google.com/maps/dir/14.2721246,121.1544842/14.2540966,121.1284223/@14.2667727,121.1189606,14z/data=!3m1!4b1!4m4!4m3!1m1!4e1!1m0?entry=ttu&g_ep=EgoyMDI1MDkyNC4wIKXMDSoASAFQAw%3D%3D",target:"_blank",rel:"noopener noreferrer",className:"btn btn-success",children:[e.jsx("i",{className:"bi bi-geo-alt-fill me-2"})," ",e.jsx("span",{className:"d-none d-sm-inline",children:"Get "}),"Directions"]})]})]})}),e.jsx("footer",{className:"text-center py-3 py-md-4 bg-primary text-white",children:e.jsx("div",{className:"container px-3 px-md-4",children:e.jsxs("p",{className:"mb-0 small",children:["Â© ",new Date().getFullYear()," Kreative Dental Clinic. All Rights Reserved."]})})})]})}function rt({onCreated:s}){const[l,a]=t.useState({name:"",sku_code:"",type:"supply",unit:"pcs",low_stock_threshold:0,default_pack_size:"",is_controlled:!1,is_sellable:!1,patient_price:"",sellable_notes:"",notes:""}),[i,n]=t.useState(!1),o=(c,m)=>a(b=>({...b,[c]:m})),r=async c=>{var m,b;c.preventDefault(),n(!0);try{await M.post("/api/inventory/items",l),a({name:"",sku_code:"",type:"supply",unit:"pcs",low_stock_threshold:0,default_pack_size:"",is_controlled:!1,is_sellable:!1,patient_price:"",sellable_notes:"",notes:""}),s==null||s()}catch(f){alert(((b=(m=f==null?void 0:f.response)==null?void 0:m.data)==null?void 0:b.message)||"Failed to save item")}finally{n(!1)}};return e.jsxs("form",{onSubmit:r,children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Item Name *"}),e.jsx("input",{className:"form-control",placeholder:"Item name",value:l.name,onChange:c=>o("name",c.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"SKU Code *"}),e.jsx("input",{className:"form-control",placeholder:"SKU code",value:l.sku_code,onChange:c=>o("sku_code",c.target.value),required:!0})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Type"}),e.jsxs("select",{className:"form-select",value:l.type,onChange:c=>o("type",c.target.value),children:[e.jsx("option",{value:"drug",children:"Drug"}),e.jsx("option",{value:"equipment",children:"Equipment"}),e.jsx("option",{value:"supply",children:"Supply"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Unit"}),e.jsx("input",{className:"form-control",placeholder:"pcs/ml/g",value:l.unit,onChange:c=>o("unit",c.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Low-stock Threshold"}),e.jsx("input",{className:"form-control",type:"number",min:"0",placeholder:"0",value:l.low_stock_threshold,onChange:c=>o("low_stock_threshold",c.target.value)})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Default Pack Size (optional)"}),e.jsx("input",{className:"form-control",type:"number",min:"0",step:"0.001",placeholder:"e.g., 100",value:l.default_pack_size,onChange:c=>o("default_pack_size",c.target.value)})]}),e.jsx("div",{className:"col-md-6 d-flex align-items-end",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",checked:l.is_controlled,onChange:c=>o("is_controlled",c.target.checked)}),e.jsx("label",{className:"form-check-label",children:"Controlled item"})]})})]}),e.jsx("div",{className:"row mb-3",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",checked:l.is_sellable,onChange:c=>o("is_sellable",c.target.checked)}),e.jsxs("label",{className:"form-check-label fw-semibold",children:[e.jsx("i",{className:"fas fa-shopping-cart me-2"}),"This item can be sold to patients separately (not included in procedure)"]})]})})}),l.is_sellable&&e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label",children:["Patient Price (â‚±) ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"â‚±"}),e.jsx("input",{className:"form-control",type:"number",step:"0.01",min:"0",placeholder:"0.00",value:l.patient_price,onChange:c=>o("patient_price",c.target.value),required:l.is_sellable})]}),e.jsx("small",{className:"text-muted",children:"Price that patients will pay for this item"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Sellable Notes (optional)"}),e.jsx("textarea",{className:"form-control",rows:2,placeholder:"e.g., Antibiotic for post-procedure infection prevention",value:l.sellable_notes,onChange:c=>o("sellable_notes",c.target.value)}),e.jsx("small",{className:"text-muted",children:"Notes shown to staff when selecting this item"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"form-control",rows:3,placeholder:"Additional notes...",value:l.notes,onChange:c=>o("notes",c.target.value)})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",disabled:i,className:"btn btn-primary",children:i?"Saving...":"Save Item"})})]})}function ct(s=new Date){const l=a=>String(a).padStart(2,"0");return`${s.getFullYear()}-${l(s.getMonth()+1)}-${l(s.getDate())}T${l(s.getHours())}:${l(s.getMinutes())}`}function dt(s=new Date){const l=a=>String(a).padStart(2,"0");return`${s.getFullYear()}-${l(s.getMonth()+1)}-${l(s.getDate())}`}function ot({items:s=[],onReceived:l,initialItemId:a}){const[i,n]=t.useState({item_id:"",qty_received:"",received_at:ct(),cost_per_unit:"",lot_number:"",batch_number:"",expiry_date:"",supplier_id:"",invoice_no:"",invoice_date:"",pack_size:"",notes:""}),[o,r]=t.useState(!1),[c,m]=t.useState([]),[b,f]=t.useState(!1),[y,h]=t.useState(!1),[j,u]=t.useState({name:"",contact_person:"",phone:"",email:"",address:"",notes:""});t.useEffect(()=>{a&&n(x=>({...x,item_id:String(a)}))},[a]),t.useEffect(()=>{(async()=>{try{const{data:x}=await M.get("/api/inventory/suppliers");m(x)}catch(x){console.error("Failed to load suppliers",x)}})()},[]);const P=s.find(x=>x.id===Number(i.item_id)),g=(x,p)=>n(C=>({...C,[x]:p})),_=async x=>{var p,C;x.preventDefault(),r(!0);try{await M.post("/api/inventory/receive",{...i,received_at:i.received_at?i.received_at.replace("T"," ")+":00":null}),n(v=>({...v,qty_received:"",cost_per_unit:"",lot_number:"",batch_number:"",expiry_date:"",invoice_no:"",invoice_date:"",pack_size:"",notes:""})),l==null||l(),alert("Stock received.")}catch(v){alert(((C=(p=v==null?void 0:v.response)==null?void 0:p.data)==null?void 0:C.message)||"Receive failed")}finally{r(!1)}},N=!o&&i.item_id&&i.qty_received&&i.received_at&&i.batch_number&&((P==null?void 0:P.type)!=="drug"||i.lot_number&&i.expiry_date);return e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Item *"}),e.jsxs("select",{className:"form-select",value:i.item_id,onChange:x=>g("item_id",x.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select itemâ€¦"}),s.map(x=>e.jsxs("option",{value:x.id,children:[x.name," (",x.sku_code,")"]},x.id))]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Quantity received *"}),e.jsx("input",{className:"form-control",type:"number",step:"0.001",min:"0.001",placeholder:"e.g., 10",value:i.qty_received,onChange:x=>g("qty_received",x.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Date & time received *"}),e.jsx("input",{className:"form-control",type:"datetime-local",value:i.received_at,onChange:x=>g("received_at",x.target.value),required:!0}),e.jsx("div",{className:"form-text",children:"Must be within the allowed backdate window (â‰¤ 24 hours; not in the future)."})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Cost per unit (optional)"}),e.jsx("input",{className:"form-control",type:"number",step:"0.01",min:"0",placeholder:"e.g., 12.50",value:i.cost_per_unit,onChange:x=>g("cost_per_unit",x.target.value)})]})]}),(P==null?void 0:P.type)==="drug"&&e.jsx("div",{className:"alert alert-info mb-3",children:e.jsxs("small",{children:["For ",e.jsx("strong",{children:"drugs"}),", ",e.jsx("strong",{children:"Lot number"})," and ",e.jsx("strong",{children:"Expiry date"})," are required."]})}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{className:"form-label",children:["Lot number",(P==null?void 0:P.type)==="drug"?" *":""]}),e.jsx("input",{className:"form-control",placeholder:"e.g., LOT-ABC-123",value:i.lot_number,onChange:x=>g("lot_number",x.target.value),required:(P==null?void 0:P.type)==="drug"})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Batch number *"}),e.jsx("input",{className:"form-control",placeholder:"e.g., BATCH-2025-09",value:i.batch_number,onChange:x=>g("batch_number",x.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{className:"form-label",children:["Expiry date",(P==null?void 0:P.type)==="drug"?" *":""]}),e.jsx("input",{className:"form-control",type:"date",min:dt(),value:i.expiry_date,onChange:x=>g("expiry_date",x.target.value),required:(P==null?void 0:P.type)==="drug"}),e.jsxs("div",{className:"form-text",children:["If the item is a ",e.jsx("strong",{children:"drug"}),", expiry is required and must be a ",e.jsx("strong",{children:"future"})," date."]})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Invoice no. (optional)"}),e.jsx("input",{className:"form-control",placeholder:"e.g., INV-000123",value:i.invoice_no,onChange:x=>g("invoice_no",x.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Invoice date (optional)"}),e.jsx("input",{className:"form-control",type:"date",value:i.invoice_date,onChange:x=>g("invoice_date",x.target.value)})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label",children:"Pack size note (optional)"}),e.jsx("input",{className:"form-control",placeholder:"e.g., 1 box = 100 pcs",value:i.pack_size,onChange:x=>g("pack_size",x.target.value)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Supplier (optional)"}),e.jsxs("div",{className:"input-group",children:[e.jsxs("select",{className:"form-select",value:i.supplier_id,onChange:x=>g("supplier_id",x.target.value),children:[e.jsx("option",{value:"",children:"No supplier"}),c.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))]}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>f(!0),title:"Add new supplier",children:"+ Add"})]}),e.jsx("div",{className:"form-text",children:"Linking a supplier improves audit trail and costing."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes (optional)"}),e.jsx("textarea",{className:"form-control",rows:3,placeholder:"Additional remarksâ€¦",value:i.notes,onChange:x=>g("notes",x.target.value)})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",disabled:!N,className:"btn btn-primary",children:o?"Receivingâ€¦":"Receive Stock"})}),b&&e.jsx("div",{className:"modal fade show d-block",role:"dialog","aria-modal":"true",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:2100,backgroundColor:"rgba(0, 0, 0, 0.5)",overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},onMouseDown:x=>{x.target===x.currentTarget&&f(!1)},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"Add Supplier"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>f(!1),"aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Name *"}),e.jsx("input",{className:"form-control",value:j.name,onChange:x=>u(p=>({...p,name:x.target.value})),required:!0})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Contact person"}),e.jsx("input",{className:"form-control",value:j.contact_person||"",onChange:x=>u(p=>({...p,contact_person:x.target.value}))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Phone"}),e.jsx("input",{className:"form-control",value:j.phone||"",onChange:x=>u(p=>({...p,phone:x.target.value}))})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:"form-control",value:j.email||"",onChange:x=>u(p=>({...p,email:x.target.value}))})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("input",{className:"form-control",value:j.address||"",onChange:x=>u(p=>({...p,address:x.target.value}))})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes"}),e.jsx("textarea",{className:"form-control",rows:3,value:j.notes||"",onChange:x=>u(p=>({...p,notes:x.target.value}))})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>f(!1),children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",disabled:y||!j.name,onClick:async()=>{var x,p;try{h(!0);const{data:C}=await M.post("/api/inventory/suppliers",j);m(v=>[...v,C]),n(v=>({...v,supplier_id:String(C.id)})),f(!1),u({name:"",contact_person:"",phone:"",email:"",address:"",notes:""})}catch(C){alert(((p=(x=C==null?void 0:C.response)==null?void 0:x.data)==null?void 0:p.message)||"Failed to add supplier")}finally{h(!1)}},children:y?"Savingâ€¦":"Save Supplier"})]})]})})})]})}function mt({items:s=[],user:l=null,onConsumed:a}){const i=(l==null?void 0:l.role)==="staff",[n,o]=t.useState({item_id:"",quantity:"",ref_type:i?"visit":"",ref_id:"",notes:""});t.useMemo(()=>s.find(m=>m.id===Number(n.item_id)),[s,n.item_id]);const r=(m,b)=>o(f=>({...f,[m]:b})),c=async m=>{var f,y,h;m.preventDefault();const b={item_id:Number(n.item_id),quantity:Number(n.quantity)};i?(b.ref_type="visit",n.ref_id&&(b.ref_id=Number(n.ref_id))):(n.ref_type&&(b.ref_type=n.ref_type),n.ref_id&&(b.ref_id=Number(n.ref_id))),(f=n.notes)!=null&&f.trim()&&(b.notes=n.notes.trim());try{await M.post("/api/inventory/consume",b),o(j=>({...j,quantity:"",ref_id:"",notes:""})),a==null||a(),alert("Stock consumed.")}catch(j){alert(((h=(y=j==null?void 0:j.response)==null?void 0:y.data)==null?void 0:h.message)||"Consume failed")}};return e.jsxs("form",{onSubmit:c,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Item *"}),e.jsxs("select",{className:"form-select",value:n.item_id,onChange:m=>r("item_id",m.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select itemâ€¦"}),s.map(m=>e.jsxs("option",{value:m.id,children:[m.name," (",m.sku_code,")"]},m.id))]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Quantity *"}),e.jsx("input",{className:"form-control",type:"number",step:"0.001",min:"0.001",placeholder:"e.g., 1",value:n.quantity,onChange:m=>r("quantity",m.target.value),required:!0})]}),e.jsx("div",{className:"col-md-6",children:i?e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Visit ID (required for staff) *"}),e.jsx("input",{className:"form-control",type:"number",min:"1",placeholder:"Finished Visit ID",value:n.ref_id,onChange:m=>r("ref_id",m.target.value),required:!0}),e.jsxs("div",{className:"form-text",children:["Backend requires a ",e.jsx("strong",{children:"finished"})," visit for staff consumption."]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Reference type (optional)"}),e.jsxs("select",{className:"form-select",value:n.ref_type,onChange:m=>r("ref_type",m.target.value),children:[e.jsx("option",{value:"",children:"None"}),e.jsx("option",{value:"visit",children:"Visit"}),e.jsx("option",{value:"appointment",children:"Appointment"})]})]})})]}),!i&&n.ref_type&&e.jsx("div",{className:"row mb-3",children:e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:n.ref_type==="visit"?"Visit ID":"Appointment ID"}),e.jsx("input",{className:"form-control",type:"number",min:"1",placeholder:"e.g., 123",value:n.ref_id,onChange:m=>r("ref_id",m.target.value)})]})}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes (optional)"}),e.jsx("textarea",{className:"form-control",rows:3,placeholder:"Additional notes...",value:n.notes,onChange:m=>r("notes",m.target.value)})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",className:"btn btn-warning",children:"Consume Stock"})})]})}const ht=["damaged","expired","count_correction","return_to_supplier","stock_take_variance","theft","other"],xt=s=>{if(!s)return"";const l=String(s);return l.includes("T")?l.split("T")[0]:l};function ut({items:s=[],onAdjusted:l,onNeedReceive:a}){const[i,n]=t.useState({item_id:"",batch_id:"",direction:"decrease",quantity:"",adjust_reason:"damaged",notes:"",custom_reason:""}),[o,r]=t.useState([]),[c,m]=t.useState(!1),b=(h,j)=>n(u=>({...u,[h]:j}));t.useEffect(()=>{const h=Number(i.item_id);if(n(j=>({...j,batch_id:""})),!h){r([]);return}(async()=>{m(!0);try{const{data:j}=await M.get(`/api/inventory/items/${h}/batches`),P=[...Array.isArray(j==null?void 0:j.batches)?j.batches:[]].sort((g,_)=>{const N=g.expiry_date?0:1,x=_.expiry_date?0:1;if(N!==x)return N-x;const p=g.expiry_date||"",C=_.expiry_date||"";if(p!==C)return p.localeCompare(C);const v=g.received_at||"",A=_.received_at||"";return v.localeCompare(A)});r(P),P.length&&n(g=>g.batch_id?g:{...g,batch_id:String(P[0].id)})}catch{r([])}finally{m(!1)}})()},[i.item_id]);const f=Number(i.item_id)>0&&Number(i.batch_id)>0&&Number(i.quantity)>0&&!!i.adjust_reason&&!c,y=async h=>{var g,_,N;if(h.preventDefault(),!o.find(x=>String(x.id)===String(i.batch_id))){alert("Please select a valid batch.");return}let u=((g=i.notes)==null?void 0:g.trim())||"";i.adjust_reason==="other"&&i.custom_reason.trim()&&(u=u?`${i.custom_reason.trim()} â€” ${u}`:i.custom_reason.trim());const P={item_id:Number(i.item_id),batch_id:Number(i.batch_id),direction:i.direction,quantity:Number(i.quantity),adjust_reason:i.adjust_reason,...u?{notes:u}:{}};try{await M.post("/api/inventory/adjust",P),n(x=>({...x,quantity:"",notes:"",custom_reason:""})),l==null||l(),alert("Inventory adjusted.")}catch(x){alert(((N=(_=x==null?void 0:x.response)==null?void 0:_.data)==null?void 0:N.message)||"Adjust failed")}};return e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Item *"}),e.jsxs("select",{className:"form-select",value:i.item_id,onChange:h=>b("item_id",h.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select itemâ€¦"}),s.map(h=>e.jsxs("option",{value:String(h.id),children:[h.name," (",h.sku_code,")"]},h.id))]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Batch ",c&&e.jsx("span",{className:"text-muted small",children:"(loadingâ€¦)"})]}),e.jsxs("select",{className:"form-select",value:i.batch_id,onChange:h=>b("batch_id",h.target.value),required:!0,disabled:!i.item_id||c||o.length===0,children:[e.jsx("option",{value:"",disabled:!0,children:c?"Loadingâ€¦":"Select batchâ€¦"}),o.map(h=>e.jsxs("option",{value:String(h.id),children:["#",h.id,h.lot_number?` â€¢ Lot ${h.lot_number}`:"",h.expiry_date?` â€¢ Exp ${xt(h.expiry_date)}`:"",` â€¢ On hand ${h.qty_on_hand}`]},h.id))]}),i.item_id&&o.length===0&&!c&&e.jsxs("div",{className:"form-text",children:["No batches yet."," ",e.jsx("button",{type:"button",className:"btn btn-link p-0 text-decoration-underline",onClick:()=>a==null?void 0:a(Number(i.item_id)),children:"Create one via Receive"}),"."]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Direction *"}),e.jsxs("select",{className:"form-select",value:i.direction,onChange:h=>b("direction",h.target.value),required:!0,children:[e.jsx("option",{value:"decrease",children:"Decrease"}),e.jsx("option",{value:"increase",children:"Increase"})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Quantity *"}),e.jsx("input",{className:"form-control",type:"number",step:"0.001",min:"0.001",placeholder:"e.g., 1",value:i.quantity,onChange:h=>b("quantity",h.target.value),required:!0})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Reason *"}),e.jsx("select",{className:"form-select",value:i.adjust_reason,onChange:h=>b("adjust_reason",h.target.value),required:!0,children:ht.map(h=>e.jsx("option",{value:h,children:h.replace("_"," ").replace(/\b\w/g,j=>j.toUpperCase())},h))})]}),i.adjust_reason==="other"&&e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Describe reason *"}),e.jsx("input",{className:"form-control",placeholder:"e.g., audit note",value:i.custom_reason,onChange:h=>b("custom_reason",h.target.value),required:!0})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Notes (optional)"}),e.jsx("textarea",{className:"form-control",rows:3,placeholder:"Additional notes...",value:i.notes,onChange:h=>b("notes",h.target.value)})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{type:"submit",className:"btn btn-secondary",disabled:!f,children:"Adjust Stock"})})]})}function bs({open:s,onClose:l,title:a,children:i,maxWidth:n="md"}){const o=t.useRef(null),r=t.useRef(null);if(t.useEffect(()=>{if(!s)return;r.current=document.activeElement;const m=document.body.style.overflow;document.body.style.overflow="hidden";const b=y=>{var P;if(y.key==="Escape"&&(l==null||l()),y.key!=="Tab")return;const h=(P=o.current)==null?void 0:P.querySelectorAll('a,button,input,select,textarea,[tabindex]:not([tabindex="-1"])');if(!h||h.length===0)return;const j=h[0],u=h[h.length-1];y.shiftKey&&document.activeElement===j?(y.preventDefault(),u.focus()):!y.shiftKey&&document.activeElement===u&&(y.preventDefault(),j.focus())};document.addEventListener("keydown",b);const f=setTimeout(()=>{var y;return(y=o.current)==null?void 0:y.focus()},0);return()=>{clearTimeout(f),document.removeEventListener("keydown",b),document.body.style.overflow=m,r.current instanceof HTMLElement&&r.current.focus()}},[s,l]),!s)return null;const c={sm:"modal-sm",md:"",lg:"modal-lg",xl:"modal-xl"};return da.createPortal(e.jsx("div",{className:"modal fade show d-block",role:"dialog","aria-modal":"true",style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:2e3,backgroundColor:"rgba(0, 0, 0, 0.5)",overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},onMouseDown:m=>{m.target===m.currentTarget&&(l==null||l())},children:e.jsx("div",{className:`modal-dialog modal-dialog-scrollable ${c[n]}`,style:{maxHeight:"calc(100vh - 2rem)",margin:"0 auto",width:"100%"},children:e.jsxs("div",{ref:o,tabIndex:-1,className:"modal-content",style:{maxHeight:"calc(100vh - 2rem)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:a}),e.jsx("button",{type:"button",className:"btn-close",onClick:l,"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",minHeight:0,padding:"1rem",flex:"1 1 auto"},children:i})]})})}),document.body)}function pt(){const[s,l]=t.useState(!0),[a,i]=t.useState(!1),[n,o]=t.useState({staff_can_receive:!1,near_expiry_days:30,low_stock_debounce_hours:24}),r=async()=>{l(!0);try{const{data:m}=await M.get("/api/inventory/settings");o(m)}finally{l(!1)}},c=async()=>{var m,b;i(!0);try{await M.patch("/api/inventory/settings",n),alert("Settings saved.")}catch(f){alert(((b=(m=f==null?void 0:f.response)==null?void 0:m.data)==null?void 0:b.message)||"Save failed")}finally{i(!1)}};return t.useEffect(()=>{r()},[]),s?e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-700 p-6",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-6 bg-gray-200 dark:bg-gray-700 rounded w-1/3 mb-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/4"})]})]})}):e.jsxs("div",{children:[e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",checked:n.staff_can_receive,onChange:m=>o(b=>({...b,staff_can_receive:m.target.checked}))}),e.jsx("label",{className:"form-check-label",children:"Allow staff to receive stock"})]})}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Near-expiry days"}),e.jsx("input",{className:"form-control",type:"number",min:"1",max:"365",value:n.near_expiry_days,onChange:m=>o(b=>({...b,near_expiry_days:Number(m.target.value)}))})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Low-stock debounce (hours)"}),e.jsx("input",{className:"form-control",type:"number",min:"1",max:"168",value:n.low_stock_debounce_hours,onChange:m=>o(b=>({...b,low_stock_debounce_hours:Number(m.target.value)}))})]})]}),e.jsx("div",{className:"d-flex justify-content-end",children:e.jsx("button",{className:"btn btn-primary",onClick:c,disabled:a,children:a?"Savingâ€¦":"Save Settings"})})]})}function ea(){const[s,l]=t.useState([]),[a,i]=t.useState(""),[n,o]=t.useState(!1),[r,c]=t.useState(null),[m,b]=t.useState(null),[f,y]=t.useState(!1),[h,j]=t.useState(!1),[u,P]=t.useState(!1),[g,_]=t.useState(!1),[N,x]=t.useState(!1),[p,C]=t.useState(null),v=R=>{C(R),_(!1),j(!0)},A=async(R="")=>{o(!0);try{const{data:H}=await M.get("/api/inventory/items",{params:{q:R}});l(H.data||[])}finally{o(!1)}},z=R=>{if(i(R),m&&clearTimeout(m),R.length===0||R.length>=2){const H=setTimeout(()=>{A(R)},300);b(H)}},T=async()=>{try{const{data:R}=await M.get("/api/user");c(R)}catch(R){console.error("Failed to load user",R)}};t.useEffect(()=>{A(),T()},[]);const S=t.useMemo(()=>s.length,[s]),d=f||h||u||g||N;return e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"h3 mb-1",children:"Inventory"}),e.jsx("p",{className:"text-muted small",children:"Manage your stock and supplies"})]}),e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsx("div",{className:"card border-0 bg-light",children:e.jsxs("div",{className:"card-body py-2 px-3",children:[e.jsx("div",{className:"h5 mb-0 text-primary",children:S}),e.jsx("div",{className:"small text-muted",children:"Total Items"})]})}),(r==null?void 0:r.role)==="admin"&&e.jsx("button",{className:`btn btn-outline-secondary btn-sm ${d?"disabled":""}`,onClick:()=>!d&&x(!0),disabled:d,title:"Inventory Settings",children:e.jsx("i",{className:"bi bi-gear"})})]})]}),e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center mb-4",children:[e.jsxs("div",{className:"input-group flex-grow-1",style:{minWidth:"300px"},children:[e.jsx("span",{className:"input-group-text",children:e.jsx("i",{className:"bi bi-search"})}),e.jsx("input",{className:`form-control ${d?"opacity-50":""}`,placeholder:"Search items... (min 2 characters)",value:a,onChange:R=>!d&&z(R.target.value),disabled:d})]}),e.jsx("button",{className:`btn btn-outline-secondary ${d?"disabled":""}`,onClick:()=>!d&&A(a),disabled:d||a.length>0&&a.length<2,children:"Search"}),a.length>0&&a.length<2&&e.jsxs("div",{className:"text-warning small mt-1",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Please enter at least 2 characters to search"]}),e.jsxs("div",{className:"d-flex gap-2 ms-auto",children:[e.jsx("button",{className:`btn btn-success btn-sm ${d?"disabled":""}`,onClick:()=>!d&&y(!0),disabled:d,children:"+ Add Item"}),e.jsx("button",{className:`btn btn-primary btn-sm ${d?"disabled":""}`,onClick:()=>!d&&j(!0),disabled:d,children:"â‡ª Receive Stock"}),e.jsx("button",{className:`btn btn-warning btn-sm ${d?"disabled":""}`,onClick:()=>!d&&P(!0),disabled:d,children:"âˆ’ Consume"}),(r==null?void 0:r.role)==="admin"&&e.jsx("button",{className:`btn btn-secondary btn-sm ${d?"disabled":""}`,onClick:()=>!d&&_(!0),disabled:d,children:"âœŽ Adjust"})]})]}),e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"card-title mb-0",children:["Items (",S,")"]}),n&&e.jsx("span",{className:"badge bg-secondary",children:"Loadingâ€¦"})]}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"SKU"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{children:"Threshold"}),e.jsx("th",{children:"On Hand"}),e.jsx("th",{children:"Sellable"})]})}),e.jsxs("tbody",{children:[s.map(R=>{const H=Number(R.total_on_hand||0),G=R.low_stock_threshold??0,$=H<=G;return e.jsxs("tr",{children:[e.jsx("td",{className:"fw-medium",children:R.name}),e.jsx("td",{className:"font-monospace text-muted",children:R.sku_code}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary",children:R.type})}),e.jsx("td",{className:"text-muted",children:R.unit}),e.jsx("td",{className:"text-muted",children:G}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:`fw-medium ${$?"text-danger":"text-success"}`,children:H}),$&&e.jsx("span",{className:"badge bg-danger",children:"Low"})]})}),e.jsx("td",{children:R.is_sellable?e.jsxs("span",{className:"badge bg-success",title:R.sellable_notes,children:[e.jsx("i",{className:"fas fa-shopping-cart me-1"}),"â‚±",Number(R.patient_price||0).toLocaleString()]}):e.jsx("span",{className:"text-muted",children:"-"})})]},R.id)}),s.length===0&&!n&&e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center text-muted py-4",children:"No items yet."})})]})]})})})]}),e.jsx(bs,{open:f,onClose:()=>y(!1),title:"Add Item",children:e.jsx(rt,{onCreated:()=>{y(!1),A(a)}})}),e.jsx(bs,{open:h,onClose:()=>{j(!1),C(null)},title:"Receive Stock",children:e.jsx(ot,{items:s,initialItemId:p,onReceived:()=>{j(!1),C(null),A(a)}})}),e.jsx(bs,{open:u,onClose:()=>P(!1),title:"Consume Stock",children:e.jsx(mt,{items:s,user:r,onConsumed:()=>{P(!1),A(a)}})}),e.jsx(bs,{open:g,onClose:()=>_(!1),title:"Adjust Stock (Admin)",children:e.jsx(ut,{items:s,onAdjusted:()=>{_(!1),A(a)},onNeedReceive:v})}),e.jsx(bs,{open:N,onClose:()=>x(!1),title:"Inventory Settings",children:e.jsx(pt,{})})]})}function $s({allow:s,to:l="/404",children:a}){const[i,n]=t.useState({loading:!0,user:null,settings:null}),o=ss();return t.useEffect(()=>{let c=!0;return(async()=>{try{const[m,b]=await Promise.all([M.get("/api/user"),M.get("/api/inventory/settings")]);c&&n({loading:!1,user:m.data,settings:b.data})}catch{c&&n({loading:!1,user:null,settings:null})}})(),()=>{c=!1}},[]),i.loading?e.jsx("div",{className:"p-4",children:"Loadingâ€¦"}):s({user:i.user,settings:i.settings})?a:e.jsx(oa,{to:l,state:{from:o},replace:!0})}const bt=({user:s,settings:l})=>(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="staff"&&!!(l!=null&&l.staff_can_receive),ft=({user:s,settings:l,visitFinished:a})=>(s==null?void 0:s.role)==="admin"||(s==null?void 0:s.role)==="staff"&&!!(l!=null&&l.staff_can_receive)&&a===!0;function Ls({children:s}){return e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"100vh",width:"100%"},children:s})}const Cs=async()=>{const s=localStorage.getItem("fingerprint");if(s)return s;const a=await(await Ua.load()).get();return localStorage.setItem("fingerprint",a.visitorId),a.visitorId};function gt(){var z,T,S;const[s,l]=t.useState(""),[a,i]=t.useState(""),[n,o]=t.useState(""),[r,c]=t.useState(!1),m=Se(),b=ss(),{setUser:f}=Me(),y=((z=b.state)==null?void 0:z.message)||"",h=((T=b.state)==null?void 0:T.redirectTo)||null,j=((S=b.state)==null?void 0:S.preselectedService)||null;t.useEffect(()=>{y&&o(y)},[y]);const u=async d=>{var R,H,G,$,L,E;d.preventDefault();try{c(!0),await M.get("/sanctum/csrf-cookie");const I=await Cs(),W=await M.post("/api/login",{email:s,password:a,device_id:I}),B=W.data.user||W.data;if(W.data.requires_password_change){o("Login successful. Please change your password."),f(B),g(!0),c(!1);return}o("Login successful!"),f(B),setTimeout(()=>{B.role==="admin"?m("/admin"):B.role==="staff"?m("/staff"):B.role==="patient"?h==="/patient/appointment"?m("/patient/appointment",{state:{preselectedService:j}}):m("/patient"):B.role==="dentist"?m("/dentist"):o("Login successful, but no dashboard yet for this role.")},150)}catch(I){console.error(I);const W=(($=(G=(H=(R=I.response)==null?void 0:R.data)==null?void 0:H.errors)==null?void 0:G.email)==null?void 0:$[0])||((E=(L=I.response)==null?void 0:L.data)==null?void 0:E.message)||"Login failed";Ge.error(W,{style:{background:"#dc3545",color:"#fff"},iconTheme:{primary:"#fff",secondary:"#dc3545"}})}finally{c(!1)}},[P,g]=t.useState(!1),[_,N]=t.useState(""),[x,p]=t.useState(""),[C,v]=t.useState(""),A=async()=>{var d,R;if(v(""),!_||_.length<8){v("Password must be at least 8 characters.");return}if(_!==x){v("Passwords do not match.");return}try{await M.post("/api/dentist/change-password",{password:_}),g(!1),o("Password changed successfully!"),m("/dentist")}catch(H){v(((R=(d=H.response)==null?void 0:d.data)==null?void 0:R.message)||"Failed to change password")}};return e.jsxs(Ls,{children:[e.jsx(ks,{position:"top-center"}),e.jsxs("div",{className:"auth-layout",children:[r&&e.jsx(ze,{message:"Logging in..."}),e.jsxs("div",{className:"login-container",children:[e.jsxs("div",{className:"login-left",children:[e.jsxs("div",{className:"brand-block",children:[e.jsx("img",{src:us,alt:"Kreative Dental Logo",className:"site-logo"}),e.jsxs("div",{className:"brand-text",children:[e.jsx("h2",{className:"clinic-name m-0",children:"Kreative Dental & Orthodontics"}),e.jsx("span",{className:"tagline",children:"Your smile, thoughtfully crafted."})]})]}),e.jsx("h1",{className:"welcome-title",children:"Hello, welcome!"}),e.jsxs("p",{className:"login-description",children:["Please log in to access your appointments, treatment history, and personalized dental care. ",e.jsx("br",{}),"Your oral health is just a click away!"]}),y&&e.jsxs("div",{className:"alert alert-info mb-4",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),y]}),e.jsxs("div",{className:"left-highlights",children:[e.jsxs("div",{className:"highlight",children:[e.jsx("span",{className:"emoji"}),e.jsx("span",{children:"Comprehensive dental services"})]}),e.jsxs("div",{className:"highlight",children:[e.jsx("span",{className:"emoji"}),e.jsx("span",{children:"Easy online appointment booking"})]}),e.jsxs("div",{className:"highlight",children:[e.jsx("span",{className:"emoji"}),e.jsx("span",{children:"Secure and private records"})]})]})]}),e.jsx("div",{className:"login-right",children:e.jsxs("form",{className:"login-form card-glass",onSubmit:u,children:[e.jsx("div",{className:"form-head",children:e.jsx("h3",{className:"m-0",children:"Sign in"})}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Email address"}),e.jsx("input",{type:"email",value:s,onChange:d=>l(d.target.value),required:!0,placeholder:"name@gmail.com"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Password"}),e.jsx("input",{type:"password",value:a,onChange:d=>i(d.target.value),required:!0})]}),e.jsxs("div",{className:"form-options",children:[e.jsxs("label",{className:"form-check",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2"})," Remember me"]}),e.jsx(ye,{to:"/forgot-password",className:"forgot-link",children:"Forgot password?"})]}),e.jsx("button",{type:"submit",className:"btn-primary-lg w-100",children:"Login"}),e.jsxs("div",{className:"btn-row",children:[e.jsx("button",{type:"button",className:"btn-secondary-lg",onClick:()=>m("/register"),children:"Create account"}),e.jsx("button",{type:"button",className:"btn-outline-lg",onClick:()=>m("/"),children:"Go to Homepage"})]}),n&&!n.toLowerCase().includes("credentials")&&!n.toLowerCase().includes("failed")&&e.jsx("p",{className:"login-message",children:n})]})})]})]}),P&&e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:1050,backdropFilter:"blur(2px)"},children:e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1060},children:e.jsxs("div",{className:"card shadow-lg border-warning",style:{width:450,maxWidth:"90vw"},children:[e.jsx("div",{className:"card-header bg-warning text-dark text-center",children:e.jsxs("h4",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-shield-exclamation me-2"}),"Account Security Required"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"alert alert-warning mb-3",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"You must change your temporary password to continue."}),e.jsx("br",{}),e.jsx("small",{children:"This is required for account security and cannot be skipped."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"New Password:"}),e.jsx("input",{type:"password",className:"form-control",value:_,onChange:d=>N(d.target.value),placeholder:"Enter your new password",autoFocus:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Confirm Password:"}),e.jsx("input",{type:"password",className:"form-control",value:x,onChange:d=>p(d.target.value),placeholder:"Confirm your new password"})]}),C&&e.jsxs("div",{className:"alert alert-danger mb-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),C]}),e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-primary btn-lg",onClick:A,disabled:!_||!x,children:[e.jsx("i",{className:"bi bi-shield-check me-2"}),"Secure My Account"]})})]})]})})})]})}const ps={privacy_policy:`**Data Protection Act Compliance**

Kreative Dental Clinic is committed to protecting your privacy and personal information in accordance with the Data Protection Act. We collect, use, store, and process your personal data only for the purpose of providing dental services and managing your patient records.

**Information We Collect:**

- Personal identification information (name, email, contact number)
- Medical and dental history
- Appointment records and treatment information
- Billing and payment information
- Device and usage information when you access our online services

**How We Use Your Information:**

- To provide and improve our dental services
- To schedule and manage appointments
- To communicate with you about your treatment and appointments
- To maintain your medical records as required by law
- To process payments and billing
- To send important updates and notifications

**Data Security:**

We implement appropriate technical and organizational measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction. Your data is stored securely and access is restricted to authorized personnel only.

**Your Rights:**

- Right to access your personal information
- Right to rectification of inaccurate data
- Right to erasure (in certain circumstances)
- Right to data portability
- Right to object to processing
- Right to withdraw consent

**Data Retention:**

We retain your personal information for as long as necessary to provide our services and as required by applicable laws and regulations. Medical records are typically retained for a minimum period as mandated by law.`,terms_conditions:`**Acceptance of Terms:**

By creating an account and using our services, you agree to comply with and be bound by these Terms and Conditions. If you do not agree with any part of these terms, please do not use our services.

**Account Responsibilities:**

- You are responsible for maintaining the confidentiality of your account credentials
- You must provide accurate and complete information
- You must notify us immediately of any unauthorized use of your account
- You are responsible for all activities that occur under your account

**Appointment Policies:**

- Appointments should be made in advance through the system
- Cancellations should be made at least 24 hours in advance
- Late arrivals may result in rescheduling of your appointment
- Missed appointments without proper notice may incur a fee

**Medical Information:**

The information provided in this system is for your convenience only. It is not a substitute for professional medical advice, diagnosis, or treatment. Always consult with qualified dental professionals for proper diagnosis and treatment.

**Service Availability:**

We reserve the right to modify, suspend, or discontinue any aspect of the service at any time. We do not guarantee uninterrupted or error-free access to our systems.

**Limitation of Liability:**

To the fullest extent permitted by law, Kreative Dental Clinic shall not be liable for any indirect, incidental, special, consequential, or punitive damages resulting from your use of our services.

**Changes to Terms:**

We reserve the right to modify these Terms and Conditions at any time. Continued use of our services after changes constitutes acceptance of the modified terms.`,contact_email:"kreativedent@gmail.com",contact_phone:"0927 759 2845",effective_date:new Date().toISOString().split("T")[0]};function jt(){const[s,l]=t.useState({name:"",email:"",contact_number:"",password:"",confirmPassword:""}),[a,i]=t.useState({}),[n,o]=t.useState(""),[r,c]=t.useState(!1),[m,b]=t.useState(!1),[f,y]=t.useState(!1),[h,j]=t.useState(ps),[u,P]=t.useState(!1),g=Se();t.useEffect(()=>{f&&_()},[f]);const _=async()=>{P(!0);try{const{data:v}=await M.get("/api/policy",{skip401Handler:!0});j({privacy_policy:v.privacy_policy||ps.privacy_policy,terms_conditions:v.terms_conditions||ps.terms_conditions,contact_email:v.contact_email||ps.contact_email,contact_phone:v.contact_phone||ps.contact_phone,effective_date:v.effective_date||ps.effective_date})}catch(v){console.error("Failed to fetch policy, using default",v)}finally{P(!1)}},N=v=>{if(!v)return"";const A=v.split(`
`),z=[];let T=!1,S=[];return A.forEach((d,R)=>{d.startsWith("**")&&d.endsWith("**")?(T&&(z.push(e.jsx("ul",{children:S},`ul-${R}`)),S=[],T=!1),z.push(e.jsx("p",{children:e.jsx("strong",{children:d.replace(/\*\*/g,"")})},R))):d.startsWith("- ")?(T||(T=!0),S.push(e.jsx("li",{children:d.substring(2)},`li-${R}`))):d.trim()===""?(T&&(z.push(e.jsx("ul",{children:S},`ul-${R}`)),S=[],T=!1),z.push(e.jsx("br",{},R))):(T&&(z.push(e.jsx("ul",{children:S},`ul-${R}`)),S=[],T=!1),z.push(e.jsx("p",{children:d},R)))}),T&&S.length>0&&z.push(e.jsx("ul",{children:S},"ul-final")),z},x=()=>{const v={};return/^09\d{9}$/.test(s.contact_number)||(v.contact_number="Contact number must start with 09 and be 11 digits."),/(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}/.test(s.password)||(v.password="Password must have at least 1 uppercase, 1 lowercase, 1 number, and be 8+ characters."),s.password!==s.confirmPassword&&(v.confirmPassword="Passwords do not match."),m||(v.terms="You must accept the Terms and Conditions and Privacy Policy to register."),i(v),Object.keys(v).length===0},p=v=>{l({...s,[v.target.name]:v.target.value}),i({...a,[v.target.name]:null})},C=async v=>{var A,z,T,S;if(v.preventDefault(),o(""),!!x())try{c(!0),await M.get("/sanctum/csrf-cookie");const d=await M.post("/api/register",{name:s.name,email:s.email,contact_number:s.contact_number,password:s.password,password_confirmation:s.confirmPassword});localStorage.setItem("token",d.data.token),Ge.success("Successful registration",{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px"},duration:3e3,position:"top-center"}),l({name:"",email:"",contact_number:"",password:"",confirmPassword:""}),i({}),o(""),setTimeout(()=>{g("/login")},1500)}catch(d){if((z=(A=d.response)==null?void 0:A.data)!=null&&z.errors){const H={};Object.keys(d.response.data.errors).forEach(G=>{G==="contact_number"?H.contact_number=d.response.data.errors[G][0]:G==="password"?H.password=d.response.data.errors[G][0]:G==="email"?H.email=d.response.data.errors[G][0]:G==="name"&&(H.name=d.response.data.errors[G][0])}),i(H)}const R=((S=(T=d.response)==null?void 0:T.data)==null?void 0:S.message)||"Registration failed";o(R)}finally{c(!1)}};return e.jsxs(Ls,{children:[e.jsx(ks,{position:"top-center"}),r&&e.jsx(ze,{message:"Registering patient..."}),e.jsxs("div",{className:"auth-container",children:[e.jsxs("div",{className:"auth-left",children:[e.jsx("img",{src:us,alt:"Kreative Dental Logo",className:"auth-logo"}),e.jsx("h2",{className:"auth-title",children:"Create Your Account"}),e.jsx("p",{className:"auth-description",children:"Join us today and manage your appointments, treatment history, and profile in one place."})]}),e.jsx("div",{className:"auth-right",children:e.jsxs("div",{className:"card shadow-sm p-4",children:[e.jsx("h3",{className:"text-center mb-4",children:"Patient Registration"}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-person me-2"}),"Full Name"]}),e.jsx("input",{type:"text",className:`form-control ${a.name?"is-invalid":""}`,name:"name",value:s.name,onChange:p,required:!0}),a.name&&e.jsx("div",{className:"invalid-feedback",children:a.name})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-envelope me-2"}),"Email"]}),e.jsx("input",{type:"email",className:`form-control ${a.email?"is-invalid":""}`,name:"email",value:s.email,onChange:p,required:!0,autoComplete:"email"}),a.email&&e.jsx("div",{className:"invalid-feedback",children:a.email})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-telephone me-2"}),"Contact Number"]}),e.jsx("input",{type:"text",className:`form-control ${a.contact_number?"is-invalid":""}`,name:"contact_number",value:s.contact_number,onChange:p,required:!0}),a.contact_number&&e.jsx("div",{className:"invalid-feedback",children:a.contact_number})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-lock me-2"}),"Password"]}),e.jsx("input",{type:"password",className:`form-control ${a.password?"is-invalid":""}`,name:"password",value:s.password,onChange:p,required:!0,autoComplete:"new-password"}),a.password&&e.jsx("div",{className:"invalid-feedback",children:a.password})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-lock-fill me-2"}),"Confirm Password"]}),e.jsx("input",{type:"password",className:`form-control ${a.confirmPassword?"is-invalid":""}`,name:"confirmPassword",value:s.confirmPassword,onChange:p,required:!0,autoComplete:"new-password"}),a.confirmPassword&&e.jsx("div",{className:"invalid-feedback",children:a.confirmPassword})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:`form-check-input ${a.terms?"is-invalid":""}`,type:"checkbox",id:"acceptTerms",checked:m,onChange:v=>{b(v.target.checked),i({...a,terms:null})},required:!0}),e.jsxs("label",{className:"form-check-label",htmlFor:"acceptTerms",children:["I agree to the"," ",e.jsx("button",{type:"button",className:"btn btn-link p-0 text-decoration-none",onClick:v=>{v.preventDefault(),y(!0)},style:{verticalAlign:"baseline"},children:"Term, Privacy Policy"})]}),a.terms&&e.jsx("div",{className:"invalid-feedback d-block",children:a.terms})]})}),e.jsxs("button",{type:"submit",className:"btn btn-primary w-100",disabled:!m,children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Register"]})]}),n&&e.jsx("div",{className:`alert text-center mt-3 ${n.includes("âœ…")||n.includes("âš ï¸")?"alert-info":"alert-danger"}`,children:n}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs(ye,{to:"/login",className:"d-block text-decoration-none text-primary mb-2",children:[e.jsx("i",{className:"bi bi-box-arrow-in-right me-2"}),"Already have an account? Login"]})})]})})]}),f&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Terms, Privacy Policy"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>y(!1)})]}),e.jsx("div",{className:"modal-body",children:u?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsx("h6",{children:"Privacy Policy"}),e.jsx("div",{className:"policy-content",children:N(h.privacy_policy)}),e.jsx("hr",{}),e.jsx("h6",{children:"Terms and Conditions"}),e.jsx("div",{className:"policy-content",children:N(h.terms_conditions)}),e.jsx("hr",{}),e.jsx("p",{children:e.jsx("strong",{children:"Contact Information:"})}),e.jsx("p",{children:"If you have any questions about this Privacy Policy or Terms and Conditions, please contact us at:"}),e.jsxs("p",{children:["Kreative Dental Clinic",e.jsx("br",{}),"Email: ",h.contact_email,e.jsx("br",{}),"Phone: ",h.contact_phone]}),e.jsxs("p",{className:"text-muted small mt-4",children:[e.jsx("strong",{children:"Effective Date:"})," ",h.effective_date?new Date(h.effective_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>y(!1),children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>{b(!0),y(!1)},children:"Accept and Close"})]})]})})})]})}function vt(){var h,j;const s=ss(),l=((h=s.state)==null?void 0:h.email)||"",a=((j=s.state)==null?void 0:j.fromProfile)||!1,[i,n]=t.useState(""),[o,r]=t.useState(""),[c,m]=t.useState(""),[b,f]=t.useState(!1);t.useEffect(()=>{n(l)},[l]);const y=async u=>{var P,g;u.preventDefault(),r(""),m("");try{f(!0),await M.get("/sanctum/csrf-cookie");const _=await Cs(),N=await M.post("/forgot-password",{email:i,device_id:_});r(N.data.message||"Reset link sent to your email.")}catch(_){const N=((g=(P=_.response)==null?void 0:P.data)==null?void 0:g.message)||"Something went wrong";m(N)}finally{f(!1)}};return e.jsxs(Ls,{children:[b&&e.jsx(ze,{message:"Sending reset link..."}),e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",width:"1300px",height:"720px",margin:"0 auto",padding:"20px"},children:e.jsxs("div",{className:"card shadow-sm p-4",style:{width:"400px",padding:"30px",borderRadius:"12px",boxShadow:"0px 4px 12px rgba(0, 0, 0, 0.1)"},children:[e.jsx("h3",{className:"text-center mb-4",children:a?"Send Password Reset Link":"Forgot Password"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-envelope me-2"}),"Email Address"]}),e.jsx("input",{type:"email",className:"form-control",value:i,readOnly:a,onChange:u=>n(u.target.value),required:!0,autoComplete:"email"})]}),e.jsxs("button",{type:"submit",className:"btn btn-primary w-100",children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Reset Link"]})]}),o&&e.jsx("div",{className:"alert alert-success text-center mt-3",children:o}),c&&e.jsx("div",{className:"alert alert-danger text-center mt-3",children:c}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs(ye,{to:"/login",className:"d-block text-decoration-none text-primary",children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to Login"]})})]})})]})}function Nt(){const{token:s}=Ms(),[l]=qs(),a=l.get("email")||"",i=Se(),[n,o]=t.useState({email:a,password:"",password_confirmation:""}),[r,c]=t.useState({}),[m,b]=t.useState(""),[f,y]=t.useState(!1),h=u=>{o({...n,[u.target.name]:u.target.value}),c({...r,[u.target.name]:null})},j=async u=>{var P,g;if(u.preventDefault(),b(""),c({}),!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}/.test(n.password)){c({password:"Password must have at least 1 uppercase, 1 lowercase, 1 number, and be 8+ characters."});return}if(n.password!==n.password_confirmation){c({password_confirmation:"Passwords do not match."});return}try{y(!0),await M.get("/sanctum/csrf-cookie");const _=await M.post("/reset-password",{token:s,email:n.email,password:n.password,password_confirmation:n.password_confirmation});b("Password has been reset! Redirecting to login..."),setTimeout(()=>{i("/login")},2e3)}catch(_){const N=((g=(P=_.response)==null?void 0:P.data)==null?void 0:g.message)||"Reset failed";b(N)}finally{y(!1)}};return e.jsxs(Ls,{children:[f&&e.jsx(ze,{message:"Resetting password..."}),e.jsxs("div",{className:"card shadow-sm p-4",style:{width:"100%",maxWidth:"500px"},children:[e.jsx("h3",{className:"text-center mb-4",children:"Reset Password"}),e.jsxs("form",{onSubmit:j,children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-envelope me-2"}),"Email"]}),e.jsx("input",{type:"email",name:"email",className:"form-control",value:n.email,onChange:h,required:!0,readOnly:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-lock me-2"}),"New Password"]}),e.jsx("input",{type:"password",name:"password",className:`form-control ${r.password?"is-invalid":""}`,value:n.password,onChange:h,required:!0,autoComplete:"new-password"}),r.password&&e.jsx("div",{className:"invalid-feedback",children:r.password})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:[e.jsx("i",{className:"bi bi-lock-fill me-2"}),"Confirm Password"]}),e.jsx("input",{type:"password",name:"password_confirmation",className:`form-control ${r.password_confirmation?"is-invalid":""}`,value:n.password_confirmation,onChange:h,required:!0,autoComplete:"new-password"}),r.password_confirmation&&e.jsx("div",{className:"invalid-feedback",children:r.password_confirmation})]}),e.jsxs("button",{type:"submit",className:"btn btn-primary w-100",children:[e.jsx("i",{className:"bi bi-shield-lock me-2"}),"Reset Password"]})]}),m&&e.jsx("div",{className:"alert alert-info text-center mt-3",children:m}),e.jsx("div",{className:"text-center mt-3",children:e.jsxs(ye,{to:"/login",className:"text-decoration-none text-primary",children:[e.jsx("i",{className:"bi bi-box-arrow-in-left me-2"}),"Back to Login"]})})]})]})}function yt(){const[s,l]=t.useState(""),[a,i]=t.useState(!1),n=async()=>{try{i(!0);const o=await M.post("/email/verification-notification");l("Verification link resent to your email!")}catch{l("Failed to resend. Please try again later.")}finally{i(!1)}};return e.jsx("div",{className:"container d-flex justify-content-center align-items-center",style:{minHeight:"100vh"},children:e.jsxs("div",{className:"card shadow-sm p-4",style:{maxWidth:"500px",width:"100%"},children:[e.jsx("h3",{className:"text-center mb-3",children:"Verify Your Email"}),e.jsx("p",{className:"text-center",children:"A verification link has been sent to your email. Please check your inbox."}),s&&e.jsx("div",{className:"alert alert-info text-center",children:s}),e.jsx("div",{className:"text-center mt-3",children:e.jsx("button",{onClick:n,className:"btn btn-outline-primary",disabled:a,children:a?"Resending...":"Resend Verification Link"})})]})})}function wt(){return e.jsx("div",{className:"container d-flex justify-content-center align-items-center",style:{minHeight:"100vh"},children:e.jsxs("div",{className:"card shadow-sm p-4",style:{maxWidth:"500px",width:"100%"},children:[e.jsxs("h2",{className:"text-center mb-3 text-success",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Email Verified!"]}),e.jsx("p",{className:"text-center",children:"Your email has been successfully verified. You can now log in to your account."}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs(ye,{to:"/login",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-box-arrow-in-right me-2"}),"Go to Login"]})})]})})}function _t(){const{id:s,hash:l}=Ms(),a=ss();return t.useEffect(()=>{if(!s||!l)return;const i=a.search||"";window.location.replace(`/verify-email/${s}/${l}${i}`)},[l,s,a.search]),e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"60vh"},children:e.jsx(ze,{message:"Verifying your email..."})})}function St(){return e.jsxs("div",{className:"landing-page",children:[e.jsx("header",{className:"site-header shadow-sm",children:e.jsxs("div",{className:"container d-flex justify-content-between align-items-center py-2 py-md-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("img",{src:us,alt:"Kreative Dental Logo",className:"site-logo me-2"}),e.jsx("span",{className:"logo-text",children:"Kreative Dental Clinic"})]}),e.jsx("nav",{className:"d-none d-md-block",children:e.jsxs("ul",{className:"nav-list d-flex gap-2 gap-lg-3 mb-0",children:[e.jsx("li",{children:e.jsx("a",{className:"nav-link",href:"/#home",children:"Home"})}),e.jsx("li",{children:e.jsx("a",{className:"nav-link",href:"/#services",children:"Services"})}),e.jsx("li",{children:e.jsx("a",{className:"nav-link",href:"/#about",children:"About"})}),e.jsx("li",{children:e.jsx("a",{className:"nav-link",href:"/#contact",children:"Contact"})})]})})]})}),e.jsx("section",{className:"hero-section d-flex align-items-center text-white",children:e.jsxs("div",{className:"container text-center px-3 px-md-4",children:[e.jsx("h1",{className:"hero-title mb-3 mb-md-4",children:"Oops! Page not found."}),e.jsx("p",{className:"hero-subtitle mb-4 mb-md-5",children:"The page you are looking for may have moved or no longer exists."}),e.jsxs("div",{className:"hero-buttons mt-4 d-flex flex-column flex-sm-row justify-content-center align-items-center gap-2 gap-md-3",children:[e.jsx(ye,{to:"/",className:"btn btn-light btn-lg shadow w-100 w-sm-auto px-4",children:"Back to Home"}),e.jsx(ye,{to:"/login",className:"btn btn-outline-light btn-lg w-100 w-sm-auto px-4",children:"Login"}),e.jsx(ye,{to:"/register",className:"btn btn-outline-light btn-lg w-100 w-sm-auto px-4",children:"Register"})]})]})}),e.jsx("footer",{className:"text-center py-3 py-md-4 bg-primary text-white",children:e.jsx("div",{className:"container px-3 px-md-4",children:e.jsxs("p",{className:"mb-0 small",children:["Â© ",new Date().getFullYear()," Kreative Dental Clinic. All Rights Reserved."]})})})]})}function Fs(){const{items:s,unread:l,loading:a,error:i,loadList:n,loadUnread:o,markAllRead:r}=Sa(),[c,m]=t.useState(!1),[b,f]=t.useState(null),y=t.useRef(!1),h=t.useRef(null),j=t.useRef(null),u=Se(),[P,g]=t.useState({top:0,left:0}),_=340,N=()=>{if(!h.current)return;const v=h.current.getBoundingClientRect();let A=v.right-_;A=Math.max(8,A),A=Math.min(A,window.innerWidth-_-8);const z=Math.max(8,v.bottom+8);g({top:z,left:A})};t.useEffect(()=>{o()},[o]);const x=v=>{if(!v)return"";const A=new Date,z=new Date(v),T=Math.floor((A-z)/1e3);return T<60?"Just now":T<3600?`${Math.floor(T/60)}m ago`:T<86400?`${Math.floor(T/3600)}h ago`:T<604800?`${Math.floor(T/86400)}d ago`:`${Math.floor(T/86400)}d ago`},p=async()=>{const v=!c;m(v),v&&(setTimeout(()=>{N()},10),await n(),l>0&&(await r(),await o()))},C=v=>{var A;if(console.log("Notification clicked:",v),y.current){console.log("Already navigating, ignoring click");return}if(v.type==="visit_code"&&((A=v.data)!=null&&A.visit_code)){console.log("Navigating to visit code:",v.data.visit_code),y.current=!0,f(v.id),m(!1),setTimeout(()=>{u(`/dentist/visit/${v.data.visit_code}`),setTimeout(()=>{y.current=!1,f(null)},1500)},200);return}m(!1)};return t.useEffect(()=>{if(!c)return;const v=T=>T.key==="Escape"&&m(!1),A=()=>N(),z=T=>{if(!j.current||!h.current)return;const S=j.current.contains(T.target),d=h.current.contains(T.target);!S&&!d&&m(!1)};return document.addEventListener("keydown",v),window.addEventListener("resize",A),document.addEventListener("mousedown",z),()=>{document.removeEventListener("keydown",v),window.removeEventListener("resize",A),document.removeEventListener("mousedown",z)}},[c]),e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          .notification-bell-btn:hover {
            background: linear-gradient(135deg, #0096c7 0%, #0056b3 100%) !important;
            transform: translateY(-1px) !important;
          }
        `}),e.jsxs("button",{ref:h,onClick:p,className:"btn d-inline-flex align-items-center notification-bell-btn",title:"Notifications","aria-label":"Notifications",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",border:"none",color:"white",borderRadius:"8px",padding:"0.5rem 0.75rem",transition:"all 0.3s ease"},children:[e.jsx("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})}),l>0&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"#dc3545",color:"white",fontSize:"0.7rem",fontWeight:"600"},children:l>99?"99+":l})]}),c&&e.jsx("div",{ref:j,role:"dialog","aria-modal":"true",className:"position-fixed",style:{top:P.top,left:P.left,width:_,zIndex:1050,maxWidth:"calc(100vw - 16px)"},children:e.jsxs("div",{className:"card shadow",style:{borderRadius:"12px",border:"none"},children:[e.jsxs("div",{className:"card-header py-3 d-flex align-items-center justify-content-between",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",borderRadius:"12px 12px 0 0"},children:[e.jsxs("div",{children:[e.jsx("strong",{style:{fontSize:"1.1rem"},children:"Notifications"}),e.jsx("div",{className:"small",style:{opacity:.9},children:"Clinic updates & alerts"})]}),e.jsx("button",{className:"btn btn-sm p-0 notification-close-btn",onClick:()=>m(!1),style:{color:"white",background:"rgba(255,255,255,0.2)",border:"none",borderRadius:"6px",padding:"0.25rem 0.5rem",fontSize:"0.8rem",fontWeight:"600"},children:"Close"})]}),e.jsxs("div",{className:"list-group list-group-flush",style:{maxHeight:340,overflow:"auto"},children:[a&&e.jsxs("div",{className:"list-group-item small text-muted p-3",style:{textAlign:"center"},children:[e.jsx("i",{className:"bi bi-hourglass-split me-2"}),"Loadingâ€¦"]}),i&&!a&&e.jsxs("div",{className:"list-group-item small text-danger p-3",style:{textAlign:"center"},children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),i]}),!a&&!i&&s.length===0&&e.jsxs("div",{className:"list-group-item small text-muted p-4",style:{textAlign:"center"},children:[e.jsx("i",{className:"bi bi-bell-slash display-6 d-block mb-2 text-muted"}),"No notifications."]}),!a&&!i&&s.map(v=>{var A,z;return e.jsx("div",{className:`list-group-item small p-3 ${b===v.id?"list-group-item-success":""}`,style:{borderLeft:"none",borderRight:"none",borderBottom:"1px solid #f1f3f4"},children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"me-3 flex-grow-1",children:[e.jsxs("div",{className:"fw-semibold mb-1",style:{color:"#1e293b",fontSize:"0.9rem"},children:[v.title||"Notification",v.severity==="danger"&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"#dc3545",color:"white",fontSize:"0.65rem"},children:"Important"}),v.severity==="warning"&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"#ffc107",color:"#000",fontSize:"0.65rem"},children:"Warning"}),v.severity==="info"&&e.jsx("span",{className:"badge ms-2",style:{backgroundColor:"#00b4d8",color:"white",fontSize:"0.65rem"},children:"Info"}),v.type==="visit_code"&&e.jsxs("span",{className:"badge ms-2",style:{backgroundColor:"#28a745",color:"white",fontSize:"0.65rem"},children:[e.jsx("i",{className:"bi bi-key me-1"}),"Visit Code"]})]}),v.body&&e.jsx("div",{className:"text-muted mt-1",style:{fontSize:"0.8rem",lineHeight:"1.4"},children:v.type==="visit_code"&&((A=v.data)!=null&&A.visit_code)?e.jsxs(e.Fragment,{children:[v.body.split(v.data.visit_code)[0],e.jsx("span",{className:"fw-bold text-primary",style:{cursor:"pointer",textDecoration:"underline",backgroundColor:b===v.id?"#d1ecf1":"transparent",padding:"1px 3px",borderRadius:"3px"},onClick:T=>{T.preventDefault(),T.stopPropagation(),C(v)},title:"Click to use visit code and continue",children:v.data.visit_code}),v.body.split(v.data.visit_code)[1]]}):v.body}),((z=v.data)==null?void 0:z.date)&&e.jsxs("div",{className:"text-muted mt-1",style:{fontSize:"0.75rem"},children:["Date: ",v.data.date]})]}),e.jsxs("div",{className:"d-flex flex-column align-items-end",children:[b===v.id&&e.jsxs("small",{className:"text-success mb-1",children:[e.jsx("i",{className:"bi bi-arrow-right-circle me-1"}),"Opening visit..."]}),e.jsx("small",{className:"text-muted",style:{fontSize:"0.7rem",whiteSpace:"nowrap"},children:x(v.created_at)})]})]})},v.id)})]}),e.jsxs("div",{className:"card-footer py-3 d-flex justify-content-between",style:{background:"#f8f9fa",borderRadius:"0 0 12px 12px",borderTop:"1px solid #e9ecef"},children:[e.jsx(ye,{to:"/notifications",className:"btn btn-sm p-0 notification-see-all-btn",style:{color:"#00b4d8",background:"transparent",border:"none",fontWeight:"600",fontSize:"0.8rem"},children:"See all"}),e.jsx("button",{className:"btn btn-sm p-0 notification-bottom-close-btn",onClick:()=>m(!1),style:{color:"#6c757d",background:"transparent",border:"none",fontWeight:"600",fontSize:"0.8rem"},children:"Close"})]})]})})]})}function kt(){const s=Se(),l=ss(),{user:a,logout:i}=Me(),[n,o]=t.useState(()=>window.innerWidth>=992);t.useEffect(()=>{if(a&&a.role!=="admin"){const c=a.role==="staff"?"/staff":a.role==="patient"?"/patient":a.role==="dentist"?"/dentist":"/";s(c,{replace:!0})}},[a,s]),t.useEffect(()=>{const c=()=>{window.innerWidth>=992?o(!0):o(!1)};return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]);const r=async()=>{await i(),s("/")};return e.jsxs("div",{className:`admin-shell ${n?"sidebar-open":"sidebar-closed"}`,children:[e.jsxs("aside",{className:"sidebar  text-white",children:[e.jsxs("div",{className:"sidebar-header d-flex align-items-center justify-content-center position-relative",children:[e.jsx("h5",{className:"m-0 fw-bold text-center w-100",children:"Admin Panel"}),e.jsx("div",{className:"d-flex align-items-center gap-2 position-absolute",style:{right:"0.9rem",zIndex:2},children:e.jsx("button",{className:"btn btn-sm btn-outline-light d-lg-none",onClick:()=>o(!1),"aria-label":"Close sidebar",children:e.jsx("i",{className:"bi bi-x"})})})]}),e.jsx("div",{className:"nav-scroller",children:e.jsxs("ul",{className:"nav flex-column",children:[e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin",end:!0,className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"label",children:"Dashboard"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/devices",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM15.1 8H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})}),e.jsx("span",{className:"label",children:"Device Management"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/staff-register",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-4h3v-2.5c0-.83.67-1.5 1.5-1.5h2c.83 0 1.5.67 1.5 1.5V16h3v2H4zM12.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5zM24 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3z"})}),e.jsx("span",{className:"label",children:"Manage Staff Account"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/dentists",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})}),e.jsx("span",{className:"label",children:"Dentists"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/schedule",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"})}),e.jsx("span",{className:"label",children:"Clinic Schedule"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/appointments",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"})}),e.jsx("span",{className:"label",children:"Appointments"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/time-blocks",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM7 10h5v5H7z"})}),e.jsx("span",{className:"label",children:"Time Block Utilization"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/patient-manager",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M16 4c0-1.11.89-2 2-2s2 .89 2 2-.89 2-2 2-2-.89-2-2zM4 18v-4h3v-2.5c0-.83.67-1.5 1.5-1.5h2c.83 0 1.5.67 1.5 1.5V16h3v2H4zM12.5 11.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5-.67 1.5-1.5 1.5-1.5-.67-1.5-1.5zM24 16v2h-3v3h-2v-3h-3v-2h3v-3h2v3h3z"})}),e.jsx("span",{className:"label",children:"Patient Manager"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/patient-binding",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24zm2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"})}),e.jsx("span",{className:"label",children:"Patient-User Binding"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/payment-records",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"})}),e.jsx("span",{className:"label",children:"Payment Records"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/refund-requests",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm-5 14H4v-4h11v4zm0-5H4V9h11v4zm5 5h-4V9h4v9z"})}),e.jsx("span",{className:"label",children:"Refund Requests"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/policy-settings",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})}),e.jsx("span",{className:"label",children:"Policy Settings"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/services",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"})}),e.jsx("span",{className:"label",children:"Manage Services"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/service-discounts",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12.79 21L3 11.21v2c0 .45.54.67.85.35l.79-.79 1.41 1.41c.78.78 2.05.78 2.83 0l1.41-1.41 1.41 1.41c.78.78 2.05.78 2.83 0L16.94 12 18.36 13.42c.78.78 2.05.78 2.83 0l1.41-1.41.79.79c.31.32.85.1.85-.35v-2L14.21 21c-.78.78-2.05.78-2.83 0L12.79 21zM11.38 17.41c.78.78 2.05.78 2.83 0l1.41-1.41 1.41 1.41c.78.78 2.05.78 2.83 0l.71-.71L21 16.27V5c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v11.27l.43.43.71.71z"})}),e.jsx("span",{className:"label",children:"Service Promos"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/promo-archive",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2h-8l-2-2z"})}),e.jsx("span",{className:"label",children:"Promo Archive"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/inventory",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm8 13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h4v1a1 1 0 0 0 2 0V9h2v10z"})}),e.jsx("span",{className:"label",children:"Inventory"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/goals",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z"})}),e.jsx("span",{className:"label",children:"Goals"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/monthly-report",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M3.5 18.49l6-6.01 4 4L22 6.92l-1.41-1.41-7.09 7.97-4-4L2 16.99z"})}),e.jsx("span",{className:"label",children:"Monthly Visits"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/analytics",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"})}),e.jsx("span",{className:"label",children:"Analytics"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/system-logs",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 2 2h12c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})}),e.jsx("span",{className:"label",children:"System Logs"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/admin/profile",className:({isActive:c})=>"nav-link"+(c?" active":""),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H11V21H5V19H13V17H5V15H13V13H5V11H13V9H21M15 15V17H19V19H15V21H17V23H21V21H23V17H21V15H15Z"})}),e.jsx("span",{className:"label",children:"Account"})]})}),e.jsx("li",{className:"nav-item mt-4 px-3",children:e.jsxs("button",{className:"btn btn-outline-danger w-100 d-flex align-items-center justify-content-center icon-only-btn",onClick:r,title:"Logout","aria-label":"Logout",children:[e.jsx("i",{className:"bi-box-arrow-right fs-5"}),e.jsx("span",{className:"visually-hidden",children:"Logout"})]})})]})})]}),e.jsxs("div",{className:`content-area ${l.pathname==="/admin/device-approvals"?"device-approvals-content":""}`,children:[e.jsxs("div",{className:"topbar d-flex align-items-center pe-0",children:[e.jsx("button",{className:"btn btn-dark toggle-btn me-2",onClick:()=>o(c=>!c),"aria-label":"Toggle sidebar",children:e.jsx("i",{className:"bi bi-list"})}),e.jsx("div",{className:"notifications-bell me-0",children:e.jsx(Fs,{})})]}),e.jsx("main",{className:`flex-grow-1 ${l.pathname==="/admin/device-approvals"?"device-approvals-main":""}`,children:e.jsx(fs,{})})]}),e.jsx("div",{className:`sidebar-overlay ${n?"show":""}`,onClick:()=>o(!1)})]})}const Ct=()=>{const[s,l]=t.useState({phoneNumber:"",message:"",loading:!1,result:null,error:null}),a=async i=>{if(i.preventDefault(),!s.phoneNumber.trim()){l(o=>({...o,error:"Phone number is required"}));return}if(!/^9[0-9]{9}$/.test(s.phoneNumber)){l(o=>({...o,error:"Please enter a valid 10-digit Philippine mobile number (e.g., 9171234567)"}));return}l(o=>({...o,loading:!0,error:null,result:null}));try{const o="0"+s.phoneNumber,r=await ha.post("/api/admin/test-sms",{phone_number:o,message:s.message||void 0});l(c=>({...c,loading:!1,result:r.data,phoneNumber:"",message:""}))}catch(o){l(r=>{var c,m;return{...r,loading:!1,error:((m=(c=o.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to send test SMS"}})}};return e.jsx("div",{className:"admin-dashboard-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:e.jsx("div",{className:"container-fluid",style:{width:"100%",maxWidth:"none",padding:0},children:e.jsx("div",{className:"row",style:{margin:0,width:"100%"},children:e.jsxs("div",{className:"col-12",style:{padding:0},children:[e.jsxs("div",{className:"text-center mb-5",children:[e.jsx("div",{className:"rounded-circle mx-auto mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",border:"2px solid #e2e8f0"},children:e.jsx("i",{className:"bi bi-house-door",style:{color:"#1e293b"}})}),e.jsx("h1",{className:"fw-bold mb-3",style:{color:"#1e293b"},children:"Welcome, Admin!"}),e.jsx("p",{className:"text-muted fs-5",children:"Your administrative control center"})]}),e.jsxs("div",{className:"row g-4 mb-5",style:{margin:0,width:"100%"},children:[e.jsx("div",{className:"col-12 col-sm-6 col-lg-3",style:{padding:"0.5rem"},children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",width:"100%"},children:e.jsxs("div",{className:"card-body p-4 text-center",children:[e.jsx("div",{className:"rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px",fontSize:"1.5rem",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",border:"2px solid #e2e8f0"},children:e.jsx("i",{className:"bi bi-people",style:{color:"#1e293b"}})}),e.jsx("h5",{className:"fw-bold",style:{color:"#1e293b"},children:"Patient Management"}),e.jsx("p",{className:"text-muted small",children:"Manage patient records and appointments"})]})})}),e.jsx("div",{className:"col-12 col-sm-6 col-lg-3",style:{padding:"0.5rem"},children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",width:"100%"},children:e.jsxs("div",{className:"card-body p-4 text-center",children:[e.jsx("div",{className:"bg-success rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-calendar-check text-white"})}),e.jsx("h5",{className:"fw-bold text-success",children:"Appointments"}),e.jsx("p",{className:"text-muted small",children:"Schedule and manage appointments"})]})})}),e.jsx("div",{className:"col-12 col-sm-6 col-lg-3",style:{padding:"0.5rem"},children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",width:"100%"},children:e.jsxs("div",{className:"card-body p-4 text-center",children:[e.jsx("div",{className:"bg-info rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-bar-chart text-white"})}),e.jsx("h5",{className:"fw-bold text-info",children:"Analytics"}),e.jsx("p",{className:"text-muted small",children:"View reports and analytics"})]})})}),e.jsx("div",{className:"col-12 col-sm-6 col-lg-3",style:{padding:"0.5rem"},children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",width:"100%"},children:e.jsxs("div",{className:"card-body p-4 text-center",children:[e.jsx("div",{className:"bg-warning rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"60px",height:"60px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-gear text-white"})}),e.jsx("h5",{className:"fw-bold text-warning",children:"Settings"}),e.jsx("p",{className:"text-muted small",children:"Configure system settings"})]})})})]}),e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px",width:"100%"},children:[e.jsx("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Dashboard Status"]})}),e.jsxs("div",{className:"card-body p-5 text-center",children:[e.jsx("div",{className:"bg-light rounded-circle mx-auto mb-4 d-flex align-items-center justify-content-center",style:{width:"100px",height:"100px",fontSize:"2.5rem"},children:"ðŸš§"}),e.jsx("h4",{className:"fw-bold mb-3",style:{color:"#1e293b"},children:"Dashboard Under Construction"}),e.jsx("p",{className:"text-muted fs-5 mb-4",children:"We're working hard to bring you a comprehensive admin dashboard with all the features you need."}),e.jsxs("div",{className:"row g-3 justify-content-center",style:{margin:0,width:"100%"},children:[e.jsx("div",{className:"col-12 col-sm-6 col-md-4",style:{padding:"0.5rem"},children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px",width:"100%"},children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-check text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark",children:"User Management"}),e.jsx("small",{className:"text-muted",children:"Available"})]})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4",style:{padding:"0.5rem"},children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px",width:"100%"},children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-check text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark",children:"System Logs"}),e.jsx("small",{className:"text-muted",children:"Available"})]})]})}),e.jsx("div",{className:"col-12 col-sm-6 col-md-4",style:{padding:"0.5rem"},children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px",width:"100%"},children:[e.jsx("div",{className:"bg-warning rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-clock text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark",children:"Analytics"}),e.jsx("small",{className:"text-muted",children:"Coming Soon"})]})]})})]})]})]}),e.jsxs("div",{className:"card border-0 shadow-sm mt-4",style:{borderRadius:"16px",width:"100%"},children:[e.jsx("div",{className:"card-header bg-info text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-chat-dots me-2"}),"SMS Test"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("form",{onSubmit:a,children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{htmlFor:"phoneNumber",className:"form-label fw-semibold",children:"Phone Number (Philippines)"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:"+63"}),e.jsx("input",{type:"text",className:"form-control border-start-0",id:"phoneNumber",placeholder:"9171234567",value:s.phoneNumber,onChange:i=>l(n=>({...n,phoneNumber:i.target.value})),disabled:s.loading,maxLength:10})]}),e.jsx("div",{className:"form-text",children:"Enter 10-digit Philippine mobile number (e.g., 9171234567)"})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{htmlFor:"message",className:"form-label fw-semibold",children:"Custom Message (Optional)"}),e.jsx("input",{type:"text",className:"form-control",id:"message",placeholder:"Leave empty for default test message",value:s.message,onChange:i=>l(n=>({...n,message:i.target.value})),disabled:s.loading,maxLength:160}),e.jsxs("div",{className:"form-text",children:[s.message.length,"/160 characters"]})]}),e.jsx("div",{className:"col-12",children:e.jsx("button",{type:"submit",className:"btn btn-info btn-lg px-4",disabled:s.loading||!s.phoneNumber.trim()||!/^9[0-9]{9}$/.test(s.phoneNumber),children:s.loading?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Test SMS"]})})})]})}),s.error&&e.jsxs("div",{className:"alert alert-danger mt-3",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),s.error]}),s.result&&e.jsxs("div",{className:"alert alert-success mt-3",role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),e.jsx("strong",{children:"Success!"})," ",s.result.message,s.result.data&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{children:[e.jsx("strong",{children:"Phone:"})," +63",s.result.data.phone_number.replace("+639",""),e.jsx("br",{}),e.jsx("strong",{children:"Message:"})," ",s.result.data.message,e.jsx("br",{}),e.jsx("strong",{children:"Sent at:"})," ",new Date(s.result.data.sent_at).toLocaleString()]})})]})]})]})]})})})})},Pt=()=>{const[s,l]=t.useState([]),[a,i]=t.useState(!0),[n,o]=t.useState({}),r=async()=>{try{const b=await M.get("/api/admin/pending-devices");console.log("Pending devices:",b.data),l(b.data)}catch(b){console.error("Failed to load pending devices:",b)}finally{i(!1)}};t.useEffect(()=>{r()},[]);const c=async b=>{try{await M.post("/api/admin/approve-device",{device_id:b,device_name:n[b]||""}),r()}catch(f){console.error("Failed to approve:",f)}},m=async b=>{try{await M.post("/api/admin/reject-device",{device_id:b}),r()}catch(f){console.error("Failed to reject:",f)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"ðŸ“± Pending Device Approvals"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Review and approve staff device registrations"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("span",{className:"badge bg-warning fs-6",children:[s.length," pending approval",s.length!==1?"s":""]})})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-0",children:a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading pending devices..."})]})}):s.length===0?e.jsx("div",{className:"text-center text-muted",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"ðŸ“±"}),e.jsx("h4",{className:"text-muted mb-3",children:"No devices pending approval"}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"All staff devices have been reviewed and approved."})]})}):e.jsx("div",{className:"table-responsive",style:{width:"100%"},children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Staff Member"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Device Info"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Request Date"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Device Name"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold text-center",style:{fontSize:"0.9rem",color:"#64748b"},children:"Actions"})]})}),e.jsx("tbody",{children:s.map(b=>{var f;return e.jsxs("tr",{className:"border-bottom",children:[e.jsx("td",{className:"px-4 py-3 border-0",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-person text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",style:{fontSize:"1rem",color:"#1e293b"},children:b.staff_name}),e.jsx("div",{className:"text-muted small",children:b.staff_role})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",style:{fontSize:"0.9rem",color:"#374151"},children:b.device_type||"Unknown Device"}),e.jsxs("div",{className:"text-muted small font-monospace",children:[(f=b.device_fingerprint)==null?void 0:f.substring(0,20),"..."]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"0.9rem",color:"#6b7280"},children:new Date(b.created_at).toLocaleDateString()}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px",fontSize:"0.9rem"},placeholder:"e.g. Front Desk PC",value:n[b.id]||"",onChange:y=>o(h=>({...h,[b.id]:y.target.value}))})}),e.jsx("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{className:"btn btn-sm btn-success me-1",onClick:()=>c(b.id),style:{borderRadius:"8px"},title:"Approve device",children:e.jsx("i",{className:"bi bi-check-circle"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>m(b.id),style:{borderRadius:"8px"},title:"Reject device",children:e.jsx("i",{className:"bi bi-x-circle"})})]})})]},b.id)})})]})})})})]})},Rt=()=>{const[s,l]=t.useState([]),[a,i]=t.useState(!0),[n,o]=t.useState(null),[r,c]=t.useState(""),m=async()=>{try{const y=await M.get("/api/approved-devices");l(y.data)}catch(y){console.error("Failed to load approved devices:",y)}finally{i(!1)}},b=async y=>{try{await M.put("/api/rename-device",{device_id:y,device_name:r}),o(null),c(""),m()}catch(h){console.error("Rename failed:",h)}},f=async y=>{try{await M.post("/api/revoke-device",{device_id:y}),m()}catch(h){console.error("Revoke failed:",h)}};return t.useEffect(()=>{m()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"âœ… Approved Staff Devices"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Manage and monitor approved staff devices"})]}),e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("span",{className:"badge bg-success fs-6",children:[s.length," approved device",s.length!==1?"s":""]})})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-0",children:a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-success mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading approved devices..."})]})}):s.length===0?e.jsx("div",{className:"text-center text-muted",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"âœ…"}),e.jsx("h4",{className:"text-muted mb-3",children:"No approved devices"}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"No devices have been approved yet."})]})}):e.jsx("div",{className:"table-responsive",style:{width:"100%"},children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Staff Member"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Device Name"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Device Fingerprint"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold",style:{fontSize:"0.9rem",color:"#64748b"},children:"Last Updated"}),e.jsx("th",{className:"px-4 py-3 border-0 fw-semibold text-center",style:{fontSize:"0.9rem",color:"#64748b"},children:"Actions"})]})}),e.jsx("tbody",{children:s.map(y=>{var h;return e.jsxs("tr",{className:"border-bottom",children:[e.jsx("td",{className:"px-4 py-3 border-0",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-success rounded-circle d-flex align-items-center justify-content-center me-3",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-person text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold",style:{fontSize:"1rem",color:"#1e293b"},children:y.staff_name}),e.jsx("div",{className:"text-muted small",children:y.staff_role||"Staff"})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",children:n===y.id?e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("input",{type:"text",className:"form-control form-control-sm",value:r,onChange:j=>c(j.target.value),placeholder:"New device name",style:{maxWidth:"200px"}}),e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>b(y.id),children:e.jsx("i",{className:"bi bi-check"})}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>o(null),children:e.jsx("i",{className:"bi bi-x"})})]}):e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("span",{className:"fw-medium",style:{fontSize:"1rem",color:"#374151"},children:y.device_name||"(Unnamed)"}),e.jsx("button",{className:"btn btn-link btn-sm p-0",onClick:()=>{o(y.id),c(y.device_name||"")},title:"Edit device name",children:e.jsx("i",{className:"bi bi-pencil text-primary"})})]})}),e.jsx("td",{className:"px-4 py-3 border-0",children:e.jsxs("div",{className:"font-monospace small text-muted",children:[(h=y.device_fingerprint)==null?void 0:h.substring(0,30),"..."]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"0.9rem",color:"#6b7280"},children:new Date(y.updated_at).toLocaleString()}),e.jsx("td",{className:"px-4 py-3 border-0 text-center",children:e.jsxs("button",{className:"btn btn-danger btn-sm",onClick:()=>f(y.id),title:"Revoke device access",children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Revoke"]})})]},y.id)})})]})})})})]})};function Dt(){const[s,l]=t.useState("approvals"),a=({id:i,icon:n,label:o})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${s===i?"":"btn-outline-primary"}`,onClick:()=>l(i),type:"button",style:{background:s===i?"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)":"transparent",color:s===i?"#1e293b":"#6b7280",border:s===i?"1px solid #e2e8f0":"1px solid #d1d5db",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${n==="ðŸ“±"?"phone":"check-circle"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:o}),e.jsx("span",{className:"d-sm-none",children:o.split(" ")[0]})]});return e.jsx("div",{className:"admin-device-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",maxWidth:"100%",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:[e.jsxs("h2",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-phone me-2"}),"Admin Device Management"]}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#6b7280"},children:"Comprehensive device approval and management system"})]}),e.jsxs("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 mb-4",role:"group","aria-label":"Device tabs",children:[e.jsx(a,{id:"approvals",icon:"ðŸ“±",label:"Device Approvals"}),e.jsx(a,{id:"approved",icon:"âœ…",label:"Approved Devices"})]}),e.jsxs("div",{className:"tab-content",style:{width:"100%",maxWidth:"100%"},children:[s==="approvals"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(Pt,{})}),s==="approved"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(Rt,{})})]})]})]})})})})}const At=()=>{const[s,l]=t.useState("create"),[a,i]=t.useState([]),[n,o]=t.useState(!1),[r,c]=t.useState(""),[m,b]=t.useState(1),[f,y]=t.useState(1),[h,j]=t.useState({}),[u,P]=t.useState(null),[g,_]=t.useState({name:"",email:"",password:"",password_confirmation:""}),[N,x]=t.useState(null),[p,C]=t.useState({}),v=async(H=1,G="")=>{o(!0);try{const $=await M.get("/api/admin/staff",{params:{page:H,search:G||void 0}});i($.data.data),j({current_page:$.data.current_page,last_page:$.data.last_page,per_page:$.data.per_page,total:$.data.total}),y($.data.last_page)}catch($){console.error("Failed to fetch staff accounts:",$)}finally{o(!1)}};t.useEffect(()=>{if(s==="manage"){if(u&&clearTimeout(u),r&&r.length>=2){const H=setTimeout(()=>{v(m,r)},300);P(H)}else r.length===0&&v(m,r);return()=>{u&&clearTimeout(u)}}},[s,m,r]);const A=H=>{_({...g,[H.target.name]:H.target.value})},z=async H=>{var G,$;H.preventDefault(),x(null),C({});try{const L=await M.post("/api/admin/staff",g);x("âœ… Staff account created successfully!"),_({name:"",email:"",password:"",password_confirmation:""}),s==="manage"&&v(m,r)}catch(L){($=(G=L.response)==null?void 0:G.data)!=null&&$.errors?C(L.response.data.errors):x("âŒ Something went wrong.")}},T=async(H,G)=>{if(confirm(`Are you sure you want to ${G==="activated"?"deactivate":"activate"} this staff account?`))try{await M.post(`/api/admin/staff/${H}/toggle-status`),x(`âœ… Staff account ${G==="activated"?"deactivated":"activated"} successfully!`),v(m,r)}catch{x("âŒ Failed to update staff account status.")}},S=H=>{c(H.target.value),b(1)},d=H=>{b(H)},R=()=>{if(f<=1)return null;const H=[];for(let G=1;G<=f;G++)H.push(e.jsx("button",{className:`btn btn-sm ${G===m?"btn-primary":"btn-outline-primary"}`,onClick:()=>d(G),children:G},G));return e.jsx("div",{className:"d-flex justify-content-center gap-2 mt-3",children:H})};return e.jsxs("div",{className:"manage-staff-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box"},children:[e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-people me-2"}),"Manage Staff Accounts"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Create new staff accounts and manage existing ones"})]})}),N&&e.jsxs("div",{className:`alert ${N.includes("âœ…")?"alert-success":"alert-danger"} alert-dismissible fade show`,role:"alert",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",children:"â„¹ï¸"}),N]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>x(null),"aria-label":"Close"})]}),e.jsx("div",{className:"card border-0 shadow-sm mb-4",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-0",children:e.jsxs("ul",{className:"nav nav-tabs border-0",id:"staffTabs",role:"tablist",children:[e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${s==="create"?"active":""}`,onClick:()=>l("create"),style:{border:"none",borderRadius:"16px 16px 0 0",fontWeight:"600",padding:"1rem 1.5rem",color:s==="create"?"#3b82f6":"#6b7280",backgroundColor:s==="create"?"white":"transparent"},children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Create Staff Account"]})}),e.jsx("li",{className:"nav-item",role:"presentation",children:e.jsxs("button",{className:`nav-link ${s==="manage"?"active":""}`,onClick:()=>l("manage"),style:{border:"none",borderRadius:"16px 16px 0 0",fontWeight:"600",padding:"1rem 1.5rem",color:s==="manage"?"#3b82f6":"#6b7280",backgroundColor:s==="manage"?"white":"transparent"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Manage Staff Accounts"]})})]})})}),e.jsxs("div",{className:"tab-content",children:[s==="create"&&e.jsx("div",{className:"row g-2 g-md-3 g-lg-4",children:e.jsx("div",{className:"col-12 col-lg-8 col-xl-6",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("h5",{className:"card-title mb-4 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Staff Account Details"]}),e.jsx("form",{onSubmit:z,children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-medium",children:"Full Name"}),e.jsx("input",{name:"name",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:g.name,onChange:A,placeholder:"e.g. Jane Dela Cruz",required:!0}),p.name&&e.jsx("div",{className:"text-danger mt-1 small",children:p.name[0]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-medium",children:"Email Address"}),e.jsx("input",{name:"email",type:"email",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:g.email,onChange:A,placeholder:"e.g. jane.staff@clinic.com",required:!0}),p.email&&e.jsx("div",{className:"text-danger mt-1 small",children:p.email[0]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label fw-medium",children:"Password"}),e.jsx("input",{name:"password",type:"password",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:g.password,onChange:A,placeholder:"Enter password",required:!0}),p.password&&e.jsx("div",{className:"text-danger mt-1 small",children:p.password[0]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label fw-medium",children:"Confirm Password"}),e.jsx("input",{name:"password_confirmation",type:"password",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:g.password_confirmation,onChange:A,placeholder:"Re-enter password",required:!0})]}),e.jsx("div",{className:"col-12",children:e.jsxs("button",{className:"btn w-100 border-0 shadow-sm",type:"submit",style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",borderRadius:"8px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-person-plus me-2"}),"Register Staff Member"]})})]})})]})})})}),s==="manage"&&e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("h5",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Staff Accounts (",h.total||0,")"]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs("div",{className:"input-group",style:{minWidth:"300px"},children:[e.jsx("span",{className:"input-group-text border-0 bg-light",children:e.jsx("i",{className:"bi bi-search"})}),e.jsx("input",{type:"text",className:"form-control border-0 bg-light",placeholder:"Search by name or email... (min 2 characters)",value:r,onChange:S,style:{borderRadius:"8px"}}),r.length>0&&r.length<2&&e.jsxs("div",{className:"form-text text-warning mt-1",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Please enter at least 2 characters to search"]})]})})]}),n?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading staff accounts..."})]}):a.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-people text-muted",style:{fontSize:"3rem"}}),e.jsx("p",{className:"text-muted mt-3",children:"No staff accounts found"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Created"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:a.map(H=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-medium",children:H.name}),e.jsx("td",{children:H.email}),e.jsx("td",{children:e.jsx("span",{className:`badge ${H.status==="activated"?"bg-success":"bg-danger"}`,children:H.status})}),e.jsx("td",{children:new Date(H.created_at).toLocaleDateString()}),e.jsx("td",{children:e.jsxs("button",{className:`btn btn-sm ${H.status==="activated"?"btn-outline-danger":"btn-outline-success"}`,onClick:()=>T(H.id,H.status),title:H.status==="activated"?"Deactivate Account":"Activate Account",children:[e.jsx("i",{className:`bi ${H.status==="activated"?"bi-person-x":"bi-person-check"}`}),H.status==="activated"?"Deactivate":"Activate"]})})]},H.id))})]})}),R()]})]})})]})]})},Mt=()=>{const[s,l]=t.useState(null),[a,i]=t.useState(""),[n,o]=t.useState(""),[r,c]=t.useState(!1);Se(),t.useEffect(()=>{(async()=>{try{const f=await M.get("/api/user");l(f.data)}catch(f){console.error("Failed to fetch user info",f)}})()},[]);const m=async()=>{var b,f;i(""),o(""),c(!0);try{const y=await M.post("/api/send-password-reset");i(y.data.message||"Password reset link sent to your email!")}catch(y){const h=((f=(b=y.response)==null?void 0:b.data)==null?void 0:f.message)||"Failed to send reset link";o(h)}finally{c(!1)}};return s?e.jsx("div",{className:"admin-profile-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box"},children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-md-8 col-lg-6 col-xl-5",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("h2",{className:"fw-bold mb-2",style:{color:"#1e293b"},children:"ðŸ‘¤ Admin Account"}),e.jsx("p",{className:"text-muted",children:"Manage your account settings and security"})]}),e.jsxs("div",{className:"card border-0 shadow-sm mb-4",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"Profile Information"]})}),e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",border:"2px solid #e2e8f0"},children:e.jsx("i",{className:"bi bi-person",style:{color:"#1e293b"}})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Full Name"}),e.jsx("div",{className:"fw-bold text-dark",children:s.name})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-envelope text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Email Address"}),e.jsx("div",{className:"fw-bold text-dark",children:s.email})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-shield-check text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Role"}),e.jsx("div",{className:"fw-bold text-dark",children:e.jsx("span",{className:"badge bg-success",children:s.role})})]})]})})]})})]}),a&&e.jsxs("div",{className:"alert alert-success border-0 shadow-sm mb-4",style:{borderRadius:"12px"},role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),a]}),n&&e.jsxs("div",{className:"alert alert-danger border-0 shadow-sm mb-4",style:{borderRadius:"12px"},role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),n]}),e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-warning text-dark border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-key me-2"}),"Security Settings"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("p",{className:"text-muted mb-4",children:"Need to change your password? We'll send you a secure reset link to your email address."}),e.jsx("button",{className:"btn border-0 shadow-sm w-100",onClick:m,disabled:r,style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-envelope me-2"}),"Send Password Reset Link"]})})]})]})]})})})}):e.jsx("p",{children:"Loading..."})};function Lt({show:s,onClose:l,onCategoryAdded:a}){const[i,n]=t.useState({name:"",description:""}),[o,r]=t.useState(!1),[c,m]=t.useState({}),b=h=>{const{name:j,value:u}=h.target;n(P=>({...P,[j]:u})),c[j]&&m(P=>({...P,[j]:null}))},f=async h=>{var j,u;h.preventDefault(),r(!0),m({});try{const P=await M.post("/api/service-categories",i);a&&a(P.data),n({name:"",description:""}),l()}catch(P){(u=(j=P.response)==null?void 0:j.data)!=null&&u.errors?m(P.response.data.errors):(console.error("Failed to create category:",P),m({general:"Failed to create category. Please try again."}))}finally{r(!1)}},y=()=>{n({name:"",description:""}),m({}),l()};return s?e.jsx("div",{className:"modal fade show",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"Add New Service Category"}),e.jsx("button",{type:"button",className:"btn-close",onClick:y,disabled:o})]}),e.jsxs("form",{onSubmit:f,style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0,overflow:"hidden"},children:[e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[c.general&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:c.general}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"name",className:"form-label",children:["Category Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",className:`form-control ${c.name?"is-invalid":""}`,id:"name",name:"name",value:i.name,onChange:b,placeholder:"Enter category name",required:!0}),c.name&&e.jsx("div",{className:"invalid-feedback",children:c.name[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"Description"}),e.jsx("textarea",{className:`form-control ${c.description?"is-invalid":""}`,id:"description",name:"description",value:i.description,onChange:b,placeholder:"Enter category description (optional)",rows:"3"}),c.description&&e.jsx("div",{className:"invalid-feedback",children:c.description[0]})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:y,disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Adding..."]}):"Add Category"})]})]})]})})}):null}function Ft(){var oe;const[s,l]=t.useState([]),[a,i]=t.useState([]),[n,o]=t.useState(!0),[r,c]=t.useState(!1),[m,b]=t.useState(!1),[f,y]=t.useState(!1),[h,j]=t.useState(null),[u,P]=t.useState(""),[g,_]=t.useState({name:"",description:"",price:"",service_category_id:"",is_excluded_from_analytics:!1,estimated_minutes:"",is_special:!1,per_teeth_service:!1,per_tooth_minutes:"",special_start_date:"",special_end_date:"",bundled_service_ids:[]}),[N,x]=t.useState(!1),[p,C]=t.useState(null),[v,A]=t.useState({});t.useRef(null);const[z,T]=t.useState(!1),[S,d]=t.useState(null);t.useEffect(()=>{R(),H()},[]);const R=async()=>{try{const Y=await M.get("/api/services");l(Y.data)}catch(Y){console.error("Failed to fetch services",Y)}finally{o(!1)}},H=async()=>{try{const Y=await M.get("/api/service-categories");i(Y.data)}catch(Y){console.error("Failed to fetch categories",Y)}},G=Y=>{i(F=>[...F,Y]),_(F=>({...F,service_category_id:Y.id.toString()}))},$=u?s.filter(Y=>{var F,q,X;return((q=(F=Y.category)==null?void 0:F.id)==null?void 0:q.toString())===u||((X=Y.service_category_id)==null?void 0:X.toString())===u}):s,L=Y=>{P(Y.target.value)},E=()=>{P("")},I=Y=>{const{name:F,type:q,checked:X,value:re}=Y.target;_(F==="is_special"&&X?{...g,[F]:X,per_teeth_service:!1}:{...g,[F]:q==="checkbox"?X:re})},W=Y=>{j(Y),b(!0)},B=async()=>{try{await M.delete(`/api/services/${h.id}`),b(!1),j(null),R()}catch(Y){console.error("Failed to delete service",Y)}},Z=async()=>{const Y=g.is_special,F=!g.special_start_date&&!g.special_end_date;if(Y&&F){T(!0),d(()=>()=>te());return}te()},te=async()=>{try{N?await M.put(`/api/services/${p}`,g):await M.post("/api/services",g),c(!1),R(),ne(),A({})}catch(Y){Y.response&&Y.response.status===422?A(Y.response.data.errors||{}):console.error("Failed to save service",Y)}},ne=()=>{_({name:"",description:"",price:"",category:"",is_excluded_from_analytics:!1,estimated_minutes:"",is_special:!1,per_teeth_service:!1,per_tooth_minutes:"",special_start_date:"",special_end_date:"",bundled_service_ids:[]}),x(!1),C(null)},be=Y=>{var F,q,X,re;_({name:Y.name,description:Y.description,price:Y.price,service_category_id:((q=(F=Y.category)==null?void 0:F.id)==null?void 0:q.toString())||((X=Y.service_category_id)==null?void 0:X.toString())||"",is_excluded_from_analytics:Y.is_excluded_from_analytics||!1,estimated_minutes:Y.estimated_minutes||"",is_special:Y.is_special||!1,per_teeth_service:Y.per_teeth_service||!1,per_tooth_minutes:Y.per_tooth_minutes||"",special_start_date:Y.special_start_date||"",special_end_date:Y.special_end_date||"",bundled_service_ids:((re=Y.bundled_services)==null?void 0:re.map(V=>V.id))||[]}),C(Y.id),x(!0),c(!0)};return e.jsxs("div",{className:"service-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Service Management"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Manage your clinic's services and packages"})]}),e.jsx("div",{className:"d-flex gap-2 flex-wrap",children:e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:()=>c(!0),style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add New Service"]})})]}),e.jsx("div",{className:"card border-0 shadow-sm mb-4",style:{borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsxs("h6",{className:"mb-0 fw-semibold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-funnel me-2"}),"Filter Services by Category"]}),e.jsx("small",{className:"text-muted",children:"Show services from a specific category"})]}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:u,onChange:L,children:[e.jsx("option",{value:"",children:"All Categories"}),a.map(Y=>e.jsx("option",{value:Y.id,children:Y.name},Y.id))]}),u&&e.jsx("button",{className:"btn btn-outline-secondary border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},onClick:E,title:"Clear filter",children:e.jsx("i",{className:"bi bi-x-lg"})})]})})]}),u&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"alert alert-info mb-0",style:{borderRadius:"12px"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Showing ",$.length," service",$.length!==1?"s":""," from category: ",e.jsx("strong",{children:(oe=a.find(Y=>Y.id.toString()===u))==null?void 0:oe.name})]})})]})}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-4",children:n?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Fetching services..."})]})}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0 w-100",children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-tag me-2"}),"Service Name"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Description"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-currency-dollar me-2"}),"Price"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-grid me-2"}),"Category"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Time"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-star me-2"}),"Special"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-graph-up me-2"}),"Analytics"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Per Teeth"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0 text-center",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Actions"]})]})}),e.jsx("tbody",{children:$.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"9",className:"text-center py-5",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-inbox display-4 d-block mb-3"}),e.jsx("h5",{children:"No services found"}),e.jsx("p",{className:"mb-0",children:u?"No services found in the selected category.":"No services available. Add your first service to get started."})]})})}):$.map(Y=>{var F,q;return e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸ¦·"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:Y.name}),((F=Y.bundled_services)==null?void 0:F.length)>0&&e.jsxs("small",{className:"text-muted",children:["(",Y.bundled_services.map(X=>X.name).join(", "),")"]})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"200px"},title:Y.description,children:Y.description||"-"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"fw-bold text-success fs-5",children:Y.per_teeth_service?`â‚±${Number(Y.price).toFixed(2)} per tooth`:`â‚±${Number(Y.price).toFixed(2)}`})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("span",{className:"badge bg-light text-dark",children:((q=Y.category)==null?void 0:q.name)||"-"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("span",{className:"fw-semibold text-dark",children:[Y.estimated_minutes," mins"]}),e.jsx("small",{className:"text-muted",children:"Estimated"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"d-flex flex-column align-items-start",children:Y.is_special?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"badge bg-warning text-dark mb-1",children:"Special"}),e.jsx("small",{className:"text-muted",children:Y.special_start_date&&Y.special_end_date?`${Y.special_start_date} â†’ ${Y.special_end_date}`:"(Permanent)"})]}):e.jsx("span",{className:"text-muted",children:"-"})})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("span",{className:`badge ${Y.is_excluded_from_analytics?"bg-danger":"bg-success"}`,children:Y.is_excluded_from_analytics?"Excluded":"Included"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("span",{className:`badge ${Y.per_teeth_service?"bg-info":"bg-secondary"}`,children:Y.per_teeth_service?"Yes":"No"})}),e.jsx("td",{className:"px-4 py-3 text-center border-0",children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{className:"btn btn-sm btn-success",onClick:()=>be(Y),title:"Edit service",children:e.jsx("i",{className:"bi bi-pencil"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>W(Y),title:"Delete service",children:e.jsx("i",{className:"bi bi-trash"})})]})})]},Y.id)})})]})})})}),r&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",role:"dialog",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:N?"Edit Service":"Add Service"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>{c(!1),ne()}})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Service Name ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"text",name:"name",className:`form-control ${v.name?"is-invalid":""}`,value:g.name,onChange:I,required:!0}),v.name&&e.jsx("div",{className:"invalid-feedback",children:v.name[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Description"}),e.jsx("textarea",{name:"description",className:`form-control ${v.description?"is-invalid":""}`,value:g.description,onChange:I}),v.description&&e.jsx("div",{className:"invalid-feedback",children:v.description[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Price (â‚±) ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"number",name:"price",className:`form-control ${v.price?"is-invalid":""}`,value:g.price,onChange:I,required:!0}),g.per_teeth_service&&e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"This will be the price per tooth. Total cost will be calculated based on number of teeth treated."]}),v.price&&e.jsx("div",{className:"invalid-feedback",children:v.price[0]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Category ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsxs("div",{className:"input-group",children:[e.jsxs("select",{name:"service_category_id",className:`form-select ${v.service_category_id?"is-invalid":""}`,value:g.service_category_id,onChange:I,required:!0,children:[e.jsx("option",{value:"",children:"-- Select Category --"}),a.map(Y=>e.jsx("option",{value:Y.id,children:Y.name},Y.id))]}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:()=>y(!0),title:"Add new category",children:e.jsx("i",{className:"bi bi-plus"})})]}),v.service_category_id&&e.jsx("div",{className:"invalid-feedback",children:v.service_category_id[0]})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"excludeAnalytics",name:"is_excluded_from_analytics",checked:g.is_excluded_from_analytics,onChange:I}),e.jsxs("label",{className:"form-check-label",htmlFor:"excludeAnalytics",children:["Exclude from analytics",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Used to hide situational services like dentures from charts and usage-based reports."})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Estimated Procedure Time (minutes)"," ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"number",name:"estimated_minutes",className:`form-control ${v.estimated_minutes?"is-invalid":""}`,value:g.estimated_minutes,onChange:I,required:!0}),e.jsx("small",{className:"text-muted",children:"This will be automatically rounded up to the nearest 30 minutes."}),v.estimated_minutes&&e.jsx("div",{className:"invalid-feedback",children:v.estimated_minutes[0]})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"isSpecial",name:"is_special",checked:g.is_special,onChange:I}),e.jsxs("label",{className:"form-check-label",htmlFor:"isSpecial",children:["Mark as Special / Package",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Special services require a start and end date and cannot be used with promo discounts."})]})]}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"perTeethService",name:"per_teeth_service",checked:g.per_teeth_service,onChange:I,disabled:g.is_special}),e.jsxs("label",{className:"form-check-label",htmlFor:"perTeethService",children:["Per Teeth Service",e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:"Track which specific tooth was serviced and what procedure was done. Examples: Tooth Extraction, Tooth Filling, Root Canal Treatment."})]})]}),g.per_teeth_service&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Minutes per Tooth ",e.jsx("span",{className:"text-danger",children:"*"})]}),e.jsx("input",{type:"number",name:"per_tooth_minutes",className:`form-control ${v.per_tooth_minutes?"is-invalid":""}`,value:g.per_tooth_minutes,onChange:I,min:"1",max:"60",required:!0}),e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Time per tooth. Total appointment time will be calculated as: (minutes per tooth Ã— number of teeth) rounded up to 30-minute blocks."]}),v.per_tooth_minutes&&e.jsx("div",{className:"invalid-feedback",children:v.per_tooth_minutes[0]})]}),g.is_special&&g.per_teeth_service&&e.jsxs("div",{className:"alert alert-warning mb-3",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Warning:"})," Per Teeth Service is only available for solo services. Since this service is marked as Special/Package, the Per Teeth option has been turned off."]}),g.is_special&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Start Date"," ",e.jsx("small",{className:"text-muted",children:"(optional)"})]}),e.jsx("input",{type:"date",name:"special_start_date",className:`form-control ${v.special_start_date?"is-invalid":""}`,value:g.special_start_date,onChange:I}),v.special_start_date&&e.jsx("div",{className:"invalid-feedback",children:v.special_start_date[0]}),e.jsxs("label",{className:"form-label mt-2",children:["End Date ",e.jsx("small",{className:"text-muted",children:"(optional)"})]}),e.jsx("input",{type:"date",name:"special_end_date",className:`form-control ${v.special_end_date?"is-invalid":""}`,value:g.special_end_date,onChange:I}),v.special_end_date&&e.jsx("div",{className:"invalid-feedback",children:v.special_end_date[0]}),e.jsx("label",{className:"form-label",children:"Bundled Services"}),e.jsx("div",{className:"border rounded p-2",style:{maxHeight:200,overflowY:"auto"},children:s.filter(Y=>Y.id!==p).map(Y=>e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:`bundle-${Y.id}`,checked:g.bundled_service_ids.includes(Y.id),onChange:F=>{const q=F.target.checked;_(X=>{const re=q?[...X.bundled_service_ids,Y.id]:X.bundled_service_ids.filter(V=>V!==Y.id);return{...X,bundled_service_ids:re}})}}),e.jsx("label",{className:"form-check-label",htmlFor:`bundle-${Y.id}`,children:Y.name})]},Y.id))}),e.jsx("small",{className:"text-muted",children:"Tick services to include in this package."})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{c(!1),ne()},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:Z,children:"Save"})]})]})})}),m&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",role:"dialog",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-danger text-white flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"âš ï¸ Confirm Deletion"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>b(!1)})]}),e.jsx("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:e.jsxs("p",{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:h==null?void 0:h.name}),"?",e.jsx("br",{}),e.jsx("span",{className:"text-danger",children:"This action cannot be undone."})]})}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>b(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-danger",onClick:B,children:"Yes, Delete"})]})]})})}),z&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",role:"dialog",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"Confirm Permanent Special"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>T(!1)})]}),e.jsx("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:e.jsxs("p",{children:["This special service has no start or end date.",e.jsx("br",{}),"Do you want to save it as a ",e.jsx("strong",{children:"permanent package"}),"?"]})}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>T(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:()=>{T(!1),S&&S()},children:"Yes, Save as Permanent"})]})]})})}),e.jsx(Lt,{show:f,onClose:()=>y(!1),onCategoryAdded:G})]})}function zt({show:s,services:l,onSelect:a,onClose:i}){const[n,o]=t.useState(null);ma.useEffect(()=>{s||o(null)},[s]),t.useEffect(()=>{if(s){const m=document.body.style.overflow;return document.body.style.overflow="auto",()=>{document.body.style.overflow=m}}},[s]);const r=m=>{o(m)},c=()=>{n&&(a(n),o(null))};return s?e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1055,position:"fixed",top:0,left:0,right:0,bottom:0,overflowY:"auto",padding:"1.75rem 0",pointerEvents:"auto"},children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable modal-dialog-centered",style:{maxHeight:"calc(100vh - 3.5rem)",margin:"0 auto",display:"flex",alignItems:"center",minHeight:"calc(100vh - 3.5rem)"},children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsx("h5",{className:"modal-title",children:"ðŸ¦· Select Service"}),e.jsx("button",{type:"button",className:"btn-close",onClick:i})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",minHeight:0,padding:"1rem",maxHeight:"calc(100vh - 200px)"},children:[e.jsxs("div",{className:"alert alert-info border-0 mb-3",style:{borderRadius:"12px"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),'Click on a service to select it, then click "Select Service" to confirm.']}),e.jsx("ul",{className:"list-group",children:l.map(m=>e.jsxs("li",{className:`list-group-item list-group-item-action d-flex justify-content-between align-items-center ${n===m.id?"active":""}`,onClick:()=>r(m.id),role:"button",style:{cursor:"pointer",transition:"all 0.2s ease",borderRadius:n===m.id?"8px":"0"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:m.name}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:m.description})]}),e.jsxs("span",{className:"badge bg-primary",children:["â‚±",m.price]})]},m.id))})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,borderTop:"1px solid #dee2e6",padding:"1rem",backgroundColor:"#f8f9fa"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:i,children:"Cancel"}),e.jsxs("button",{className:"btn btn-primary",onClick:c,disabled:!n,children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Select Service"]})]})]})})}):null}function Tt({show:s,promo:l,service:a,onSave:i,onCancel:n,loading:o,isCreatingNew:r=!1}){const[c,m]=t.useState({start_date:"",end_date:"",discounted_price:""}),[b,f]=t.useState({});ma.useEffect(()=>{m(l?{start_date:l.start_date,end_date:l.end_date,discounted_price:l.discounted_price}:{start_date:"",end_date:"",discounted_price:""}),f({})},[l]),t.useEffect(()=>{if(s){const j=document.body.style.overflow;return document.body.style.overflow="auto",()=>{document.body.style.overflow=j}}},[s]);const y=j=>{m({...c,[j.target.name]:j.target.value}),b[j.target.name]&&f({...b,[j.target.name]:null})},h=async j=>{var u;j.preventDefault(),f({});try{await i(c)}catch(P){if(((u=P.response)==null?void 0:u.status)===422){const g=P.response.data.errors;f(g||{})}}};return s?e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1055,position:"fixed",top:0,left:0,right:0,bottom:0,overflowY:"auto",padding:"3rem 0",pointerEvents:"auto"},children:e.jsx("div",{className:"modal-dialog modal-dialog-scrollable modal-dialog-centered",style:{maxHeight:"calc(100vh - 6rem)",margin:"0 auto",display:"flex",alignItems:"center",minHeight:"calc(100vh - 6rem)"},children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:`modal-header ${r?"bg-success":"bg-info"} text-white flex-shrink-0`,style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:`bi ${r?"bi-plus-circle":"bi-pencil"} me-2`}),r?"Create New Promo":"Edit Promo"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:n})]}),e.jsxs("form",{onSubmit:h,className:"d-flex flex-column h-100",children:[e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",minHeight:0,padding:"1rem",maxHeight:"calc(100vh - 280px)"},children:[e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Service:"})," ",a==null?void 0:a.name,e.jsx("br",{}),e.jsx("strong",{children:"Original Price:"})," â‚±",a==null?void 0:a.price]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Start Date"}),e.jsx("input",{name:"start_date",type:"date",className:`form-control ${b.start_date?"is-invalid":""}`,value:c.start_date,onChange:y,required:!0}),b.start_date&&e.jsx("div",{className:"invalid-feedback",children:b.start_date[0]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"End Date"}),e.jsx("input",{name:"end_date",type:"date",className:`form-control ${b.end_date?"is-invalid":""}`,value:c.end_date,onChange:y,required:!0}),b.end_date&&e.jsx("div",{className:"invalid-feedback",children:b.end_date[0]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label",children:"Discounted Price (â‚±)"}),e.jsx("input",{name:"discounted_price",type:"number",step:"0.01",min:"0",max:a==null?void 0:a.price,className:`form-control ${b.discounted_price?"is-invalid":""}`,value:c.discounted_price,onChange:y,required:!0}),b.discounted_price&&e.jsx("div",{className:"invalid-feedback",children:b.discounted_price[0]}),e.jsxs("div",{className:"form-text",children:["Maximum: â‚±",a==null?void 0:a.price]})]})]}),b.message&&e.jsxs("div",{className:"alert alert-danger mt-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),b.message]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,borderTop:"1px solid #dee2e6",padding:"1rem",backgroundColor:"#f8f9fa",zIndex:1},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:n,disabled:o,children:"Cancel"}),e.jsx("button",{type:"submit",className:`btn ${r?"btn-success":"btn-primary"}`,disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),r?"Creating...":"Updating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:`bi ${r?"bi-plus-circle":"bi-check-circle"} me-1`}),r?"Create Promo":"Update Promo"]})})]})]})]})})}):null}function Et(){var le,U;const[s,l]=t.useState([]),[a,i]=t.useState(null),[n,o]=t.useState({start_date:"",end_date:"",discounted_price:""}),[r,c]=t.useState({}),[m,b]=t.useState(!1),[f,y]=t.useState(!1),[h,j]=t.useState(null),[u,P]=t.useState(!1),[g,_]=t.useState(null),[N,x]=t.useState(!1),[p,C]=t.useState(null),[v,A]=t.useState(!1),[z,T]=t.useState([]),[S,d]=t.useState(!1),[R,H]=t.useState(!1),[G,$]=t.useState(!1),[L,E]=t.useState(null);t.useEffect(()=>{(async()=>{try{const[K,J]=await Promise.all([M.get("/api/services"),M.get("/api/discounts-overview")]);l(K.data),T(J.data)}catch(K){console.error("Failed to load initial data",K)}})()},[]),t.useEffect(()=>()=>{document.body.style.overflow=""},[]);const I=async()=>{d(!0);try{const{data:k}=await M.get("/api/discounts-overview");T(k||[])}catch(k){console.error("Failed to load overview promos",k),T([])}finally{d(!1)}},W=async(k=null)=>{var J;const K=k||n;b(!0),c({});try{if(v){const ue=await M.post(`/api/services/${a}/discounts`,K);ue.data.warning&&alert(`âš  Promo saved, but some dates are clinic closed:
${ue.data.warning}`),x(!1),A(!1)}else g&&(await M.put(`/api/discounts/${g}`,K),x(!1),C(null),_(null));o({start_date:"",end_date:"",discounted_price:""}),P(!1),i(null),await I()}catch(ue){if(((J=ue.response)==null?void 0:J.status)===422){const ve=ue.response.data.message,Ce=ue.response.data.errors;if(ve!=null&&ve.includes("clinic closed")){alert(`âŒ Cannot save promo: ${ve}`);return}throw c(Ce||{message:ve}),ue}else throw console.error("Unknown error",ue),ue}finally{b(!1)}},B=t.useMemo(()=>s.find(k=>k.id===Number(a)),[s,a]),Z=t.useCallback(()=>{y(!0),document.body.style.overflow="hidden"},[]),te=t.useCallback(async k=>{y(!1),i(k),A(!0),C(null),_(null),x(!0)},[]);t.useCallback(k=>{C(k),_(k.id),A(!1),x(!0),document.body.style.overflow="hidden"},[]);const ne=t.useCallback(()=>{x(!1),C(null),_(null),A(!1),i(null),document.body.style.overflow=""},[]),be=k=>{E(k),H(!0),document.body.style.overflow="hidden"},oe=async()=>{var k,K;if(L)try{await M.post(`/api/discounts/${L.id}/launch`),await I(),H(!1),E(null)}catch(J){console.error("Failed to launch promo",J),alert("Failed to launch promo: "+(((K=(k=J.response)==null?void 0:k.data)==null?void 0:K.message)||"Unknown error"))}finally{document.body.style.overflow=""}},Y=()=>{H(!1),E(null),document.body.style.overflow=""},F=k=>{E(k),$(!0),document.body.style.overflow="hidden"},q=async()=>{var k,K;if(L)try{await M.post(`/api/discounts/${L.id}/cancel`),await I(),$(!1),E(null)}catch(J){console.error("Failed to cancel promo",J),alert("Failed to cancel promo: "+(((K=(k=J.response)==null?void 0:k.data)==null?void 0:K.message)||"Unknown error"))}finally{document.body.style.overflow=""}},X=()=>{$(!1),E(null),document.body.style.overflow=""},re=k=>{const K=s.find(J=>J.id===k.service_id);K&&(i(K.id),C(k),_(k.id),A(!1),x(!0))},V=k=>{if(k.status!=="launched"||!k.activated_at)return!1;const K=new Date(k.activated_at);return(new Date-K)/(1e3*60*60*24)<=1},ce=t.useCallback(k=>{switch(k){case"planned":return e.jsx("span",{className:"badge bg-secondary",children:"Planned"});case"launched":return e.jsx("span",{className:"badge bg-success",children:"Launched"});case"canceled":return e.jsx("span",{className:"badge bg-warning text-dark",children:"Canceled"});default:return e.jsx("span",{className:"badge bg-light text-dark",children:"Unknown"})}},[]),he=t.useMemo(()=>s.filter(k=>!k.is_special),[s]);return e.jsxs("div",{className:"service-discounts-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"Service Promo Discounts"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Create and manage promotional discounts for services"})]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:Z,style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Create New Promo"]})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[h&&e.jsxs("div",{className:"alert alert-success border-0 shadow-sm mb-4",style:{borderRadius:"12px"},children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),h]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-info-circle text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark",children:"Promo Management"}),e.jsx("small",{className:"text-muted",children:"Create and manage service discounts"})]})]})}),e.jsx("div",{className:"col-12 col-md-6 mt-3 mt-md-0",children:e.jsxs("div",{className:"d-flex align-items-center p-3 bg-light rounded",style:{borderRadius:"12px"},children:[e.jsx("div",{className:"bg-warning rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-exclamation-triangle text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-semibold text-dark",children:"Restrictions"}),e.jsx("small",{className:"text-muted",children:"Specials/Packages cannot be discounted"})]})]})})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-list-ul me-2 text-primary"}),"Active and Planned Promos"]}),e.jsx("div",{className:"flex-grow-1"}),e.jsxs("span",{className:"badge bg-primary fs-6",children:[z.length," promo",z.length!==1?"s":""]})]}),S?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading promos..."})]})}):z.length>0?e.jsx("div",{className:"table-responsive",style:{width:"100%"},children:e.jsxs("table",{className:"table table-hover mb-0",style:{width:"100%"},children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-tag me-2"}),"Service Name"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar-event me-2"}),"Start Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar-x me-2"}),"End Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi  me-2"}),"Discounted Price"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-activity me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Activated Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0 text-center",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Actions"]})]})}),e.jsx("tbody",{children:z.map(k=>{var K,J;return e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸ¦·"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:((K=k.service)==null?void 0:K.name)||"-"}),e.jsx("small",{className:"text-muted",children:"Dental Service"})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:k.start_date}),e.jsx("small",{className:"text-muted",children:"Campaign Start"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:k.end_date}),e.jsx("small",{className:"text-muted",children:"Campaign End"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("span",{className:"fw-bold text-success fs-5",children:["â‚±",Number(k.discounted_price).toFixed(2)]}),e.jsx("small",{className:"text-muted",children:"Promotional Price"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[ce(k.status),e.jsx("small",{className:"text-muted mt-1",children:"Current State"})]})}),e.jsx("td",{className:"px-4 py-3 text-muted border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:((J=k.activated_at)==null?void 0:J.split("T")[0])||"-"}),e.jsx("small",{className:"text-muted",children:k.activated_at?"Launch Date":"Not Activated"})]})}),e.jsxs("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:[k.status==="planned"&&e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{className:"btn btn-sm btn-success me-1",onClick:()=>be(k),title:"Launch this promo",style:{borderRadius:"8px"},children:e.jsx("i",{className:"bi bi-play-fill"})}),e.jsx("button",{className:"btn btn-sm btn-warning me-1",onClick:()=>F(k),title:"Cancel this promo",style:{borderRadius:"8px"},children:e.jsx("i",{className:"bi bi-x-circle"})}),e.jsx("button",{className:"btn btn-sm btn-info",onClick:()=>re(k),title:"Edit this promo",style:{borderRadius:"8px"},children:e.jsx("i",{className:"bi bi-pencil"})})]}),k.status==="launched"&&V(k)&&e.jsxs("button",{className:"btn btn-sm btn-warning",onClick:()=>F(k),title:"Cancel this promo",style:{borderRadius:"8px"},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]}),k.status==="launched"&&!V(k)&&e.jsxs("span",{className:"text-muted small",children:[e.jsx("i",{className:"bi bi-check-circle text-success"})," Active"]}),k.status==="canceled"&&e.jsxs("span",{className:"text-muted small",children:[e.jsx("i",{className:"bi bi-x-circle text-warning"})," Canceled"]})]})]},k.id)})})]})}):e.jsx("div",{className:"text-center text-muted",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"ðŸ’°"}),e.jsx("h3",{className:"text-muted mb-3",children:"No active or planned promos"}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"Create your first promotional discount to get started."}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:Z,style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Create First Promo"]})]})})]}),e.jsx(zt,{show:f,services:he,onSelect:te,onClose:()=>{y(!1),document.body.style.overflow=""}}),e.jsx(Tt,{show:N,promo:p,service:B,onSave:W,onCancel:ne,loading:m,isCreatingNew:v}),R&&L&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1055,position:"fixed",top:0,left:0,right:0,bottom:0,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-success text-white flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-play-circle me-2"}),"Launch Promo"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:Y})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Warning:"})," This action cannot be undone easily."]}),e.jsx("p",{children:"Are you sure you want to launch this promo?"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title",children:(le=L.service)==null?void 0:le.name}),e.jsxs("p",{className:"card-text mb-1",children:[e.jsx("strong",{children:"Start Date:"})," ",L.start_date,e.jsx("br",{}),e.jsx("strong",{children:"End Date:"})," ",L.end_date,e.jsx("br",{}),e.jsx("strong",{children:"Discounted Price:"})," â‚±",Number(L.discounted_price).toFixed(2)]})]})})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:Y,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-success",onClick:oe,children:[e.jsx("i",{className:"bi bi-play-fill me-1"}),"Launch Promo"]})]})]})})}),G&&L&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",zIndex:1055,position:"fixed",top:0,left:0,right:0,bottom:0,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-warning text-dark flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Cancel Promo"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:X})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Warning:"})," This action cannot be undone."]}),e.jsx("p",{children:"Are you sure you want to cancel this promo?"}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h6",{className:"card-title",children:(U=L.service)==null?void 0:U.name}),e.jsxs("p",{className:"card-text mb-1",children:[e.jsx("strong",{children:"Start Date:"})," ",L.start_date,e.jsx("br",{}),e.jsx("strong",{children:"End Date:"})," ",L.end_date,e.jsx("br",{}),e.jsx("strong",{children:"Discounted Price:"})," â‚±",Number(L.discounted_price).toFixed(2),e.jsx("br",{}),e.jsx("strong",{children:"Status:"})," ",ce(L.status)]})]})})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:X,children:"Cancel"}),e.jsxs("button",{type:"button",className:"btn btn-warning",onClick:q,children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel Promo"]})]})]})})}),m&&e.jsx(ze,{message:"Saving promo..."})]})})]})}const Ks=async(s,l=20)=>{try{const a=await $t(us);return s.addImage(a,"PNG",20,l,32,32),s.setFontSize(16),s.setFont("helvetica","bold"),s.text("Kreative Dental & Orthodontics",60,l+20),s.setDrawColor(200,200,200),s.setLineWidth(.5),s.line(20,l+40,s.internal.pageSize.getWidth()-20,l+40),l+50}catch(a){return console.error("Error adding clinic header to PDF:",a),s.setFontSize(16),s.setFont("helvetica","bold"),s.text("Kreative Dental & Orthodontics",20,l+20),s.setDrawColor(200,200,200),s.setLineWidth(.5),s.line(20,l+40,s.internal.pageSize.getWidth()-20,l+40),l+50}},$t=s=>new Promise((l,a)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{const n=document.createElement("canvas"),o=n.getContext("2d");n.width=i.width,n.height=i.height,o.drawImage(i,0,0);const r=n.toDataURL("image/png");l(r)},i.onerror=()=>a(new Error("Failed to load image")),i.src=s});function It(){const s=new Date().getFullYear(),[l,a]=t.useState(s),[i,n]=t.useState([]),[o,r]=t.useState(!0);t.useEffect(()=>{c()},[l]);const c=async()=>{r(!0);try{const{data:f}=await M.get(`/api/discounts-archive?year=${l}`);n(f)}catch(f){console.error("Failed to load archive",f)}finally{r(!1)}},m=async()=>{const{default:f}=await Ke(async()=>{const{default:N}=await import("./pdf-vendor-BZobkf7J.js").then(x=>x.j);return{default:N}},[]),{default:y}=await Ke(async()=>{const{default:N}=await import("./pdf-vendor-BZobkf7J.js").then(x=>x.b);return{default:N}},[]),h=new f({orientation:"p",unit:"pt",format:"a4"}),j=h.internal.pageSize.width,u=h.internal.pageSize.height;h.setDrawColor(0,119,182),h.setLineWidth(2),h.rect(20,20,j-40,u-40),h.setDrawColor(200,200,200),h.setLineWidth(1),h.rect(30,30,j-60,u-60);let P=await Ks(h,60);h.setFontSize(16),h.setFont("helvetica","bold"),h.setTextColor(0,119,182),h.text(`Promo Archive â€” ${l}`,j/2,P,{align:"center"}),P+=20,y(h,{startY:P,head:[["Service","Start","End","Price","Status","Activated"]],body:i.map(N=>{var x,p;return[((x=N.service)==null?void 0:x.name)||"-",N.start_date,N.end_date,`PHP ${Number(N.discounted_price).toFixed(2)}`,N.status.charAt(0).toUpperCase()+N.status.slice(1),((p=N.activated_at)==null?void 0:p.split("T")[0])||"-"]}),theme:"striped",margin:{left:40,right:40},styles:{fontSize:10,cellPadding:8},headStyles:{fillColor:[0,119,182],textColor:[255,255,255],fontStyle:"bold",fontSize:11}});const g=u-50;h.setDrawColor(200,200,200),h.setLineWidth(1),h.line(30,g,j-30,g),h.setFontSize(8),h.setFont("helvetica","normal"),h.setTextColor(150,150,150);const _=new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"});h.text(`Generated on ${_}`,j/2,g+15,{align:"center"}),h.save(`promo-archive-${l}.pdf`)},b=f=>{switch(f){case"planned":return e.jsx("span",{className:"badge bg-secondary",children:"Planned"});case"launched":return e.jsx("span",{className:"badge bg-success",children:"Launched"});case"canceled":return e.jsx("span",{className:"badge bg-warning text-dark",children:"Canceled"});case"done":return e.jsx("span",{className:"badge bg-dark",children:"Done"});default:return e.jsx("span",{className:"badge bg-light text-dark",children:"Unknown"})}};return e.jsxs("div",{className:"promo-archive-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"ðŸ“ Promo Archive"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"View and manage archived promotional campaigns"})]}),e.jsxs("div",{className:"d-flex gap-3 align-items-center",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label fw-semibold mb-1",children:"Filter by Year"}),e.jsx("select",{className:"form-control border-0 shadow-sm",style:{width:120,borderRadius:"12px",padding:"12px 16px",fontSize:"14px",fontWeight:"500"},value:l,onChange:f=>a(f.target.value),children:[...Array(s-2022)].map((f,y)=>{const h=s-y;return e.jsx("option",{value:h,children:h},h)})})]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:m,style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease",marginTop:"24px"},children:[e.jsx("i",{className:"bi bi-download me-2"}),"Export PDF"]})]})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-0",children:o?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading archived promos..."})]})}):e.jsx("div",{className:"table-responsive",style:{width:"100%"},children:e.jsxs("table",{className:"table table-hover mb-0",style:{width:"100%",tableLayout:"fixed"},children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"25%"}}),e.jsx("col",{style:{width:"12%"}}),e.jsx("col",{style:{width:"12%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"12%"}}),e.jsx("col",{style:{width:"24%"}})]}),e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-tag me-2"}),"Service Name"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar-event me-2"}),"Start Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar-x me-2"}),"End Date"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-currency-dollar me-2"}),"Discounted Price"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-activity me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Date Activated"]})]})}),e.jsx("tbody",{children:i.length>0?i.map(f=>{var y,h;return e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸ¦·"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:((y=f.service)==null?void 0:y.name)||"-"}),e.jsx("small",{className:"text-muted",children:"Dental Service"})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:f.start_date}),e.jsx("small",{className:"text-muted",children:"Campaign Start"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:f.end_date}),e.jsx("small",{className:"text-muted",children:"Campaign End"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsxs("span",{className:"fw-bold text-success fs-5",children:["â‚±",Number(f.discounted_price).toFixed(2)]}),e.jsx("small",{className:"text-muted",children:"Promotional Price"})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[b(f.status),e.jsx("small",{className:"text-muted mt-1",children:"Current State"})]})}),e.jsx("td",{className:"px-4 py-3 text-muted border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:((h=f.activated_at)==null?void 0:h.split("T")[0])||"-"}),e.jsx("small",{className:"text-muted",children:f.activated_at?"Launch Date":"Not Activated"})]})})]},f.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center text-muted border-0",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"ðŸ“"}),e.jsxs("h3",{className:"text-muted mb-3",children:["No promos found for ",l]}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"This year doesn't have any promotional campaigns yet."}),e.jsxs("button",{className:"btn btn-outline-secondary",children:[e.jsx("i",{className:"bi bi-calendar me-2"}),"Try Different Year"]})]})})})})]})})})})]})}function Gs(){const[s,l]=t.useState([]),[a,i]=t.useState(!0),[n,o]=t.useState(!1),[r,c]=t.useState(""),[m,b]=t.useState(!0),[f,y]=t.useState(""),[h,j]=t.useState(""),[u,P]=t.useState(""),[g,_]=t.useState(null),[N,x]=t.useState(!1),[p,C]=t.useState(null),[v,A]=t.useState(!1),[z,T]=t.useState(null);t.useEffect(()=>{S()},[]);const S=async()=>{try{const E=await M.get("/api/clinic-calendar");l(E.data)}catch(E){console.error("Failed to fetch clinic calendar",E)}finally{i(!1)}};t.useEffect(()=>{(async()=>{if(r)try{const I=await M.get("/api/clinic-calendar/resolve",{params:{date:r}}),{source:W,data:B}=I.data;W==="override"?(_(B),b(!!B.is_open),y(B.open_time??""),j(B.close_time??""),P(B.note??""),alert("âš ï¸ This date already has an override. You are editing it.")):(_(null),b(!!B.is_open),y(B.open_time??""),j(B.close_time??""),P(B.note??""))}catch{console.warn("Resolve not available; continuing without it.")}})()},[r]);const d=async E=>{E.preventDefault();try{const I={date:r,is_open:m,open_time:m?L(f):null,close_time:m?L(h):null,note:u||null};g?await M.put(`/api/clinic-calendar/${g.id}`,I):await M.post("/api/clinic-calendar",I),o(!1),c(""),b(!0),y(""),j(""),P(""),_(null),S()}catch(I){console.error("Failed to add/update entry",I),alert("Failed to save entry. Maybe the date already exists?")}},R=E=>{C({...E,open_time:E.open_time??"",close_time:E.close_time??""}),x(!0)},H=async E=>{E.preventDefault();try{await M.put(`/api/clinic-calendar/${p.id}`,{is_open:!!p.is_open,open_time:p.is_open?L(p.open_time):null,close_time:p.is_open?L(p.close_time):null,note:p.note||null}),x(!1),C(null),S()}catch(I){console.error("Failed to update entry",I),alert("Update failed.")}},G=E=>{T(E),A(!0)},$=async()=>{try{await M.delete(`/api/clinic-calendar/${z.id}`),A(!1),T(null),S()}catch(E){console.error("Failed to delete entry",E),alert("Deletion failed.")}},L=E=>E?String(E).slice(0,5):null;return e.jsxs("div",{className:"clinic-calendar-manager-page",style:{width:"100%",maxWidth:"100%",padding:"0",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",style:{width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"ðŸ“… Clinic Calendar Manager"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Manage clinic operating hours and special dates"})]}),e.jsxs("button",{className:"btn border-0 shadow-sm flex-shrink-0",onClick:()=>o(!0),style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b",border:"1px solid #e2e8f0",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add Entry"]})]}),e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px",width:"100%",maxWidth:"100%"},children:e.jsx("div",{className:"card-body p-0",style:{width:"100%",maxWidth:"100%"},children:a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading calendar entries..."})]})}):e.jsx("div",{className:"table-responsive",style:{width:"100%",maxWidth:"100%",margin:0},children:e.jsxs("table",{className:"table table-hover mb-0",style:{width:"100%",maxWidth:"100%",margin:0,tableLayout:"fixed"},children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"18%"},children:[e.jsx("i",{className:"bi bi-calendar-date me-2"}),"Date"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"12%"},children:[e.jsx("i",{className:"bi bi-toggle-on me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"15%"},children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Opening"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"15%"},children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Closing"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0",style:{fontSize:"1.1rem",width:"25%"},children:[e.jsx("i",{className:"bi bi-chat-text me-2"}),"Note"]}),e.jsxs("th",{className:"fw-semibold px-3 py-3 border-0 text-center",style:{fontSize:"1.1rem",width:"15%"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Actions"]})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center text-muted border-0",style:{height:"400px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"120px",height:"120px",fontSize:"3rem"},children:"ðŸ“…"}),e.jsx("h3",{className:"text-muted mb-3",children:"No calendar entries"}),e.jsx("p",{className:"text-muted mb-4 fs-5",children:"Start by adding your first calendar entry."}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:()=>o(!0),style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add First Entry"]})]})})}):s.map(E=>{var I,W;return e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-3 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-2 d-flex align-items-center justify-content-center",style:{width:"32px",height:"32px",fontSize:"1rem"},children:"ðŸ“…"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:new Date(E.date).toLocaleDateString()}),e.jsx("small",{className:"text-muted",children:"Calendar Date"})]})]})}),e.jsx("td",{className:"px-3 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[E.is_open?e.jsx("span",{className:"badge bg-success",children:"âœ… Open"}):e.jsx("span",{className:"badge bg-danger",children:"âŒ Closed"}),e.jsx("small",{className:"text-muted mt-1",children:"Operating Status"})]})}),e.jsx("td",{className:"px-3 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:((I=E.open_time)==null?void 0:I.slice(0,5))||"â€”"}),e.jsx("small",{className:"text-muted",children:"Opening Time"})]})}),e.jsx("td",{className:"px-3 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:((W=E.close_time)==null?void 0:W.slice(0,5))||"â€”"}),e.jsx("small",{className:"text-muted",children:"Closing Time"})]})}),e.jsx("td",{className:"px-3 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"text-truncate",title:E.note||"â€”",children:E.note||"â€”"})}),e.jsx("td",{className:"px-3 py-3 border-0 text-center",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"btn-group",role:"group",children:[e.jsx("button",{className:"btn btn-sm btn-warning me-1",onClick:()=>R(E),style:{borderRadius:"8px"},title:"Edit entry",children:e.jsx("i",{className:"bi bi-pencil"})}),e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>G(E),style:{borderRadius:"8px"},title:"Delete entry",children:e.jsx("i",{className:"bi bi-trash"})})]})})]},E.id)})})]})})})}),n&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{background:"rgba(0,0,0,0.5)",zIndex:1055},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"modal-header bg-primary text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:[e.jsxs("h5",{className:"modal-title fw-semibold",children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Add Clinic Calendar Entry"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>o(!1)})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsxs("form",{onSubmit:d,children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-date me-1"}),"Date"]}),e.jsx("input",{type:"date",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},required:!0,value:r,onChange:E=>c(E.target.value),disabled:!!g})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-toggle-on me-1"}),"Open Status"]}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:m?"true":"false",onChange:E=>b(E.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Open"}),e.jsx("option",{value:"false",children:"Closed"})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Opening Time"]}),e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:f,onChange:E=>y(E.target.value),required:m})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock-history me-1"}),"Closing Time"]}),e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:h,onChange:E=>j(E.target.value),required:m})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-chat-text me-1"}),"Note"]}),e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:u,onChange:E=>P(E.target.value),placeholder:"Optional note about this date"})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},onClick:()=>{o(!1),c(""),b(!0),y(""),j(""),P(""),_(null)},children:"Cancel"}),e.jsxs("button",{type:"submit",className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Save Entry"]})]})]})})]})})}),N&&p&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{background:"rgba(0,0,0,0.5)",zIndex:1055},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"modal-header bg-warning text-dark border-0",style:{borderRadius:"16px 16px 0 0"},children:[e.jsxs("h5",{className:"modal-title fw-semibold",children:[e.jsx("i",{className:"bi bi-pencil-square me-2"}),"Edit Clinic Calendar Entry"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>x(!1)})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsxs("form",{onSubmit:H,children:[e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-date me-1"}),"Date"]}),e.jsx("input",{type:"date",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:p.date.slice(0,10),disabled:!0})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-toggle-on me-1"}),"Open Status"]}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:p.is_open?"true":"false",onChange:E=>C({...p,is_open:E.target.value==="true"}),children:[e.jsx("option",{value:"true",children:"Open"}),e.jsx("option",{value:"false",children:"Closed"})]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Opening Time"]}),e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:p.open_time||"",onChange:E=>C({...p,open_time:E.target.value}),disabled:!p.is_open})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock-history me-1"}),"Closing Time"]}),e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:p.close_time||"",onChange:E=>C({...p,close_time:E.target.value}),disabled:!p.is_open})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-chat-text me-1"}),"Note"]}),e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px"},value:p.note||"",onChange:E=>C({...p,note:E.target.value}),placeholder:"Optional note about this date"})]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsx("button",{type:"button",className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},onClick:()=>x(!1),children:"Cancel"}),e.jsxs("button",{type:"submit",className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffc107 0%, #e0a800 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Update Entry"]})]})]})})]})})}),v&&z&&e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{background:"rgba(0,0,0,0.5)",zIndex:1055},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content border-0 shadow",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"modal-header bg-danger text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:[e.jsxs("h5",{className:"modal-title fw-semibold",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Confirm Deletion"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>A(!1)})]}),e.jsxs("div",{className:"modal-body p-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"bg-danger rounded-circle mx-auto mb-3 d-flex align-items-center justify-content-center",style:{width:"80px",height:"80px",fontSize:"2rem"},children:e.jsx("i",{className:"bi bi-trash text-white"})}),e.jsx("h5",{className:"fw-bold",children:"Are you sure?"}),e.jsxs("p",{className:"text-muted",children:["You are about to delete the calendar entry for ",e.jsx("strong",{children:z.date.slice(0,10)}),"."]}),e.jsx("p",{className:"text-danger fw-semibold",children:"This action cannot be undone."})]}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},onClick:()=>A(!1),children:"Cancel"}),e.jsxs("button",{className:"btn border-0 shadow-sm",style:{background:"linear-gradient(135deg, #dc3545 0%, #b02a37 100%)",color:"white",borderRadius:"12px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},onClick:$,children:[e.jsx("i",{className:"bi bi-trash me-2"}),"Delete Entry"]})]})]})]})})})]})}const sa=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];function Pa(){const[s,l]=t.useState([]),[a,i]=t.useState(null);t.useEffect(()=>{n()},[]);const n=async()=>{try{const c=await M.get("/api/weekly-schedule");l(c.data)}catch(c){console.error("Failed to load weekly schedule",c)}},o=(c,m,b)=>{l(f=>f.map(y=>{if(y.id!==c)return y;if(m==="is_open"){const h=b;return{...y,is_open:h,open_time:h?y.open_time||"08:00":"",close_time:h?y.close_time||"17:00":""}}return{...y,[m]:b}}))},r=async c=>{const m=s.find(b=>b.id===c);i(c);try{await M.patch(`/api/weekly-schedule/${c}`,{is_open:!!m.is_open,open_time:m.is_open?m.open_time:null,close_time:m.is_open?m.close_time:null,note:m.note??null}),alert(`âœ… ${sa[m.weekday]} saved.`)}catch(b){console.error("Failed to save",b),alert("âŒ Save failed. See console.")}finally{i(null)}};return e.jsxs("div",{className:"weekly-schedule-page",style:{width:"100%",maxWidth:"100%",padding:"0",boxSizing:"border-box"},children:[e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar-week me-2"}),"Weekly Default Schedule"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Configure clinic operating hours and availability for each day of the week"})]})}),e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsx("div",{className:"card-header bg-transparent border-0 p-4 pb-0",children:e.jsxs("h5",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Operating Hours Configuration"]})}),e.jsxs("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:[e.jsx("div",{className:"table-responsive",style:{width:"100%",maxWidth:"100%"},children:e.jsxs("table",{className:"table table-hover align-middle mb-0",children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"140px"},children:[e.jsx("i",{className:"bi bi-calendar-day me-2"}),"Day"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"120px"},children:[e.jsx("i",{className:"bi bi-power me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"120px"},children:[e.jsx("i",{className:"bi bi-sunrise me-2"}),"Opening"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"120px"},children:[e.jsx("i",{className:"bi bi-sunset me-2"}),"Closing"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-chat-text me-2"}),"Note"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem",minWidth:"110px"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Action"]})]})}),e.jsx("tbody",{children:s.map(c=>e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-3 px-md-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸ“…"}),e.jsx("div",{children:e.jsx("div",{className:"fw-bold text-dark",children:sa[c.weekday]})})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px"},value:c.is_open?"true":"false",onChange:m=>o(c.id,"is_open",m.target.value==="true"),children:[e.jsx("option",{value:"true",children:"Open"}),e.jsx("option",{value:"false",children:"Closed"})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:c.is_open?e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px"},value:c.open_time||"",onChange:m=>o(c.id,"open_time",m.target.value)}):e.jsx("input",{className:"form-control border-0 shadow-sm",disabled:!0,placeholder:"â€”",style:{borderRadius:"8px",padding:"8px 12px"}})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:c.is_open?e.jsx("input",{type:"time",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px"},value:c.close_time||"",onChange:m=>o(c.id,"close_time",m.target.value)}):e.jsx("input",{className:"form-control border-0 shadow-sm",disabled:!0,placeholder:"â€”",style:{borderRadius:"8px",padding:"8px 12px"}})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 12px"},value:c.note||"",onChange:m=>o(c.id,"note",m.target.value),placeholder:"Optional note"})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",children:e.jsx("button",{className:"btn btn-sm border-0 shadow-sm",onClick:()=>r(c.id),disabled:a===c.id,style:{background:a===c.id?"linear-gradient(135deg, #6b7280 0%, #4b5563 100%)":"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",borderRadius:"8px",padding:"8px 16px",fontWeight:"600",transition:"all 0.3s ease"},children:a===c.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-lg me-1"}),"Save"]})})})]},c.id))})]})}),e.jsx("div",{className:"mt-4 p-3 bg-light rounded-3",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"me-3",children:e.jsx("i",{className:"bi bi-info-circle text-primary",style:{fontSize:"1.2rem"}})}),e.jsxs("div",{children:[e.jsx("h6",{className:"fw-semibold mb-2 text-dark",children:"Important Notes"}),e.jsxs("p",{className:"text-muted mb-0 small",children:[e.jsx("strong",{children:"Dentist headcount and per-slot capacity"})," are managed separately in the"," ",e.jsx("strong",{children:"ðŸ“Š Capacity (14 days)"})," section and by individual dentist schedulesâ€”not in this weekly configuration."]})]})]})})]})]})})})]})}const Vt=()=>new Date().toISOString().slice(0,10),Ht=s=>{if(!s)return"";const l=String(s);return l.includes("T")?l.split("T")[0]:l.slice(0,10)};function Ra(){const[s,l]=t.useState([]),[a,i]=t.useState([]),[n,o]=t.useState(!0),[r,c]=t.useState(!1),[m,b]=t.useState(""),f=t.useMemo(()=>Vt(),[]),y=14;t.useEffect(()=>{(async()=>{var _,N;o(!0),b("");try{const x=await M.get("/api/clinic-calendar/daily",{params:{from:f,days:y}}),C=(Array.isArray(x.data)?x.data:[]).map(v=>({date:Ht(v.date),active_dentists:Number.isFinite(+v.active_dentists)?+v.active_dentists:0,max_parallel:v.max_parallel===null||v.max_parallel===void 0?"":String(v.max_parallel),is_closed:!!v.is_closed,note:v.note??""}));l(C),i(C)}catch(x){console.error(x),b(((N=(_=x==null?void 0:x.response)==null?void 0:_.data)==null?void 0:N.message)||"Failed to load capacity.")}finally{o(!1)}})()},[f]);const h=(g,_)=>l(N=>N.map((x,p)=>p===g?{...x,..._}:x)),j=(g,_)=>_?g.is_closed!==_.is_closed||(g.max_parallel??"")!==(_.max_parallel??"")||(g.note??"")!==(_.note??""):!0,u=async(g,_)=>{var x,p;if(!j(g,_))return;g.is_closed!==_.is_closed&&await M.put(`/api/clinic-calendar/${g.date}/closure`,{closed:g.is_closed,message:((x=g.note)==null?void 0:x.trim())||null}),g.is_closed||await M.put(`/api/clinic-calendar/day/${g.date}`,{max_parallel:g.max_parallel===""||g.max_parallel===null?null:Number(g.max_parallel),note:((p=g.note)==null?void 0:p.trim())||null})},P=async()=>{var g,_;c(!0),b("");try{const N=Object.fromEntries(a.map(x=>[x.date,x]));await Promise.all(s.map(x=>u(x,N[x.date]))),alert("Changes saved."),i(s)}catch(N){console.error(N),b(((_=(g=N==null?void 0:N.response)==null?void 0:g.data)==null?void 0:_.message)||"Save failed.")}finally{c(!1)}};return e.jsxs("div",{className:"p-2",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h3",{className:"m-0",children:"ðŸ“Š Capacity (next 14 days)"}),e.jsx("button",{className:"btn btn-dark",disabled:r||n,onClick:P,children:r?"Savingâ€¦":"Save All"})]}),m&&e.jsx("div",{className:"alert alert-danger py-2",role:"alert",children:m}),n?e.jsx("div",{children:"Loadingâ€¦"}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm table-bordered align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{style:{minWidth:115},children:"Date"}),e.jsx("th",{children:"Weekday"}),e.jsx("th",{className:"text-center",children:"Active Dentists"}),e.jsx("th",{style:{minWidth:180},children:"Max sameâ€‘time appts"}),e.jsx("th",{className:"text-center",style:{minWidth:120},children:"Status"}),e.jsx("th",{children:"Note / Reason"}),e.jsx("th",{className:"text-center",children:"Effective capacity"})]})}),e.jsxs("tbody",{children:[s.map((g,_)=>{const N=new Date(g.date).toLocaleDateString(void 0,{weekday:"short"}),x=Number.isFinite(+g.active_dentists)?+g.active_dentists:0,p=g.max_parallel===""||g.max_parallel===null?1/0:Math.max(0,Number(g.max_parallel)),C=g.is_closed?0:Math.min(x,p);return e.jsxs("tr",{children:[e.jsx("td",{className:"fw-medium",children:g.date}),e.jsx("td",{children:N}),e.jsx("td",{className:"text-center",children:x}),e.jsxs("td",{children:[e.jsx("input",{type:"number",min:0,className:"form-control form-control-sm",value:g.max_parallel,placeholder:`${x} (default)`,onChange:v=>h(_,{max_parallel:v.target.value}),disabled:g.is_closed,"aria-label":`Max same-time appts for ${g.date}`}),e.jsxs("div",{className:"form-text",children:["Leave blank to default to dayâ€™s active dentists (",x,")."]}),g.max_parallel!==""&&Number(g.max_parallel)>x&&!g.is_closed&&e.jsxs("small",{className:"text-danger",children:["Cap exceeds available dentists â€” effective capacity wonâ€™t exceed ",x,"."]})]}),e.jsx("td",{className:"text-center",children:e.jsxs("select",{className:"form-select form-select-sm",value:g.is_closed?"closed":"open",onChange:v=>h(_,{is_closed:v.target.value==="closed"}),"aria-label":`Status for ${g.date}`,children:[e.jsx("option",{value:"open",children:"Open"}),e.jsx("option",{value:"closed",children:"Closed"})]})}),e.jsx("td",{children:e.jsx("input",{className:"form-control form-control-sm",value:g.note,onChange:v=>h(_,{note:v.target.value}),placeholder:g.is_closed?"Reason for closure (shown to users)":"Optional note"})}),e.jsx("td",{className:"text-center",children:p===1/0?g.is_closed?0:x:C})]},g.date)}),s.length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center text-muted py-3",children:"No days found."})})]})]})})]})}function Wt(){const[s,l]=t.useState("calendar"),a=({id:i,icon:n,label:o})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${s===i?"":"btn-outline-primary"}`,onClick:()=>l(i),type:"button",style:{background:s===i?"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)":"transparent",color:s===i?"#1e293b":"#6b7280",border:s===i?"1px solid #e2e8f0":"1px solid #d1d5db",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${n==="ðŸ“…"?"calendar":n==="ðŸ”"?"arrow-repeat":"bar-chart"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:o}),e.jsx("span",{className:"d-sm-none",children:o.split(" ")[0]})]});return e.jsx("div",{className:"schedule-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",maxWidth:"100%",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:[e.jsxs("h2",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar3 me-2"}),"Clinic Schedule Management"]}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#6b7280"},children:"Comprehensive scheduling and capacity management system"})]}),e.jsxs("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 mb-4",role:"group","aria-label":"Schedule tabs",children:[e.jsx(a,{id:"calendar",icon:"ðŸ“…",label:"Calendar Overrides"}),e.jsx(a,{id:"weekly",icon:"ðŸ”",label:"Weekly Defaults"}),e.jsx(a,{id:"capacity",icon:"ðŸ“Š",label:"Capacity (14 days)"})]}),e.jsxs("div",{className:"tab-content",style:{width:"100%",maxWidth:"100%"},children:[s==="calendar"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(Gs,{})}),s==="weekly"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(Pa,{})}),s==="capacity"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(Ra,{})})]})]})]})})})})}/*!
 * chartjs-plugin-datalabels v2.2.0
 * https://chartjs-plugin-datalabels.netlify.app
 * (c) 2017-2022 chartjs-plugin-datalabels contributors
 * Released under the MIT license
 */var aa=function(){if(typeof window<"u"){if(window.devicePixelRatio)return window.devicePixelRatio;var s=window.screen;if(s)return(s.deviceXDPI||1)/(s.logicalXDPI||1)}return 1}(),ws={toTextLines:function(s){var l=[],a;for(s=[].concat(s);s.length;)a=s.pop(),typeof a=="string"?l.unshift.apply(l,a.split(`
`)):Array.isArray(a)?s.push.apply(s,a):ys(s)||l.unshift(""+a);return l},textSize:function(s,l,a){var i=[].concat(l),n=i.length,o=s.font,r=0,c;for(s.font=a.string,c=0;c<n;++c)r=Math.max(s.measureText(i[c]).width,r);return s.font=o,{height:n*a.lineHeight,width:r}},bound:function(s,l,a){return Math.max(s,Math.min(l,a))},arrayDiff:function(s,l){var a=s.slice(),i=[],n,o,r,c;for(n=0,r=l.length;n<r;++n)c=l[n],o=a.indexOf(c),o===-1?i.push([c,1]):a.splice(o,1);for(n=0,r=a.length;n<r;++n)i.push([a[n],-1]);return i},rasterize:function(s){return Math.round(s*aa)/aa}};function Is(s,l){var a=l.x,i=l.y;if(a===null)return{x:0,y:-1};if(i===null)return{x:1,y:0};var n=s.x-a,o=s.y-i,r=Math.sqrt(n*n+o*o);return{x:r?n/r:0,y:r?o/r:-1}}function Bt(s,l,a,i,n){switch(n){case"center":a=i=0;break;case"bottom":a=0,i=1;break;case"right":a=1,i=0;break;case"left":a=-1,i=0;break;case"top":a=0,i=-1;break;case"start":a=-a,i=-i;break;case"end":break;default:n*=Math.PI/180,a=Math.cos(n),i=Math.sin(n);break}return{x:s,y:l,vx:a,vy:i}}var Ot=0,Da=1,Aa=2,Ma=4,La=8;function Ps(s,l,a){var i=Ot;return s<a.left?i|=Da:s>a.right&&(i|=Aa),l<a.top?i|=La:l>a.bottom&&(i|=Ma),i}function qt(s,l){for(var a=s.x0,i=s.y0,n=s.x1,o=s.y1,r=Ps(a,i,l),c=Ps(n,o,l),m,b,f;!(!(r|c)||r&c);)m=r||c,m&La?(b=a+(n-a)*(l.top-i)/(o-i),f=l.top):m&Ma?(b=a+(n-a)*(l.bottom-i)/(o-i),f=l.bottom):m&Aa?(f=i+(o-i)*(l.right-a)/(n-a),b=l.right):m&Da&&(f=i+(o-i)*(l.left-a)/(n-a),b=l.left),m===r?(a=b,i=f,r=Ps(a,i,l)):(n=b,o=f,c=Ps(n,o,l));return{x0:a,x1:n,y0:i,y1:o}}function Rs(s,l){var a=l.anchor,i=s,n,o;return l.clamp&&(i=qt(i,l.area)),a==="start"?(n=i.x0,o=i.y0):a==="end"?(n=i.x1,o=i.y1):(n=(i.x0+i.x1)/2,o=(i.y0+i.y1)/2),Bt(n,o,s.vx,s.vy,l.align)}var Ds={arc:function(s,l){var a=(s.startAngle+s.endAngle)/2,i=Math.cos(a),n=Math.sin(a),o=s.innerRadius,r=s.outerRadius;return Rs({x0:s.x+i*o,y0:s.y+n*o,x1:s.x+i*r,y1:s.y+n*r,vx:i,vy:n},l)},point:function(s,l){var a=Is(s,l.origin),i=a.x*s.options.radius,n=a.y*s.options.radius;return Rs({x0:s.x-i,y0:s.y-n,x1:s.x+i,y1:s.y+n,vx:a.x,vy:a.y},l)},bar:function(s,l){var a=Is(s,l.origin),i=s.x,n=s.y,o=0,r=0;return s.horizontal?(i=Math.min(s.x,s.base),o=Math.abs(s.base-s.x)):(n=Math.min(s.y,s.base),r=Math.abs(s.base-s.y)),Rs({x0:i,y0:n+r,x1:i+o,y1:n,vx:a.x,vy:a.y},l)},fallback:function(s,l){var a=Is(s,l.origin);return Rs({x0:s.x,y0:s.y,x1:s.x+(s.width||0),y1:s.y+(s.height||0),vx:a.x,vy:a.y},l)}},es=ws.rasterize;function Ut(s){var l=s.borderWidth||0,a=s.padding,i=s.size.height,n=s.size.width,o=-n/2,r=-i/2;return{frame:{x:o-a.left-l,y:r-a.top-l,w:n+a.width+l*2,h:i+a.height+l*2},text:{x:o,y:r,w:n,h:i}}}function Yt(s,l){var a=l.chart.getDatasetMeta(l.datasetIndex).vScale;if(!a)return null;if(a.xCenter!==void 0&&a.yCenter!==void 0)return{x:a.xCenter,y:a.yCenter};var i=a.getBasePixel();return s.horizontal?{x:i,y:null}:{x:null,y:i}}function Kt(s){return s instanceof pa?Ds.arc:s instanceof Us?Ds.point:s instanceof Ys?Ds.bar:Ds.fallback}function Gt(s,l,a,i,n,o){var r=Math.PI/2;if(o){var c=Math.min(o,n/2,i/2),m=l+c,b=a+c,f=l+i-c,y=a+n-c;s.moveTo(l,b),m<f&&b<y?(s.arc(m,b,c,-Math.PI,-r),s.arc(f,b,c,-r,0),s.arc(f,y,c,0,r),s.arc(m,y,c,r,Math.PI)):m<f?(s.moveTo(m,a),s.arc(f,b,c,-r,r),s.arc(m,b,c,r,Math.PI+r)):b<y?(s.arc(m,b,c,-Math.PI,0),s.arc(m,y,c,0,Math.PI)):s.arc(m,b,c,-Math.PI,Math.PI),s.closePath(),s.moveTo(l,a)}else s.rect(l,a,i,n)}function Xt(s,l,a){var i=a.backgroundColor,n=a.borderColor,o=a.borderWidth;!i&&(!n||!o)||(s.beginPath(),Gt(s,es(l.x)+o/2,es(l.y)+o/2,es(l.w)-o,es(l.h)-o,a.borderRadius),s.closePath(),i&&(s.fillStyle=i,s.fill()),n&&o&&(s.strokeStyle=n,s.lineWidth=o,s.lineJoin="miter",s.stroke()))}function Qt(s,l,a){var i=a.lineHeight,n=s.w,o=s.x,r=s.y+i/2;return l==="center"?o+=n/2:(l==="end"||l==="right")&&(o+=n),{h:i,w:n,x:o,y:r}}function Jt(s,l,a){var i=s.shadowBlur,n=a.stroked,o=es(a.x),r=es(a.y),c=es(a.w);n&&s.strokeText(l,o,r,c),a.filled&&(i&&n&&(s.shadowBlur=0),s.fillText(l,o,r,c),i&&n&&(s.shadowBlur=i))}function Zt(s,l,a,i){var n=i.textAlign,o=i.color,r=!!o,c=i.font,m=l.length,b=i.textStrokeColor,f=i.textStrokeWidth,y=b&&f,h;if(!(!m||!r&&!y))for(a=Qt(a,n,c),s.font=c.string,s.textAlign=n,s.textBaseline="middle",s.shadowBlur=i.textShadowBlur,s.shadowColor=i.textShadowColor,r&&(s.fillStyle=o),y&&(s.lineJoin="round",s.lineWidth=f,s.strokeStyle=b),h=0,m=l.length;h<m;++h)Jt(s,l[h],{stroked:y,filled:r,w:a.w,x:a.x,y:a.y+a.h*h})}var Fa=function(s,l,a,i){var n=this;n._config=s,n._index=i,n._model=null,n._rects=null,n._ctx=l,n._el=a};Ss(Fa.prototype,{_modelize:function(s,l,a,i){var n=this,o=n._index,r=Xa(De([a.font,{}],i,o)),c=De([a.color,Qa.color],i,o);return{align:De([a.align,"center"],i,o),anchor:De([a.anchor,"center"],i,o),area:i.chart.chartArea,backgroundColor:De([a.backgroundColor,null],i,o),borderColor:De([a.borderColor,null],i,o),borderRadius:De([a.borderRadius,0],i,o),borderWidth:De([a.borderWidth,0],i,o),clamp:De([a.clamp,!1],i,o),clip:De([a.clip,!1],i,o),color:c,display:s,font:r,lines:l,offset:De([a.offset,4],i,o),opacity:De([a.opacity,1],i,o),origin:Yt(n._el,i),padding:Ja(De([a.padding,4],i,o)),positioner:Kt(n._el),rotation:De([a.rotation,0],i,o)*(Math.PI/180),size:ws.textSize(n._ctx,l,r),textAlign:De([a.textAlign,"start"],i,o),textShadowBlur:De([a.textShadowBlur,0],i,o),textShadowColor:De([a.textShadowColor,c],i,o),textStrokeColor:De([a.textStrokeColor,c],i,o),textStrokeWidth:De([a.textStrokeWidth,0],i,o)}},update:function(s){var l=this,a=null,i=null,n=l._index,o=l._config,r,c,m,b=De([o.display,!0],s,n);b&&(r=s.dataset.data[n],c=Ga(ua(o.formatter,[r,s]),r),m=ys(c)?[]:ws.toTextLines(c),m.length&&(a=l._modelize(b,m,o,s),i=Ut(a))),l._model=a,l._rects=i},geometry:function(){return this._rects?this._rects.frame:{}},rotation:function(){return this._model?this._model.rotation:0},visible:function(){return this._model&&this._model.opacity},model:function(){return this._model},draw:function(s,l){var a=this,i=s.ctx,n=a._model,o=a._rects,r;this.visible()&&(i.save(),n.clip&&(r=n.area,i.beginPath(),i.rect(r.left,r.top,r.right-r.left,r.bottom-r.top),i.clip()),i.globalAlpha=ws.bound(0,n.opacity,1),i.translate(es(l.x),es(l.y)),i.rotate(n.rotation),Xt(i,o.frame,n),Zt(i,n.lines,o.text,n),i.restore())}});var ei=Number.MIN_SAFE_INTEGER||-9007199254740991,si=Number.MAX_SAFE_INTEGER||9007199254740991;function Ns(s,l,a){var i=Math.cos(a),n=Math.sin(a),o=l.x,r=l.y;return{x:o+i*(s.x-o)-n*(s.y-r),y:r+n*(s.x-o)+i*(s.y-r)}}function ta(s,l){var a=si,i=ei,n=l.origin,o,r,c,m,b;for(o=0;o<s.length;++o)r=s[o],c=r.x-n.x,m=r.y-n.y,b=l.vx*c+l.vy*m,a=Math.min(a,b),i=Math.max(i,b);return{min:a,max:i}}function As(s,l){var a=l.x-s.x,i=l.y-s.y,n=Math.sqrt(a*a+i*i);return{vx:(l.x-s.x)/n,vy:(l.y-s.y)/n,origin:s,ln:n}}var za=function(){this._rotation=0,this._rect={x:0,y:0,w:0,h:0}};Ss(za.prototype,{center:function(){var s=this._rect;return{x:s.x+s.w/2,y:s.y+s.h/2}},update:function(s,l,a){this._rotation=a,this._rect={x:l.x+s.x,y:l.y+s.y,w:l.w,h:l.h}},contains:function(s){var l=this,a=1,i=l._rect;return s=Ns(s,l.center(),-l._rotation),!(s.x<i.x-a||s.y<i.y-a||s.x>i.x+i.w+a*2||s.y>i.y+i.h+a*2)},intersects:function(s){var l=this._points(),a=s._points(),i=[As(l[0],l[1]),As(l[0],l[3])],n,o,r;for(this._rotation!==s._rotation&&i.push(As(a[0],a[1]),As(a[0],a[3])),n=0;n<i.length;++n)if(o=ta(l,i[n]),r=ta(a,i[n]),o.max<r.min||r.max<o.min)return!1;return!0},_points:function(){var s=this,l=s._rect,a=s._rotation,i=s.center();return[Ns({x:l.x,y:l.y},i,a),Ns({x:l.x+l.w,y:l.y},i,a),Ns({x:l.x+l.w,y:l.y+l.h},i,a),Ns({x:l.x,y:l.y+l.h},i,a)]}});function Ta(s,l,a){var i=l.positioner(s,l),n=i.vx,o=i.vy;if(!n&&!o)return{x:i.x,y:i.y};var r=a.w,c=a.h,m=l.rotation,b=Math.abs(r/2*Math.cos(m))+Math.abs(c/2*Math.sin(m)),f=Math.abs(r/2*Math.sin(m))+Math.abs(c/2*Math.cos(m)),y=1/Math.max(Math.abs(n),Math.abs(o));return b*=n*y,f*=o*y,b+=l.offset*n,f+=l.offset*o,{x:i.x+b,y:i.y+f}}function ai(s,l){var a,i,n,o;for(a=s.length-1;a>=0;--a)for(n=s[a].$layout,i=a-1;i>=0&&n._visible;--i)o=s[i].$layout,o._visible&&n._box.intersects(o._box)&&l(n,o);return s}function ti(s){var l,a,i,n,o,r,c;for(l=0,a=s.length;l<a;++l)i=s[l],n=i.$layout,n._visible&&(c=new Proxy(i._el,{get:(m,b)=>m.getProps([b],!0)[b]}),o=i.geometry(),r=Ta(c,i.model(),o),n._box.update(r,o,i.rotation()));return ai(s,function(m,b){var f=m._hidable,y=b._hidable;f&&y||y?b._visible=!1:f&&(m._visible=!1)})}var _s={prepare:function(s){var l=[],a,i,n,o,r;for(a=0,n=s.length;a<n;++a)for(i=0,o=s[a].length;i<o;++i)r=s[a][i],l.push(r),r.$layout={_box:new za,_hidable:!1,_visible:!0,_set:a,_idx:r._index};return l.sort(function(c,m){var b=c.$layout,f=m.$layout;return b._idx===f._idx?f._set-b._set:f._idx-b._idx}),this.update(l),l},update:function(s){var l=!1,a,i,n,o,r;for(a=0,i=s.length;a<i;++a)n=s[a],o=n.model(),r=n.$layout,r._hidable=o&&o.display==="auto",r._visible=n.visible(),l|=r._hidable;l&&ti(s)},lookup:function(s,l){var a,i;for(a=s.length-1;a>=0;--a)if(i=s[a].$layout,i&&i._visible&&i._box.contains(l))return s[a];return null},draw:function(s,l){var a,i,n,o,r,c;for(a=0,i=l.length;a<i;++a)n=l[a],o=n.$layout,o._visible&&(r=n.geometry(),c=Ta(n._el,n.model(),r),o._box.update(c,r,n.rotation()),n.draw(s,c))}},ii=function(s){if(ys(s))return null;var l=s,a,i,n;if(Ya(s))if(!ys(s.label))l=s.label;else if(!ys(s.r))l=s.r;else for(l="",a=Object.keys(s),n=0,i=a.length;n<i;++n)l+=(n!==0?", ":"")+a[n]+": "+s[a[n]];return""+l},li={align:"center",anchor:"center",backgroundColor:null,borderColor:null,borderRadius:0,borderWidth:0,clamp:!1,clip:!1,color:void 0,display:!0,font:{family:void 0,lineHeight:1.2,size:void 0,style:void 0,weight:null},formatter:ii,labels:void 0,listeners:{},offset:4,opacity:1,padding:{top:4,right:4,bottom:4,left:4},rotation:0,textAlign:"start",textStrokeColor:void 0,textStrokeWidth:0,textShadowBlur:0,textShadowColor:void 0},He="$datalabels",Ea="$default";function ni(s,l){var a=s.datalabels,i={},n=[],o,r;return a===!1?null:(a===!0&&(a={}),l=Ss({},[l,a]),o=l.labels||{},r=Object.keys(o),delete l.labels,r.length?r.forEach(function(c){o[c]&&n.push(Ss({},[l,o[c],{_key:c}]))}):n.push(l),i=n.reduce(function(c,m){return Ka(m.listeners||{},function(b,f){c[f]=c[f]||{},c[f][m._key||Ea]=b}),delete m.listeners,c},{}),{labels:n,listeners:i})}function Ws(s,l,a,i){if(l){var n=a.$context,o=a.$groups,r;l[o._set]&&(r=l[o._set][o._key],r&&ua(r,[n,i])===!0&&(s[He]._dirty=!0,a.update(n)))}}function ri(s,l,a,i,n){var o,r;!a&&!i||(a?i?a!==i&&(r=o=!0):r=!0:o=!0,r&&Ws(s,l.leave,a,n),o&&Ws(s,l.enter,i,n))}function ci(s,l){var a=s[He],i=a._listeners,n,o;if(!(!i.enter&&!i.leave)){if(l.type==="mousemove")o=_s.lookup(a._labels,l);else if(l.type!=="mouseout")return;n=a._hovered,a._hovered=o,ri(s,i,n,o,l)}}function di(s,l){var a=s[He],i=a._listeners.click,n=i&&_s.lookup(a._labels,l);n&&Ws(s,i,n,l)}var oi={id:"datalabels",defaults:li,beforeInit:function(s){s[He]={_actives:[]}},beforeUpdate:function(s){var l=s[He];l._listened=!1,l._listeners={},l._datasets=[],l._labels=[]},afterDatasetUpdate:function(s,l,a){var i=l.index,n=s[He],o=n._datasets[i]=[],r=s.isDatasetVisible(i),c=s.data.datasets[i],m=ni(c,a),b=l.meta.data||[],f=s.ctx,y,h,j,u,P,g,_,N;for(f.save(),y=0,j=b.length;y<j;++y)if(_=b[y],_[He]=[],r&&_&&s.getDataVisibility(y)&&!_.skip)for(h=0,u=m.labels.length;h<u;++h)P=m.labels[h],g=P._key,N=new Fa(P,f,_,y),N.$groups={_set:i,_key:g||Ea},N.$context={active:!1,chart:s,dataIndex:y,dataset:c,datasetIndex:i},N.update(N.$context),_[He].push(N),o.push(N);f.restore(),Ss(n._listeners,m.listeners,{merger:function(x,p,C){p[x]=p[x]||{},p[x][l.index]=C[x],n._listened=!0}})},afterUpdate:function(s){s[He]._labels=_s.prepare(s[He]._datasets)},afterDatasetsDraw:function(s){_s.draw(s,s[He]._labels)},beforeEvent:function(s,l){if(s[He]._listened){var a=l.event;switch(a.type){case"mousemove":case"mouseout":ci(s,a);break;case"click":di(s,a);break}}},afterEvent:function(s){var l=s[He],a=l._actives,i=l._actives=s.getActiveElements(),n=ws.arrayDiff(a,i),o,r,c,m,b,f,y;for(o=0,r=n.length;o<r;++o)if(b=n[o],b[1])for(y=b[0].element[He]||[],c=0,m=y.length;c<m;++c)f=y[c],f.$context.active=b[1]===1,f.update(f.$context);(l._dirty||n.length)&&(_s.update(l._labels),s.render()),delete l._dirty}};ba.register(fa,ga,Us,ja,Ys,va,Na,ya,oi);function mi(){var C,v;const[s,l]=t.useState(()=>new Date().toISOString().slice(0,7)),[a,i]=t.useState(!1),[n,o]=t.useState(""),[r,c]=t.useState({totals:{visits:0,inquiries:0},by_hour:[],by_service:[],by_visit_type:[]}),m=async()=>{var A,z;i(!0),o("");try{const T=await M.get("/api/reports/visits-monthly",{params:{month:s}});console.log("Monthly report API response:",T.data),c(T.data||{})}catch(T){console.error(T),o(((z=(A=T==null?void 0:T.response)==null?void 0:A.data)==null?void 0:z.message)||"Failed to load report.")}finally{i(!1)}};t.useEffect(()=>{m()},[s]);const b=t.useMemo(()=>{const A=new Map;for(let z=0;z<24;z++)A.set(z,0);return(r.by_hour||[]).forEach(z=>{const T=Number(z.hour)||0;A.set(T,(A.get(T)||0)+(Number(z.count)||0))}),Array.from(A.entries()).map(([z,T])=>({label:String(z).padStart(2,"0"),count:T}))},[r.by_hour]),f=t.useMemo(()=>{const A=(r.by_service||[]).map(z=>{var G,$,L;const T=Number(z.count)||0,S=Number(z.walkin||0),d=Number(z.appointment||0);let R=S,H=d;if(S===0&&d===0&&T>0){const E=((G=r==null?void 0:r.totals)==null?void 0:G.visits)||0,I=r.by_visit_type||[],W=(($=I.find(Z=>Z.visit_type==="walkin"))==null?void 0:$.count)||0,B=((L=I.find(Z=>Z.visit_type==="appointment"))==null?void 0:L.count)||0;if(E>0){const Z=Number(W)/E,te=Number(B)/E;R=Math.round(T*Z),H=Math.round(T*te),R+H!==T&&(H=T-R)}else R=Math.round(T*.6),H=T-R}return{label:z.service_name||"(Unspecified)",count:T,walkin:R,appointment:H}});return console.log("Processed byService data:",A),A},[r.by_service,r.by_visit_type,r.totals]),y=t.useMemo(()=>{const A=new Map;for(let z=0;z<24;z++)A.set(z,0);return(r.by_hour_avg_per_day||[]).forEach(z=>{const T=Number(z.hour)||0;A.set(T,Number(z.avg_per_day)||0)}),A},[r.by_hour_avg_per_day]),h=t.useMemo(()=>({labels:b.map(A=>A.label),datasets:[{label:"Total (month)",data:b.map(A=>A.count),backgroundColor:"rgba(25,135,84,0.85)",borderColor:"#198754",borderWidth:1,type:"bar",yAxisID:"y"},{label:"Avg per day",data:b.map(A=>Number(y.get(Number(A.label))||0)),borderColor:"#0d6efd",backgroundColor:"rgba(13,110,253,0.25)",borderWidth:2,pointRadius:2,tension:.3,type:"line",yAxisID:"y"}]}),[b,y]),j={color:"#fff",font:{weight:"bold"},formatter:A=>A>0?A:""},u=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{font:{size:11}}},tooltip:{enabled:!0},datalabels:{anchor:"end",align:"end",offset:2,font:{size:9},...j}},scales:{x:{title:{display:!0,text:"Hour of Day",font:{size:12}},ticks:{font:{size:11}}},y:{title:{display:!0,text:"Visits (total) / Avg per day",font:{size:12}},beginAtZero:!0,ticks:{precision:0,font:{size:11}}}}}),[]),P=t.useMemo(()=>({labels:f.map(A=>A.label),datasets:[{label:"Walk-in",data:f.map(A=>A.walkin),backgroundColor:"#0d6efd",borderColor:"#0d6efd",borderWidth:1},{label:"Appointment",data:f.map(A=>A.appointment),backgroundColor:"#6c757d",borderColor:"#6c757d",borderWidth:1}]}),[f]),g=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,labels:{font:{size:11}}},tooltip:{enabled:!0},datalabels:{anchor:"end",align:"end",offset:2,font:{size:9},...j}},scales:{x:{title:{display:!0,text:"Service",font:{size:12}},ticks:{autoSkip:!1,maxRotation:60,minRotation:30,font:{size:10}}},y:{title:{display:!0,text:"Visits",font:{size:12}},beginAtZero:!0,ticks:{precision:0,font:{size:11}}}}}),[]),_=t.useMemo(()=>{if(!b.length)return null;const A=b.reduce((T,S)=>T.count>S.count?T:S),z=b.reduce((T,S)=>T+S.count,0)/b.length;return{peakHour:Number(A.label),peakCount:A.count,avgPerHour:z}},[b]),N=t.useMemo(()=>{if(!f.length)return null;const A=f.reduce((d,R)=>d+R.count,0),z=f.reduce((d,R)=>d.count>R.count?d:R),T=A?z.count/A*100:null,S=z.walkin>z.appointment;return{topService:z.label,topCount:z.count,topShare:T,total:A,topWalkin:S}},[f]),x=async()=>{var A,z,T,S,d,R;try{const{default:H}=await Ke(async()=>{const{default:I}=await import("./pdf-vendor-BZobkf7J.js").then(W=>W.j);return{default:I}},[]),{default:G}=await Ke(async()=>{const{default:I}=await import("./pdf-vendor-BZobkf7J.js").then(W=>W.b);return{default:I}},[]),$=new H({orientation:"p",unit:"pt",format:"a4"}),L=(I,W,B)=>(I.setFontSize(12),I.setFont("helvetica","bold"),I.setTextColor(0,119,182),I.text(W,40,B),I.setTextColor(0,0,0),B+15);let E=await Ks($,20);if($.setFontSize(14),$.text(`Monthly Visits Report â€” ${s}`,40,E),E+=30,E=L($,"Overview",E),G($,{startY:E,head:[["Metric","Value"]],body:[["Total Visits",String(((A=r==null?void 0:r.totals)==null?void 0:A.visits)??0)],["Inquiries This Month",String(((z=r==null?void 0:r.totals)==null?void 0:z.inquiries)??0)]],theme:"striped"}),E=L($,"Hourly Visit Analysis",(((T=$.lastAutoTable)==null?void 0:T.finalY)||100)+20),G($,{startY:E,head:[["Hour","Total (month)","Avg/day"]],body:(b||[]).map(I=>[I.label,String(I.count),String(Number(y.get(Number(I.label))||0).toFixed(2))]),theme:"grid",styles:{fontSize:9},headStyles:{fillColor:[25,135,84]}}),_&&G($,{startY:(((S=$.lastAutoTable)==null?void 0:S.finalY)||100)+8,head:[["Insight"]],body:[[`On average, about ${_.avgPerHour.toFixed(1)} patients come per hour. The busiest time is ${_.peakHour}:00 (${_.peakCount} visits). More staff should be available at this time.`]],theme:"plain",styles:{fontSize:8,textColor:100,cellPadding:2},headStyles:{fontStyle:"bold",textColor:120},columnStyles:{0:{cellWidth:515}},margin:{left:40,right:40}}),E=L($,"Service Usage Analysis",(((d=$.lastAutoTable)==null?void 0:d.finalY)||100)+20),G($,{startY:E,head:[["Service","Walk-in","Appointment","Total"]],body:(f||[]).map(I=>[I.label,String(I.walkin),String(I.appointment),String(I.count)]),theme:"grid",styles:{fontSize:9},headStyles:{fillColor:[220,53,69]}}),N){const I=N.topShare!=null?`, ${N.topShare.toFixed(0)}% of total`:"";G($,{startY:(((R=$.lastAutoTable)==null?void 0:R.finalY)||100)+8,head:[["Insight"]],body:[[`Most patients came for ${N.topService} (${N.topCount} visits${I}). Most were booked by ${N.topWalkin?"walk-in":"appointment"}.`]],theme:"plain",styles:{fontSize:8,textColor:100,cellPadding:2},headStyles:{fontStyle:"bold",textColor:120},columnStyles:{0:{cellWidth:515}},margin:{left:40,right:40}})}$.save(`visits-report-${s}.pdf`)}catch(H){console.error(H),alert("Failed to generate PDF.")}},p=async()=>{var A,z,T;try{const S=new xa.Workbook,d=S.addWorksheet("Overview");if(d.addRow(["Metric","Value"]),d.addRow(["Total Visits",((A=r==null?void 0:r.totals)==null?void 0:A.visits)??0]),d.addRow(["Inquiries This Month",((z=r==null?void 0:r.totals)==null?void 0:z.inquiries)??0]),d.getRow(1).font={bold:!0},d.columns=[{width:20},{width:15}],(b==null?void 0:b.length)>0){const L=S.addWorksheet("Hourly Analysis");L.addRow(["Hour","Visits","Walk-ins","Appointments"]),b.forEach(E=>{L.addRow([E.label,E.count,E.walkin,E.appointment])}),L.getRow(1).font={bold:!0},L.columns=[{width:10},{width:12},{width:12},{width:15}]}if((f==null?void 0:f.length)>0){const L=S.addWorksheet("Service Analysis");L.addRow(["Service","Total Visits","Walk-ins","Appointments","Walk-in %","Appointment %"]),f.forEach(E=>{const I=E.count||0,W=E.walkin||0,B=E.appointment||0,Z=I>0?Number((W/I*100).toFixed(1)):null,te=I>0?Number((B/I*100).toFixed(1)):null;L.addRow([E.label,I,W,B,Z,te])}),L.getRow(1).font={bold:!0},L.columns=[{width:25},{width:15},{width:12},{width:15},{width:12},{width:15}]}if(((T=r==null?void 0:r.visits)==null?void 0:T.length)>0){const L=S.addWorksheet("Visit Details");L.addRow(["Date","Time","Service","Type","Patient ID","Status"]),r.visits.forEach(E=>{L.addRow([E.date,E.time,E.service,E.type,E.patient_id,E.status])}),L.getRow(1).font={bold:!0},L.columns=[{width:12},{width:10},{width:20},{width:12},{width:15},{width:12}]}const R=await S.xlsx.writeBuffer(),H=new Blob([R],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),G=window.URL.createObjectURL(H),$=document.createElement("a");$.href=G,$.download=`visits-report-${s}.xlsx`,$.click(),window.URL.revokeObjectURL(G)}catch(S){console.error(S),alert("Failed to generate Excel file.")}};return e.jsxs("div",{className:"admin-monthly-report-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",position:"relative",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-4 gap-3",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:"ðŸ“ˆ Monthly Visits Report"}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Analyze patient visits and service usage patterns"})]}),e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-3 align-items-stretch align-items-sm-center",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsx("label",{className:"form-label fw-semibold mb-1",children:"Select Month"}),e.jsx("input",{type:"month",className:"form-control border-0 shadow-sm",style:{minWidth:150,maxWidth:170,borderRadius:"12px",padding:"12px 16px",fontSize:"14px",fontWeight:"500"},value:s,onChange:A=>l(A.target.value),"aria-label":"Select month"})]}),e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 align-items-stretch align-items-sm-center flex-shrink-0",children:[e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:m,disabled:a,style:{background:"linear-gradient(135deg, #6c757d 0%, #495057 100%)",color:"white",borderRadius:"12px",padding:"12px 20px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"100px"},children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh"]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:x,disabled:a,style:{background:"linear-gradient(135deg, #343a40 0%, #212529 100%)",color:"white",borderRadius:"12px",padding:"12px 20px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"100px"},children:[e.jsx("i",{className:"bi bi-file-earmark-pdf me-2"}),"PDF"]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:p,disabled:a,style:{background:"linear-gradient(135deg, #198754 0%, #146c43 100%)",color:"white",borderRadius:"12px",padding:"12px 20px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"100px"},children:[e.jsx("i",{className:"bi bi-file-earmark-excel me-2"}),"Excel"]})]})]})]}),n&&e.jsxs("div",{className:"alert alert-danger border-0 shadow-sm mb-4",style:{borderRadius:"12px"},role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),n]}),a?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading monthly report..."})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-12 col-sm-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-people text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Total Visits"}),e.jsx("div",{className:"fs-3 fw-bold text-primary",children:((C=r==null?void 0:r.totals)==null?void 0:C.visits)??0})]})]})})})}),e.jsx("div",{className:"col-12 col-sm-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px"},children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-chat-dots text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Inquiries"}),e.jsx("div",{className:"fs-3 fw-bold text-info",children:((v=r==null?void 0:r.totals)==null?void 0:v.inquiries)??0})]})]})})})})]}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-primary text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Visits by Hour"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("div",{style:{height:"350px",position:"relative",width:"100%"},children:e.jsx(Hs,{data:h,options:u})}),_&&e.jsx("div",{className:"mt-3 p-3 bg-light rounded",style:{borderRadius:"12px"},children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"On average, about ",_.avgPerHour.toFixed(1)," patients come per hour. The busiest time is ",_.peakHour,":00 (",_.peakCount," visits). More staff should be available at this time."]})})]})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-success text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:e.jsxs("h5",{className:"mb-0 fw-semibold",children:[e.jsx("i",{className:"bi bi-bar-chart me-2"}),"Visits by Service & Type"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsx("div",{style:{height:"350px",position:"relative",width:"100%"},children:e.jsx(Hs,{data:P,options:g})}),N&&e.jsx("div",{className:"mt-3 p-3 bg-light rounded",style:{borderRadius:"12px"},children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Most patients came for ",N.topService," (",N.topCount," visits",N.topShare!=null?`, ${N.topShare.toFixed(0)}% of total`:"","). Most were booked by ",N.topWalkin?"walk-in":"appointment","."]})})]})]})})]})]})]})}function hi(){const[s,l]=t.useState(()=>new Date().toISOString().slice(0,7)),[a,i]=t.useState("visits"),[n,o]=t.useState(100),[r,c]=t.useState(""),[m,b]=t.useState(""),[f,y]=t.useState(!1),[h,j]=t.useState(""),[u,P]=t.useState([]),[g,_]=t.useState([]),[N,x]=t.useState([]);t.useEffect(()=>{(async()=>{var d;try{const R=await M.get("/api/services");_(R.data||[]);const H=((d=R.data)==null?void 0:d.filter(G=>G.is_special||G.bundleItems&&G.bundleItems.length>0))||[];x(H)}catch(R){console.error("Failed to load data:",R)}})()},[]);const p=async()=>{var S,d;y(!0),j("");try{const R=await M.get("/api/goals",{params:{period:s}});P(Array.isArray(R.data)?R.data:[])}catch(R){console.error(R),j(((d=(S=R==null?void 0:R.response)==null?void 0:S.data)==null?void 0:d.message)||"Failed to load goals.")}finally{y(!1)}};t.useEffect(()=>{p()},[s]);const C=async S=>{var d,R;S.preventDefault(),y(!0),j("");try{const H={period_type:"month",metric:a==="visits"?"total_visits":a,target_value:n,period_start:s,period_end:null,service_id:a==="service_availment"?r:null,package_id:a==="package_promo_availment"?m:null};await M.post("/api/goals",H),await p(),o(100),c(""),b("")}catch(H){console.error(H),j(((R=(d=H==null?void 0:H.response)==null?void 0:d.data)==null?void 0:R.message)||"Failed to create goal.")}finally{y(!1)}},v=S=>{const d=Number(S.latest_actual||0),R=Number(S.target_value||1),H=new Date,G=new Date(S.period_start),$=S.period_end?new Date(S.period_end):new Date(G.getFullYear(),G.getMonth()+1,0),L=Math.ceil(($-G)/(1e3*60*60*24)),E=Math.min(Math.ceil((H-G)/(1e3*60*60*24)),L),I=Math.round(R*E/L);return S.status==="missed"?{label:"Missed",color:"danger"}:S.status==="done"?{label:"Completed",color:"success"}:d>=I?{label:"On track",color:"success"}:d>=I*.8?{label:"At risk",color:"warning"}:{label:"Behind",color:"danger"}},A=S=>{const d=Number(S.latest_actual||0),R=Number(S.target_value||1);return Math.min(100,Math.round(d/R*100))},z=S=>{switch(S){case"total_visits":return"Visits";case"service_availment":return"Service Availment";case"package_promo_availment":return"Package/Promo Availment";default:return S}},T=S=>{switch(S.metric){case"total_visits":return"Total number of visits";case"service_availment":const d=g.find(H=>H.id===S.service_id);return d?`${d.name}`:"Unknown Service";case"package_promo_availment":const R=N.find(H=>H.id===S.package_id);return R?`${R.name}`:"Unknown Package/Promo";default:return""}};return e.jsxs("div",{className:"admin-goals-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"m-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-bullseye me-2"}),"Performance Goals"]}),e.jsx("p",{className:"text-muted mb-0 mt-1",children:"Set and track your clinic's performance targets"})]}),e.jsx("div",{className:"d-flex gap-2 flex-wrap align-items-center",children:e.jsx("input",{type:"month",className:"form-control border-0 shadow-sm",style:{width:180,borderRadius:"12px",padding:"12px 16px",fontSize:"14px",fontWeight:"500"},value:s,onChange:S=>l(S.target.value),"aria-label":"Select month"})})]}),h&&e.jsx("div",{className:"alert alert-danger border-0 shadow-sm mb-4",role:"alert",style:{borderRadius:"12px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("span",{className:"me-2",children:"âš ï¸"}),h]})}),e.jsxs("div",{className:"row g-2 g-md-3 g-lg-4",children:[e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("h5",{className:"card-title mb-4 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Create New Goal"]}),e.jsxs("form",{className:"row g-3",onSubmit:C,children:[e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Metric"}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:a,onChange:S=>i(S.target.value),children:[e.jsx("option",{value:"visits",children:"Visits"}),e.jsx("option",{value:"service_availment",children:"Service Availment"}),e.jsx("option",{value:"package_promo_availment",children:"Package/Promo Availment"})]})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Period"}),e.jsx("input",{type:"month",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:s,onChange:S=>l(S.target.value)})]}),a==="service_availment"&&e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Service"}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:r,onChange:S=>c(S.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a regular service..."}),g.filter(S=>!S.is_special).map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),a==="package_promo_availment"&&e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Package/Promo"}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:m,onChange:S=>b(S.target.value),required:!0,children:[e.jsx("option",{value:"",children:"Select a package/promo..."}),N.map(S=>e.jsx("option",{value:S.id,children:S.name},S.id))]})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsx("label",{className:"form-label fw-medium",children:"Target Value"}),e.jsx("input",{type:"number",min:"1",className:"form-control border-0 shadow-sm",style:{borderRadius:"8px",padding:"12px 16px"},value:n,onChange:S=>o(S.target.value),placeholder:a==="visits"?"Number of visits":"Target number",required:!0})]}),a==="service_availment"&&e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"alert alert-info border-0 shadow-sm",style:{borderRadius:"8px"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Only regular services (non-special) are shown. Patients who availed promos for these services will be excluded from the count."]})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3 d-flex align-items-end",children:e.jsxs("button",{className:"btn w-100 border-0 shadow-sm",disabled:f,style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",borderRadius:"8px",padding:"12px 24px",fontWeight:"600",transition:"all 0.3s ease"},children:[f?"âŸ³":"âœ“"," Create Goal"]})})]})]})})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsx("div",{className:"card-header bg-transparent border-0 p-4 pb-0",children:e.jsxs("h5",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-list-check me-2"}),"Goals for ",s]})}),e.jsx("div",{className:"card-body p-4",children:f?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"200px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading goals..."})]})}):u.length===0?e.jsxs("div",{className:"text-center text-muted py-5",children:[e.jsx("div",{className:"fs-1 mb-3",style:{color:"#e2e8f0"},children:e.jsx("i",{className:"bi bi-inbox"})}),e.jsx("h6",{className:"fw-medium mb-1",children:"No goals found for this period"}),e.jsx("p",{className:"small mb-0",children:"Create your first goal using the form above"})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0 w-100",children:[e.jsxs("colgroup",{children:[e.jsx("col",{style:{width:"20%"}}),e.jsx("col",{style:{width:"18%"}}),e.jsx("col",{style:{width:"15%"}}),e.jsx("col",{style:{width:"10%"}}),e.jsx("col",{style:{width:"10%"}}),e.jsx("col",{style:{width:"12%"}}),e.jsx("col",{style:{width:"15%"}})]}),e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-bullseye me-2"}),"Metric"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Description"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-calendar me-2"}),"Period"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-target me-2"}),"Target"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Actual"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-activity me-2"}),"Status"]}),e.jsxs("th",{className:"fw-semibold px-3 px-md-4 py-3 border-0",style:{fontSize:"1.1rem"},children:[e.jsx("i",{className:"bi bi-graph-up me-2"}),"Progress"]})]})}),e.jsx("tbody",{children:u.map(S=>e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-3 px-md-4 py-3 fw-medium border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:"ðŸŽ¯"}),e.jsx("div",{children:e.jsx("div",{className:"fw-bold text-dark",children:z(S.metric)})})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"180px"},title:T(S),children:T(S)})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"fw-semibold text-dark",children:S.period_type==="month"?new Date(S.period_start).toLocaleDateString("en-US",{year:"numeric",month:"short"}):`${new Date(S.period_start).toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${new Date(S.period_end).toLocaleDateString("en-US",{month:"short",day:"numeric"})}`}),e.jsx("small",{className:"text-muted",children:"Period"})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("span",{className:"badge bg-light text-dark fs-6",children:S.target_value})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"fw-bold text-success fs-5",children:S.latest_actual||0})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsxs("div",{className:"d-flex flex-column align-items-start",children:[(()=>{const d=v(S);return e.jsx("span",{className:`badge bg-${d.color} mb-1`,children:d.label})})(),e.jsx("small",{className:"text-muted",children:"Current"})]})}),e.jsx("td",{className:"px-3 px-md-4 py-3 border-0",children:e.jsx("div",{className:"d-flex align-items-center",children:e.jsx("div",{className:"progress flex-grow-1 me-2",style:{height:24},children:e.jsx("div",{className:`progress-bar ${A(S)>=100?"bg-success":A(S)>=70?"bg-info":"bg-warning"}`,role:"progressbar",style:{width:`${A(S)}%`},"aria-valuenow":A(S),"aria-valuemin":"0","aria-valuemax":"100",children:e.jsxs("span",{className:"text-white fw-medium small",children:[A(S),"%"]})})})})})]},S.id))})]})})})]})})]})]})}const xi=()=>{const[s,l]=t.useState([]),[a,i]=t.useState(!0),[n,o]=t.useState(!1),[r,c]=t.useState({categories:[],actions:[],users:[]}),[m,b]=t.useState({user_id:"",category:"",action:"",subject_id:"",date_from:"",date_to:"",search:""}),[f,y]=t.useState({current_page:1,last_page:1,per_page:20,total:0}),[h,j]=t.useState(!1),[u,P]=t.useState(!1),[g,_]=t.useState(null),[N,x]=t.useState(null),[p,C]=t.useState(!1),[v,A]=t.useState(null),[z,T]=t.useState({top:0,left:0}),[S,d]=t.useState(null);t.useEffect(()=>{R(),H(!0)},[]),t.useEffect(()=>{if(!a){if(S&&clearTimeout(S),m.search&&m.search.length>=2){const F=setTimeout(()=>{H(!1)},300);d(F)}else(!m.search||m.search.length===0)&&H(!1);return()=>{S&&clearTimeout(S)}}},[m,f.current_page,f.per_page]),t.useEffect(()=>{if(u){document.body.classList.add("modal-open");const F=()=>{v&&te(v)};return window.addEventListener("scroll",F,!0),window.addEventListener("resize",F),()=>{window.removeEventListener("scroll",F,!0),window.removeEventListener("resize",F)}}else document.body.classList.remove("modal-open");return()=>{document.body.classList.remove("modal-open")}},[u,v]);const R=async()=>{try{const F=await M.get("/api/system-logs/filter-options");c(F.data)}catch(F){console.error("Failed to fetch filter options:",F)}},H=async(F=!1)=>{try{F?i(!0):o(!0);const q=new URLSearchParams;Object.entries(m).forEach(([re,V])=>{if(V){if(re==="search"&&V.length<2)return;q.append(re,V)}}),q.append("page",f.current_page),q.append("per_page",f.per_page);const X=await M.get(`/api/system-logs?${q.toString()}`);l(X.data.data),y({current_page:X.data.current_page,last_page:X.data.last_page,per_page:X.data.per_page,total:X.data.total})}catch(q){console.error("Failed to fetch system logs:",q)}finally{F?i(!1):o(!1)}},G=(F,q)=>{b(X=>({...X,[F]:q})),y(X=>({...X,current_page:1}))},$=()=>{b({user_id:"",category:"",action:"",subject_id:"",date_from:"",date_to:"",search:""}),y(F=>({...F,current_page:1}))},L=F=>{b(q=>({...q,[F]:""})),y(q=>({...q,current_page:1}))},E=()=>Object.values(m).filter(F=>F!=="").length,I=()=>Object.entries(m).filter(([F,q])=>q!=="").map(([F,q])=>{let X=q,re=F.replace(/_/g," ").replace(/\b\w/g,V=>V.toUpperCase());if(F==="user_id"){const V=r.users.find(ce=>ce.id.toString()===q.toString());X=V?V.name:q}else F==="category"?X=B(q).label:F==="action"?X=Z(q).label:(F==="date_from"||F==="date_to")&&(X=new Date(q).toLocaleDateString(),re=F==="date_from"?"From":"To");return{key:F,label:re,value:X}}),W=F=>new Date(F).toLocaleString(),B=F=>({appointment:{label:"Appointment",icon:"bi-calendar-check",color:"bg-primary",description:"Appointment-related activities"},dentist:{label:"Dentist",icon:"bi-person-badge",color:"bg-info",description:"Dentist profile and schedule management"},device:{label:"Device",icon:"bi-laptop",color:"bg-warning",description:"Device registration and approval"},user:{label:"User",icon:"bi-person",color:"bg-success",description:"User account management"},inventory:{label:"Inventory",icon:"bi-box-seam",color:"bg-secondary",description:"Inventory and stock management"},payment:{label:"Payment",icon:"bi-credit-card",color:"bg-dark",description:"Payment processing and transactions"},system:{label:"System",icon:"bi-gear",color:"bg-danger",description:"System-level operations and maintenance"}})[F]||{label:F.charAt(0).toUpperCase()+F.slice(1),icon:"bi-question-circle",color:"bg-light text-dark",description:"System activity"},Z=F=>{const q={created:{label:"Created",icon:"bi-plus-circle",color:"bg-success",description:"New item was created"},approved:{label:"Approved",icon:"bi-check-circle",color:"bg-success",description:"Item was approved"},rejected:{label:"Rejected",icon:"bi-x-circle",color:"bg-danger",description:"Item was rejected"},updated:{label:"Updated",icon:"bi-pencil-square",color:"bg-warning text-dark",description:"Item was modified"},deleted:{label:"Deleted",icon:"bi-trash",color:"bg-danger",description:"Item was removed"},marked_no_show:{label:"No Show",icon:"bi-person-x",color:"bg-warning text-dark",description:"Appointment marked as no show"},cancelled:{label:"Cancelled",icon:"bi-x-octagon",color:"bg-danger",description:"Item was cancelled"},scheduled:{label:"Scheduled",icon:"bi-calendar-plus",color:"bg-info",description:"Item was scheduled"},completed:{label:"Completed",icon:"bi-check2-all",color:"bg-success",description:"Item was completed"},logged_in:{label:"Login",icon:"bi-box-arrow-in-right",color:"bg-info",description:"User logged in"},logged_out:{label:"Logout",icon:"bi-box-arrow-right",color:"bg-secondary",description:"User logged out"}};return q[F]?q[F]:F.includes("create")||F.includes("add")?q.created:F.includes("update")||F.includes("edit")?q.updated:F.includes("delete")||F.includes("remove")?q.deleted:F.includes("approve")||F.includes("accept")?q.approved:F.includes("reject")||F.includes("cancel")?q.rejected:{label:F.replace(/_/g," ").replace(/\b\w/g,X=>X.toUpperCase()),icon:"bi-arrow-right-circle",color:"bg-secondary",description:"System activity"}},te=F=>{const q=F.getBoundingClientRect(),X=400,re=Math.min(window.innerHeight*.8,600),V=8,ce=20;let he=q.bottom+V,le=q.left;he+re>window.innerHeight-ce&&(he=q.top-re-V);const U=window.innerWidth-X-ce;le=Math.max(ce,Math.min(le,U)),he=Math.max(ce,he),(q.bottom<0||q.top>window.innerHeight)&&(he=(window.innerHeight-re)/2,le=(window.innerWidth-X)/2),T({top:he,left:le})},ne=(F,q)=>{x(F),_(F.context),A(q),te(q),P(!0),setTimeout(()=>{const X=document.querySelector(".context-popup-card");X&&X.focus()},100)},be=()=>{v&&v.focus(),P(!1),_(null),x(null),C(!1),A(null)},oe=async()=>{try{const F={id:N==null?void 0:N.id,user:N==null?void 0:N.user,category:N==null?void 0:N.category,action:N==null?void 0:N.action,subject_id:N==null?void 0:N.subject_id,message:N==null?void 0:N.message,context:g,created_at:N==null?void 0:N.created_at};await navigator.clipboard.writeText(JSON.stringify(F,null,2)),C(!0),setTimeout(()=>C(!1),2e3)}catch(F){console.error("Failed to copy to clipboard:",F)}},Y=(F,q)=>{if(!q||Object.keys(q).length===0)return e.jsx("div",{className:"context-popup-section",children:e.jsxs("div",{className:"text-center text-muted py-3",children:[e.jsx("i",{className:"bi bi-info-circle me-2",style:{fontSize:"2rem"}}),e.jsx("p",{className:"mt-2 mb-0",children:"No additional context data available for this log entry."})]})});const X=(le,U)=>U==null?e.jsx("span",{className:"text-muted fst-italic",children:"Not specified"}):typeof U=="boolean"?e.jsx("span",{className:U?"text-success fw-bold":"text-danger fw-bold",children:U?"Yes":"No"}):typeof U=="object"?e.jsx("div",{className:"context-json-viewer",children:JSON.stringify(U,null,2)}):U.toString(),re=le=>({id:"ID",name:"Name",email:"Email Address",phone:"Phone Number",status:"Status",type:"Type",amount:"Amount",date:"Date",time:"Time",description:"Description",notes:"Notes",user_id:"User ID",patient_id:"Patient ID",appointment_id:"Appointment ID",service_id:"Service ID",dentist_id:"Dentist ID",device_id:"Device ID",payment_id:"Payment ID",inventory_id:"Inventory Item ID",created_at:"Created At",updated_at:"Updated At",deleted_at:"Deleted At",ip_address:"IP Address",user_agent:"Browser Information",device_name:"Device Name",device_type:"Device Type",device_status:"Device Status",appointment_date:"Appointment Date",appointment_time:"Appointment Time",patient_name:"Patient Name",dentist_name:"Dentist Name",service_name:"Service Name",payment_amount:"Payment Amount",payment_method:"Payment Method",payment_status:"Payment Status",quantity:"Quantity",unit_price:"Unit Price",total_amount:"Total Amount",reason:"Reason",comment:"Comment",old_values:"Previous Values",new_values:"New Values",changes:"Changes Made",reference_code:"Reference Code",time_slot:"Time Slot",rejection_note:"Rejection Note",warning_message:"Warning Message",warning_count:"Warning Count",no_show_count:"No-Show Count",block_reason:"Block Reason",block_type:"Block Type",blocked_ip:"Blocked IP",unblock_reason:"Unblock Reason",old_count:"Old Count",new_count:"New Count",admin_id:"Admin ID",custom_message:"Custom Message",added_by:"Added By",linked_by:"Linked By",flagged_by:"Flagged By",created_by:"Created By",updated_by:"Updated By",deleted_by:"Deleted By",performed_by:"Performed By",old_name:"Old Name",new_name:"New Name",old_status:"Old Status",new_status:"New Status",old_date:"Old Date",new_date:"New Date",old_time_slot:"Old Time Slot",new_time_slot:"New Time Slot",contact_number:"Contact Number",category_id:"Category ID",estimated_minutes:"Estimated Minutes",price:"Price",role:"Role",action_required:"Action Required"})[le]||le.replace(/_/g," ").replace(/\b\w/g,k=>k.toUpperCase()),V=le=>({id:"bi-hash",name:"bi-person",email:"bi-envelope",phone:"bi-telephone",status:"bi-circle-fill",type:"bi-tag",amount:"bi-currency-dollar",date:"bi-calendar",time:"bi-clock",description:"bi-text-paragraph",notes:"bi-sticky",user_id:"bi-person-badge",patient_id:"bi-person-heart",appointment_id:"bi-calendar-check",service_id:"bi-gear",device_id:"bi-laptop",payment_id:"bi-credit-card",ip_address:"bi-globe",user_agent:"bi-browser-chrome",reason:"bi-chat-quote",comment:"bi-chat-text",old_values:"bi-arrow-left",new_values:"bi-arrow-right",reference_code:"bi-code-square",time_slot:"bi-clock-history",warning_message:"bi-exclamation-triangle",no_show_count:"bi-x-octagon",block_reason:"bi-shield-x",contact_number:"bi-telephone",price:"bi-currency-dollar"})[le]||"bi-info-circle",ce=le=>["reason","block_reason","rejection_note","warning_message","unblock_reason","action_required"].includes(le),he=le=>["reference_code","device_fingerprint","ip_address","blocked_ip"].includes(le);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"context-popup-section",children:[e.jsxs("div",{className:"context-popup-section-title",children:[e.jsx("i",{className:"bi bi-info-circle-fill"}),e.jsx("span",{children:"Log Summary"})]}),e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:"bi bi-hash"}),"Log ID"]}),e.jsxs("div",{className:"context-field-value code",children:["#",F.id]})]}),F.user&&e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:"bi bi-person-badge"}),"Performed By"]}),e.jsxs("div",{className:"context-field-value",children:[e.jsx("strong",{children:F.user.name})," (",F.user.email,")"]})]}),e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:"bi bi-chat-text"}),"Message"]}),e.jsx("div",{className:"context-field-value",children:F.message})]}),e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:"bi bi-calendar"}),"Timestamp"]}),e.jsx("div",{className:"context-field-value",children:new Date(F.created_at).toLocaleString("en-US",{dateStyle:"full",timeStyle:"medium"})})]})]}),e.jsxs("div",{className:"context-popup-section",children:[e.jsxs("div",{className:"context-popup-section-title",children:[e.jsx("i",{className:"bi bi-list-ul"}),e.jsxs("span",{children:["Context Details (",Object.keys(q).length," field",Object.keys(q).length!==1?"s":"",")"]})]}),Object.entries(q).map(([le,U])=>e.jsxs("div",{className:"context-field",children:[e.jsxs("div",{className:"context-field-label",children:[e.jsx("i",{className:`bi ${V(le)}`}),re(le)]}),e.jsx("div",{className:`context-field-value ${ce(le)?"highlight":""} ${he(le)?"code":""}`,children:X(le,U)})]},le))]})]})};return e.jsxs("div",{className:"system-logs-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",padding:"1rem 1.5rem",boxSizing:"border-box"},children:[e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"12px"},children:e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3 me-3",children:e.jsx("i",{className:"bi bi-list-ul text-primary",style:{fontSize:"1.5rem"}})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0 text-muted small",children:"Total Logs"}),e.jsx("h4",{className:"mb-0 fw-bold",children:f.total.toLocaleString()})]})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-md-end",children:[e.jsx("div",{className:"bg-info bg-opacity-10 rounded-circle p-3 me-3",children:e.jsx("i",{className:"bi bi-eye text-info",style:{fontSize:"1.5rem"}})}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0 text-muted small",children:"Showing"}),e.jsxs("h4",{className:"mb-0 fw-bold",children:[s.length,f.total>0&&e.jsxs("span",{className:"text-muted small ms-2",children:["(Page ",f.current_page,"/",f.last_page,")"]})]})]})]})})]})})})}),e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px",background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)"},children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"row g-3 align-items-center",children:[e.jsxs("div",{className:"col-12 col-lg-4",children:[e.jsxs("div",{className:"position-relative",children:[e.jsx("i",{className:"bi bi-search position-absolute",style:{left:"16px",top:"50%",transform:"translateY(-50%)",color:"#6c757d"}}),e.jsx("input",{type:"text",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px 12px 42px",background:"white",borderColor:m.search&&m.search.length===1?"#ffc107":""},placeholder:"Search logs... (min 2 characters)",value:m.search,onChange:F=>G("search",F.target.value)})]}),m.search&&m.search.length>0&&m.search.length<2&&e.jsxs("small",{className:"text-warning mt-1 d-block fw-semibold",children:[e.jsx("i",{className:"bi bi-info-circle-fill me-1"}),"Enter at least 2 characters to search"]})]}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:m.category,onChange:F=>G("category",F.target.value),children:[e.jsx("option",{value:"",children:"All Categories"}),r.categories.map(F=>{const q=B(F);return e.jsx("option",{value:F,children:q.label},F)})]})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:m.action,onChange:F=>G("action",F.target.value),children:[e.jsx("option",{value:"",children:"All Actions"}),r.actions.map(F=>{const q=Z(F);return e.jsx("option",{value:F,children:q.label},F)})]})}),e.jsx("div",{className:"col-12 col-lg-2",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:`btn flex-grow-1 border-0 shadow-sm ${h?"btn-primary":"btn-outline-primary"}`,onClick:()=>j(!h),style:{borderRadius:"12px",padding:"12px 16px",fontWeight:"600",background:h?"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)":"white",color:h?"white":"#0d6efd",border:h?"none":"2px solid #0d6efd"},children:e.jsx("i",{className:"bi bi-sliders"})}),E()>0&&e.jsx("button",{className:"btn btn-outline-danger border-0 shadow-sm",onClick:$,style:{borderRadius:"12px",padding:"12px 16px",fontWeight:"600"},title:"Clear all filters",children:e.jsx("i",{className:"bi bi-x-circle"})})]})})]}),h&&e.jsx("div",{className:"mt-3 pt-3 border-top",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsxs("label",{className:"form-label fw-semibold text-muted small",children:[e.jsx("i",{className:"bi bi-person me-1"}),"User"]}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:m.user_id,onChange:F=>G("user_id",F.target.value),children:[e.jsx("option",{value:"",children:"All Users"}),r.users.map(F=>e.jsx("option",{value:F.id,children:F.name},F.id))]})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsxs("label",{className:"form-label fw-semibold text-muted small",children:[e.jsx("i",{className:"bi bi-hash me-1"}),"Subject ID"]}),e.jsx("input",{type:"number",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},placeholder:"Enter ID",value:m.subject_id,onChange:F=>G("subject_id",F.target.value)})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsxs("label",{className:"form-label fw-semibold text-muted small",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Date From"]}),e.jsx("input",{type:"date",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:m.date_from,onChange:F=>G("date_from",F.target.value)})]}),e.jsxs("div",{className:"col-12 col-md-6 col-lg-3",children:[e.jsxs("label",{className:"form-label fw-semibold text-muted small",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Date To"]}),e.jsx("input",{type:"date",className:"form-control border-0 shadow-sm",style:{borderRadius:"12px",padding:"12px 16px",background:"white"},value:m.date_to,onChange:F=>G("date_to",F.target.value)})]})]})})]})})}),I().length>0&&e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"d-flex flex-wrap gap-2 align-items-center",children:[e.jsxs("span",{className:"text-muted small fw-semibold",children:[e.jsx("i",{className:"bi bi-funnel-fill me-1"}),"Active Filters:"]}),I().map(F=>e.jsxs("span",{className:"badge d-inline-flex align-items-center gap-2",style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",padding:"8px 12px",borderRadius:"8px",fontSize:"0.875rem",fontWeight:"500"},children:[e.jsxs("span",{children:[F.label,": ",e.jsx("strong",{children:F.value})]}),e.jsx("button",{onClick:()=>L(F.key),className:"btn-close btn-close-white",style:{fontSize:"0.65rem",opacity:.8},"aria-label":`Remove ${F.label} filter`})]},F.key)),e.jsxs("button",{onClick:$,className:"btn btn-sm btn-outline-danger",style:{borderRadius:"8px",padding:"6px 12px"},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Clear All"]})]})}),a?e.jsx("div",{className:"d-flex justify-content-center align-items-center py-5",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",style:{width:"3rem",height:"3rem"},children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted fs-5",children:"Loading system logs..."})]})}):s.length===0?e.jsx("div",{className:"text-center text-muted py-5",children:e.jsxs("div",{className:"d-flex flex-column align-items-center justify-content-center",children:[e.jsx("div",{className:"bg-light rounded-circle mb-4 d-flex align-items-center justify-content-center",style:{width:"100px",height:"100px",fontSize:"2.5rem"},children:"ðŸ“‹"}),e.jsx("h3",{className:"text-muted mb-3",children:"No system logs found"}),e.jsx("p",{className:"text-muted mb-0",children:"Try adjusting your filters or check back later for new activity."})]})}):e.jsxs("div",{className:"table-responsive position-relative",style:{width:"100%"},children:[n&&e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{background:"rgba(255, 255, 255, 0.9)",zIndex:10,backdropFilter:"blur(2px)"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted small mb-0",children:"Updating results..."})]})}),e.jsxs("table",{className:"table table-hover mb-0",style:{width:"100%"},children:[e.jsx("thead",{className:"table-primary sticky-top",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"5%"},children:[e.jsx("i",{className:"bi bi-hash me-2"}),"ID"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"15%"},children:[e.jsx("i",{className:"bi bi-person me-2"}),"User"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"12%"},children:[e.jsx("i",{className:"bi bi-tags me-2"}),"Category"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"12%"},children:[e.jsx("i",{className:"bi bi-lightning me-2"}),"Action"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"10%"},children:[e.jsx("i",{className:"bi bi-link-45deg me-2"}),"Subject ID"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"25%"},children:[e.jsx("i",{className:"bi bi-chat-text me-2"}),"Message"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0 text-center",style:{fontSize:"1.1rem",width:"10%"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Details"]}),e.jsxs("th",{className:"fw-semibold px-4 py-3 border-0",style:{fontSize:"1.1rem",width:"11%"},children:[e.jsx("i",{className:"bi bi-calendar me-2"}),"Date"]})]})}),e.jsx("tbody",{style:{opacity:n?.5:1,transition:"opacity 0.2s ease"},children:s.map(F=>e.jsxs("tr",{className:"align-middle",style:{height:"60px"},children:[e.jsx("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:e.jsx("span",{className:"badge bg-secondary",children:F.id})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:F.user?e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-person text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark text-truncate",style:{maxWidth:"150px"},title:F.user.name,children:F.user.name}),e.jsx("small",{className:"text-muted text-truncate d-block",style:{maxWidth:"150px"},title:F.user.email,children:F.user.email})]})]}):e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-secondary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",fontSize:"1.2rem"},children:e.jsx("i",{className:"bi bi-gear text-white"})}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold text-dark",children:"System"}),e.jsx("small",{className:"text-muted",children:"Automated"})]})]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:(()=>{const q=B(F.category);return e.jsxs("span",{className:`badge ${q.color} d-flex align-items-center text-truncate`,title:q.description,children:[e.jsx("i",{className:`bi ${q.icon} me-1 flex-shrink-0`}),e.jsx("span",{className:"text-truncate",children:q.label})]})})()}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:(()=>{const q=Z(F.action);return e.jsxs("span",{className:`badge ${q.color} d-flex align-items-center text-truncate`,title:q.description,children:[e.jsx("i",{className:`bi ${q.icon} me-1 flex-shrink-0`}),e.jsx("span",{className:"text-truncate",children:q.label})]})})()}),e.jsx("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:F.subject_id?e.jsx("span",{className:"badge bg-light text-dark",children:F.subject_id}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("div",{className:"text-truncate",style:{maxWidth:"300px"},title:F.message,children:F.message})}),e.jsx("td",{className:"px-4 py-3 border-0 text-center",style:{fontSize:"1rem"},children:e.jsxs("button",{className:"btn btn-sm btn-outline-info",onClick:q=>ne(F,q.currentTarget),title:"View detailed information",style:{borderRadius:"8px"},children:[e.jsx("i",{className:"bi bi-eye me-1"}),"Details"]})}),e.jsx("td",{className:"px-4 py-3 border-0",style:{fontSize:"1rem"},children:e.jsx("small",{className:"text-truncate d-block",style:{maxWidth:"120px"},title:W(F.created_at),children:W(F.created_at)})})]},F.id))})]})]}),f.last_page>1&&e.jsx("div",{className:"d-flex justify-content-center mt-3",children:e.jsx("nav",{"aria-label":"System logs pagination",children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${f.current_page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link border-0 shadow-sm",style:{borderRadius:"8px",margin:"0 2px"},onClick:()=>y(F=>({...F,current_page:F.current_page-1})),disabled:f.current_page===1,children:e.jsx("i",{className:"bi bi-chevron-left"})})}),Array.from({length:Math.min(f.last_page,5)},(F,q)=>{const X=q+1;return e.jsx("li",{className:`page-item ${X===f.current_page?"active":""}`,children:e.jsx("button",{className:"page-link border-0 shadow-sm",style:{borderRadius:"8px",margin:"0 2px"},onClick:()=>y(re=>({...re,current_page:X})),children:X})},X)}),e.jsx("li",{className:`page-item ${f.current_page===f.last_page?"disabled":""}`,children:e.jsx("button",{className:"page-link border-0 shadow-sm",style:{borderRadius:"8px",margin:"0 2px"},onClick:()=>y(F=>({...F,current_page:F.current_page+1})),disabled:f.current_page===f.last_page,children:e.jsx("i",{className:"bi bi-chevron-right"})})})]})})}),u&&da.createPortal(e.jsxs("div",{className:"context-popup-card",role:"dialog","aria-modal":"true","aria-label":"Details",tabIndex:-1,style:{top:z.top,left:z.left,right:"auto"},children:[e.jsxs("div",{className:"context-popup-header",children:[e.jsxs("div",{className:"context-popup-title",children:[e.jsx("i",{className:"bi bi-file-text-fill me-2"}),e.jsx("span",{children:"System Log Details"})]}),e.jsx("div",{className:"context-popup-controls",children:e.jsx("button",{type:"button",className:"context-popup-close",onClick:be,title:"Close",children:e.jsx("i",{className:"bi bi-x-lg"})})})]}),e.jsxs("div",{className:"context-popup-body",children:[p&&e.jsxs("div",{className:"alert alert-success d-flex align-items-center mb-3",role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),e.jsx("div",{children:"Full log data copied to clipboard successfully!"})]}),e.jsx("div",{className:"context-popup-content",children:e.jsx("div",{className:"context-popup-data",children:N&&Y(N,g)})})]}),e.jsxs("div",{className:"context-popup-footer",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-clock-history text-muted"}),e.jsxs("small",{className:"text-muted",children:["ID #",N==null?void 0:N.id," â€¢ ",N==null?void 0:N.category,"/",N==null?void 0:N.action]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{type:"button",className:"context-popup-btn context-popup-btn-secondary",onClick:be,children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Close"]}),e.jsxs("button",{type:"button",className:"context-popup-btn context-popup-btn-primary",onClick:oe,children:[e.jsx("i",{className:"bi bi-clipboard me-1"}),"Copy All Data"]})]})]})]}),document.body),e.jsx("div",{className:"mt-4 pt-3 border-top",children:e.jsx("div",{className:"d-flex justify-content-center align-items-center",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-list-ul text-muted"}),e.jsx("label",{className:"form-label mb-0 fw-semibold text-muted",children:"Logs per page:"}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"8px",padding:"8px 16px",width:"auto"},value:f.per_page,onChange:F=>y(q=>({...q,per_page:parseInt(F.target.value),current_page:1})),children:[e.jsx("option",{value:10,children:"10"}),e.jsx("option",{value:20,children:"20"}),e.jsx("option",{value:50,children:"50"}),e.jsx("option",{value:100,children:"100"})]})]})})})})})]})};ba.register(fa,ga,Us,ja,Ys,pa,va,Na,ya,Za);function ui(){var X,re,V,ce,he,le,U,k,K,J,ue,ve,Ce,Ae,rs;const[s,l]=t.useState(()=>new Date().toISOString().slice(0,7)),[a,i]=t.useState(6),[n,o]=t.useState("visits"),[r,c]=t.useState(!1),[m,b]=t.useState(!1),[f,y]=t.useState(""),[h,j]=t.useState(null),[u,P]=t.useState(null),[g,_]=t.useState("monthly"),[N,x]=t.useState(""),[p,C]=t.useState(""),v=async()=>{var D,Q,ae,me;c(!0),y("");try{const de=(await M.get("/api/analytics/summary",{params:{period:s}})).data||null;console.log("Analytics API Response:",de),console.log("Has insights:",de!=null&&de.insights?"Yes":"No"),console.log("Insights count:",((D=de==null?void 0:de.insights)==null?void 0:D.length)||0),de&&de.insights&&!Array.isArray(de.insights)&&(console.warn("Insights data is not an array, converting..."),de.insights=[]),j(de)}catch(xe){console.error("Analytics loading error:",xe),console.error("Error response:",(Q=xe==null?void 0:xe.response)==null?void 0:Q.data),y(((me=(ae=xe==null?void 0:xe.response)==null?void 0:ae.data)==null?void 0:me.message)||(xe==null?void 0:xe.message)||"Failed to load analytics.")}finally{c(!1)}},A=async()=>{var D;b(!0);try{const Q={months:a};n==="revenue"&&(g==="yearly"&&(Q.yearly=!0),N&&p&&(Q.start_date=N,Q.end_date=p));const me=(await M.get("/api/analytics/trend",{params:Q})).data||null;console.log("Trend API Parameters:",Q),console.log("Selected Metric:",n),console.log("Revenue Timeframe:",g),console.log("Revenue Start Date:",N),console.log("Revenue End Date:",p),console.log("Revenue Controls Should Show:",n==="revenue"),P(me)}catch(Q){console.error("Trend loading error:",Q),console.error("Error response:",(D=Q==null?void 0:Q.response)==null?void 0:D.data)}finally{b(!1)}},z=async()=>{await Promise.all([v(),A()])};t.useEffect(()=>{v()},[s]),t.useEffect(()=>{n!=="revenue"&&(console.log("Clearing revenue controls for metric:",n),_("monthly"),x(""),C(""))},[n]),t.useEffect(()=>{A()},[a,n,g,N,p]),t.useEffect(()=>{z()},[]);const T=async()=>{var D,Q,ae,me,xe,de,ke,Le,Ne,$e,Fe,Te,We,Ve,Pe,Be,Oe,qe,Xe,Qe,Je,Ze,Ie,cs,ds,os,ms,as,ts,is,ls,hs,w,O,se,ie;try{const{default:pe}=await Ke(async()=>{const{default:Re}=await import("./pdf-vendor-BZobkf7J.js").then(we=>we.j);return{default:Re}},[]),{default:Ee}=await Ke(async()=>{const{default:Re}=await import("./pdf-vendor-BZobkf7J.js").then(we=>we.b);return{default:Re}},[]),fe=new pe({orientation:"p",unit:"pt",format:"a4"}),xs=(Re,we,Ye)=>(Re.setFontSize(12),Re.setFont("helvetica","bold"),Re.setTextColor(0,119,182),Re.text(we,40,Ye),Re.setTextColor(0,0,0),Ye+15);let ge=await Ks(fe,20);if(fe.setFontSize(14),fe.setFont("helvetica","bold"),fe.text("Analytics Dashboard Report",40,ge),ge+=20,fe.setFontSize(10),fe.setFont("helvetica","normal"),fe.text(`Report Period: ${s}`,40,ge),ge+=15,u&&u.labels&&u.labels.length>0){const Re=`Trend Analysis: ${n.charAt(0).toUpperCase()+n.slice(1)} over ${u.labels.length} periods`;if(fe.text(Re,40,ge),ge+=15,n==="revenue"&&N&&p){const we=`Custom Date Range: ${N} to ${p}`;fe.text(we,40,ge),ge+=15}if(n==="revenue"&&g){const we=`Time Period: ${g.charAt(0).toUpperCase()+g.slice(1)}`;fe.text(we,40,ge),ge+=15}}ge+=15,ge=xs(fe,"Key Performance Indicators",ge);const _e=[["Metric","Current","Previous","Change","Trend"],["Total Visits",String(((D=d==null?void 0:d.total_visits)==null?void 0:D.value)??0),String(((Q=d==null?void 0:d.total_visits)==null?void 0:Q.prev)??0),`${((ae=d==null?void 0:d.total_visits)==null?void 0:ae.pct_change)??0}%`,(((me=d==null?void 0:d.total_visits)==null?void 0:me.pct_change)??0)>=0?"â†— Positive":"â†˜ Negative"],["Approved Appts",String(((xe=d==null?void 0:d.approved_appointments)==null?void 0:xe.value)??0),String(((de=d==null?void 0:d.approved_appointments)==null?void 0:de.prev)??0),`${((ke=d==null?void 0:d.approved_appointments)==null?void 0:ke.pct_change)??0}%`,(((Le=d==null?void 0:d.approved_appointments)==null?void 0:Le.pct_change)??0)>=0?"â†— Positive":"â†˜ Negative"],["No-shows",String(((Ne=d==null?void 0:d.no_shows)==null?void 0:Ne.value)??0),String((($e=d==null?void 0:d.no_shows)==null?void 0:$e.prev)??0),`${((Fe=d==null?void 0:d.no_shows)==null?void 0:Fe.pct_change)??0}%`,(((Te=d==null?void 0:d.no_shows)==null?void 0:Te.pct_change)??0)>=0?"â†— Concern":"â†˜ Better"],["Avg Duration (min)",String(((We=d==null?void 0:d.avg_visit_duration_min)==null?void 0:We.value)??0),String(((Ve=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Ve.prev)??0),`${((Pe=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Pe.pct_change)??0}%`,(((Be=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Be.pct_change)??0)>=0?"â†— Longer":"â†˜ Shorter"],["Revenue",`â‚±${(((Oe=d==null?void 0:d.total_revenue)==null?void 0:Oe.value)??0).toLocaleString()}`,`â‚±${(((qe=d==null?void 0:d.total_revenue)==null?void 0:qe.prev)??0).toLocaleString()}`,`${((Xe=d==null?void 0:d.total_revenue)==null?void 0:Xe.pct_change)??0}%`,(((Qe=d==null?void 0:d.total_revenue)==null?void 0:Qe.pct_change)??0)>=0?"â†— Growth":"â†˜ Decline"]];Ee(fe,{startY:ge,head:[_e[0]],body:_e.slice(1),theme:"striped",styles:{fontSize:9,cellPadding:4,overflow:"linebreak"},headStyles:{fillColor:[59,130,246],textColor:255,fontStyle:"bold",fontSize:9},columnStyles:{0:{cellWidth:100},1:{cellWidth:80},2:{cellWidth:80},3:{cellWidth:60},4:{cellWidth:70}}}),ge=xs(fe,"Payment Method Distribution",(((Je=fe.lastAutoTable)==null?void 0:Je.finalY)||100)+20);const Ue=[["Payment Method","Count","Percentage"],["Cash",String(((Ie=(Ze=d==null?void 0:d.payment_method_share)==null?void 0:Ze.cash)==null?void 0:Ie.count)??0),`${((ds=(cs=d==null?void 0:d.payment_method_share)==null?void 0:cs.cash)==null?void 0:ds.share_pct)??0}%`],["HMO",String(((ms=(os=d==null?void 0:d.payment_method_share)==null?void 0:os.hmo)==null?void 0:ms.count)??0),`${((ts=(as=d==null?void 0:d.payment_method_share)==null?void 0:as.hmo)==null?void 0:ts.share_pct)??0}%`],["Maya",String(((ls=(is=d==null?void 0:d.payment_method_share)==null?void 0:is.maya)==null?void 0:ls.count)??0),`${((w=(hs=d==null?void 0:d.payment_method_share)==null?void 0:hs.maya)==null?void 0:w.share_pct)??0}%`]];if(Ee(fe,{startY:ge,head:[Ue[0]],body:Ue.slice(1),theme:"striped"}),((O=h==null?void 0:h.top_revenue_services)==null?void 0:O.length)>0){ge=xs(fe,"Revenue by Service",(((se=fe.lastAutoTable)==null?void 0:se.finalY)||100)+20);const Re=[["Service","Current Revenue","Previous Revenue","Change (%)"],...h.top_revenue_services.map(we=>[we.service_name,`â‚±${we.revenue.toLocaleString()}`,`â‚±${(we.prev_revenue||0).toLocaleString()}`,`${we.pct_change||0}%`])];Ee(fe,{startY:ge,head:[Re[0]],body:Re.slice(1),theme:"striped"})}if(u&&u.labels&&u.labels.length>0){ge=xs(fe,"Monthly Trends Analysis",(((ie=fe.lastAutoTable)==null?void 0:ie.finalY)||100)+20),fe.setFontSize(9),fe.setFont("helvetica","normal"),fe.text(`Metric: ${n.charAt(0).toUpperCase()+n.slice(1)}`,40,ge),ge+=12,n==="revenue"&&(fe.text(`Time Period: ${g.charAt(0).toUpperCase()+g.slice(1)}`,40,ge),ge+=12,N&&p&&(fe.text(`Custom Range: ${N} to ${p}`,40,ge),ge+=12)),ge+=5;const Re=[["Period","Visits","Appointments","Revenue","Loss"],...u.labels.map((we,Ye)=>{var ns,gs,js,Qs;return[we,String(((ns=u.visits)==null?void 0:ns[Ye])??0),String(((gs=u.appointments)==null?void 0:gs[Ye])??0),`â‚±${(((js=u.revenue)==null?void 0:js[Ye])??0).toLocaleString()}`,`â‚±${(((Qs=u.loss)==null?void 0:Qs[Ye])??0).toLocaleString()}`]})];Ee(fe,{startY:ge,head:[Re[0]],body:Re.slice(1),theme:"striped",styles:{fontSize:8},headStyles:{fillColor:[59,130,246],textColor:255,fontStyle:"bold"}})}fe.save(`analytics-report-${s}.pdf`)}catch(pe){console.error(pe),alert("Failed to generate PDF.")}},S=async()=>{var D,Q,ae,me,xe,de,ke,Le,Ne,$e,Fe,Te,We,Ve,Pe,Be,Oe,qe,Xe,Qe,Je,Ze,Ie,cs,ds,os,ms,as,ts,is,ls,hs,w;try{const O=new xa.Workbook,se=O.addWorksheet("KPI Overview");se.addRow(["Metric","Current Value","Previous Value","Change (%)","Trend Status"]),se.addRow(["Total Visits",((D=d==null?void 0:d.total_visits)==null?void 0:D.value)??0,((Q=d==null?void 0:d.total_visits)==null?void 0:Q.prev)??0,((ae=d==null?void 0:d.total_visits)==null?void 0:ae.pct_change)??0,(((me=d==null?void 0:d.total_visits)==null?void 0:me.pct_change)??0)>=0?"Positive":"Negative"]),se.addRow(["Approved Appointments",((xe=d==null?void 0:d.approved_appointments)==null?void 0:xe.value)??0,((de=d==null?void 0:d.approved_appointments)==null?void 0:de.prev)??0,((ke=d==null?void 0:d.approved_appointments)==null?void 0:ke.pct_change)??0,(((Le=d==null?void 0:d.approved_appointments)==null?void 0:Le.pct_change)??0)>=0?"Positive":"Negative"]),se.addRow(["No-shows",((Ne=d==null?void 0:d.no_shows)==null?void 0:Ne.value)??0,(($e=d==null?void 0:d.no_shows)==null?void 0:$e.prev)??0,((Fe=d==null?void 0:d.no_shows)==null?void 0:Fe.pct_change)??0,(()=>{var we,Ye,ns;const _e=((we=d==null?void 0:d.no_shows)==null?void 0:we.value)??0,Ue=((Ye=d==null?void 0:d.no_shows)==null?void 0:Ye.prev)??0,Re=((ns=d==null?void 0:d.no_shows)==null?void 0:ns.pct_change)??0;return _e===0&&Ue===0||_e===0&&Ue>0?"Excellent":Ue===0&&_e>0||Re>=0?"Concerning":"Improving"})()]),se.addRow(["Avg Visit Duration (min)",((Te=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Te.value)??0,((We=d==null?void 0:d.avg_visit_duration_min)==null?void 0:We.prev)??0,((Ve=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Ve.pct_change)??0,(((Pe=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Pe.pct_change)??0)>=0?"Longer":"Shorter"]);const ie=se.addRow(["Total Revenue",`â‚±${(((Be=d==null?void 0:d.total_revenue)==null?void 0:Be.value)??0).toLocaleString()}`,`â‚±${(((Oe=d==null?void 0:d.total_revenue)==null?void 0:Oe.prev)??0).toLocaleString()}`,((qe=d==null?void 0:d.total_revenue)==null?void 0:qe.pct_change)??0,(((Xe=d==null?void 0:d.total_revenue)==null?void 0:Xe.pct_change)??0)>=0?"Growth":"Decline"]);se.getRow(1).font={bold:!0},se.columns=[{width:25},{width:20},{width:20},{width:12},{width:15}];const pe=O.addWorksheet("Payment Methods");if(pe.addRow(["Payment Method","Count","Percentage"]),pe.addRow(["Cash",((Je=(Qe=d==null?void 0:d.payment_method_share)==null?void 0:Qe.cash)==null?void 0:Je.count)??0,((Ie=(Ze=d==null?void 0:d.payment_method_share)==null?void 0:Ze.cash)==null?void 0:Ie.share_pct)??0]),pe.addRow(["HMO",((ds=(cs=d==null?void 0:d.payment_method_share)==null?void 0:cs.hmo)==null?void 0:ds.count)??0,((ms=(os=d==null?void 0:d.payment_method_share)==null?void 0:os.hmo)==null?void 0:ms.share_pct)??0]),pe.addRow(["Maya",((ts=(as=d==null?void 0:d.payment_method_share)==null?void 0:as.maya)==null?void 0:ts.count)??0,((ls=(is=d==null?void 0:d.payment_method_share)==null?void 0:is.maya)==null?void 0:ls.share_pct)??0]),pe.getRow(1).font={bold:!0},pe.columns=[{width:20},{width:12},{width:12}],((hs=h==null?void 0:h.top_revenue_services)==null?void 0:hs.length)>0){const _e=O.addWorksheet("Revenue by Service");_e.addRow(["Service","Current Revenue","Previous Revenue","Change (%)"]),h.top_revenue_services.forEach(Ue=>{_e.addRow([Ue.service_name,`â‚±${(Ue.revenue||0).toLocaleString()}`,`â‚±${(Ue.prev_revenue||0).toLocaleString()}`,Ue.pct_change||0])}),_e.getRow(1).font={bold:!0},_e.columns=[{width:30},{width:20},{width:20},{width:12}]}if(((w=u==null?void 0:u.labels)==null?void 0:w.length)>0){const _e=O.addWorksheet("Trend Analysis");_e.addRow(["Report Configuration"]),_e.addRow(["Metric Selected:",n.charAt(0).toUpperCase()+n.slice(1)]),_e.addRow(["Time Range:",`${u.labels.length} periods`]),n==="revenue"&&(g&&_e.addRow(["Time Period:",g.charAt(0).toUpperCase()+g.slice(1)]),N&&p&&_e.addRow(["Custom Date Range:",`${N} to ${p}`])),_e.addRow([]),_e.addRow(["Period","Visits","Appointments","Revenue","Loss"]),u.labels.forEach((Re,we)=>{var Ye,ns,gs,js;_e.addRow([Re,((Ye=u.visits)==null?void 0:Ye[we])??0,((ns=u.appointments)==null?void 0:ns[we])??0,`â‚±${(((gs=u.revenue)==null?void 0:gs[we])??0).toLocaleString()}`,`â‚±${(((js=u.loss)==null?void 0:js[we])??0).toLocaleString()}`])}),_e.getRow(1).font={bold:!0};const Ue=n==="revenue"&&N&&p?7:n==="revenue"&&g?6:5;_e.getRow(Ue).font={bold:!0},_e.columns=[{width:20},{width:12},{width:15},{width:18},{width:18}]}const Ee=await O.xlsx.writeBuffer(),fe=new Blob([Ee],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),xs=window.URL.createObjectURL(fe),ge=document.createElement("a");ge.href=xs,ge.download=`analytics-report-${s}.xlsx`,ge.click(),window.URL.revokeObjectURL(xs)}catch(O){console.error(O),alert("Failed to generate Excel file.")}},d=(h==null?void 0:h.kpis)||{},R=t.useMemo(()=>{var me,xe,de;const D=((me=d==null?void 0:d.payment_method_share)==null?void 0:me.cash)??{},Q=((xe=d==null?void 0:d.payment_method_share)==null?void 0:xe.hmo)??{},ae=((de=d==null?void 0:d.payment_method_share)==null?void 0:de.maya)??{};return{labels:["Cash","HMO","Maya"],datasets:[{label:"This Month",backgroundColor:["rgba(34, 197, 94, 0.8)","rgba(139, 92, 246, 0.8)","rgba(59, 130, 246, 0.8)"],borderColor:["rgba(34, 197, 94, 1)","rgba(139, 92, 246, 1)","rgba(59, 130, 246, 1)"],borderWidth:2,borderRadius:8,borderSkipped:!1,data:[Number(D.share_pct||0),Number(Q.share_pct||0),Number(ae.share_pct||0)]}]}},[d]),H=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!1,callbacks:{label:function(D){return`${D.label}: ${D.parsed.y}%`}}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:12,weight:"500"}}},y:{beginAtZero:!0,max:100,grid:{color:"rgba(107, 114, 128, 0.1)",drawBorder:!1},ticks:{callback:D=>`${D}%`,color:"#6b7280",font:{size:12,weight:"500"}}}}}),[]),G=t.useMemo(()=>{var xe,de,ke,Le,Ne,$e,Fe,Te,We,Ve,Pe,Be,Oe,qe,Xe,Qe,Je,Ze;const D=((xe=d==null?void 0:d.total_visits)==null?void 0:xe.value)||0,Q=((de=d==null?void 0:d.approved_appointments)==null?void 0:de.value)||0,ae=((ke=d==null?void 0:d.no_shows)==null?void 0:ke.value)||0,me=((Le=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Le.value)||0;return(Ne=d==null?void 0:d.total_revenue)!=null&&Ne.value,($e=d==null?void 0:d.total_revenue)!=null&&$e.prev,[{id:"visits",title:"Total Visits",icon:"ðŸ‘¥",value:D,prevValue:((Fe=d==null?void 0:d.total_visits)==null?void 0:Fe.prev)||0,change:((Te=d==null?void 0:d.total_visits)==null?void 0:Te.pct_change)||0,color:"#8B5CF6",glowColor:"rgba(139, 92, 246, 0.4)",data:{labels:["Current Month","Previous Month"],datasets:[{data:[D,((We=d==null?void 0:d.total_visits)==null?void 0:We.prev)||0],backgroundColor:["#8B5CF6","rgba(139, 92, 246, 0.3)"],borderColor:["#8B5CF6","rgba(139, 92, 246, 0.5)"],borderWidth:3,hoverBackgroundColor:["#7C3AED","rgba(139, 92, 246, 0.4)"]}]},formatter:Ie=>Ie.toString()},{id:"approved",title:"Approved Appointments",icon:"âœ…",value:Q,prevValue:((Ve=d==null?void 0:d.approved_appointments)==null?void 0:Ve.prev)||0,change:((Pe=d==null?void 0:d.approved_appointments)==null?void 0:Pe.pct_change)||0,color:"#0EA5E9",glowColor:"rgba(14, 165, 233, 0.4)",data:{labels:["Current Month","Previous Month"],datasets:[{data:[Q,((Be=d==null?void 0:d.approved_appointments)==null?void 0:Be.prev)||0],backgroundColor:["#0EA5E9","rgba(14, 165, 233, 0.3)"],borderColor:["#0EA5E9","rgba(14, 165, 233, 0.5)"],borderWidth:3,hoverBackgroundColor:["#0284C7","rgba(14, 165, 233, 0.4)"]}]},formatter:Ie=>Ie.toString()},{id:"noshows",title:"No-shows",icon:"âŒ",value:ae,prevValue:((Oe=d==null?void 0:d.no_shows)==null?void 0:Oe.prev)||0,change:((qe=d==null?void 0:d.no_shows)==null?void 0:qe.pct_change)||0,color:"#FF6B6B",glowColor:"rgba(255, 107, 107, 0.4)",data:{labels:["Current Month","Previous Month"],datasets:[{data:[ae,((Xe=d==null?void 0:d.no_shows)==null?void 0:Xe.prev)||0],backgroundColor:["#FF6B6B","rgba(255, 107, 107, 0.3)"],borderColor:["#FF6B6B","rgba(255, 107, 107, 0.5)"],borderWidth:3,hoverBackgroundColor:["#EF4444","rgba(255, 107, 107, 0.4)"]}]},formatter:Ie=>Ie.toString()},{id:"avgtime",title:"Average Visit Time",icon:"â±ï¸",value:me,prevValue:((Qe=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Qe.prev)||0,change:((Je=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Je.pct_change)||0,color:"#84CC16",glowColor:"rgba(132, 204, 22, 0.4)",data:{labels:["Current Month","Previous Month"],datasets:[{data:[me,((Ze=d==null?void 0:d.avg_visit_duration_min)==null?void 0:Ze.prev)||0],backgroundColor:["#84CC16","rgba(132, 204, 22, 0.3)"],borderColor:["#84CC16","rgba(132, 204, 22, 0.5)"],borderWidth:3,hoverBackgroundColor:["#65A30D","rgba(132, 204, 22, 0.4)"]}]},formatter:Ie=>`${Ie} min`}]},[d]),$=D=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"bottom",align:"center",labels:{usePointStyle:!0,pointStyle:"circle",padding:15,font:{size:12,weight:"600",family:"'Inter', 'Segoe UI', sans-serif"},color:"#374151",boxWidth:12,boxHeight:12,generateLabels:function(Q){const ae=Q.data;return ae.labels.length&&ae.datasets.length?ae.labels.map((me,xe)=>{const de=ae.datasets[0];de.data[xe];const ke=de.backgroundColor[xe];return{text:me,fillStyle:ke,strokeStyle:ke,lineWidth:0,pointStyle:"circle",hidden:!1,index:xe}}):[]}}},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.9)",titleColor:"white",bodyColor:"white",borderColor:D.color,borderWidth:2,cornerRadius:12,displayColors:!0,titleFont:{size:14,weight:"bold"},bodyFont:{size:13,weight:"500"},padding:12,callbacks:{label:function(Q){const ae=Q.parsed,me=Q.dataset.data.reduce((de,ke)=>de+ke,0),xe=(ae/me*100).toFixed(1);return`${Q.label}: ${D.formatter(ae)} (${xe}%)`}}}},elements:{arc:{borderWidth:0}},interaction:{intersect:!1,mode:"nearest"},animation:{animateRotate:!0,animateScale:!0,duration:1200,easing:"easeOutQuart"}});t.useMemo(()=>{var Q,ae,me,xe;if(!h)return null;const D=de=>de>0?`â–² ${de}%`:de<0?`â–¼ ${Math.abs(de)}%`:"â€”";return{visits:`Change vs last month: ${D(((Q=d==null?void 0:d.total_visits)==null?void 0:Q.pct_change)||0)}`,approved:`Change vs last month: ${D(((ae=d==null?void 0:d.approved_appointments)==null?void 0:ae.pct_change)||0)}`,noShows:`Change vs last month: ${D(((me=d==null?void 0:d.no_shows)==null?void 0:me.pct_change)||0)}`,avgDuration:`Change vs last month: ${D(((xe=d==null?void 0:d.avg_visit_duration_min)==null?void 0:xe.pct_change)||0)}`}},[h,d]);const L=t.useMemo(()=>{var ke,Le,Ne,$e,Fe,Te,We,Ve,Pe,Be,Oe,qe;const D=((Le=(ke=d==null?void 0:d.payment_method_share)==null?void 0:ke.cash)==null?void 0:Le.share_pct)??0,Q=(($e=(Ne=d==null?void 0:d.payment_method_share)==null?void 0:Ne.hmo)==null?void 0:$e.share_pct)??0,ae=((Te=(Fe=d==null?void 0:d.payment_method_share)==null?void 0:Fe.maya)==null?void 0:Te.share_pct)??0,me=((Ve=(We=d==null?void 0:d.payment_method_share)==null?void 0:We.cash)==null?void 0:Ve.pct_point_change)??0,xe=((Be=(Pe=d==null?void 0:d.payment_method_share)==null?void 0:Pe.hmo)==null?void 0:Be.pct_point_change)??0,de=((qe=(Oe=d==null?void 0:d.payment_method_share)==null?void 0:Oe.maya)==null?void 0:qe.pct_point_change)??0;return D===0&&Q===0&&ae===0?null:`Cash: ${D}% (${me>=0?"â–²":"â–¼"}${Math.abs(me)}), HMO: ${Q}% (${xe>=0?"â–²":"â–¼"}${Math.abs(xe)}), Maya: ${ae}% (${de>=0?"â–²":"â–¼"}${Math.abs(de)}). `+(ae>40?"Tip: Strong digital payment adoption. Monitor Maya transaction fees.":Q>50?"Tip: Monitor insurer approval times and patient satisfaction with HMO processes.":"Tip: Payment preferences vary by patient demographics and insurance coverage.")},[d]),E=t.useMemo(()=>{var xe,de,ke,Le;const D=((xe=d==null?void 0:d.patient_follow_up_rate)==null?void 0:xe.value)??0,Q=((de=d==null?void 0:d.patient_follow_up_rate)==null?void 0:de.pct_change)??0,ae=((ke=d==null?void 0:d.patient_follow_up_rate)==null?void 0:ke.total_first_time_patients)??0,me=((Le=d==null?void 0:d.patient_follow_up_rate)==null?void 0:Le.returned_patients)??0;return ae===0?null:`Follow-up rate: ${D}% (${me}/${ae} patients returned within 3-4 months). Change: ${Q>=0?"â–²":"â–¼"}${Math.abs(Q)}%. `+(D>=50?"Excellent retention! This indicates strong patient satisfaction.":D>=30?"Good retention. Consider strategies to improve further.":"Consider implementing follow-up calls, appointment reminders, or patient satisfaction surveys.")},[d]);t.useMemo(()=>{const D=((h==null?void 0:h.top_services)||[])[0];if(!D)return null;const Q=D.pct_change??0;return`Top service: ${D.service_name} (Î” ${Q>=0?"â–²":"â–¼"}${Math.abs(Q)}% vs last month). Tip: Align stock/staffing; promote under-performers.`},[h]);const I=D=>typeof D=="number"?`${D>0?"+":""}${D.toFixed(2)}%`:"0%",W=D=>{const[Q,ae]=(D||"").split("-").map(Number);return!Q||!ae?"":new Date(Q,ae-1,1).toLocaleString("en-US",{month:"short",year:"numeric"})};W((D=>{const[Q,ae]=(D||"").split("-").map(Number);if(!Q||!ae)return D;const me=new Date(Q,ae-1,1);return me.setMonth(me.getMonth()-1),`${me.getFullYear()}-${String(me.getMonth()+1).padStart(2,"0")}`})(s)),W(s);function Z(D,Q){if(D==null||Q===-100&&D===0)return 0;const ae=1+(Q??0)/100;return ae===0?0:Number((D/ae).toFixed(2))}const te=d==null?void 0:d.total_visits,ne=d==null?void 0:d.approved_appointments,be=d==null?void 0:d.no_shows,oe=d==null?void 0:d.avg_visit_duration_min,Y=d==null?void 0:d.total_revenue;(te==null?void 0:te.prev)??Z(te==null?void 0:te.value,te==null?void 0:te.pct_change),(ne==null?void 0:ne.prev)??Z(ne==null?void 0:ne.value,ne==null?void 0:ne.pct_change),(be==null?void 0:be.prev)??Z(be==null?void 0:be.value,be==null?void 0:be.pct_change),(oe==null?void 0:oe.prev)??Z(oe==null?void 0:oe.value,oe==null?void 0:oe.pct_change),(Y==null?void 0:Y.prev)??Z(Y==null?void 0:Y.value,Y==null?void 0:Y.pct_change);const F=t.useMemo(()=>{if(!u)return null;const Q={visits:{label:"Visits",data:u.visits,borderColor:"#3b82f6",backgroundColor:"rgba(59, 130, 246, 0.1)",yAxisID:"y"},appointments:{label:"Appointments",data:u.appointments,borderColor:"#10b981",backgroundColor:"rgba(16, 185, 129, 0.1)",yAxisID:"y"},revenue:{label:"Revenue",data:u.revenue,borderColor:"#f59e0b",backgroundColor:"rgba(245, 158, 11, 0.1)",yAxisID:"y1"},loss:{label:"Loss",data:u.loss||[],borderColor:"#ef4444",backgroundColor:"rgba(239, 68, 68, 0.1)",yAxisID:"y1"}}[n];return Q?{labels:u.labels,datasets:[{label:Q.label,data:Q.data,borderColor:Q.borderColor,backgroundColor:Q.backgroundColor,tension:.4,pointRadius:4,pointHoverRadius:6,borderWidth:3,fill:!1,yAxisID:Q.yAxisID}]}:null},[u,n]),q=t.useMemo(()=>({responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!0,position:"top",labels:{usePointStyle:!0,padding:20,font:{size:12,weight:"500"}}},tooltip:{enabled:!0,backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.1)",borderWidth:1,cornerRadius:8,displayColors:!0,callbacks:{label:function(D){const Q=D.dataset.label,ae=D.parsed.y;return Q==="Revenue"?`${Q}: â‚±${ae.toLocaleString()}`:Q==="Loss"?`${Q}: â‚±${ae.toLocaleString()}`:`${Q}: ${ae}`}}}},scales:{x:{grid:{display:!1},ticks:{color:"#6b7280",font:{size:12,weight:"500"}}},y:{type:"linear",display:!0,position:"left",beginAtZero:!0,grid:{color:"rgba(107, 114, 128, 0.1)",drawBorder:!1},ticks:{color:"#6b7280",font:{size:12,weight:"500"}}},y1:{type:"linear",display:!0,position:"right",beginAtZero:!0,grid:{drawOnChartArea:!1},ticks:{color:"#6b7280",font:{size:12,weight:"500"},callback:function(D){return`â‚±${D.toLocaleString()}`}}}}}),[]);return e.jsx(e.Fragment,{children:e.jsx("div",{className:"analytics-dashboard-page",style:{minHeight:"100vh",width:"100vw",position:"relative",left:0,right:0,padding:"1.5rem 2rem",boxSizing:"border-box",background:"linear-gradient(135deg, #F8FAFC 0%, #E2E8F0 50%, #CBD5E1 100%)",color:"#1E293B"},children:e.jsxs("div",{className:"container-xl",children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center mb-5 gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"m-0 fw-bold",style:{color:"#1E293B",fontSize:"2.5rem",textShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:"ðŸ“Š Analytics Dashboard"}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#64748B",fontSize:"1.1rem"},children:"Real-time insights and performance metrics for your clinic"})]}),e.jsxs("div",{className:"d-flex gap-2 align-items-center flex-wrap",children:[e.jsx("input",{type:"month",className:"form-control form-control-sm border-0",style:{width:180,borderRadius:"16px",padding:"14px 18px",fontSize:"14px",fontWeight:"600",background:"rgba(255, 255, 255, 0.9)",color:"#1E293B",border:"1px solid rgba(59, 130, 246, 0.2)",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.1), inset 0 1px 0 rgba(255, 255, 255, 0.8)"},value:s,onChange:D=>l(D.target.value),"aria-label":"Select month"}),e.jsxs("button",{className:"btn border-0",onClick:v,disabled:r,style:{background:"linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)",color:"white",borderRadius:"16px",padding:"14px 28px",fontWeight:"700",fontSize:"14px",boxShadow:"0 8px 25px rgba(59, 130, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)",transition:"all 0.3s ease",transform:r?"scale(0.95)":"scale(1)"},children:[r?"âŸ³":"ðŸ”„"," ",r?"Loading...":"Refresh Data"]}),e.jsxs("div",{className:"dropdown",children:[e.jsx("button",{className:"btn dropdown-toggle border-0",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",style:{background:"linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%)",color:"white",borderRadius:"16px",padding:"14px 20px",fontWeight:"700",fontSize:"14px",boxShadow:"0 8px 25px rgba(139, 92, 246, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2)"},children:"ðŸ“Š Export Data"}),e.jsxs("ul",{className:"dropdown-menu",style:{background:"rgba(255, 255, 255, 0.95)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:"12px",boxShadow:"0 10px 40px rgba(0, 0, 0, 0.15)"},children:[e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:T,disabled:r,style:{color:"#1E293B",padding:"12px 20px",borderRadius:"8px",transition:"all 0.2s ease"},onMouseEnter:D=>D.target.style.background="rgba(59, 130, 246, 0.1)",onMouseLeave:D=>D.target.style.background="transparent",children:"ðŸ“„ Download PDF Report"})}),e.jsx("li",{children:e.jsx("button",{className:"dropdown-item",onClick:S,disabled:r,style:{color:"#1E293B",padding:"12px 20px",borderRadius:"8px",transition:"all 0.2s ease"},onMouseEnter:D=>D.target.style.background="rgba(16, 185, 129, 0.1)",onMouseLeave:D=>D.target.style.background="transparent",children:"ðŸ“Š Export Excel Data"})})]})]})]})]}),f&&e.jsx("div",{className:"alert border-0 mb-4",role:"alert",style:{borderRadius:"20px",background:"linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(254, 226, 226, 0.8) 100%)",border:"2px solid rgba(239, 68, 68, 0.2)",boxShadow:"0 10px 30px rgba(239, 68, 68, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.8)",backdropFilter:"blur(10px)",color:"#DC2626"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3 d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px",borderRadius:"12px",background:"linear-gradient(135deg, #EF4444 0%, #DC2626 100%)",boxShadow:"0 6px 15px rgba(239, 68, 68, 0.3)",fontSize:"18px"},children:"âš ï¸"}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-bold mb-1",style:{color:"#B91C1C"},children:"System Alert"}),e.jsx("div",{style:{color:"#DC2626"},children:f})]})]})}),r?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"500px"},children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"position-relative mb-4",children:[e.jsx("div",{className:"spinner-border",role:"status",style:{width:"4rem",height:"4rem",borderWidth:"4px",borderColor:"transparent",borderTopColor:"#3B82F6",borderRightColor:"#8B5CF6",borderBottomColor:"#14B8A6",borderLeftColor:"#F97316",animation:"spin 1.5s linear infinite",filter:"drop-shadow(0 4px 8px rgba(59, 130, 246, 0.3))"},children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"position-absolute top-50 start-50 translate-middle",style:{fontSize:"1.5rem",animation:"pulse 2s ease-in-out infinite"},children:"ðŸ“Š"})]}),e.jsx("h5",{className:"fw-bold mb-2",style:{color:"#1E293B",textShadow:"0 2px 4px rgba(0, 0, 0, 0.1)"},children:"Analyzing Data..."}),e.jsx("p",{style:{color:"#64748B",fontSize:"1rem"},children:"Processing clinic analytics and generating insights"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2 mt-3",children:[e.jsx("div",{className:"bg-primary rounded-circle",style:{width:"8px",height:"8px",animation:"bounce 1.4s ease-in-out infinite"}}),e.jsx("div",{className:"bg-info rounded-circle",style:{width:"8px",height:"8px",animation:"bounce 1.4s ease-in-out 0.2s infinite"}}),e.jsx("div",{className:"bg-success rounded-circle",style:{width:"8px",height:"8px",animation:"bounce 1.4s ease-in-out 0.4s infinite"}})]})]})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row g-4 mb-5",children:G.map((D,Q)=>e.jsx("div",{className:"col-12 col-sm-6 col-lg-3 col-xl-3",children:e.jsxs("div",{className:"card h-100 border-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.9) 100%)",borderRadius:"24px",border:`2px solid ${D.color}20`,boxShadow:`
                        0 20px 40px rgba(0, 0, 0, 0.1),
                        0 0 0 1px rgba(255, 255, 255, 0.8),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9),
                        0 0 30px ${D.color}15
                      `,backdropFilter:"blur(20px)",transition:"all 0.4s cubic-bezier(0.4, 0, 0.2, 1)",transform:"translateY(0px)"},onMouseEnter:ae=>{ae.currentTarget.style.transform="translateY(-8px)",ae.currentTarget.style.boxShadow=`
                        0 30px 60px rgba(0, 0, 0, 0.15),
                        0 0 0 1px rgba(255, 255, 255, 0.9),
                        inset 0 1px 0 rgba(255, 255, 255, 1),
                        0 0 40px ${D.color}25
                      `},onMouseLeave:ae=>{ae.currentTarget.style.transform="translateY(0px)",ae.currentTarget.style.boxShadow=`
                        0 20px 40px rgba(0, 0, 0, 0.1),
                        0 0 0 1px rgba(255, 255, 255, 0.8),
                        inset 0 1px 0 rgba(255, 255, 255, 0.9),
                        0 0 30px ${D.color}15
                      `},children:[e.jsx("div",{className:"card-header border-0 bg-transparent pt-4 pb-2",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3 d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px",borderRadius:"16px",background:`linear-gradient(135deg, ${D.color} 0%, ${D.color}CC 100%)`,boxShadow:`0 8px 20px ${D.color}30, inset 0 1px 0 rgba(255, 255, 255, 0.3)`,fontSize:"20px"},children:D.icon}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-0 fw-bold",style:{color:"#1E293B",fontSize:"1rem",textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"},children:D.title}),e.jsx("small",{style:{color:"#64748B",fontSize:"0.8rem"},children:W(s)})]})]}),e.jsxs("div",{className:"px-3 py-1 rounded-pill",style:{background:D.change>=0?"linear-gradient(135deg, #10B981 0%, #059669 100%)":"linear-gradient(135deg, #EF4444 0%, #DC2626 100%)",fontSize:"0.75rem",fontWeight:"700",color:"white",boxShadow:D.change>=0?"0 4px 12px rgba(16, 185, 129, 0.3)":"0 4px 12px rgba(239, 68, 68, 0.3)"},children:[D.change>=0?"â†—":"â†˜"," ",Math.abs(D.change).toFixed(1),"%"]})]})}),e.jsxs("div",{className:"card-body pt-2 pb-4",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("div",{className:"fw-bold mb-1",style:{fontSize:"2.2rem",color:D.color,textShadow:`0 2px 4px ${D.color}30`,lineHeight:"1.1"},children:D.formatter(D.value)}),e.jsxs("div",{style:{color:"#64748B",fontSize:"0.85rem"},children:["Previous: ",D.formatter(D.prevValue)]})]}),e.jsx("div",{style:{height:"250px",position:"relative"},children:e.jsx(Ha,{data:D.data,options:$(D)})})]})]})},D.id))}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card h-100 border-0",style:{background:"linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(248, 250, 252, 0.9) 100%)",borderRadius:"24px",border:"2px solid rgba(14, 165, 233, 0.2)",boxShadow:"0 20px 40px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.9), 0 0 30px rgba(14, 165, 233, 0.15)",backdropFilter:"blur(20px)"},children:[e.jsx("div",{className:"card-header border-0 bg-transparent py-4",children:e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1E293B",textShadow:"0 1px 2px rgba(0, 0, 0, 0.1)"},children:[e.jsx("span",{className:"me-3",style:{fontSize:"1.5rem"},children:"ðŸ’³"}),"Payment Method Share"]})}),e.jsxs("div",{className:"card-body pt-0",children:[e.jsx("div",{className:"px-1 px-md-2",style:{height:"300px"},children:e.jsx(Hs,{data:R,options:H})}),e.jsxs("div",{className:"mt-3 p-3 rounded-3",style:{backgroundColor:"rgba(59, 130, 246, 0.05)"},children:[e.jsx("div",{className:"small text-muted mb-2 fw-medium",children:"Monthly Changes:"}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("span",{className:"small",children:[e.jsx("span",{className:"fw-medium",children:"Cash:"}),e.jsx("span",{className:(((re=(X=d==null?void 0:d.payment_method_share)==null?void 0:X.cash)==null?void 0:re.pct_point_change)??0)>=0?"text-success":"text-danger",children:I(((ce=(V=d==null?void 0:d.payment_method_share)==null?void 0:V.cash)==null?void 0:ce.pct_point_change)||0)})]}),e.jsxs("span",{className:"small",children:[e.jsx("span",{className:"fw-medium",children:"HMO:"}),e.jsx("span",{className:(((le=(he=d==null?void 0:d.payment_method_share)==null?void 0:he.hmo)==null?void 0:le.pct_point_change)??0)>=0?"text-success":"text-danger",children:I(((k=(U=d==null?void 0:d.payment_method_share)==null?void 0:U.hmo)==null?void 0:k.pct_point_change)||0)})]}),e.jsxs("span",{className:"small",children:[e.jsx("span",{className:"fw-medium",children:"Maya:"}),e.jsx("span",{className:(((J=(K=d==null?void 0:d.payment_method_share)==null?void 0:K.maya)==null?void 0:J.pct_point_change)??0)>=0?"text-success":"text-danger",children:I(((ve=(ue=d==null?void 0:d.payment_method_share)==null?void 0:ue.maya)==null?void 0:ve.pct_point_change)||0)})]})]})]}),L&&e.jsx("div",{className:"mt-3 p-3 rounded-3",style:{backgroundColor:"rgba(16, 185, 129, 0.05)"},children:e.jsx("small",{className:"text-muted",children:L})}),E&&e.jsx("div",{className:"mt-3 p-3 rounded-3",style:{backgroundColor:"rgba(139, 92, 246, 0.05)"},children:e.jsx("small",{className:"text-muted",children:E})})]})]})}),e.jsx("div",{className:"col-12 col-lg-6",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0 bg-transparent py-4",children:e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ’°"}),"Revenue by Service"]})}),e.jsxs("div",{className:"card-body pt-0",children:[e.jsxs("div",{className:"list-group list-group-flush",children:[((h==null?void 0:h.top_revenue_services)||[]).map((D,Q)=>e.jsxs("div",{className:"list-group-item border-0 px-0 py-3 d-flex justify-content-between align-items-center",style:{borderBottom:Q<((h==null?void 0:h.top_revenue_services)||[]).length-1?"1px solid rgba(0,0,0,0.05)":"none"},children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3 d-flex align-items-center justify-content-center rounded-circle",style:{width:"32px",height:"32px",backgroundColor:Q===0?"#fbbf24":Q===1?"#9ca3af":Q===2?"#f59e0b":"#e5e7eb",color:"white",fontSize:"14px",fontWeight:"bold"},children:Q+1}),e.jsx("span",{className:"fw-medium",style:{color:"#374151"},children:D.service_name})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("strong",{className:"me-3 fs-6",style:{color:"#1f2937"},children:["â‚±",D.revenue.toLocaleString()]}),e.jsxs("span",{className:`badge ${(D.pct_change??0)>=0?"bg-success":"bg-danger"} px-2 py-1`,style:{fontSize:"0.75rem"},children:[(D.pct_change??0)>=0?"â†—":"â†˜"," ",Math.abs(D.pct_change??0).toFixed(1),"%"]})]})]},`${D.service_id}-${D.service_name}`)),((h==null?void 0:h.top_revenue_services)||[]).length===0&&e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx("span",{className:"fs-4",children:"ðŸ’°"}),e.jsx("p",{className:"mt-2 mb-0",children:"No revenue data available"})]})]}),e.jsxs("div",{className:"mt-3 p-3 rounded-3",style:{backgroundColor:"rgba(16, 185, 129, 0.05)"},children:[e.jsx("div",{className:"small text-muted mb-2 fw-medium",children:"Total Revenue This Month:"}),e.jsxs("div",{className:"fs-4 fw-bold text-success",children:["â‚±",(((Ce=d==null?void 0:d.total_revenue)==null?void 0:Ce.value)??0).toLocaleString()]}),e.jsxs("div",{className:"small text-muted",children:[((Ae=d==null?void 0:d.total_revenue)==null?void 0:Ae.pct_change)>=0?"â†—":"â†˜"," ",Math.abs(((rs=d==null?void 0:d.total_revenue)==null?void 0:rs.pct_change)??0).toFixed(1),"% vs last month"]})]})]})]})})]}),F&&e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card h-100 border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0 bg-transparent py-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ“ˆ"}),n==="revenue"&&N&&p?"Revenue Trends":"Monthly Trends",m&&e.jsx("span",{className:"ms-2 spinner-border spinner-border-sm text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})]}),e.jsxs("div",{className:"d-flex gap-2 flex-wrap",children:[e.jsxs("select",{value:n,onChange:D=>o(D.target.value),className:"form-select form-select-sm",style:{width:140},children:[e.jsx("option",{value:"visits",children:"Visits"}),e.jsx("option",{value:"appointments",children:"Appointments"}),e.jsx("option",{value:"revenue",children:"Revenue"}),e.jsx("option",{value:"loss",children:"Loss"})]}),e.jsxs("select",{value:a,onChange:D=>i(Number(D.target.value)),className:"form-select form-select-sm",style:{width:140},children:[e.jsx("option",{value:6,children:"Last 6 months"}),e.jsx("option",{value:12,children:"Last 1 year"}),e.jsx("option",{value:24,children:"Last 2 years"})]})]})]})}),n==="revenue"&&e.jsx("div",{className:"card-body pt-0 pb-3 border-top",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label small fw-medium text-muted",children:"Time Period:"}),e.jsxs("div",{className:"d-flex gap-3",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"revenueTimeframe",id:"revenueMonthly",value:"monthly",checked:g==="monthly",onChange:D=>_(D.target.value)}),e.jsx("label",{className:"form-check-label small",htmlFor:"revenueMonthly",children:"Monthly"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"radio",name:"revenueTimeframe",id:"revenueYearly",value:"yearly",checked:g==="yearly",onChange:D=>_(D.target.value)}),e.jsx("label",{className:"form-check-label small",htmlFor:"revenueYearly",children:"Yearly"})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label small fw-medium text-muted",children:"Custom Date Range (Optional):"}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("input",{type:"date",className:"form-control form-control-sm",value:N,onChange:D=>x(D.target.value),placeholder:"Start Date",style:{fontSize:"0.8rem"}}),e.jsx("input",{type:"date",className:"form-control form-control-sm",value:p,onChange:D=>C(D.target.value),placeholder:"End Date",style:{fontSize:"0.8rem"}})]}),N&&p?e.jsxs("small",{className:"text-muted",children:["Showing data from ",N," to ",p]}):e.jsx("small",{className:"text-muted",children:"Leave empty to use default time range"})]})]})}),e.jsx("div",{className:"card-body pt-0",children:m?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"300px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading trend data..."})}),e.jsx("p",{className:"text-muted mb-0",children:"Loading trend data..."})]})}):e.jsx("div",{className:"px-1 px-md-2",style:{height:"300px"},children:e.jsx(Wa,{data:F,options:q})})})]})})}),h&&h.clinic_closure_info&&h.clinic_closure_info.has_significant_closures&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(254, 226, 226, 0.1) 100%)",borderRadius:"16px",border:"2px solid rgba(239, 68, 68, 0.2)",boxShadow:"0 10px 30px rgba(239, 68, 68, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.8)"},children:[e.jsxs("div",{className:"card-header border-0 bg-transparent py-4",children:[e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#DC2626"},children:[e.jsx("span",{className:"me-2",children:"ðŸš¨"}),"Clinic Closure Alert"]}),e.jsx("p",{className:"mb-0 mt-2 text-muted small",children:"Unexpected clinic closures detected this month"})]}),e.jsx("div",{className:"card-body pt-0",children:e.jsx("div",{className:"alert alert-warning border-0 mb-0",style:{background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:"12px"},children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("div",{className:"me-3",children:e.jsx("div",{className:"d-flex align-items-center justify-content-center rounded-circle",style:{width:"40px",height:"40px",background:"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)",color:"white",fontSize:"18px"},children:"âš ï¸"})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsx("h6",{className:"fw-bold mb-2",style:{color:"#92400E"},children:h.clinic_closure_info.summary}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Expected Open Days:"}),e.jsx("span",{className:"fw-semibold",children:h.clinic_closure_info.total_expected_open_days})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Days with Activity:"}),e.jsx("span",{className:"fw-semibold",children:h.clinic_closure_info.total_actual_open_days})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Unexpected Closures:"}),e.jsx("span",{className:"fw-semibold text-danger",children:h.clinic_closure_info.closure_count})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Closure Rate:"}),e.jsxs("span",{className:"fw-semibold text-danger",children:[h.clinic_closure_info.closure_rate_percentage,"%"]})]})})]}),h.clinic_closure_info.unexpected_closures&&h.clinic_closure_info.unexpected_closures.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsx("h6",{className:"fw-semibold mb-2",style:{color:"#92400E",fontSize:"0.9rem"},children:"Closed Days:"}),e.jsxs("div",{className:"d-flex flex-wrap gap-2",children:[h.clinic_closure_info.unexpected_closures.slice(0,10).map((D,Q)=>e.jsxs("span",{className:"badge",style:{background:"rgba(239, 68, 68, 0.1)",color:"#DC2626",border:"1px solid rgba(239, 68, 68, 0.3)",fontSize:"0.75rem"},children:[D.day_name," ",D.date.split("-")[2]]},Q)),h.clinic_closure_info.unexpected_closures.length>10&&e.jsxs("span",{className:"badge bg-secondary",style:{fontSize:"0.75rem"},children:["+",h.clinic_closure_info.unexpected_closures.length-10," more"]})]})]})]})]})})})]})}),h&&h.has_last_month_data&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsxs("div",{className:"card-header border-0 bg-transparent py-4",children:[e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ’¡"}),"Actionable Insights & Recommendations"]}),e.jsx("p",{className:"mb-0 mt-2 text-muted small",children:"Data-driven recommendations to improve your clinic's performance"})]}),e.jsx("div",{className:"card-body pt-0",children:e.jsx("div",{className:"row g-3",children:h.insights&&h.insights.length>0?h.insights.map((D,Q)=>e.jsx("div",{className:"col-12 col-lg-6",children:e.jsx("div",{className:"card h-100 border-0",style:{background:D.priority==="high"?"linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(254, 226, 226, 0.1) 100%)":D.priority==="medium"?"linear-gradient(135deg, rgba(245, 158, 11, 0.05) 0%, rgba(254, 243, 199, 0.1) 100%)":"linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(209, 250, 229, 0.1) 100%)",borderRadius:"12px",border:D.priority==="high"?"1px solid rgba(239, 68, 68, 0.2)":D.priority==="medium"?"1px solid rgba(245, 158, 11, 0.2)":"1px solid rgba(16, 185, 129, 0.2)"},children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"d-flex align-items-start justify-content-between mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3 d-flex align-items-center justify-content-center rounded-circle",style:{width:"40px",height:"40px",background:D.priority==="high"?"linear-gradient(135deg, #EF4444 0%, #DC2626 100%)":D.priority==="medium"?"linear-gradient(135deg, #F59E0B 0%, #D97706 100%)":"linear-gradient(135deg, #10B981 0%, #059669 100%)",color:"white",fontSize:"18px"},children:D.priority==="high"?"ðŸš¨":D.priority==="medium"?"âš ï¸":"âœ…"}),e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1 fw-bold",style:{color:"#1e293b"},children:D.title}),e.jsxs("span",{className:`badge px-2 py-1 ${D.priority==="high"?"bg-danger":D.priority==="medium"?"bg-warning":"bg-success"}`,style:{fontSize:"0.7rem"},children:[D.priority.toUpperCase()," PRIORITY"]})]})]}),e.jsx("div",{className:"text-end",children:e.jsx("small",{className:"text-muted d-block",style:{fontSize:"0.7rem"},children:D.category.replace("_"," ").toUpperCase()})})]}),e.jsx("p",{className:"text-muted mb-3",style:{fontSize:"0.9rem",lineHeight:"1.5"},children:D.description}),e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"fw-semibold mb-2",style:{color:"#374151",fontSize:"0.85rem"},children:"Recommended Actions:"}),e.jsxs("ul",{className:"list-unstyled mb-0",children:[D.actions.slice(0,3).map((ae,me)=>e.jsxs("li",{className:"d-flex align-items-start mb-1",children:[e.jsx("span",{className:"me-2 text-primary",style:{fontSize:"0.8rem"},children:"â€¢"}),e.jsx("span",{style:{fontSize:"0.8rem",color:"#6b7280"},children:ae})]},me)),D.actions.length>3&&e.jsxs("li",{className:"text-muted",style:{fontSize:"0.75rem"},children:["+",D.actions.length-3," more recommendations"]})]})]}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("small",{className:"text-muted",style:{fontSize:"0.75rem"},children:["Impact: ",D.impact]}),e.jsx("button",{className:"btn btn-sm border-0",style:{background:"linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%)",color:"white",borderRadius:"8px",fontSize:"0.75rem",padding:"4px 12px"},onClick:()=>{const ae=D.actions.join(`
â€¢ `);navigator.clipboard.writeText(`Actions for ${D.title}:
â€¢ ${ae}`),alert("Actions copied to clipboard!")},children:"Copy Actions"})]})]})})},Q)):e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"fs-1 mb-3",children:"ðŸ”"}),e.jsx("p",{className:"text-muted mb-0 fw-medium",children:"No actionable insights available"}),e.jsx("small",{className:"text-muted",children:"Insights will appear here when data patterns are detected"})]})})})})]})}),h&&!h.has_last_month_data&&e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsxs("div",{className:"card-header border-0 bg-transparent py-4",children:[e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ“Š"}),"Analytics Status"]}),e.jsx("p",{className:"mb-0 mt-2 text-muted small",children:"Current month analytics overview"})]}),e.jsx("div",{className:"card-body pt-0",children:e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"fs-1 mb-3",children:"ðŸ“ˆ"}),e.jsx("h6",{className:"fw-bold mb-2",style:{color:"#374151"},children:"Insufficient Historical Data"}),e.jsx("p",{className:"text-muted mb-3",children:"Actionable insights require comparison with previous month data. Current month shows activity, but we need more historical data to generate meaningful recommendations."}),e.jsx("div",{className:"alert alert-info border-0",style:{background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:"12px"},children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Tip:"})," Once you have at least one month of historical data, the system will automatically generate actionable insights and recommendations to help optimize your clinic's performance."]})})]})})]})}),e.jsx("div",{className:"mt-4",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0 bg-transparent py-4",children:e.jsxs("h5",{className:"mb-0 fw-bold d-flex align-items-center",style:{color:"#1e293b"},children:[e.jsx("span",{className:"me-2",children:"ðŸ””"}),"System Alerts"]})}),e.jsx("div",{className:"card-body pt-0",children:((h==null?void 0:h.alerts)||[]).length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"fs-1 mb-3",children:"âœ…"}),e.jsx("p",{className:"text-muted mb-0 fw-medium",children:"All systems running smoothly"}),e.jsx("small",{className:"text-muted",children:"No alerts to display"})]}):e.jsx("div",{className:"list-group list-group-flush",children:((h==null?void 0:h.alerts)||[]).map((D,Q)=>e.jsxs("div",{className:`list-group-item border-0 px-0 py-3 d-flex align-items-start ${D.type==="warning"?"text-warning":"text-info"}`,children:[e.jsx("span",{className:"me-3 mt-1",children:D.type==="warning"?"âš ï¸":"â„¹ï¸"}),e.jsx("span",{className:"fw-medium",children:D.message})]},Q))})})]})})]})]})})})}const pi=()=>{const[s,l]=t.useState([]),[a,i]=t.useState({total_patients_with_no_shows:0,patients_under_warning:0,blocked_patients:0,total_no_shows:0,average_no_shows_per_patient:0}),[n,o]=t.useState(!0),[r,c]=t.useState(!0),[m,b]=t.useState(null),[f,y]=t.useState(null),[h,j]=t.useState(!1),[u,P]=t.useState(""),[g,_]=t.useState({}),[N,x]=t.useState(!1),[p,C]=t.useState({status:"",min_no_shows:"",search:""}),[v,A]=t.useState(null);t.useEffect(()=>{if(v&&clearTimeout(v),p.search&&p.search.length>=2){const L=setTimeout(()=>{z(),T()},300);A(L)}else(p.search.length===0||p.status||p.min_no_shows)&&(z(),T());return()=>{v&&clearTimeout(v)}},[p]);const z=async()=>{try{o(!0),b(null);const L=new URLSearchParams;p.status&&L.append("status",p.status),p.min_no_shows&&L.append("min_no_shows",p.min_no_shows),p.search&&L.append("search",p.search);const E=await M.get(`/api/admin/patient-manager?${L.toString()}`);if(E.data&&E.data.data){const I=E.data.data.data||E.data.data||[];l(I)}else Array.isArray(E.data)?l(E.data):l([])}catch(L){b("Failed to fetch patients"),l([]),console.error("Error fetching patients:",L)}finally{o(!1)}},T=async()=>{try{c(!0);const L=await M.get("/api/admin/patient-manager/statistics");i(L.data.data||L.data||{})}catch(L){console.error("Error fetching statistics:",L),i({})}finally{c(!1)}},S=L=>{L==="warning"?C({...p,status:p.status==="warning"?"":"warning"}):L==="blocked"&&C({...p,status:p.status==="blocked"?"":"blocked"})},d=async(L,E,I={})=>{var W,B,Z,te;try{console.log("handleAction called:",{action:L,patientId:E,data:I});let ne;switch(L){case"send-warning":ne=await M.post(`/api/admin/patient-manager/${E}/send-warning`,I);break;case"block":console.log("Blocking patient with data:",I),ne=await M.post(`/api/admin/patient-manager/${E}/block`,I);break;case"unblock":ne=await M.post(`/api/admin/patient-manager/${E}/unblock`,I);break;case"add-note":ne=await M.post(`/api/admin/patient-manager/${E}/add-note`,I);break;case"reset-no-shows":ne=await M.post(`/api/admin/patient-manager/${E}/reset-no-shows`,I);break;default:throw new Error("Unknown action")}ne.data.success?(alert(ne.data.message),z(),T(),j(!1)):alert(ne.data.message||"Action failed")}catch(ne){if((B=(W=ne.response)==null?void 0:W.data)!=null&&B.errors){const be=Object.values(ne.response.data.errors).flat().join(`
`);alert(`Validation failed:
${be}`)}else alert(((te=(Z=ne.response)==null?void 0:Z.data)==null?void 0:te.message)||"Action failed");console.error("Error performing action:",ne)}},R=async(L,E)=>{var W;P(L),y(E);const I={};if(L==="block"&&(I.block_type="account"),_(I),j(!0),L==="block"&&E.id){x(!0);try{const B=await M.get(`/api/admin/patient-manager/${E.id}`);if(B.data.success){y(B.data.data),console.log("Loaded detailed patient data:",B.data.data);const Z=(W=B.data.data.patient)==null?void 0:W.last_login_ip;Z&&_(te=>({...te,block_type:te.block_type||"account",ip:Z})),console.log("Form data after loading patient details:",g)}}catch(B){console.error("Error fetching detailed patient data:",B)}finally{x(!1)}}},H=()=>{j(!1),y(null),_({}),P("")},G=L=>({active:{class:"badge bg-success",text:"Active"},warning:{class:"badge bg-warning",text:"Under Warning"},blocked:{class:"badge bg-danger",text:"Blocked"}})[L]||{class:"badge bg-secondary",text:"Unknown"},$=()=>{var L,E,I,W;return!h||!f?null:e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-lg",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[u==="send-warning"&&"Send Warning",u==="block"&&"Block Patient",u==="unblock"&&"Unblock Patient",u==="add-note"&&"Add Admin Note",u==="reset-no-shows"&&"Reset No-Show Count"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:H})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Patient:"})," ",(L=f.patient)==null?void 0:L.first_name," ",(E=f.patient)==null?void 0:E.last_name,e.jsx("br",{}),e.jsx("strong",{children:"No-show Count:"})," ",f.no_show_count,e.jsx("br",{}),e.jsx("strong",{children:"Current Status:"})," ",e.jsx("span",{className:G(f.block_status).class,children:G(f.block_status).text})]}),u==="send-warning"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Warning Message"}),e.jsx("textarea",{className:"form-control",rows:"4",value:g.message||"",onChange:B=>_({...g,message:B.target.value}),placeholder:"Enter custom warning message..."})]}),u==="block"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"Note:"})," This will block the patient from booking new appointments online. They can still walk in for services and access their account."]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Block Reason"}),e.jsx("textarea",{className:"form-control",rows:"3",value:g.reason||"",onChange:B=>_({...g,reason:B.target.value}),placeholder:"Enter reason for blocking appointment booking...",required:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Block Type"}),e.jsxs("select",{className:"form-control",value:g.block_type||"account",onChange:B=>_({...g,block_type:B.target.value}),children:[e.jsx("option",{value:"account",children:"Account Only"}),e.jsx("option",{value:"ip",children:"IP Address Only"}),e.jsx("option",{value:"both",children:"Account + IP Address"})]})]}),(g.block_type==="ip"||g.block_type==="both")&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"IP Address"}),N&&e.jsx("div",{className:"mb-2",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-hourglass-split me-1"}),"Loading recent IP addresses..."]})}),!N&&((I=f==null?void 0:f.patient)==null?void 0:I.recent_ip_addresses)&&f.patient.recent_ip_addresses.length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted",children:"Recent IP addresses:"}),e.jsxs("small",{className:"text-muted ms-2",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Multiple IPs may appear due to VPNs, mobile networks, or proxy usage"]}),e.jsx("div",{className:"mt-1",children:f.patient.recent_ip_addresses.slice(0,3).map((B,Z)=>e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm me-2 mb-1",onClick:()=>_({...g,ip:B.ip}),title:`Last seen: ${new Date(B.last_seen).toLocaleString()}`,children:[e.jsx("i",{className:"bi bi-ip-address me-1"}),B.ip,Z===0&&e.jsx("span",{className:"badge bg-primary ms-1",children:"Latest"})]},Z))})]}),e.jsx("input",{type:"text",className:"form-control",value:g.ip||"",onChange:B=>_({...g,ip:B.target.value}),placeholder:"Enter IP address to block..."}),g.ip&&e.jsxs("div",{className:"mt-1",children:[(g.ip==="127.0.0.1"||g.ip.startsWith("192.168.")||g.ip.startsWith("10.")||g.ip.startsWith("172."))&&e.jsxs("small",{className:"text-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"Warning: This appears to be a local/private IP address. Blocking this may affect multiple users."]}),g.ip==="0.0.0.0"&&e.jsxs("small",{className:"text-danger",children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Invalid IP address. Please enter a valid public IP."]})]}),e.jsx("small",{className:"form-text text-muted",children:(W=f==null?void 0:f.patient)!=null&&W.recent_ip_addresses&&f.patient.recent_ip_addresses.length>0?"Click on a recent IP above to auto-fill, or enter a custom public IP address.":"Enter a valid public IP address to block. Private/local IPs (127.0.0.1, 192.168.x.x, etc.) are not recommended as they may affect multiple users."})]})]}),u==="unblock"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Unblock Reason (Optional)"}),e.jsx("textarea",{className:"form-control",rows:"3",value:g.reason||"",onChange:B=>_({...g,reason:B.target.value}),placeholder:"Enter reason for unblocking..."})]}),u==="add-note"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Admin Note"}),e.jsx("textarea",{className:"form-control",rows:"4",value:g.note||"",onChange:B=>_({...g,note:B.target.value}),placeholder:"Enter admin note...",required:!0})]}),u==="reset-no-shows"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Reset Reason"}),e.jsx("textarea",{className:"form-control",rows:"3",value:g.reason||"",onChange:B=>_({...g,reason:B.target.value}),placeholder:"Enter reason for resetting no-show count...",required:!0}),e.jsxs("div",{className:"form-text text-warning",children:[e.jsx("strong",{children:"Warning:"})," This will reset the patient's no-show count to 0 and remove all warnings/blocks."]})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:H,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>d(u,f.id,g),children:"Confirm"})]})]})})})};return e.jsxs("div",{className:"patient-manager",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{children:"Patient Manager"}),e.jsxs("div",{className:"d-flex gap-2",children:[(p.status||p.min_no_shows||p.search)&&e.jsxs("button",{className:"btn btn-outline-secondary",onClick:()=>C({status:"",min_no_shows:"",search:""}),title:"Clear all filters",children:[e.jsx("i",{className:"bi bi-funnel"})," Clear Filters"]}),e.jsxs("button",{className:"btn btn-outline-primary",onClick:z,children:[e.jsx("i",{className:"bi bi-arrow-clockwise"})," Refresh"]})]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card bg-primary text-white",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Total with No-shows"}),e.jsx("h3",{children:r?"...":(a==null?void 0:a.total_patients_with_no_shows)||0})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:`card bg-warning text-white ${p.status==="warning"?"border border-3 border-light":""}`,style:{cursor:"pointer"},onClick:()=>S("warning"),title:"Click to filter patients under warning",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Under Warning"}),e.jsx("h3",{children:r?"...":(a==null?void 0:a.patients_under_warning)||0}),p.status==="warning"&&e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-funnel-fill"})," Filter Active"]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:`card bg-danger text-white ${p.status==="blocked"?"border border-3 border-light":""}`,style:{cursor:"pointer"},onClick:()=>S("blocked"),title:"Click to filter blocked patients",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Blocked"}),e.jsx("h3",{children:r?"...":(a==null?void 0:a.blocked_patients)||0}),p.status==="blocked"&&e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-funnel-fill"})," Filter Active"]})]})})}),e.jsx("div",{className:"col-md-3",children:e.jsx("div",{className:"card bg-info text-white",children:e.jsxs("div",{className:"card-body",children:[e.jsx("h5",{className:"card-title",children:"Total No-shows"}),e.jsx("h3",{children:r?"...":(a==null?void 0:a.total_no_shows)||0})]})})})]}),e.jsx("div",{className:"card mb-4",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Status"}),e.jsxs("select",{className:"form-control",value:p.status,onChange:L=>C({...p,status:L.target.value}),children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"warning",children:"Under Warning"}),e.jsx("option",{value:"blocked",children:"Blocked"})]})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label",children:"Min No-shows"}),e.jsx("input",{type:"number",className:"form-control",value:p.min_no_shows,onChange:L=>C({...p,min_no_shows:L.target.value}),placeholder:"Minimum no-shows"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label",children:"Search"}),e.jsx("input",{type:"text",className:"form-control",value:p.search,onChange:L=>C({...p,search:L.target.value}),placeholder:"Search by name or contact number... (min 2 characters)"}),p.search.length>0&&p.search.length<2&&e.jsxs("div",{className:"form-text text-warning",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Please enter at least 2 characters to search"]})]})]})})}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body position-relative",children:[n&&e.jsx("div",{className:"position-absolute top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center",style:{backgroundColor:"rgba(255, 255, 255, 0.8)",zIndex:10,minHeight:"200px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 mb-0",children:"Updating table..."})]})}),m&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:m}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"No-shows"}),e.jsx("th",{children:"Warnings"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Last No-show"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s&&s.length>0?s.map(L=>{var E,I,W,B,Z;return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsxs("strong",{children:[(E=L.patient)==null?void 0:E.first_name," ",(I=L.patient)==null?void 0:I.last_name]}),((B=(W=L.patient)==null?void 0:W.user)==null?void 0:B.email)&&e.jsx("div",{className:"text-muted small",children:L.patient.user.email})]}),e.jsx("td",{children:(Z=L.patient)==null?void 0:Z.contact_number}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-danger",children:L.no_show_count})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-warning",children:L.warning_count})}),e.jsx("td",{children:e.jsx("span",{className:G(L.block_status).class,children:G(L.block_status).text})}),e.jsx("td",{children:L.last_no_show_at?new Date(L.last_no_show_at).toLocaleDateString():"Never"}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{className:"btn btn-outline-warning",onClick:()=>R("send-warning",L),title:"Send Warning",children:e.jsx("i",{className:"bi bi-exclamation-triangle"})}),L.block_status!=="blocked"?e.jsx("button",{className:"btn btn-outline-danger",onClick:()=>R("block",L),title:"Block Appointment Booking",children:e.jsx("i",{className:"bi bi-ban"})}):e.jsx("button",{className:"btn btn-outline-success",onClick:()=>R("unblock",L),title:"Unblock Appointment Booking",children:e.jsx("i",{className:"bi bi-check-circle"})}),e.jsx("button",{className:"btn btn-outline-info",onClick:()=>R("add-note",L),title:"Add Note",children:e.jsx("i",{className:"bi bi-sticky"})}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>R("reset-no-shows",L),title:"Reset No-shows",children:e.jsx("i",{className:"bi bi-arrow-clockwise"})})]})})]},L.id)}):e.jsx("tr",{children:e.jsx("td",{colSpan:"7",className:"text-center py-4",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-inbox fs-1 d-block mb-2"}),n?"Loading patients...":"No patients found"]})})})})]})}),s&&s.length===0&&!n&&e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-muted",children:"No patients found matching the criteria."})})]})}),$()]})};function bi(){const[s,l]=t.useState("week1"),[a,i]=t.useState([]),[n,o]=t.useState(!0),[r,c]=t.useState(null),b=(N=>{const x=new Date,p=new Date(x),C=x.getDay(),v=C===0?6:C-1;p.setDate(x.getDate()-v),p.setDate(p.getDate()+(N==="week2"?7:0));const A=[];for(let z=0;z<7;z++){const T=new Date(p);T.setDate(p.getDate()+z),A.push(T.toISOString().split("T")[0])}return A})(s),f=new Date(b[0]),y=new Date(b[6]);t.useEffect(()=>{h()},[s]);const h=async()=>{try{o(!0),c(null);const N=await M.get("/api/admin/time-block-utilization",{params:{start_date:b[0],end_date:b[6]}});i(N.data)}catch(N){console.error("Failed to fetch time block data:",N),c("Failed to load time block data. Please try again.")}finally{o(!1)}},j=N=>new Date(N).toLocaleDateString("en-US",{weekday:"short"}),u=N=>new Date(N).toLocaleDateString("en-US",{month:"short",day:"numeric"}),P=N=>N===0?"#e2e8f0":N<=25?"#dcfce7":N<=50?"#fef3c7":N<=75?"#fed7aa":"#fecaca",_=(()=>{const N=[];for(let x=8;x<17;x++)for(let p=0;p<60;p+=30){const C=`${x.toString().padStart(2,"0")}:${p.toString().padStart(2,"0")}`;N.push(C)}return N})();return e.jsx("div",{className:"time-block-utilization-dashboard",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",maxWidth:"100%",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:[e.jsxs("div",{className:"d-flex flex-column flex-lg-row justify-content-between align-items-start align-items-lg-center gap-3",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar-week me-2"}),"Time Block Utilization Dashboard"]}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#6b7280"},children:"Visual overview of appointment capacity and time block usage"})]}),e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2",children:[e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsxs("label",{className:"form-label mb-0 fw-semibold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar-range me-1"}),"Week:"]}),e.jsxs("select",{className:"form-select border-0 shadow-sm",style:{borderRadius:"12px",padding:"8px 12px",background:"white",border:"1px solid #e2e8f0",minWidth:"120px"},value:s,onChange:N=>l(N.target.value),children:[e.jsx("option",{value:"week1",children:"Week 1"}),e.jsx("option",{value:"week2",children:"Week 2"})]})]}),e.jsxs("button",{className:"btn border-0 shadow-sm",onClick:h,style:{background:"linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%)",color:"white",borderRadius:"12px",padding:"8px 16px",fontWeight:"600",transition:"all 0.3s ease"},children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("div",{className:"badge bg-primary fs-6 px-3 py-2",children:[f.toLocaleDateString("en-US",{month:"long",day:"numeric"})," - ",y.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})]}),e.jsx("small",{className:"text-muted",children:s==="week1"?"Next 7 days":"Following 7 days"})]})})]}),e.jsx("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:n?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"spinner-border text-primary mb-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted",children:"Loading time block data..."})]})}):r?e.jsxs("div",{className:"alert alert-danger d-flex align-items-center",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-2"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error:"})," ",r]})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"fw-semibold mb-3",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Utilization Legend"]}),e.jsx("div",{className:"d-flex flex-wrap gap-3",children:[{level:"Empty",color:"#e2e8f0",range:"0%"},{level:"Low",color:"#dcfce7",range:"1-25%"},{level:"Medium",color:"#fef3c7",range:"26-50%"},{level:"High",color:"#fed7aa",range:"51-75%"},{level:"Very High",color:"#fecaca",range:"76-100%"}].map(N=>e.jsxs("div",{className:"d-flex align-items-center gap-2",children:[e.jsx("div",{style:{width:"20px",height:"20px",backgroundColor:N.color,borderRadius:"4px",border:"1px solid #d1d5db"}}),e.jsxs("span",{className:"text-muted small",children:[N.level," (",N.range,")"]})]},N.level))})]}),e.jsx("div",{className:"table-responsive",style:{maxHeight:"70vh",overflow:"auto"},children:e.jsxs("table",{className:"table table-bordered mb-0",style:{fontSize:"0.875rem"},children:[e.jsx("thead",{className:"table-primary sticky-top",children:e.jsxs("tr",{children:[e.jsxs("th",{className:"fw-semibold px-2 py-2 border-0 text-center",style:{minWidth:"80px",position:"sticky",left:0,backgroundColor:"#0d6efd",zIndex:10},children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Time"]}),b.map((N,x)=>e.jsx("th",{className:"fw-semibold px-2 py-2 border-0 text-center",style:{minWidth:"120px"},children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("div",{className:"fw-bold",children:j(N)}),e.jsx("small",{className:"text-muted",children:u(N)})]})},N))]})}),e.jsx("tbody",{children:_.map(N=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-semibold px-2 py-2 text-center border-0",style:{position:"sticky",left:0,backgroundColor:"#f8fafc",zIndex:5,borderRight:"2px solid #e2e8f0 !important"},children:N}),b.map(x=>{var T;const p=a.find(S=>S.date===x),C=(T=p==null?void 0:p.time_slots)==null?void 0:T.find(S=>S.time===N),v=(C==null?void 0:C.utilization_percentage)||0,A=(C==null?void 0:C.appointment_count)||0,z=(C==null?void 0:C.max_capacity)||1;return e.jsx("td",{className:"px-1 py-2 text-center border-0",style:{backgroundColor:P(v),border:"1px solid #e2e8f0",position:"relative",cursor:"pointer"},title:`${N} - ${j(x)} ${u(x)}
Utilization: ${v}%
Appointments: ${A}/${z}`,children:e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsxs("small",{className:"fw-semibold",style:{fontSize:"0.75rem"},children:[v,"%"]}),e.jsxs("small",{className:"text-muted",style:{fontSize:"0.7rem"},children:[A,"/",z]})]})},`${x}-${N}`)})]},N))})]})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("h6",{className:"fw-semibold mb-3",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-bar-chart me-2"}),"Week Summary"]}),e.jsx("div",{className:"row g-3",children:b.map(N=>{const x=a.find(A=>A.date===N),p=(x==null?void 0:x.total_slots)||0,C=(x==null?void 0:x.total_utilization)||0,v=(x==null?void 0:x.total_appointments)||0;return e.jsx("div",{className:"col-12 col-md-6 col-lg-4",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("h6",{className:"card-title mb-0 fw-semibold",children:j(N)}),e.jsx("small",{className:"text-muted",children:u(N)})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Appointments"}),e.jsx("span",{className:"fw-bold text-primary",children:v})]}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Avg. Utilization"}),e.jsxs("span",{className:"fw-bold text-success",children:[C,"%"]})]}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Time Slots"}),e.jsx("span",{className:"fw-bold text-info",children:p})]})]})]})})},N)})})]})]})})]})})})})}const Xs=({show:s,onHide:l,receiptData:a})=>(t.useEffect(()=>(s?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[s]),!s||!a?null:e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal-backdrop fade show",style:{zIndex:1050},onClick:l}),e.jsx("div",{className:"modal fade show d-block",tabIndex:"-1",style:{zIndex:1055},onClick:l,children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable",onClick:i=>i.stopPropagation(),children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header border-bottom-0",style:{background:"linear-gradient(135deg, #0077be 0%, #005a8f 100%)"},children:[e.jsxs("h5",{className:"modal-title text-white",children:[e.jsx("i",{className:"bi bi-receipt me-2"}),"Receipt - ",a.receipt_number]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:l,"aria-label":"Close"})]}),e.jsx("div",{className:"modal-body p-4",style:{backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"receipt-container bg-white p-4 rounded shadow-sm",children:[e.jsxs("div",{className:"text-center border-bottom pb-3 mb-4",style:{borderBottomColor:"#0077be",borderBottomWidth:"3px"},children:[e.jsx("h2",{className:"mb-1",style:{color:"#0077be",fontSize:"28px",fontWeight:"bold"},children:a.clinic_name}),e.jsx("p",{className:"text-muted mb-0",style:{fontSize:"16px"},children:a.receipt_type==="visit"?"Visit Receipt":"Official Receipt"})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:"Receipt Information"}),e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Receipt No:"}),e.jsx("span",{className:"fw-bold",children:a.receipt_number})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Date:"}),e.jsx("span",{children:a.receipt_date})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Time:"}),e.jsx("span",{children:a.receipt_time})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:"Clinic Information"}),e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Address:"}),e.jsx("span",{className:"text-end",children:a.clinic_address})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Phone:"}),e.jsx("span",{children:a.clinic_phone})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Email:"}),e.jsx("span",{children:a.clinic_email})]})]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:"Patient Information"}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Name:"}),e.jsx("span",{className:"fw-bold",children:a.patient_name})]}),a.patient_email&&e.jsxs("div",{className:"col-md-6 d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Email:"}),e.jsx("span",{children:a.patient_email})]}),a.patient_phone&&e.jsxs("div",{className:"col-md-6 d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Phone:"}),e.jsx("span",{children:a.patient_phone})]}),a.patient_address&&e.jsxs("div",{className:"col-md-6 d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Address:"}),e.jsx("span",{className:"text-end",children:a.patient_address})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:a.receipt_type==="visit"?"Visit Details":"Service Details"}),e.jsxs("div",{className:"p-3 rounded",style:{backgroundColor:"#f8f9fa",borderLeft:"4px solid #0077be"},children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Service:"}),e.jsx("span",{className:"fw-bold",children:a.service_name})]}),a.service_description&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Description:"}),e.jsx("span",{className:"text-end",children:a.service_description})]}),a.receipt_type==="appointment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Appointment Date:"}),e.jsx("span",{children:a.service_date})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Time Slot:"}),e.jsx("span",{children:a.service_time})]}),a.teeth_count&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Teeth Count:"}),e.jsx("span",{children:a.teeth_description})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Status:"}),e.jsx("span",{className:"badge bg-success",children:a.appointment_status})]})]}),a.receipt_type==="visit"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Visit Date:"}),e.jsx("span",{children:a.visit_date})]}),a.start_time&&a.end_time&&e.jsxs("div",{className:"p-2 rounded mb-2",style:{backgroundColor:"#d4edda",borderLeft:"4px solid #28a745"},children:[e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsx("span",{className:"text-muted",children:"Start Time:"}),e.jsx("span",{children:a.start_time})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"End Time:"}),e.jsx("span",{children:a.end_time})]})]}),a.teeth_treated&&e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Teeth Treated:"}),e.jsx("span",{children:a.teeth_treated})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Status:"}),e.jsx("span",{className:"badge bg-success",children:a.visit_status})]})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{className:"fw-bold mb-2 pb-1 border-bottom",style:{color:"#0077be"},children:"Payment Information"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-bordered",children:[e.jsx("thead",{style:{backgroundColor:"#f8f9fa"},children:e.jsxs("tr",{children:[e.jsx("th",{style:{color:"#0077be"},children:"Payment Method"}),e.jsx("th",{style:{color:"#0077be"},children:"Reference"}),e.jsx("th",{style:{color:"#0077be"},children:"Amount"}),e.jsx("th",{style:{color:"#0077be"},children:"Date Paid"}),e.jsx("th",{style:{color:"#0077be"},children:"Status"})]})}),e.jsxs("tbody",{children:[a.payment_details&&a.payment_details.length>0?a.payment_details.map((i,n)=>e.jsxs("tr",{children:[e.jsx("td",{children:i.method}),e.jsx("td",{children:i.reference}),e.jsxs("td",{children:["â‚±",parseFloat(i.amount).toFixed(2)]}),e.jsx("td",{children:i.paid_at||"N/A"}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-success",children:i.status})})]},n)):e.jsx("tr",{children:e.jsx("td",{colSpan:"5",className:"text-center",children:"No payment records found"})}),e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",fontWeight:"bold"},children:[e.jsx("td",{colSpan:"2",children:e.jsx("strong",{children:"Total Amount"})}),e.jsxs("td",{style:{color:"#28a745",fontSize:"16px"},children:["â‚±",parseFloat(a.total_amount).toFixed(2)]}),e.jsx("td",{colSpan:"2"})]}),e.jsxs("tr",{style:{backgroundColor:"#e3f2fd",fontWeight:"bold"},children:[e.jsx("td",{colSpan:"2",children:e.jsx("strong",{children:"Total Paid"})}),e.jsxs("td",{style:{color:"#28a745",fontSize:"16px"},children:["â‚±",parseFloat(a.total_paid).toFixed(2)]}),e.jsx("td",{colSpan:"2"})]})]})]})})]}),a.notes&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"p-3 rounded",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeaa7"},children:[e.jsx("h6",{className:"mb-2",style:{color:"#856404"},children:"Additional Notes"}),e.jsx("p",{className:"mb-0",children:a.notes})]})}),a.receipt_type==="visit"&&a.has_notes&&e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"p-3 rounded",style:{backgroundColor:"#fff3cd",border:"1px solid #ffeaa7"},children:[e.jsx("h6",{className:"mb-2",style:{color:"#856404"},children:"Treatment Notes"}),e.jsx("p",{className:"mb-0",children:"Detailed treatment notes and findings are available in your patient record. Please contact the clinic if you need a copy of your treatment notes."})]})}),e.jsxs("div",{className:"text-center mt-4 pt-3 border-top",children:[e.jsx("p",{className:"fw-bold mb-2",children:"Thank you for choosing Kreative Dental & Orthodontics!"}),e.jsx("p",{className:"text-muted mb-1",style:{fontSize:"12px"},children:"Please keep this receipt for your records."}),e.jsxs("p",{className:"text-muted mb-1",style:{fontSize:"12px"},children:["For inquiries, please contact us at ",a.clinic_phone," or ",a.clinic_email]}),e.jsxs("p",{className:"text-muted",style:{fontSize:"10px"},children:["Generated on ",a.receipt_date," at ",a.receipt_time]})]})]})}),e.jsx("div",{className:"modal-footer",children:e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:l,children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Close"]})})]})})})]}));Xs.propTypes={show:zs.bool.isRequired,onHide:zs.func.isRequired,receiptData:zs.object};const fi=()=>{const[s,l]=t.useState([]),[a,i]=t.useState(!0),[n,o]=t.useState(null),[r,c]=t.useState({current_page:1,last_page:1,per_page:20,total:0}),[m,b]=t.useState({search:"",appointment_date:"",visit_date:""}),[f,y]=t.useState(!1),[h,j]=t.useState(null),[u,P]=t.useState(!1),[g,_]=t.useState(null),[N,x]=t.useState(!0);t.useEffect(()=>{p(1),x(!1)},[]),t.useEffect(()=>{if(N)return;g&&clearTimeout(g);const S=m.search&&m.search.length>=2,d=m.appointment_date||m.visit_date;if(S){const R=setTimeout(()=>{p(1)},300);_(R)}else(d||m.search.length===0)&&p(1);return()=>{g&&clearTimeout(g)}},[m.search,m.appointment_date,m.visit_date]);const p=async(S=1)=>{try{i(!0),o(null);const d={page:S,...m};Object.keys(d).forEach(H=>{d[H]||delete d[H]});const R=await M.get("/api/admin/payment-records",{params:d});R.data&&R.data.data?(l(R.data.data),c(R.data.pagination||{current_page:1,last_page:1,per_page:20,total:0})):(l([]),c({current_page:1,last_page:1,per_page:20,total:0}))}catch(d){console.error("Failed to fetch payment records:",d),o("Failed to load payment records. Please try again.")}finally{i(!1)}},C=S=>{const{name:d,value:R}=S.target;b(H=>({...H,[d]:R}))},v=()=>{b({search:"",appointment_date:"",visit_date:""})},A=async S=>{try{P(!0);const d=await M.get(`/api/admin/payment-records/${S.id}/receipt-data`);j(d.data.data),y(!0)}catch(d){console.error("Failed to fetch receipt data:",d),alert("Failed to load receipt. Please try again.")}finally{P(!1)}},z=()=>{y(!1),j(null)},T=S=>{p(S)};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-1",style:{color:"#0077be",fontWeight:"bold"},children:[e.jsx("i",{className:"bi bi-receipt me-2"}),"Payment Records"]}),e.jsx("p",{className:"text-muted mb-0",children:"Search and view payment receipts"})]}),r.total>0&&e.jsxs("div",{className:"badge bg-primary",style:{fontSize:"14px",padding:"10px 15px"},children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),r.total," Paid ",r.total===1?"Payment":"Payments"]})]}),e.jsx("div",{className:"card shadow-sm mb-4",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-funnel me-2"}),"Filters"]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-person-search me-1"}),"Search Patient Name"]}),e.jsx("input",{type:"text",className:"form-control",name:"search",value:m.search,onChange:C,placeholder:"Enter patient name..."}),e.jsx("small",{className:"text-muted",children:"Minimum 2 characters"})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Appointment Date"]}),e.jsx("input",{type:"date",className:"form-control",name:"appointment_date",value:m.appointment_date,onChange:C})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),"Visit Date"]}),e.jsx("input",{type:"date",className:"form-control",name:"visit_date",value:m.visit_date,onChange:C})]}),e.jsx("div",{className:"col-md-2 d-flex align-items-end",children:e.jsxs("button",{className:"btn btn-outline-secondary w-100",onClick:v,disabled:!m.search&&!m.appointment_date&&!m.visit_date,children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Clear"]})})]})]})}),e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:a?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading payment records..."})]}):n?e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),n]}):s.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-inbox",style:{fontSize:"48px",color:"#ccc"}}),e.jsx("p",{className:"mt-3 text-muted",children:"No payment records found"}),(m.search||m.appointment_date||m.visit_date)&&e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:v,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Receipt #"}),e.jsx("th",{children:"Patient Name"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Appointment Date"}),e.jsx("th",{children:"Visit Date"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Date Paid"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(S=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge bg-info text-dark",children:S.receipt_number})}),e.jsx("td",{className:"fw-bold",children:S.patient_name}),e.jsx("td",{children:S.service_name}),e.jsx("td",{children:S.appointment_date?e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),new Date(S.appointment_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:S.visit_date?e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),new Date(S.visit_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsxs("td",{className:"fw-bold text-success",children:["â‚±",parseFloat(S.amount_paid).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:S.payment_method})}),e.jsx("td",{className:"text-muted",style:{fontSize:"13px"},children:S.paid_at}),e.jsx("td",{children:e.jsx("span",{className:`badge ${S.type==="visit"?"bg-primary":"bg-success"}`,children:S.type==="visit"?"Visit":"Appointment"})}),e.jsx("td",{children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>A(S),disabled:u,children:[e.jsx("i",{className:"bi bi-receipt me-1"}),"View Receipt"]})})]},S.id))})]})}),r.last_page>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(r.current_page-1)*r.per_page+1," to"," ",Math.min(r.current_page*r.per_page,r.total)," of"," ",r.total," records"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${r.current_page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>T(r.current_page-1),disabled:r.current_page===1,children:"Previous"})}),[...Array(r.last_page)].map((S,d)=>{const R=d+1;return R===1||R===r.last_page||R>=r.current_page-1&&R<=r.current_page+1?e.jsx("li",{className:`page-item ${r.current_page===R?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>T(R),children:R})},R):R===r.current_page-2||R===r.current_page+2?e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"..."})},R):null}),e.jsx("li",{className:`page-item ${r.current_page===r.last_page?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>T(r.current_page+1),disabled:r.current_page===r.last_page,children:"Next"})})]})})]})]})})})]})}),e.jsx(Xs,{show:f,onHide:z,receiptData:h})]})},$a=()=>{const[s,l]=t.useState(""),[a,i]=t.useState([]),[n,o]=t.useState(null),[r,c]=t.useState(!1),[m,b]=t.useState(""),[f,y]=t.useState([]),[h,j]=t.useState(null),[u,P]=t.useState(!1),[g,_]=t.useState(!1),[N,x]=t.useState(null),[p,C]=t.useState(""),v=()=>JSON.parse(localStorage.getItem("user")||"{}").role==="admin"?"/api/admin/patient-binding":"/api/staff/patient-binding",A=async()=>{if(!s.trim()){i([]);return}c(!0);try{const $=await M.get(`${v()}/unlinked-patients`,{params:{q:s}});i($.data)}catch($){console.error("Failed to search patients:",$),x("Failed to search patients. Please try again."),C("error")}finally{c(!1)}},z=async()=>{if(!m.trim()){y([]);return}P(!0);try{const $=await M.get(`${v()}/unlinked-users`,{params:{q:m}});y($.data)}catch($){console.error("Failed to search users:",$),x("Failed to search users. Please try again."),C("error")}finally{P(!1)}},T=async()=>{var $,L;if(!n||!h){x("Please select both a patient and a user to bind."),C("error");return}_(!0),x(null);try{const E=await M.post(`${v()}/bind`,{patient_id:n.id,user_id:h.id});x(E.data.message||"Successfully bound patient to user!"),C("success"),o(null),j(null),i([]),y([]),l(""),b("")}catch(E){const I=((L=($=E.response)==null?void 0:$.data)==null?void 0:L.message)||"Failed to bind patient and user. Please try again.";x(I),C("error")}finally{_(!1)}},S=$=>{o($),x(null)},d=$=>{j($),x(null)},R=()=>{o(null)},H=()=>{j(null)},G=$=>$?new Date($).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A";return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx("div",{className:"row mb-4",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("h2",{className:"mb-2",children:[e.jsx("i",{className:"bi bi-link-45deg me-2 text-primary"}),"Patient-User Account Binding"]}),e.jsx("p",{className:"text-muted",children:"Link existing patient records to user accounts. Search for unlinked patients and users, then bind them together."})]})}),N&&e.jsxs("div",{className:`alert alert-${p==="success"?"success":"danger"} alert-dismissible fade show`,role:"alert",children:[e.jsx("i",{className:`bi bi-${p==="success"?"check-circle":"exclamation-triangle"} me-2`}),N,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>x(null)})]}),e.jsxs("div",{className:"row g-4",children:[e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"card shadow-sm h-100",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person-fill me-2"}),"Step 1: Select Patient Record"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Search Unlinked Patients"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by name or contact number...",value:s,onChange:$=>l($.target.value),onKeyPress:$=>$.key==="Enter"&&A()}),e.jsx("button",{className:"btn btn-primary",onClick:A,disabled:r,children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-search me-1"}),"Search"]})})]}),e.jsx("small",{className:"form-text text-muted",children:"Only shows patients not linked to any user account"})]}),n&&e.jsx("div",{className:"alert alert-info border-info",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Selected Patient"]}),e.jsx("p",{className:"mb-1",children:e.jsxs("strong",{children:[n.first_name," ",n.middle_name||""," ",n.last_name]})}),e.jsxs("small",{className:"text-muted",children:["ID: ",n.id," | Contact: ",n.contact_number||"N/A"," | Birthdate: ",G(n.birthdate)]})]}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:R,children:e.jsx("i",{className:"bi bi-x-lg"})})]})}),e.jsxs("div",{className:"search-results",style:{maxHeight:"400px",overflowY:"auto"},children:[a.length>0&&!n&&e.jsx("div",{className:"list-group",children:a.map($=>e.jsx("button",{className:"list-group-item list-group-item-action",onClick:()=>S($),children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:[$.first_name," ",$.middle_name||""," ",$.last_name]}),e.jsxs("small",{className:"text-muted",children:["ID: ",$.id," |",$.contact_number&&` Contact: ${$.contact_number} |`,$.birthdate&&` Birthdate: ${G($.birthdate)} |`,"Sex: ",$.sex||"N/A"]})]}),e.jsx("span",{className:"badge bg-secondary",children:"Select"})]})},$.id))}),!r&&s&&a.length===0&&e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("i",{className:"bi bi-search display-4"}),e.jsx("p",{className:"mt-2",children:"No unlinked patients found"})]}),!s&&a.length===0&&!n&&e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("i",{className:"bi bi-person-plus display-4"}),e.jsx("p",{className:"mt-2",children:"Enter a search query to find patients"})]})]})]})]})}),e.jsx("div",{className:"col-lg-6",children:e.jsxs("div",{className:"card shadow-sm h-100",children:[e.jsx("div",{className:"card-header bg-success text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"Step 2: Select User Account"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Search Unlinked Patient Users"}),e.jsxs("div",{className:"input-group",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by name, email, or contact...",value:m,onChange:$=>b($.target.value),onKeyPress:$=>$.key==="Enter"&&z()}),e.jsx("button",{className:"btn btn-success",onClick:z,disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Searching..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-search me-1"}),"Search"]})})]}),e.jsx("small",{className:"form-text text-muted",children:"Only shows patient role users without linked patient records"})]}),h&&e.jsx("div",{className:"alert alert-success border-success",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h6",{className:"mb-1",children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Selected User"]}),e.jsx("p",{className:"mb-1",children:e.jsx("strong",{children:h.name})}),e.jsxs("small",{className:"text-muted",children:["ID: ",h.id," | Email: ",h.email," | Contact: ",h.contact_number||"N/A"]})]}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:H,children:e.jsx("i",{className:"bi bi-x-lg"})})]})}),e.jsxs("div",{className:"search-results",style:{maxHeight:"400px",overflowY:"auto"},children:[f.length>0&&!h&&e.jsx("div",{className:"list-group",children:f.map($=>e.jsx("button",{className:"list-group-item list-group-item-action",onClick:()=>d($),children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:$.name}),e.jsxs("small",{className:"text-muted",children:["ID: ",$.id," | Email: ",$.email,$.contact_number&&` | Contact: ${$.contact_number}`]})]}),e.jsx("span",{className:"badge bg-secondary",children:"Select"})]})},$.id))}),!u&&m&&f.length===0&&e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("i",{className:"bi bi-search display-4"}),e.jsx("p",{className:"mt-2",children:"No unlinked user accounts found"})]}),!m&&f.length===0&&!h&&e.jsxs("div",{className:"text-center text-muted py-4",children:[e.jsx("i",{className:"bi bi-person-circle display-4"}),e.jsx("p",{className:"mt-2",children:"Enter a search query to find users"})]})]})]})]})})]}),e.jsx("div",{className:"row mt-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card shadow-sm",children:e.jsxs("div",{className:"card-body text-center",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-arrow-left-right me-2"}),"Step 3: Bind Patient to User"]}),n&&h?e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"alert alert-light border",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-5 text-start",children:[e.jsx("strong",{className:"text-primary",children:"Patient:"}),e.jsxs("p",{className:"mb-0",children:[n.first_name," ",n.middle_name||""," ",n.last_name]}),e.jsxs("small",{className:"text-muted",children:["ID: ",n.id]})]}),e.jsx("div",{className:"col-md-2",children:e.jsx("i",{className:"bi bi-arrow-left-right display-6 text-warning"})}),e.jsxs("div",{className:"col-md-5 text-start",children:[e.jsx("strong",{className:"text-success",children:"User:"}),e.jsx("p",{className:"mb-0",children:h.name}),e.jsx("small",{className:"text-muted",children:h.email})]})]})}),e.jsx("button",{className:"btn btn-warning btn-lg",onClick:T,disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Binding..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-link-45deg me-2"}),"Bind Patient to User Account"]})})]}):e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle display-4"}),e.jsx("p",{className:"mt-2",children:"Select both a patient and a user to proceed with binding"})]})]})})})})]})},gi=()=>e.jsx($a,{});function ia(){var F,q,X,re;const[s,l]=t.useState([]),[a,i]=t.useState(!0),[n,o]=t.useState("all"),[r,c]=t.useState(null),[m,b]=t.useState(!1),[f,y]=t.useState(!1),[h,j]=t.useState(!1),[u,P]=t.useState(""),[g,_]=t.useState(!1),[N,x]=t.useState(null),[p,C]=t.useState(""),[v,A]=t.useState(""),[z,T]=t.useState(!1),[S,d]=t.useState(""),R=async()=>{i(!0);try{const V=n!=="all"?{status:n}:{},{data:ce}=await M.get("/api/admin/refund-requests",{params:V});l(ce)}catch(V){console.error("Failed to load refund requests",V)}finally{i(!1)}};t.useEffect(()=>{R()},[n]);const H=async V=>{var ce,he;x(V);try{await M.post(`/api/admin/refund-requests/${V}/approve`,{admin_notes:u}),await R(),P(""),b(!1),c(null)}catch(le){alert(((he=(ce=le==null?void 0:le.response)==null?void 0:ce.data)==null?void 0:he.message)||"Failed to approve refund request.")}finally{x(null)}},G=async V=>{var ce,he;if(window.confirm("Are you sure you want to reject this refund request?")){x(V);try{await M.post(`/api/admin/refund-requests/${V}/reject`,{admin_notes:u}),await R(),P(""),b(!1),c(null)}catch(le){alert(((he=(ce=le==null?void 0:le.response)==null?void 0:ce.data)==null?void 0:he.message)||"Failed to reject refund request.")}finally{x(null)}}},$=async V=>{var ce,he;_(!0);try{await M.post(`/api/admin/refund-requests/${V}/process`,{admin_notes:u}),await R(),P(""),y(!1),c(null)}catch(le){alert(((he=(ce=le==null?void 0:le.response)==null?void 0:ce.data)==null?void 0:he.message)||"Failed to process refund request.")}finally{_(!1)}},L=async V=>{var ce,he;if(window.confirm("Mark this refund request as completed?")){x(V);try{await M.post(`/api/admin/refund-requests/${V}/complete`,{admin_notes:u}),await R(),P(""),c(null),b(!1)}catch(le){alert(((he=(ce=le==null?void 0:le.response)==null?void 0:ce.data)==null?void 0:he.message)||"Failed to mark refund request as completed.")}finally{x(null)}}},E=V=>{c(V),P(V.admin_notes||""),b(!0)},I=V=>{c(V),P(V.admin_notes||""),y(!0)},W=V=>{c(V);const ce=V!=null&&V.deadline_at?new Date(V.deadline_at).toISOString().slice(0,10):V==null?void 0:V.minimum_extend_deadline_date;C(ce||(V==null?void 0:V.minimum_extend_deadline_date)||""),A((V==null?void 0:V.deadline_extension_reason)||""),d(""),j(!0)},B=async()=>{var V,ce;if(r){if(!p||!v.trim()){d("New deadline and reason are required.");return}T(!0),d("");try{await M.post(`/api/admin/refund-requests/${r.id}/extend-deadline`,{new_deadline:p,reason:v}),await R(),j(!1),c(null),C(""),A("")}catch(he){d(((ce=(V=he==null?void 0:he.response)==null?void 0:V.data)==null?void 0:ce.message)||"Failed to extend deadline. Please try again.")}finally{T(!1)}}},Z=V=>({pending:"warning",approved:"info",rejected:"danger",processed:"success",completed:"primary"})[V]||"secondary",te=V=>`â‚±${Number(V).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`,ne=V=>V?new Date(V).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"â€”",be=V=>{if(!V.deadline_at)return{badge:"secondary",text:"No deadline",icon:"calendar-x"};const le=new Date(V.deadline_at)-new Date,U=Math.ceil(le/(1e3*60*60*24));return U<0?{badge:"danger",text:`${Math.abs(U)} day${Math.abs(U)!==1?"s":""} overdue`,icon:"exclamation-triangle",isOverdue:!0}:U<=2?{badge:"warning",text:`${U} day${U!==1?"s":""} remaining`,icon:"clock",isApproaching:!0}:{badge:"success",text:`${U} day${U!==1?"s":""} remaining`,icon:"check-circle",isOnTime:!0}},oe=V=>V?new Date(V).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"â€”",Y={all:s.length,pending:s.filter(V=>V.status==="pending").length,approved:s.filter(V=>V.status==="approved").length,rejected:s.filter(V=>V.status==="rejected").length,processed:s.filter(V=>V.status==="processed").length,completed:s.filter(V=>V.status==="completed").length};return e.jsx("div",{className:"refund-request-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4 gap-3",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"fw-bold mb-1",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise me-2"}),"Refund Requests"]}),e.jsx("p",{className:"text-muted mb-0",children:"Manage patient refund requests and process refunds"})]})}),e.jsx("div",{className:"card border-0 shadow-sm mb-4",style:{borderRadius:"12px"},children:e.jsx("div",{className:"card-body p-3",children:e.jsx("div",{className:"d-flex flex-wrap gap-2",children:[{key:"all",label:"All",icon:"list"},{key:"pending",label:"Pending",icon:"clock"},{key:"approved",label:"Approved",icon:"check-circle"},{key:"rejected",label:"Rejected",icon:"x-circle"},{key:"processed",label:"Processed",icon:"check2"},{key:"completed",label:"Completed",icon:"check2-circle"}].map(V=>e.jsxs("button",{className:`btn ${n===V.key?"btn-primary":"btn-outline-primary"} btn-sm`,onClick:()=>o(V.key),children:[e.jsx("i",{className:`bi bi-${V.icon} me-1`}),V.label,Y[V.key]>0&&e.jsx("span",{className:"badge bg-secondary ms-2",children:Y[V.key]})]},V.key))})})}),a?e.jsx("div",{className:"text-center py-5",children:e.jsx(ze,{})}):s.length===0?e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"12px"},children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("i",{className:"bi bi-inbox fs-1 text-muted mb-3"}),e.jsx("p",{className:"text-muted mb-0",children:"No refund requests found."})]})}):e.jsx("div",{className:"card border-0 shadow-sm",style:{borderRadius:"12px"},children:e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"ID"}),e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Appointment"}),e.jsx("th",{children:"Original Amount"}),e.jsx("th",{children:"Cancellation Fee"}),e.jsx("th",{children:"Refund Amount"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Requested At"}),e.jsx("th",{children:"Deadline"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(V=>{var ce,he,le,U;return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("strong",{children:["#",V.id]})}),e.jsx("td",{children:((he=(ce=V.patient)==null?void 0:ce.user)==null?void 0:he.name)||((le=V.patient)==null?void 0:le.name)||`Patient #${V.patient_id}`}),e.jsx("td",{children:V.appointment_id?e.jsxs("small",{children:["Appointment #",V.appointment_id,e.jsx("br",{}),((U=V.appointment)==null?void 0:U.date)&&e.jsx("span",{className:"text-muted",children:new Date(V.appointment.date).toLocaleDateString()})]}):"â€”"}),e.jsx("td",{children:te(V.original_amount)}),e.jsx("td",{children:te(V.cancellation_fee)}),e.jsx("td",{children:e.jsx("strong",{className:"text-success",children:te(V.refund_amount)})}),e.jsx("td",{children:e.jsx("span",{className:`badge bg-${Z(V.status)}`,children:V.status.toUpperCase()})}),e.jsx("td",{children:e.jsx("small",{children:ne(V.requested_at)})}),e.jsxs("td",{children:[V.deadline_at&&e.jsxs("div",{children:[e.jsx("small",{className:"d-block text-muted mb-1",children:oe(V.deadline_at)}),(()=>{const k=be(V);return e.jsxs("span",{className:`badge bg-${k.badge} d-inline-flex align-items-center gap-1`,title:k.isOverdue?"Deadline has passed":k.isApproaching?"Approaching deadline":"On track",children:[e.jsx("i",{className:`bi bi-${k.icon}`}),k.text]})})()]}),!V.deadline_at&&e.jsx("span",{className:"text-muted",children:"â€”"})]}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1",children:[e.jsx("button",{className:"btn btn-sm btn-outline-info",onClick:()=>E(V),title:"View Details",children:e.jsx("i",{className:"bi bi-eye"})}),V.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn btn-sm btn-outline-success",onClick:()=>H(V.id),disabled:N===V.id,title:"Approve",children:N===V.id?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status"}):e.jsx("i",{className:"bi bi-check"})}),e.jsx("button",{className:"btn btn-sm btn-outline-danger",onClick:()=>G(V.id),disabled:N===V.id,title:"Reject",children:e.jsx("i",{className:"bi bi-x"})})]}),V.status==="approved"&&e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>I(V),title:"Mark as Processed",children:e.jsx("i",{className:"bi bi-check2-circle"})}),V.status==="processed"&&e.jsx("button",{className:"btn btn-sm btn-success",onClick:()=>L(V.id),disabled:N===V.id,title:"Mark as Completed",children:N===V.id?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status"}):e.jsx("i",{className:"bi bi-flag"})}),["pending","approved","processed"].includes(V.status)&&e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>W(V),title:"Extend Deadline",children:e.jsx("i",{className:"bi bi-calendar-plus"})})]})})]},V.id)})})]})})})}),m&&r&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:["Refund Request #",r.id," Details"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>{b(!1),c(null),P("")}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Status:"}),e.jsx("br",{}),e.jsx("span",{className:`badge bg-${Z(r.status)}`,children:r.status.toUpperCase()})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Requested At:"}),e.jsx("br",{}),ne(r.requested_at)]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Processing Deadline:"}),e.jsx("br",{}),r.deadline_at?e.jsxs("div",{children:[e.jsx("div",{className:"mb-1",children:oe(r.deadline_at)}),(()=>{const V=be(r);return e.jsxs("span",{className:`badge bg-${V.badge} d-inline-flex align-items-center gap-1`,children:[e.jsx("i",{className:`bi bi-${V.icon}`}),V.text]})})()]}):e.jsx("span",{className:"text-muted",children:"No deadline set"})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Initial Pickup Notice Sent:"}),e.jsx("br",{}),r.pickup_notified_at?ne(r.pickup_notified_at):"â€”"]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Reminder Sent:"}),e.jsx("br",{}),r.pickup_reminder_sent_at?ne(r.pickup_reminder_sent_at):"â€”"]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Minimum Extend Deadline:"}),e.jsx("br",{}),r.minimum_extend_deadline_date?new Date(r.minimum_extend_deadline_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"â€”"]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Last Extension:"}),e.jsx("br",{}),r.deadline_extended_at?`${ne(r.deadline_extended_at)} by ${((F=r.deadline_extended_by)==null?void 0:F.name)||"â€”"}`:"â€”"]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Processed At:"}),e.jsx("br",{}),r.processed_at?ne(r.processed_at):"â€”"]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Completed At:"}),e.jsx("br",{}),r.completed_at?ne(r.completed_at):"â€”"]})]}),r.deadline_extension_reason&&e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Extension Reason:"}),e.jsx("p",{className:"border rounded p-2 bg-light mb-0",children:r.deadline_extension_reason})]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Patient:"}),e.jsx("br",{}),((X=(q=r.patient)==null?void 0:q.user)==null?void 0:X.name)||((re=r.patient)==null?void 0:re.name)||`Patient #${r.patient_id}`]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Appointment:"}),e.jsx("br",{}),r.appointment_id?`#${r.appointment_id}`:"â€”"]})]}),e.jsxs("div",{className:"row mb-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Original Amount:"}),e.jsx("br",{}),te(r.original_amount)]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Cancellation Fee:"}),e.jsx("br",{}),te(r.cancellation_fee)]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("strong",{children:"Refund Amount:"}),e.jsx("br",{}),e.jsx("span",{className:"text-success fw-bold",children:te(r.refund_amount)})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Reason:"}),e.jsx("br",{}),e.jsx("p",{className:"border rounded p-2 bg-light",children:r.reason||"â€”"})]}),r.admin_notes&&e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Admin Notes:"}),e.jsx("br",{}),e.jsx("p",{className:"border rounded p-2 bg-light",children:r.admin_notes})]}),(r.status==="pending"||r.status==="approved"||r.status==="processed")&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"Admin Notes:"})}),e.jsx("textarea",{className:"form-control",rows:"3",value:u,onChange:V=>P(V.target.value),placeholder:"Add notes about this refund request..."})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{b(!1),c(null),P("")},children:"Close"}),r.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",className:"btn btn-success",onClick:()=>H(r.id),disabled:N===r.id,children:N===r.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Approving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check me-2"}),"Approve"]})}),e.jsxs("button",{type:"button",className:"btn btn-danger",onClick:()=>G(r.id),disabled:N===r.id,children:[e.jsx("i",{className:"bi bi-x me-2"}),"Reject"]})]}),r.status==="processed"&&e.jsx("button",{type:"button",className:"btn btn-success",onClick:()=>L(r.id),disabled:N===r.id,children:N===r.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-flag me-2"}),"Mark as Completed"]})})]})]})})}),f&&r&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-primary text-white",children:[e.jsxs("h5",{className:"modal-title",children:["Process Refund Request #",r.id]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>{y(!1),c(null),P("")}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Refund Amount:"})," ",te(r.refund_amount)]}),e.jsx("p",{children:"Mark this refund request as processed after completing the refund transaction."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"Admin Notes (optional):"})}),e.jsx("textarea",{className:"form-control",rows:"3",value:u,onChange:V=>P(V.target.value),placeholder:"Add notes about the refund processing..."})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{y(!1),c(null),P("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>$(r.id),disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Processing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check2-circle me-2"}),"Mark as Processed"]})})]})]})})}),h&&r&&e.jsx("div",{className:"modal d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-info text-white",children:[e.jsxs("h5",{className:"modal-title",children:["Extend Deadline for Refund #",r.id]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>{j(!1),c(null),C(""),A(""),d("")}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("p",{children:["Minimum allowed deadline:Â ",e.jsx("strong",{children:r.minimum_extend_deadline_date?new Date(r.minimum_extend_deadline_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"New Deadline"})}),e.jsx("input",{type:"date",className:"form-control",min:r.minimum_extend_deadline_date||"",value:p,onChange:V=>C(V.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:e.jsx("strong",{children:"Reason for Extension"})}),e.jsx("textarea",{className:"form-control",rows:"3",value:v,onChange:V=>A(V.target.value),placeholder:"Explain why the deadline is being extended..."})]}),S&&e.jsx("div",{className:"alert alert-danger py-2",children:S}),e.jsx("div",{className:"alert alert-warning",children:"A notification and email will be sent to the patient after extending the deadline."})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{j(!1),c(null),C(""),A(""),d("")},children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-info text-white",onClick:B,disabled:z,children:z?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-save me-2"}),"Save New Deadline"]})})]})]})})})]})})}function ji(){const[s,l]=t.useState(!0),[a,i]=t.useState(!1),[n,o]=t.useState({cancellation_deadline_hours:24,monthly_cancellation_limit:3,create_zero_refund_request:!1,reminder_days:5}),[r,c]=t.useState(""),[m,b]=t.useState(""),f=async()=>{var h,j;l(!0),b("");try{const{data:u}=await M.get("/api/admin/refund-settings");o({cancellation_deadline_hours:u.cancellation_deadline_hours??24,monthly_cancellation_limit:u.monthly_cancellation_limit??3,create_zero_refund_request:u.create_zero_refund_request??!1,reminder_days:u.reminder_days??5})}catch(u){b(((j=(h=u==null?void 0:u.response)==null?void 0:h.data)==null?void 0:j.message)||"Failed to load refund settings."),console.error("Failed to load refund settings",u)}finally{l(!1)}},y=async()=>{var h,j;i(!0),c(""),b("");try{await M.patch("/api/admin/refund-settings",n),c("Refund settings saved successfully.")}catch(u){b(((j=(h=u==null?void 0:u.response)==null?void 0:h.data)==null?void 0:j.message)||"Failed to save refund settings.")}finally{i(!1)}};return t.useEffect(()=>{f()},[]),s?e.jsx("div",{className:"refund-settings-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:e.jsx("div",{className:"container-fluid",children:e.jsx(ze,{})})}):e.jsx("div",{className:"refund-settings-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-md-10 col-lg-8 col-xl-7",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h2",{className:"fw-bold mb-2",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-arrow-counterclockwise me-2"}),"Refund & Cancellation Settings"]}),e.jsx("p",{className:"text-muted",children:"Configure global settings for appointment cancellations and refunds"})]}),r&&e.jsxs("div",{className:"alert alert-success alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),r,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>c(""),"aria-label":"Close"})]}),m&&e.jsxs("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),m,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>b(""),"aria-label":"Close"})]}),e.jsxs("div",{className:"card border-0 shadow-sm",style:{borderRadius:"16px"},children:[e.jsx("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)"},children:e.jsxs("h5",{className:"mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Settings"]})}),e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-clock me-2"}),"Cancellation Deadline (Hours)"]}),e.jsx("input",{type:"number",className:"form-control",min:"0",max:"168",value:n.cancellation_deadline_hours,onChange:h=>o({...n,cancellation_deadline_hours:Number(h.target.value)})}),e.jsx("small",{className:"text-muted",children:"Minimum hours before appointment that patients must cancel to be eligible for refunds. (0-168 hours = 0-7 days)"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-x me-2"}),"Monthly Cancellation Limit per Patient"]}),e.jsx("input",{type:"number",className:"form-control",min:"0",max:"50",value:n.monthly_cancellation_limit,onChange:h=>o({...n,monthly_cancellation_limit:Number(h.target.value)})}),e.jsx("small",{className:"text-muted",children:"Maximum number of cancellations allowed per patient per month. Set to 0 to disable the limit."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"form-check form-switch",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"createZeroRefund",checked:n.create_zero_refund_request,onChange:h=>o({...n,create_zero_refund_request:h.target.checked})}),e.jsxs("label",{className:"form-check-label fw-bold",htmlFor:"createZeroRefund",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Create Refund Request Even if Amount is Zero"]})]}),e.jsx("small",{className:"text-muted d-block mt-1",children:"If enabled, a refund request will be created even when the refund amount is zero (e.g., when cancellation fee equals the payment amount)."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-bell me-2"}),"Reminder Days for Overdue Refunds"]}),e.jsx("input",{type:"number",className:"form-control",min:"1",max:"30",value:n.reminder_days,onChange:h=>o({...n,reminder_days:Number(h.target.value)})}),e.jsx("small",{className:"text-muted",children:"Number of days after approval before sending reminders for unprocessed refund requests. (1-30 days)"})]}),e.jsx("div",{className:"d-flex justify-content-end mt-4",children:e.jsx("button",{className:"btn btn-primary",onClick:y,disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-save me-2"}),"Save Settings"]})})})]})]})]})})})})}function vi(){const[s,l]=t.useState(!0),[a,i]=t.useState(!1),[n,o]=t.useState(!1),[r,c]=t.useState({privacy_policy:"",terms_conditions:"",effective_date:"",contact_email:"",contact_phone:""}),[m,b]=t.useState(""),[f,y]=t.useState(""),[h,j]=t.useState([]),[u,P]=t.useState(null),[g,_]=t.useState(!1),N=async()=>{var v,A;l(!0),y("");try{const{data:z}=await M.get("/api/admin/policy-settings");c({privacy_policy:z.privacy_policy||"",terms_conditions:z.terms_conditions||"",effective_date:z.effective_date||new Date().toISOString().split("T")[0],contact_email:z.contact_email||"",contact_phone:z.contact_phone||""})}catch(z){y(((A=(v=z==null?void 0:z.response)==null?void 0:v.data)==null?void 0:A.message)||"Failed to load policy settings."),console.error("Failed to load policy settings",z)}finally{l(!1)}},x=async()=>{var v,A,z,T;if(i(!0),b(""),y(""),r.effective_date){const S=new Date(r.effective_date),d=new Date;if(d.setHours(0,0,0,0),S<d){y("Effective date cannot be in the past. Please select today or a future date."),i(!1);return}}try{await M.put("/api/admin/policy-settings",r),b("Policy settings saved successfully. All users have been notified about the policy update."),setTimeout(()=>b(""),5e3),p(),N()}catch(S){const d=((A=(v=S==null?void 0:S.response)==null?void 0:v.data)==null?void 0:A.message)||"Failed to save policy settings.",R=(T=(z=S==null?void 0:S.response)==null?void 0:z.data)==null?void 0:T.errors;R!=null&&R.effective_date?y(R.effective_date[0]||d):y(d)}finally{i(!1)}},p=async()=>{o(!0);try{const{data:v}=await M.get("/api/admin/policy-settings/history");j(v)}catch(v){console.error("Failed to load policy history",v)}finally{o(!1)}},C=async v=>{var A,z;try{const{data:T}=await M.get(`/api/admin/policy-settings/history/${v}`);P(T),_(!0)}catch(T){y(((z=(A=T==null?void 0:T.response)==null?void 0:A.data)==null?void 0:z.message)||"Failed to load policy version.")}};return t.useEffect(()=>{N(),p()},[]),s?e.jsx("div",{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:e.jsx("div",{className:"container-fluid",children:e.jsx(ze,{})})}):e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
        .table-row-hover:hover {
          background-color: #f0f0f0 !important;
        }
      `}),e.jsxs("div",{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",padding:"1.5rem 1rem",boxSizing:"border-box"},children:[e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"row justify-content-center",children:e.jsxs("div",{className:"col-12 col-lg-10 col-xl-8",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h2",{className:"fw-bold mb-2",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Terms & Privacy Policy Settings"]}),e.jsx("p",{className:"text-muted",children:"Manage the Terms & Conditions and Privacy Policy content displayed to users"})]}),m&&e.jsxs("div",{className:"alert alert-success alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),m,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>b("")})]}),f&&e.jsxs("div",{className:"alert alert-danger alert-dismissible fade show",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),f,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>y("")})]}),e.jsx("div",{className:"card shadow-sm border-0",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("form",{onSubmit:v=>{v.preventDefault(),x()},children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-telephone me-2"}),"Contact Information"]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Email"}),e.jsx("input",{type:"email",className:"form-control",value:r.contact_email,onChange:v=>c({...r,contact_email:v.target.value}),placeholder:"kreativedent@gmail.com"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Phone"}),e.jsx("input",{type:"text",className:"form-control",value:r.contact_phone,onChange:v=>c({...r,contact_phone:v.target.value}),placeholder:"0927 759 2845"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsxs("label",{className:"form-label fw-semibold",children:["Effective Date",e.jsx("span",{className:"text-danger ms-1",children:"*"})]}),e.jsx("input",{type:"date",className:"form-control",value:r.effective_date,min:new Date().toISOString().split("T")[0],onChange:v=>{const A=v.target.value,z=new Date().toISOString().split("T")[0];if(A<z){y("Effective date cannot be in the past. Please select today or a future date.");return}c({...r,effective_date:A}),y("")},required:!0}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"The effective date must be today or a future date. All users will be notified when the policy is updated."]})]})]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-shield-lock me-2"}),"Privacy Policy"]}),e.jsxs("label",{className:"form-label fw-semibold",children:["Privacy Policy Content",e.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"0.7rem"},children:"Currently Active"})]}),e.jsx("textarea",{className:"form-control",rows:15,value:r.privacy_policy,onChange:v=>c({...r,privacy_policy:v.target.value}),placeholder:"Enter Privacy Policy content here...",style:{fontFamily:"monospace",fontSize:"0.9rem"}}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"This field is pre-filled with the currently active Privacy Policy displayed to users. You can edit and amend it as needed."]})]}),e.jsx("hr",{}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h5",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-file-earmark-text me-2"}),"Terms and Conditions"]}),e.jsxs("label",{className:"form-label fw-semibold",children:["Terms and Conditions Content",e.jsx("span",{className:"badge bg-info ms-2",style:{fontSize:"0.7rem"},children:"Currently Active"})]}),e.jsx("textarea",{className:"form-control",rows:15,value:r.terms_conditions,onChange:v=>c({...r,terms_conditions:v.target.value}),placeholder:"Enter Terms and Conditions content here...",style:{fontFamily:"monospace",fontSize:"0.9rem"}}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"This field is pre-filled with the currently active Terms and Conditions displayed to users. You can edit and amend it as needed."]})]}),e.jsxs("div",{className:"d-flex justify-content-end gap-2 mt-4",children:[e.jsxs("button",{type:"button",className:"btn btn-secondary",onClick:N,disabled:a,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Reset"]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-save me-2"}),"Save Changes"]})})]})]})})}),e.jsx("div",{className:"card shadow-sm border-0 mt-4",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Policy History"]}),e.jsxs("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:p,disabled:n,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})]}),e.jsx("p",{className:"text-muted small mb-3",children:"Click on any row to view the policy that was active on that date."}),n?e.jsx("div",{className:"text-center py-3",children:e.jsx("div",{className:"spinner-border spinner-border-sm",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):h.length===0?e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx("i",{className:"bi bi-inbox me-2"}),"No policy history available yet."]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Effective Date"}),e.jsx("th",{children:"Created At"}),e.jsx("th",{children:"Created By"}),e.jsx("th",{children:"Content"})]})}),e.jsx("tbody",{children:h.map(v=>e.jsxs("tr",{onClick:()=>C(v.id),style:{cursor:"pointer"},className:"table-row-hover",children:[e.jsx("td",{children:e.jsx("strong",{children:v.effective_date})}),e.jsx("td",{children:v.created_at}),e.jsx("td",{children:v.created_by}),e.jsxs("td",{children:[v.has_privacy_policy&&e.jsxs("span",{className:"badge bg-info me-1",children:[e.jsx("i",{className:"bi bi-shield-lock me-1"}),"Privacy"]}),v.has_terms_conditions&&e.jsxs("span",{className:"badge bg-primary",children:[e.jsx("i",{className:"bi bi-file-earmark-text me-1"}),"Terms"]})]})]},v.id))})]})})]})})]})})}),g&&u&&e.jsxs("div",{className:"modal fade show",style:{display:"block"},tabIndex:"-1",role:"dialog",children:[e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",role:"document",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Policy Version - ",u.effective_date]}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>{_(!1),P(null)}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("strong",{children:"Created:"})," ",u.created_at," by ",u.created_by]})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{children:[e.jsx("i",{className:"bi bi-shield-lock me-2"}),"Privacy Policy"]}),e.jsx("div",{className:"border rounded p-3",style:{backgroundColor:"#f8f9fa",maxHeight:"300px",overflowY:"auto",fontFamily:"monospace",fontSize:"0.9rem",whiteSpace:"pre-wrap"},children:u.privacy_policy||e.jsx("span",{className:"text-muted",children:"No privacy policy content."})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{children:[e.jsx("i",{className:"bi bi-file-earmark-text me-2"}),"Terms and Conditions"]}),e.jsx("div",{className:"border rounded p-3",style:{backgroundColor:"#f8f9fa",maxHeight:"300px",overflowY:"auto",fontFamily:"monospace",fontSize:"0.9rem",whiteSpace:"pre-wrap"},children:u.terms_conditions||e.jsx("span",{className:"text-muted",children:"No terms and conditions content."})})]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Contact Email:"})," ",u.contact_email||"N/A"]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Contact Phone:"})," ",u.contact_phone||"N/A"]})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>{_(!1),P(null)},children:"Close"})})]})}),e.jsx("div",{className:"modal-backdrop fade show"})]})]})]})}function Ni(){const s=Se(),{user:l,logout:a}=Me(),[i,n]=t.useState(!1),[o,r]=t.useState(!1),[c,m]=t.useState(null),[b,f]=t.useState(!1);t.useEffect(()=>{if(l&&l.role!=="staff"){const u=l.role==="admin"?"/admin":l.role==="patient"?"/patient":l.role==="dentist"?"/dentist":"/";s(u,{replace:!0})}},[l,s]),t.useEffect(()=>{let u=!0;return(async()=>{try{const{data:P}=await M.get("/api/inventory/settings");u&&n(!!(P!=null&&P.staff_can_receive))}catch{}finally{u&&r(!0)}})(),()=>{u=!1}},[]),t.useEffect(()=>{let u=!0;return(async()=>{try{const P=await Cs();M.defaults.headers.common["X-Device-Fingerprint"]=P;const g=await M.get("/api/device-status",{headers:{"X-Device-Fingerprint":P}});u&&m(g.data)}catch(P){console.error("Device check failed",P),u&&m({approved:!1})}finally{u&&f(!0)}})(),()=>{u=!1}},[]);const y=async()=>{await a(),s("/")},h=u=>"nav-link"+(u?" active":""),j=()=>b&&c&&!c.approved;return e.jsxs("div",{className:"staff-shell sidebar-open",children:[e.jsxs("aside",{className:"sidebar bg-dark text-white",children:[e.jsxs("div",{className:"sidebar-header d-flex align-items-center justify-content-between",children:[e.jsx("h6",{className:"m-0 fw-bold",children:"Staff Menu"}),e.jsx("button",{className:"btn btn-sm btn-outline-light d-lg-none",onClick:()=>setSidebarOpen(!1),"aria-label":"Close sidebar",children:"âœ•"})]}),e.jsxs("ul",{className:"nav flex-column nav-scroller",children:[e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff",end:!0,className:({isActive:u})=>h(u),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"})}),e.jsx("span",{className:"label",children:"Dashboard"})]})}),e.jsx("li",{className:"nav-item mt-2 small text-uppercase text-secondary ps-3",children:"Appointments"}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/appointments",className:({isActive:u})=>h(u)+(j()?" disabled text-muted":""),onClick:u=>{j()&&u.preventDefault()},style:{cursor:j()?"not-allowed":"pointer",opacity:j()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M17 12h-5v5h5v-5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1h-2zm3 18H5V8h14v11z"})}),e.jsx("span",{className:"label",children:"Appointments"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/appointment-finder",className:({isActive:u})=>h(u)+(j()?" disabled text-muted":""),onClick:u=>{j()&&u.preventDefault()},style:{cursor:j()?"not-allowed":"pointer",opacity:j()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})}),e.jsx("span",{className:"label",children:"Appointment Finder"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/appointment-reminders",className:({isActive:u})=>h(u)+(j()?" disabled text-muted":""),onClick:u=>{j()&&u.preventDefault()},style:{cursor:j()?"not-allowed":"pointer",opacity:j()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"})}),e.jsx("span",{className:"label",children:"Reminders"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/visit-tracker",className:({isActive:u})=>h(u)+(j()?" disabled text-muted":""),onClick:u=>{j()&&u.preventDefault()},style:{cursor:j()?"not-allowed":"pointer",opacity:j()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"})}),e.jsx("span",{className:"label",children:"Patient Visit Tracker"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/payment-records",className:({isActive:u})=>h(u)+(j()?" disabled text-muted":""),onClick:u=>{j()&&u.preventDefault()},style:{cursor:j()?"not-allowed":"pointer",opacity:j()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 14V6c0-1.1-.9-2-2-2H3c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zm-9-1c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm13-6v11c0 1.1-.9 2-2 2H4v-2h17V7h2z"})}),e.jsx("span",{className:"label",children:"Payment Records"})]})}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/refund-requests",className:({isActive:u})=>h(u)+(j()?" disabled text-muted":""),onClick:u=>{j()&&u.preventDefault()},style:{cursor:j()?"not-allowed":"pointer",opacity:j()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"})}),e.jsx("span",{className:"label",children:"Refund Requests"})]})}),e.jsx("li",{className:"nav-item mt-2 small text-uppercase text-secondary ps-3",children:"Patient Management"}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/patient-binding",className:({isActive:u})=>h(u)+(j()?" disabled text-muted":""),onClick:u=>{j()&&u.preventDefault()},style:{cursor:j()?"not-allowed":"pointer",opacity:j()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M10.59 13.41c.41.39.41 1.03 0 1.42-.39.39-1.03.39-1.42 0a5.003 5.003 0 0 1 0-7.07l3.54-3.54a5.003 5.003 0 0 1 7.07 0 5.003 5.003 0 0 1 0 7.07l-1.49 1.49c.01-.82-.12-1.64-.4-2.42l.47-.48a2.982 2.982 0 0 0 0-4.24 2.982 2.982 0 0 0-4.24 0l-3.53 3.53a2.982 2.982 0 0 0 0 4.24zm2.82-4.24c.39-.39 1.03-.39 1.42 0a5.003 5.003 0 0 1 0 7.07l-3.54 3.54a5.003 5.003 0 0 1-7.07 0 5.003 5.003 0 0 1 0-7.07l1.49-1.49c-.01.82.12 1.64.4 2.43l-.47.47a2.982 2.982 0 0 0 0 4.24 2.982 2.982 0 0 0 4.24 0l3.53-3.53a2.982 2.982 0 0 0 0-4.24.973.973 0 0 1 0-1.42z"})}),e.jsx("span",{className:"label",children:"Patient-User Binding"})]})}),o&&i&&e.jsxs(e.Fragment,{children:[e.jsx("li",{className:"nav-item mt-2 small text-uppercase text-secondary ps-3",children:"Operations"}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/inventory",className:({isActive:u})=>h(u)+(j()?" disabled text-muted":""),onClick:u=>{j()&&u.preventDefault()},style:{cursor:j()?"not-allowed":"pointer",opacity:j()?.5:1},children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M19 7h-3V6a4 4 0 0 0-8 0v1H5a1 1 0 0 0-1 1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8a1 1 0 0 0-1-1zM10 6a2 2 0 0 1 4 0v1h-4V6zm8 13a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V9h2v1a1 1 0 0 0 2 0V9h4v1a1 1 0 0 0 2 0V9h2v10z"})}),e.jsx("span",{className:"label",children:"Inventory"})]})})]}),e.jsx("li",{className:"nav-item mt-2 small text-uppercase text-secondary ps-3",children:"Account"}),e.jsx("li",{className:"nav-item",children:e.jsxs(je,{to:"/staff/profile",className:({isActive:u})=>h(u),children:[e.jsx("svg",{className:"icon",width:"20",height:"20",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H5C3.89 1 3 1.89 3 3V21C3 22.11 3.89 23 5 23H11V21H5V19H13V17H5V15H13V13H5V11H13V9H21M15 15V17H19V19H15V21H17V23H21V21H23V17H21V15H15Z"})}),e.jsx("span",{className:"label",children:"Account"})]})}),e.jsx("li",{className:"nav-item mt-4 px-3",children:e.jsxs("button",{className:"btn btn-outline-danger w-100 d-flex align-items-center justify-content-center icon-only-btn",onClick:y,title:"Logout","aria-label":"Logout",children:[e.jsx("i",{className:"bi-box-arrow-right fs-5"}),e.jsx("span",{className:"visually-hidden",children:"Logout"})]})})]})]}),e.jsxs("div",{className:"content-area",children:[e.jsx("div",{className:"topbar d-flex align-items-center pe-0",children:e.jsx("div",{className:"topbar-bell",children:e.jsx(Fs,{})})}),e.jsx("main",{className:"flex-grow-1 p-4 overflow-auto",children:e.jsx("div",{className:"container-fluid h-100",children:e.jsx(fs,{})})})]}),e.jsx("div",{className:"sidebar-overlay show",onClick:()=>setSidebarOpen(!1)})]})}const yi=()=>{const s=Se(),[l,a]=t.useState(null),[i,n]=t.useState(0),[o,r]=t.useState(0),[c,m]=t.useState(0),[b,f]=t.useState(0),[y,h]=t.useState(!1);t.useEffect(()=>{(async()=>{try{const P=await Cs();M.defaults.headers.common["X-Device-Fingerprint"]=P;const g=await M.get("/api/device-status",{headers:{"X-Device-Fingerprint":P}});a(g.data)}catch(P){console.error("Device check failed",P)}})()},[]);const j=t.useCallback(async()=>{h(!0);try{const u=await M.get("/api/visits/stats");n(u.data.today_visits||0),m(u.data.pending_visits||0);const P=await M.get("/api/appointments?status=pending");r(P.data.length||0);const g=await M.get("/api/appointments/remindable");f(g.data.length||0)}catch(u){console.error("Failed to load statistics",u)}finally{h(!1)}},[]);if(t.useEffect(()=>{l&&l.approved&&j()},[l,j]),!l)return e.jsx("p",{children:"Loading dashboard..."});if(!l.approved){const u=!l.temporary_code;return e.jsx("div",{className:"alert alert-warning",children:u?e.jsxs(e.Fragment,{children:["âŒ ",e.jsx("strong",{children:"This device has been rejected by the admin."}),e.jsx("br",{}),"If you believe this was a mistake, please contact the admin for clarification."]}):e.jsxs(e.Fragment,{children:["ðŸš« ",e.jsx("strong",{children:"This device is not yet approved."}),e.jsx("br",{}),"Provide the code below to the admin:",e.jsx("br",{}),e.jsx("strong",{children:"Temporary Code:"})," ",e.jsx("span",{className:"badge bg-secondary",children:l.temporary_code})]})})}return e.jsxs("div",{children:[e.jsx("h2",{className:"mb-4",children:"Welcome, Staff Member!"}),e.jsx("p",{className:"text-muted mb-4",children:"âœ… Your device is approved. You can now access all staff features from the menu."}),e.jsxs("div",{className:"row g-3 mb-4",children:[e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/staff/visit-tracker"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-calendar-day text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Today's Visits"}),e.jsx("div",{className:"fs-3 fw-bold text-primary",children:y?"...":i}),e.jsx("small",{className:"text-muted",children:"Running & Finished"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/staff/appointments"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-warning rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-clock-history text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Pending Appointments"}),e.jsx("div",{className:"fs-3 fw-bold text-warning",children:y?"...":o}),e.jsx("small",{className:"text-muted",children:"Needs approval"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/staff/visit-tracker"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-hourglass-split text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Pending Visits"}),e.jsx("div",{className:"fs-3 fw-bold text-info",children:y?"...":c}),e.jsx("small",{className:"text-muted",children:"Awaiting completion"})]})]})})})}),e.jsx("div",{className:"col-12 col-md-6 col-lg-3",children:e.jsx("div",{className:"card border-0 shadow-sm h-100",style:{borderRadius:"16px",cursor:"pointer"},onClick:()=>s("/staff/appointment-reminders"),children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center flex-shrink-0",style:{width:"50px",height:"50px",fontSize:"1.5rem"},children:e.jsx("i",{className:"bi bi-bell text-white"})}),e.jsxs("div",{className:"flex-grow-1 min-width-0",children:[e.jsx("div",{className:"text-muted small fw-semibold",children:"Appointment Reminders"}),e.jsx("div",{className:"fs-3 fw-bold text-success",children:y?"...":b}),e.jsx("small",{className:"text-muted",children:"Needs to be sent"})]})]})})})})]})]})},wi=()=>{const[s,l]=t.useState(null),[a,i]=t.useState(""),[n,o]=t.useState(""),[r,c]=t.useState(!1);Se();const{logout:m}=Me();t.useEffect(()=>{(async()=>{try{const y=await M.get("/api/user");l(y.data)}catch(y){console.error("Failed to fetch user info",y)}})()},[]);const b=async()=>{var f,y;i(""),o(""),c(!0);try{const h=await M.post("/api/send-password-reset");i(h.data.message||"Password reset link sent to your email!")}catch(h){const j=((y=(f=h.response)==null?void 0:f.data)==null?void 0:y.message)||"Failed to send reset link";o(j)}finally{c(!1)}};return s?e.jsxs("div",{style:{maxWidth:"600px"},children:[e.jsx("h2",{className:"mb-4",children:"My Account"}),e.jsxs("div",{className:"mb-4 p-3 border rounded bg-light",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",s.name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," ",s.email]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Role:"})," ",s.role]})]}),a&&e.jsx("div",{className:"alert alert-success mb-3",children:a}),n&&e.jsx("div",{className:"alert alert-danger mb-3",children:n}),e.jsx("button",{className:"btn btn-primary",onClick:b,disabled:r,children:r?"Sending...":"Send Password Reset Link"})]}):e.jsx("p",{children:"Loading..."})},_i=t.lazy(()=>Ke(()=>import("./StaffAppointmentManager-tQSv9cXv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),Si=t.lazy(()=>Ke(()=>import("./AppointmentFinder-BO-cDC1V.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8]))),ki=t.lazy(()=>Ke(()=>Promise.resolve().then(()=>Ei),void 0));function Ci(){const[s,l]=t.useState("appointments"),a=({id:i,icon:n,label:o})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${s===i?"":"btn-outline-primary"}`,onClick:()=>l(i),type:"button",style:{background:s===i?"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)":"transparent",color:s===i?"#1e293b":"#6b7280",border:s===i?"1px solid #e2e8f0":"1px solid #d1d5db",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${n==="ðŸ“…"?"calendar":n==="ðŸ‘¥"?"people":n==="ðŸ”"?"search":"calendar-check"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:o}),e.jsx("span",{className:"d-sm-none",children:o.split(" ")[0]})]});return e.jsx("div",{className:"admin-appointment-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",width:"100%",maxWidth:"100%",padding:"1.5rem",boxSizing:"border-box",overflow:"hidden"},children:e.jsx("div",{className:"row g-2 g-md-3 g-lg-4 m-0",children:e.jsx("div",{className:"col-12 p-0",children:e.jsxs("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #ffffff 0%, #f8fafc 100%)",borderRadius:"16px",width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"card-header border-0",style:{borderRadius:"16px 16px 0 0",background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",color:"#1e293b"},children:[e.jsxs("h2",{className:"card-title mb-0 fw-bold",style:{color:"#1e293b"},children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Admin Appointment & Visit Management"]}),e.jsx("p",{className:"mb-0 mt-2",style:{color:"#6b7280"},children:"Comprehensive appointment approval, finder, and patient visit tracking system"})]}),e.jsxs("div",{className:"card-body p-4",style:{width:"100%",maxWidth:"100%"},children:[e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 mb-4",role:"group","aria-label":"Appointment tabs",children:[e.jsx(a,{id:"appointments",icon:"ðŸ“…",label:"Appointment Approval"}),e.jsx(a,{id:"appointment-finder",icon:"ðŸ”",label:"Appointment Finder"}),e.jsx(a,{id:"visits",icon:"ðŸ‘¥",label:"Visit Tracking"})]}),e.jsxs("div",{className:"tab-content",style:{width:"100%",maxWidth:"100%"},children:[s==="appointments"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading Appointment Manager..."})]}),children:e.jsx(_i,{})})}),s==="appointment-finder"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading Appointment Finder..."})]}),children:e.jsx(Si,{})})}),s==="visits"&&e.jsx("div",{className:"tab-pane fade show active",style:{width:"100%",maxWidth:"100%"},children:e.jsx(t.Suspense,{fallback:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading Visit Tracker..."})]}),children:e.jsx(ki,{})})})]})]})]})})})})}function Pi(){const[s,l]=t.useState([]),[a,i]=t.useState(!0),[n,o]=t.useState({}),[r,c]=t.useState(null),[m,b]=t.useState(""),[f,y]=t.useState(!1),[h,j]=t.useState(!1);t.useEffect(()=>{u()},[]);const u=async()=>{i(!0);try{const _=await M.get("/api/appointments/remindable");l(_.data)}catch(_){console.error("Failed to load remindable appointments",_)}finally{i(!1)}},P=_=>{var p,C,v;if(_.status!=="approved"){alert("Only approved appointments can receive reminders.");return}const x=`Hello ${((C=(p=_.patient)==null?void 0:p.user)==null?void 0:C.name)||"Patient"}, this is a reminder for your dental appointment on ${_.date} at ${_.time_slot} for ${(v=_.service)==null?void 0:v.name}. Ref: ${_.reference_code}. Please arrive on time. â€“ Kreative Dental Clinic`;c(_),b(x),j(!1),y(!0)},g=async()=>{if(!r)return;const _=r.id;o(N=>({...N,[_]:!0}));try{await M.post(`/api/appointments/${_}/send-reminder`,{message:m,edited:h}),alert("SMS reminder sent!"),y(!1),u()}catch(N){alert("Failed to send SMS reminder."),console.error(N)}finally{o(N=>({...N,[_]:!1}))}};return e.jsxs("div",{className:"container mt-4",children:[e.jsx("h3",{children:"ðŸ“¤ Appointment Reminders"}),a?e.jsx(ze,{message:"Loading remindable appointments..."}):s.length===0?e.jsx("p",{className:"text-muted mt-3",children:"No appointments eligible for reminder at this time."}):e.jsx("div",{className:"table-responsive mt-3",children:e.jsxs("table",{className:"table table-bordered table-sm align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Time Slot"}),e.jsx("th",{children:"Patient"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:s.map(_=>{var N,x,p,C,v;return e.jsxs("tr",{children:[e.jsx("td",{children:_.date}),e.jsx("td",{children:_.time_slot}),e.jsx("td",{children:((x=(N=_.patient)==null?void 0:N.user)==null?void 0:x.name)||"N/A"}),e.jsx("td",{children:(p=_.service)==null?void 0:p.name}),e.jsx("td",{children:e.jsx("span",{className:`badge ${_.status==="approved"?"bg-success":"bg-warning"}`,children:_.status})}),e.jsx("td",{children:((v=(C=_.patient)==null?void 0:C.user)==null?void 0:v.email)||"â€”"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-primary",disabled:n[_.id]||_.status!=="approved",onClick:()=>P(_),children:n[_.id]?"Sending...":"Send SMS Reminder"})})]},_.id)})})]})}),e.jsxs(vs,{show:f,onHide:()=>y(!1),size:"lg",children:[e.jsx(vs.Header,{closeButton:!0,children:e.jsx(vs.Title,{children:"Edit SMS Reminder Message"})}),e.jsxs(vs.Body,{children:[e.jsxs(Ts.Group,{controlId:"reminderMessage",children:[e.jsx(Ts.Label,{children:"Message to be sent"}),e.jsx(Ts.Control,{as:"textarea",rows:5,value:m,onChange:_=>{b(_.target.value),j(!0)}})]}),!h&&e.jsx("div",{className:"mt-2 text-muted small",children:"âœï¸ This is the default message. You can edit it before sending."})]}),e.jsxs(vs.Footer,{children:[e.jsx(Js,{variant:"secondary",onClick:()=>y(!1),children:"Cancel"}),e.jsx(Js,{variant:"primary",onClick:g,disabled:n[r==null?void 0:r.id],children:n[r==null?void 0:r.id]?"Sending...":"Send SMS Reminder"})]})]})]})}function Ri(){var h;const{id:s}=Ms(),l=ss(),[a,i]=t.useState(null),[n,o]=t.useState([]),[r,c]=t.useState(!1),[m,b]=t.useState({item_id:"",quantity:"",notes:""}),f=((h=l.state)==null?void 0:h.visitFinished)===!0;if(t.useEffect(()=>{(async()=>{try{const{data:j}=await M.get(`/visits/${s}`);i(j);const u=await M.get("/inventory/items");o(u.data.data||[])}catch{}})()},[s]),!f)return e.jsx(oa,{to:"/staff",replace:!0});const y=async j=>{var u,P;j.preventDefault(),c(!0);try{await M.post("/inventory/consume",{item_id:Number(m.item_id),quantity:Number(m.quantity),ref_type:"visit",ref_id:Number(s),notes:m.notes||null}),alert("Stock consumed."),b({item_id:"",quantity:"",notes:""})}catch(g){alert(((P=(u=g==null?void 0:g.response)==null?void 0:u.data)==null?void 0:P.message)||"Consume failed")}finally{c(!1)}};return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("h1",{className:"text-xl font-semibold",children:["Consume Stock for Visit #",s]}),e.jsxs("form",{onSubmit:y,className:"space-y-3",children:[e.jsxs("select",{className:"border rounded px-3 py-2",value:m.item_id,onChange:j=>b(u=>({...u,item_id:j.target.value})),required:!0,children:[e.jsx("option",{value:"",children:"Select itemâ€¦"}),n.map(j=>e.jsxs("option",{value:j.id,children:[j.name," (",j.sku_code,")"]},j.id))]}),e.jsx("input",{className:"border rounded px-3 py-2",type:"number",min:"0.001",step:"0.001",placeholder:"Quantity",value:m.quantity,onChange:j=>b(u=>({...u,quantity:j.target.value})),required:!0}),e.jsx("textarea",{className:"border rounded px-3 py-2",rows:2,placeholder:"Notes (optional)",value:m.notes,onChange:j=>b(u=>({...u,notes:j.target.value}))}),e.jsx("button",{disabled:r,className:"border rounded px-3 py-2",children:r?"Savingâ€¦":"Consume"})]})]})}const Di=()=>{const[s,l]=t.useState([]),[a,i]=t.useState(!0),[n,o]=t.useState(null),[r,c]=t.useState({current_page:1,last_page:1,per_page:20,total:0}),[m,b]=t.useState({search:"",appointment_date:"",visit_date:""}),[f,y]=t.useState(!1),[h,j]=t.useState(null),[u,P]=t.useState(!1),[g,_]=t.useState(null),[N,x]=t.useState(!0);t.useEffect(()=>{p(1),x(!1)},[]),t.useEffect(()=>{if(N)return;g&&clearTimeout(g);const S=m.search&&m.search.length>=2,d=m.appointment_date||m.visit_date;if(S){const R=setTimeout(()=>{p(1)},300);_(R)}else(d||m.search.length===0)&&p(1);return()=>{g&&clearTimeout(g)}},[m.search,m.appointment_date,m.visit_date]);const p=async(S=1)=>{try{i(!0),o(null);const d={page:S,...m};Object.keys(d).forEach(H=>{d[H]||delete d[H]});const R=await M.get("/api/staff/payment-records",{params:d});R.data&&R.data.data?(l(R.data.data),c(R.data.pagination||{current_page:1,last_page:1,per_page:20,total:0})):(l([]),c({current_page:1,last_page:1,per_page:20,total:0}))}catch(d){console.error("Failed to fetch payment records:",d),o("Failed to load payment records. Please try again.")}finally{i(!1)}},C=S=>{const{name:d,value:R}=S.target;b(H=>({...H,[d]:R}))},v=()=>{b({search:"",appointment_date:"",visit_date:""})},A=async S=>{try{P(!0);const d=await M.get(`/api/staff/payment-records/${S.id}/receipt-data`);j(d.data.data),y(!0)}catch(d){console.error("Failed to fetch receipt data:",d),alert("Failed to load receipt. Please try again.")}finally{P(!1)}},z=()=>{y(!1),j(null)},T=S=>{p(S)};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"mb-1",style:{color:"#0077be",fontWeight:"bold"},children:[e.jsx("i",{className:"bi bi-receipt me-2"}),"Payment Records"]}),e.jsx("p",{className:"text-muted mb-0",children:"Search and view payment receipts"})]}),r.total>0&&e.jsxs("div",{className:"badge bg-primary",style:{fontSize:"14px",padding:"10px 15px"},children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),r.total," Paid ",r.total===1?"Payment":"Payments"]})]}),e.jsx("div",{className:"card shadow-sm mb-4",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"card-title mb-3",children:[e.jsx("i",{className:"bi bi-funnel me-2"}),"Filters"]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-person-search me-1"}),"Search Patient Name"]}),e.jsx("input",{type:"text",className:"form-control",name:"search",value:m.search,onChange:C,placeholder:"Enter patient name..."}),e.jsx("small",{className:"text-muted",children:"Minimum 2 characters"})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Appointment Date"]}),e.jsx("input",{type:"date",className:"form-control",name:"appointment_date",value:m.appointment_date,onChange:C})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs("label",{className:"form-label fw-bold",children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),"Visit Date"]}),e.jsx("input",{type:"date",className:"form-control",name:"visit_date",value:m.visit_date,onChange:C})]}),e.jsx("div",{className:"col-md-2 d-flex align-items-end",children:e.jsxs("button",{className:"btn btn-outline-secondary w-100",onClick:v,disabled:!m.search&&!m.appointment_date&&!m.visit_date,children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Clear"]})})]})]})}),e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:a?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-3 text-muted",children:"Loading payment records..."})]}):n?e.jsxs("div",{className:"alert alert-danger",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),n]}):s.length===0?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-inbox",style:{fontSize:"48px",color:"#ccc"}}),e.jsx("p",{className:"mt-3 text-muted",children:"No payment records found"}),(m.search||m.appointment_date||m.visit_date)&&e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:v,children:"Clear Filters"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover align-middle",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Receipt #"}),e.jsx("th",{children:"Patient Name"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Appointment Date"}),e.jsx("th",{children:"Visit Date"}),e.jsx("th",{children:"Amount Paid"}),e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Date Paid"}),e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:s.map(S=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:"badge bg-info text-dark",children:S.receipt_number})}),e.jsx("td",{className:"fw-bold",children:S.patient_name}),e.jsx("td",{children:S.service_name}),e.jsx("td",{children:S.appointment_date?e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),new Date(S.appointment_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:S.visit_date?e.jsxs("span",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-check me-1"}),new Date(S.visit_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsxs("td",{className:"fw-bold text-success",children:["â‚±",parseFloat(S.amount_paid).toFixed(2)]}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-secondary",children:S.payment_method})}),e.jsx("td",{className:"text-muted",style:{fontSize:"13px"},children:S.paid_at}),e.jsx("td",{children:e.jsx("span",{className:`badge ${S.type==="visit"?"bg-primary":"bg-success"}`,children:S.type==="visit"?"Visit":"Appointment"})}),e.jsx("td",{children:e.jsxs("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>A(S),disabled:u,children:[e.jsx("i",{className:"bi bi-receipt me-1"}),"View Receipt"]})})]},S.id))})]})}),r.last_page>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",(r.current_page-1)*r.per_page+1," to"," ",Math.min(r.current_page*r.per_page,r.total)," of"," ",r.total," records"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"pagination mb-0",children:[e.jsx("li",{className:`page-item ${r.current_page===1?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>T(r.current_page-1),disabled:r.current_page===1,children:"Previous"})}),[...Array(r.last_page)].map((S,d)=>{const R=d+1;return R===1||R===r.last_page||R>=r.current_page-1&&R<=r.current_page+1?e.jsx("li",{className:`page-item ${r.current_page===R?"active":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>T(R),children:R})},R):R===r.current_page-2||R===r.current_page+2?e.jsx("li",{className:"page-item disabled",children:e.jsx("span",{className:"page-link",children:"..."})},R):null}),e.jsx("li",{className:`page-item ${r.current_page===r.last_page?"disabled":""}`,children:e.jsx("button",{className:"page-link",onClick:()=>T(r.current_page+1),disabled:r.current_page===r.last_page,children:"Next"})})]})})]})]})})})]})}),e.jsx(Xs,{show:f,onHide:z,receiptData:h})]})},Ai=()=>e.jsx($a,{});function Mi({visit:s,onClose:l,onComplete:a}){var re,V,ce,he,le;const[i,n]=t.useState(1),[o,r]=t.useState([]),[c,m]=t.useState([]),[b,f]=t.useState(!1),[y,h]=t.useState(!1),[j,u]=t.useState([]),[P,g]=t.useState(""),[_,N]=t.useState(""),[x,p]=t.useState(""),[C,v]=t.useState(""),[A,z]=t.useState(null),[T,S]=t.useState("paid"),[d,R]=t.useState(""),[H,G]=t.useState("");t.useEffect(()=>{$(),L()},[]);const $=async()=>{try{const U=await M.get("/api/inventory/items");r(U.data.data||[])}catch(U){console.error("Failed to load inventory items",U)}},L=async()=>{var U,k;try{const J=(await M.get(`/api/visits/${s.id}/dentist-notes`)).data;J.dentist_notes&&g(J.dentist_notes),J.findings&&N(J.findings),J.treatment_plan&&p(J.treatment_plan),J.teeth_treated&&v(J.teeth_treated),(J.created_by||J.created_at)&&z({created_by:J.created_by,created_at:J.created_at,updated_by:J.updated_by,updated_at:J.updated_at})}catch(K){console.log("No dentist notes found or error fetching notes:",(k=(U=K==null?void 0:K.response)==null?void 0:U.data)==null?void 0:k.message)}},E=()=>{m([...c,{item_id:"",quantity:"",notes:""}])},I=(U,k,K)=>{const J=[...c];J[U][k]=K,m(J)},W=U=>{m(c.filter((k,K)=>K!==U))},B=(U,k)=>{const K=j.some(J=>J.item_id===U);u(K?j.filter(J=>J.item_id!==U):[...j,{item_id:U,quantity:1,unit_price:Number(k.patient_price)||0}])},Z=(U,k)=>{u(j.map(K=>K.item_id===U?{...K,quantity:Math.max(1,Number(k)||1)}:K))},te=async()=>{var U,k;h(!0);try{const K={stock_items:c.filter(J=>J.item_id&&J.quantity),billable_items:j.map(J=>({item_id:J.item_id,quantity:Number(J.quantity)||1,unit_price:Number(J.unit_price)||0})),dentist_notes:P,findings:_,treatment_plan:x,teeth_treated:C,payment_status:X?"paid":T,onsite_payment_amount:X?null:d?Number(d):null,payment_method_change:X?null:H||null};await M.post(`/api/visits/${s.id}/complete-with-details`,K);try{const J=await M.post(`/api/receipts/visit/${s.id}/email`,{},{skip401Handler:!0});J.data.note?alert(`Visit completed successfully!

${J.data.message}

${J.data.note}`):alert(`Visit completed successfully!

Receipt sent to: ${J.data.email}`)}catch(J){console.error("Failed to send receipt email:",J),alert(`Visit completed successfully!

Note: Receipt email could not be sent. Patient can download receipt from their appointments page.`)}a(),l()}catch(K){alert(((k=(U=K==null?void 0:K.response)==null?void 0:U.data)==null?void 0:k.message)||"Failed to complete visit")}finally{h(!1)}},ne=((re=s.payments)==null?void 0:re.reduce((U,k)=>U+(Number(k.amount_paid)||0),0))||0,be=Number((V=s.service)==null?void 0:V.price)||0,oe=j.reduce((U,k)=>{const K=Number(k.unit_price)||0,J=Number(k.quantity)||1;return U+K*J},0),Y=be+oe,F=Y-ne,q=(ce=s.payments)==null?void 0:ce.find(U=>U.method==="maya"&&U.status==="paid"),X=!!q;return e.jsx("div",{className:"modal fade show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},tabIndex:"-1",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-lg",role:"document",style:{maxWidth:"800px",maxHeight:"calc(100vh - 2rem)",margin:"0 auto",width:"100%"},children:e.jsxs("div",{className:"modal-content d-flex flex-column",style:{maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header bg-primary text-white py-2 flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title fw-bold mb-0",children:[e.jsx("i",{className:"fas fa-check-circle me-2"}),"Complete Visit"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:l,"aria-label":"Close",style:{fontSize:"1.2rem"}})]}),e.jsxs("div",{className:"modal-body p-3 flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsx("div",{className:"d-flex justify-content-center mb-3",children:e.jsx("div",{className:"progress w-100",style:{height:"4px"},children:e.jsx("div",{className:"progress-bar bg-primary",role:"progressbar",style:{width:`${i/3*100}%`},"aria-valuenow":i,"aria-valuemin":"0","aria-valuemax":"3"})})}),e.jsx("div",{className:"d-flex justify-content-between mb-3",children:[1,2,3].map(U=>e.jsxs("div",{className:"d-flex flex-column align-items-center",children:[e.jsx("div",{className:`rounded-circle d-flex align-items-center justify-content-center mb-1 ${i>=U?"bg-primary text-white shadow-sm":"bg-light text-muted border"}`,style:{width:"36px",height:"36px",fontSize:"14px"},children:e.jsx("i",{className:`fas ${U===1?"fa-boxes":U===2?"fa-sticky-note":"fa-credit-card"}`})}),e.jsxs("small",{className:`text-center ${i>=U?"text-primary fw-bold":"text-muted"}`,style:{fontSize:"12px"},children:[U===1&&"Stock",U===2&&"Notes",U===3&&"Payment"]})]},U))}),i===1&&e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-gradient bg-light py-2",children:e.jsxs("h6",{className:"card-title mb-0",children:[e.jsx("i",{className:"fas fa-boxes text-primary me-2"}),"Consume Stock Items"]})}),e.jsxs("div",{className:"card-body p-3",children:[c.length>0?e.jsx("div",{className:"row g-2",children:c.map((U,k)=>e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border border-primary border-opacity-25",children:e.jsx("div",{className:"card-body p-2",children:e.jsxs("div",{className:"row g-2 align-items-end",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs("select",{className:"form-select",value:U.item_id,onChange:K=>I(k,"item_id",K.target.value),children:[e.jsx("option",{value:"",children:"Item"}),o.map(K=>e.jsxs("option",{value:K.id,children:[K.name," (Stock: ",K.total_on_hand||0,")"]},K.id))]})}),e.jsx("div",{className:"col-md-2",children:e.jsx("input",{type:"number",step:"0.01",min:"0",className:"form-control",value:U.quantity,onChange:K=>I(k,"quantity",K.target.value),placeholder:"Quantity"})}),e.jsx("div",{className:"col-md-4",children:e.jsx("input",{type:"text",className:"form-control",value:U.notes,onChange:K=>I(k,"notes",K.target.value),placeholder:"Notes"})}),e.jsx("div",{className:"col-md-2",children:e.jsxs("button",{type:"button",onClick:()=>W(k),className:"btn btn-outline-danger w-100",title:"Remove item",style:{minHeight:"38px"},children:[e.jsx("i",{className:"fas fa-trash me-1"}),"Remove Item"]})})]})})})},k))}):e.jsxs("div",{className:"text-center py-4 text-muted",children:[e.jsx("i",{className:"fas fa-boxes fa-3x mb-3 text-primary opacity-50"}),e.jsx("p",{className:"mb-0",children:"No stock items added yet"}),e.jsx("small",{children:'Click "Add Item" to start consuming stock'})]}),e.jsx("div",{className:"mt-3 text-center",children:e.jsxs("button",{type:"button",onClick:E,className:"btn btn-primary",style:{minWidth:"120px"},children:[e.jsx("i",{className:"fas fa-plus me-2"}),"Add Item"]})}),e.jsx("hr",{className:"my-4"}),e.jsxs("div",{className:"alert alert-info py-2 mb-3",children:[e.jsx("i",{className:"fas fa-info-circle me-2"}),e.jsx("strong",{children:"Additional Items:"})," Select items that patients can purchase separately (not included in procedure)"]}),e.jsx("div",{className:"card border-warning",children:e.jsxs("div",{className:"card-body p-2",children:[e.jsx("div",{className:"row",children:o.filter(U=>U.is_sellable&&U.patient_price).map(U=>{var k;return e.jsxs("div",{className:"col-12 mb-2",children:[e.jsxs("div",{className:"form-check",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",checked:j.some(K=>K.item_id===U.id),onChange:()=>B(U.id,U),id:`billable-${U.id}`}),e.jsxs("label",{className:"form-check-label",htmlFor:`billable-${U.id}`,children:[U.name," - â‚±",Number(U.patient_price).toLocaleString()]})]}),j.some(K=>K.item_id===U.id)&&e.jsx("div",{className:"ms-4 mt-1",children:e.jsxs("div",{className:"input-group input-group-sm",style:{width:"150px"},children:[e.jsx("span",{className:"input-group-text",children:"Qty:"}),e.jsx("input",{type:"number",className:"form-control",min:"1",value:((k=j.find(K=>K.item_id===U.id))==null?void 0:k.quantity)||1,onChange:K=>Z(U.id,K.target.value)})]})})]},U.id)})}),o.filter(U=>U.is_sellable&&U.patient_price).length===0&&e.jsx("p",{className:"text-muted mb-0 small",children:"No billable items available. Configure items as sellable in inventory settings."})]})})]})]}),i===2&&e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-gradient bg-light py-2",children:e.jsxs("h6",{className:"card-title mb-0",children:[e.jsx("i",{className:"fas fa-sticky-note text-primary me-2"}),"Visit Documentation"]})}),e.jsxs("div",{className:"card-body p-3",children:[A&&e.jsxs("div",{className:"alert alert-info mb-3 py-2 border-0",children:[e.jsxs("h6",{className:"alert-heading small",children:[e.jsx("i",{className:"fas fa-info-circle me-2"}),"Original Notes Information"]}),e.jsxs("p",{className:"mb-1 small",children:[e.jsx("strong",{children:"Created by:"})," ",A.created_by," on ",new Date(A.created_at).toLocaleString()]}),A.updated_by&&A.updated_at&&e.jsxs("p",{className:"mb-1 small",children:[e.jsx("strong",{children:"Last updated by:"})," ",A.updated_by," on ",new Date(A.updated_at).toLocaleString()]}),e.jsx("hr",{className:"my-2"}),e.jsx("p",{className:"mb-0 small",children:"You can edit these notes as needed for the final documentation."})]}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-user-md text-primary me-1"}),"Dentist Notes"]}),e.jsx("textarea",{className:"form-control",rows:"3",value:P,onChange:U=>g(U.target.value),placeholder:"Enter dentist's notes about the visit..."})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-search text-primary me-1"}),"Findings"]}),e.jsx("textarea",{className:"form-control",rows:"3",value:_,onChange:U=>N(U.target.value),placeholder:"Document any findings or observations..."})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-clipboard-list text-primary me-1"}),"Treatment Plan"]}),e.jsx("textarea",{className:"form-control",rows:"3",value:x,onChange:U=>p(U.target.value),placeholder:"Outline the treatment plan or follow-up instructions..."})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-tooth text-primary me-1"}),"Teeth Treated"]}),e.jsx("input",{type:"text",className:"form-control",value:C,onChange:U=>v(U.target.value),placeholder:"e.g., 1,2,3,4,5 or leave blank if not applicable"}),e.jsx("div",{className:"form-text",children:"Enter tooth numbers separated by commas (e.g., 1,2,3,4,5). Use the Universal Numbering System."})]})]})]})]}),i===3&&e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-gradient bg-light py-2",children:e.jsxs("h6",{className:"card-title mb-0",children:[e.jsx("i",{className:"fas fa-credit-card text-primary me-2"}),"Payment Verification"]})}),e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%)"},children:e.jsxs("div",{className:"card-body p-3",children:[e.jsxs("h6",{className:"card-title text-dark mb-3",children:[e.jsx("i",{className:"fas fa-receipt text-primary me-2"}),"Payment Summary"]}),e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Service"}),e.jsx("div",{className:"fw-semibold text-dark",children:((he=s.service)==null?void 0:he.name)||"N/A"})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Service Price"}),e.jsxs("div",{className:"fw-semibold text-primary",children:["â‚±",be.toLocaleString(),((le=s.service)==null?void 0:le.per_teeth_service)&&e.jsx("small",{className:"text-info d-block",children:"per tooth"})]})]})}),oe>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"col-12",children:[e.jsx("hr",{className:"my-2"}),e.jsx("div",{className:"fw-semibold mb-2",children:"Additional Items:"}),j.map(U=>{const k=o.find(K=>K.id===U.item_id);return e.jsxs("div",{className:"d-flex justify-content-between mb-1",children:[e.jsxs("small",{children:[k==null?void 0:k.name," (x",U.quantity,")"]}),e.jsxs("small",{className:"fw-semibold",children:["â‚±",Number(U.unit_price*U.quantity).toLocaleString()]})]},U.item_id)}),e.jsx("hr",{className:"my-2"})]}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Additional Charges"}),e.jsxs("div",{className:"fw-semibold text-warning",children:["â‚±",oe.toLocaleString()]})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Total Price"}),e.jsxs("div",{className:"fw-bold text-primary",children:["â‚±",Y.toLocaleString()]})]})})]}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Total Paid"}),e.jsxs("div",{className:"fw-semibold text-success",children:["â‚±",ne.toLocaleString()]})]})}),e.jsx("div",{className:"col-6",children:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("small",{className:"text-muted mb-1",children:"Balance"}),e.jsxs("div",{className:`fw-bold ${F>0?"text-warning":"text-success"}`,children:["â‚±",F.toLocaleString()]})]})})]})]})})}),X&&e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"alert alert-success border-0 shadow-sm",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"fas fa-check-circle fa-2x text-success me-3"}),e.jsxs("div",{children:[e.jsxs("h6",{className:"alert-heading mb-1",children:[e.jsx("i",{className:"fas fa-credit-card me-2"}),"Maya Payment Completed"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Amount Paid:"})," â‚±",Number(q.amount_paid||0).toLocaleString()]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Payment Date:"})," ",new Date(q.paid_at).toLocaleString()]}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"fas fa-lock me-1"}),"Payment information is read-only as the Maya payment has been successfully completed."]})]})]})})}),oe>0&&!X&&e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"alert alert-warning border-0 shadow-sm",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"fas fa-exclamation-triangle fa-2x text-warning me-3"}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("h6",{className:"alert-heading mb-1",children:[e.jsx("i",{className:"fas fa-info-circle me-2"}),"Additional Items Selected"]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Additional Charges:"})," â‚±",oe.toLocaleString()]}),e.jsxs("p",{className:"mb-0 small",children:[e.jsx("i",{className:"fas fa-lightbulb me-1"}),e.jsx("strong",{children:"HMO/Maya payments only cover the service amount."}),` If the patient's HMO/Maya payment doesn't cover additional charges, select "Partially Paid" and enter the on-site payment amount for the additional items.`]})]})]})})}),e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-credit-card text-primary me-1"}),"Payment Status"]}),e.jsxs("select",{className:"form-select",value:T,onChange:U=>S(U.target.value),disabled:X,children:[e.jsx("option",{value:"paid",children:"Fully Paid"}),e.jsx("option",{value:"hmo_fully_covered",children:"HMO Fully Covered"}),e.jsx("option",{value:"partial",children:"Partially Paid (HMO didn't cover all)"}),e.jsx("option",{value:"unpaid",children:"Unpaid (Maya failed)"})]}),X&&e.jsxs("div",{className:"form-text text-muted",children:[e.jsx("i",{className:"fas fa-lock me-1"}),"Payment status cannot be changed as Maya payment is already completed."]})]}),T==="partial"&&!X&&e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-money-bill text-primary me-1"}),"On-site Payment Amount (â‚±)"]}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:"â‚±"}),e.jsx("input",{type:"number",step:"0.01",min:"0",max:F,className:"form-control",value:d,onChange:U=>R(U.target.value),placeholder:`Maximum: ${F.toLocaleString()}`})]}),e.jsxs("div",{className:"form-text",children:["Maximum amount: â‚±",F.toLocaleString()]})]}),T==="unpaid"&&!X&&e.jsxs("div",{className:"col-12",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"fas fa-exchange-alt text-primary me-1"}),"Payment Method Change"]}),e.jsxs("select",{className:"form-select",value:H,onChange:U=>G(U.target.value),children:[e.jsx("option",{value:"",children:"Select change"}),e.jsx("option",{value:"maya_to_cash",children:"Change Maya to Cash Payment"})]})]})]})})]})]}),e.jsx("div",{className:"modal-footer bg-light border-top flex-shrink-0 py-3",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#f8f9fa"},children:e.jsxs("div",{className:"d-flex justify-content-between w-100 align-items-center",children:[e.jsx("div",{children:i>1&&e.jsxs("button",{type:"button",onClick:()=>n(i-1),className:"btn btn-outline-secondary",style:{minWidth:"100px"},children:[e.jsx("i",{className:"fas fa-arrow-left me-2"}),"Previous"]})}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("small",{className:"text-muted me-3",children:["Step ",i," of 3"]}),i<3?e.jsxs("button",{type:"button",onClick:()=>n(i+1),className:"btn btn-primary",style:{minWidth:"100px"},children:["Next",e.jsx("i",{className:"fas fa-arrow-right ms-2"})]}):e.jsx("button",{type:"button",onClick:te,disabled:y,className:"btn btn-success",style:{minWidth:"140px"},children:y?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Completing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"fas fa-check me-2"}),"Complete Visit"]})})]})]})})]})})})}function Li({visit:s,onClose:l}){var h,j;const[a,i]=t.useState(""),[n,o]=t.useState(!1),[r,c]=t.useState(""),[m,b]=t.useState(null),f=async u=>{var P,g;u.preventDefault(),o(!0),c("");try{const _=await M.post(`/api/visits/${s.id}/view-notes`,{password:a});b(_.data.notes)}catch(_){c(((g=(P=_==null?void 0:_.response)==null?void 0:P.data)==null?void 0:g.message)||"Invalid password or failed to decrypt notes")}finally{o(!1)}},y=u=>u?e.jsxs("div",{className:"space-y-4",children:[u.dentist_notes&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Dentist Notes:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:u.dentist_notes})})]}),u.findings&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Findings:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:u.findings})})]}),u.treatment_plan&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-800 mb-2",children:"Treatment Plan:"}),e.jsx("div",{className:"bg-gray-50 p-3 rounded border",children:e.jsx("p",{className:"whitespace-pre-wrap",children:u.treatment_plan})})]}),e.jsxs("div",{className:"text-sm text-gray-600 border-t pt-3",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Completed by:"})," Staff ID #",u.completed_by]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Completed at:"})," ",new Date(u.completed_at).toLocaleString()]})]})]}):null;return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",style:{padding:"1rem"},children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[calc(100vh-2rem)] flex flex-col overflow-hidden",children:[e.jsx("div",{className:"p-6 flex-shrink-0 sticky top-0 bg-white border-b z-10",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h2",{className:"text-xl font-bold",children:["Visit Notes - ",(h=s.patient)==null?void 0:h.first_name," ",(j=s.patient)==null?void 0:j.last_name]}),e.jsx("button",{onClick:l,className:"text-gray-500 hover:text-gray-700",children:"âœ•"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-6",style:{minHeight:0},children:m?e.jsx("div",{children:y(m)}):e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Enter your password to view encrypted notes:"}),e.jsx("input",{type:"password",className:"w-full border rounded px-3 py-2",value:a,onChange:u=>i(u.target.value),placeholder:"Enter your account password",required:!0}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"This action will be logged for security purposes."})]}),r&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 border border-red-300 text-red-700 rounded",children:r}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:l,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:n||!a.trim(),className:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50",children:n?"Verifying...":"View Notes"})]})]})}),m&&e.jsx("div",{className:"p-6 flex-shrink-0 sticky bottom-0 bg-white border-t z-10",children:e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:l,className:"px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600",children:"Close"})})})]})})}function Fi({visit:s,onClose:l,onSuccess:a}){var P,g,_;const[i,n]=t.useState([]),[o,r]=t.useState(!0),[c,m]=t.useState(null),[b,f]=t.useState(!1),[y,h]=t.useState("");t.useEffect(()=>{j()},[]);const j=async()=>{r(!0),h("");try{const N=new Date,x=N.getDay(),C=["sun","mon","tue","wed","thu","fri","sat"][x],A=(await M.get("/api/dentists",{params:{status:"active"}})).data.filter(z=>z[C]===!0&&z.status==="active"&&(!z.contract_end_date||new Date(z.contract_end_date)>=N));console.log("Available dentists:",A),n(A)}catch(N){console.error("Failed to fetch dentists:",N),h("Failed to load available dentists. Please try again.")}finally{r(!1)}},u=async()=>{var N,x;if(!c){h("Please select a dentist to send the visit code to.");return}if(!c.email){h("Selected dentist does not have an email address configured.");return}f(!0),h("");try{console.log("Sending visit code to dentist:",c);const p=await M.post("/api/visits/send-visit-code",{visit_id:s.id,dentist_id:c.id,dentist_email:c.email});alert(`Visit code sent successfully to Dr. ${c.dentist_name||c.dentist_code}!`),a&&a(c),l()}catch(p){console.error("Failed to send visit code:",p);let C="Failed to send visit code. Please try again.";(x=(N=p.response)==null?void 0:N.data)!=null&&x.message?C=p.response.data.message:p.message&&(C=p.message),h(C)}finally{f(!1)}};return e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-lg",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Visit Code to Dentist"]}),e.jsx("button",{className:"btn-close",onClick:l,disabled:b})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"alert alert-info mb-4",children:[e.jsxs("h6",{className:"alert-heading",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Visit Information"]}),e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Patient:"})," ",(P=s.patient)==null?void 0:P.first_name," ",(g=s.patient)==null?void 0:g.last_name]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("strong",{children:"Visit Code:"}),e.jsx("span",{className:"badge bg-primary ms-2 fs-6",children:s.visit_code})]}),e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Service:"})," ",((_=s.service)==null?void 0:_.name)||"Not specified"]}),e.jsxs("div",{className:"col-md-6 mt-2",children:[e.jsx("strong",{children:"Started:"})," ",new Date(s.start_time).toLocaleString()]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-person-badge me-2"}),"Select Available Dentist Today"]}),o?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"mt-2 text-muted",children:"Loading available dentists..."})]}):y&&!i.length?e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),y]}):i.length===0?e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No dentists are scheduled to work today. Please check the dentist schedule."]}):e.jsx("div",{className:"row",children:i.map(N=>e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx("div",{className:`card h-100 cursor-pointer border-2 ${(c==null?void 0:c.id)===N.id?"border-primary bg-light":"border-light"}`,style:{cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>m(N),onMouseEnter:x=>{(c==null?void 0:c.id)!==N.id&&(x.target.style.borderColor="#0d6efd",x.target.style.boxShadow="0 2px 4px rgba(0,0,0,0.1)")},onMouseLeave:x=>{(c==null?void 0:c.id)!==N.id&&(x.target.style.borderColor="#e9ecef",x.target.style.boxShadow="none")},children:e.jsx("div",{className:"card-body p-3",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"me-3",children:e.jsx("div",{className:"bg-primary text-white rounded-circle d-flex align-items-center justify-content-center",style:{width:"40px",height:"40px"},children:e.jsx("i",{className:"bi bi-person-fill"})})}),e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("h6",{className:"card-title mb-1",children:["Dr. ",N.dentist_name||N.dentist_code]}),e.jsxs("small",{className:"text-muted",children:[N.dentist_code&&e.jsx("span",{className:"badge bg-secondary me-2",children:N.dentist_code}),N.employment_type&&e.jsx("span",{className:"text-capitalize",children:N.employment_type.replace("_"," ")})]}),N.email&&e.jsx("div",{className:"mt-1",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-envelope me-1"}),N.email]})})]}),(c==null?void 0:c.id)===N.id&&e.jsx("div",{className:"text-primary",children:e.jsx("i",{className:"bi bi-check-circle-fill fs-5"})})]})})})},N.id))})]}),y&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),y]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{className:"btn btn-secondary",onClick:l,disabled:b,children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:u,disabled:b||!c||i.length===0,children:b?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Visit Code"]})})]})]})})})}function zi({visit:s,onClose:l,onSuccess:a}){const[i,n]=t.useState({}),[o,r]=t.useState(!0),[c,m]=t.useState(!1),[b,f]=t.useState(""),[y,h]=t.useState(!1),[j,u]=t.useState(null);t.useEffect(()=>{P()},[s]);const P=async()=>{var x,p;r(!0),f("");try{const C=await M.get(`/api/visits/${s.id}/medical-history-form`);n(C.data.form_data||{}),h(C.data.previous_history_exists||!1),u(C.data.previous_history_date||null)}catch(C){console.error("Failed to load medical history form:",C),f(((p=(x=C.response)==null?void 0:x.data)==null?void 0:p.message)||"Failed to load form data. Please try again.")}finally{r(!1)}},g=(x,p)=>{n(C=>({...C,[x]:p}))},_=(x,p)=>{n(C=>({...C,[x]:p}))},N=async x=>{var p,C,v,A;x.preventDefault(),m(!0),f("");try{const z=await M.post(`/api/visits/${s.id}/medical-history`,i);alert(`Medical history completed successfully!

Visit Code: ${z.data.visit.visit_code}

You can now send this code to the dentist.`),a&&a(z.data),l()}catch(z){if(console.error("Failed to submit medical history:",z),(C=(p=z.response)==null?void 0:p.data)!=null&&C.errors){const T=Object.values(z.response.data.errors).flat().join(`
`);f(T)}else f(((A=(v=z.response)==null?void 0:v.data)==null?void 0:A.message)||"Failed to submit medical history. Please try again.")}finally{m(!1)}};return o?e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050},children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",style:{margin:"1rem auto",maxHeight:"calc(100vh - 2rem)"},children:e.jsx("div",{className:"modal-content",children:e.jsxs("div",{className:"modal-body text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("div",{className:"mt-3",children:"Loading medical history form..."})]})})})}):e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:1050,display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",style:{margin:"1rem auto",maxHeight:"calc(100vh - 2rem)"},children:e.jsxs("div",{className:"modal-content",style:{maxHeight:"calc(100vh - 2rem)",display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-file-medical me-2"}),"Dental and Medical History Form"]}),e.jsx("button",{className:"btn-close",onClick:l,disabled:c})]}),e.jsxs("form",{onSubmit:N,style:{display:"flex",flexDirection:"column",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"modal-body",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[y&&e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"Previous medical history found."})," Please review and update all information if the patient has visited other clinics or if there have been any changes.",j&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{children:["Last completed: ",new Date(j).toLocaleDateString()]})})]}),b&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),b]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person me-2"}),"Patient Information"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Full Name *"}),e.jsx("input",{type:"text",className:"form-control",value:i.full_name||"",onChange:x=>g("full_name",x.target.value),required:!0})]}),e.jsxs("div",{className:"col-md-3 mb-3",children:[e.jsx("label",{className:"form-label",children:"Age"}),e.jsx("input",{type:"number",className:"form-control",value:i.age||"",onChange:x=>g("age",x.target.value),min:"0",max:"150"})]}),e.jsxs("div",{className:"col-md-3 mb-3",children:[e.jsx("label",{className:"form-label",children:"Sex"}),e.jsxs("select",{className:"form-select",value:i.sex||"",onChange:x=>g("sex",x.target.value),children:[e.jsx("option",{value:"",children:"Select"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Address"}),e.jsx("input",{type:"text",className:"form-control",value:i.address||"",onChange:x=>g("address",x.target.value)})]}),e.jsxs("div",{className:"col-md-3 mb-3",children:[e.jsx("label",{className:"form-label",children:"Contact Number"}),e.jsx("input",{type:"text",className:"form-control",value:i.contact_number||"",onChange:x=>g("contact_number",x.target.value)})]}),e.jsxs("div",{className:"col-md-3 mb-3",children:[e.jsx("label",{className:"form-label",children:"Date of Birth"}),e.jsx("input",{type:"date",className:"form-control",value:i.date_of_birth||"",onChange:x=>g("date_of_birth",x.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Occupation"}),e.jsx("input",{type:"text",className:"form-control",value:i.occupation||"",onChange:x=>g("occupation",x.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",className:"form-control",value:i.email||"",onChange:x=>g("email",x.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Previous Dentist"}),e.jsx("input",{type:"text",className:"form-control",value:i.previous_dentist||"",onChange:x=>g("previous_dentist",x.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Dental Visit"}),e.jsx("input",{type:"date",className:"form-control",value:i.last_dental_visit||"",onChange:x=>g("last_dental_visit",x.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Physician Name"}),e.jsx("input",{type:"text",className:"form-control",value:i.physician_name||"",onChange:x=>g("physician_name",x.target.value)})]}),e.jsxs("div",{className:"col-md-6 mb-3",children:[e.jsx("label",{className:"form-label",children:"Physician Address"}),e.jsx("input",{type:"text",className:"form-control",value:i.physician_address||"",onChange:x=>g("physician_address",x.target.value)})]})]})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-heart-pulse me-2"}),"Health Questions"]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.in_good_health||!1,onChange:x=>_("in_good_health",x.target.checked)}),"Are you in good health?"]})}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.under_medical_treatment||!1,onChange:x=>_("under_medical_treatment",x.target.checked)}),"Are you under medical treatment now?"]}),i.under_medical_treatment&&e.jsx("textarea",{className:"form-control mt-2",rows:"2",placeholder:"Please provide details...",value:i.medical_treatment_details||"",onChange:x=>g("medical_treatment_details",x.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.serious_illness_surgery||!1,onChange:x=>_("serious_illness_surgery",x.target.checked)}),"Have you had any serious illness or operation?"]}),i.serious_illness_surgery&&e.jsx("textarea",{className:"form-control mt-2",rows:"2",placeholder:"Please provide details...",value:i.illness_surgery_details||"",onChange:x=>g("illness_surgery_details",x.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.hospitalized||!1,onChange:x=>_("hospitalized",x.target.checked)}),"Have you been hospitalized in the past 2 years?"]}),i.hospitalized&&e.jsx("textarea",{className:"form-control mt-2",rows:"2",placeholder:"Please provide details...",value:i.hospitalization_details||"",onChange:x=>g("hospitalization_details",x.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.taking_medications||!1,onChange:x=>_("taking_medications",x.target.checked)}),"Are you taking any medications?"]}),i.taking_medications&&e.jsx("textarea",{className:"form-control mt-2",rows:"2",placeholder:"Please list all medications...",value:i.medications_list||"",onChange:x=>g("medications_list",x.target.value)})]}),e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.uses_tobacco||!1,onChange:x=>_("uses_tobacco",x.target.checked)}),"Do you use tobacco?"]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.uses_alcohol_drugs||!1,onChange:x=>_("uses_alcohol_drugs",x.target.checked)}),"Do you use alcohol or drugs?"]})})]})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-danger text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Allergies"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_local_anesthetic||!1,onChange:x=>_("allergic_local_anesthetic",x.target.checked)}),"Local Anesthetic"]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_penicillin||!1,onChange:x=>_("allergic_penicillin",x.target.checked)}),"Penicillin"]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_sulfa||!1,onChange:x=>_("allergic_sulfa",x.target.checked)}),"Sulfa Drugs"]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_aspirin||!1,onChange:x=>_("allergic_aspirin",x.target.checked)}),"Aspirin"]})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.allergic_latex||!1,onChange:x=>_("allergic_latex",x.target.checked)}),"Latex"]})}),e.jsxs("div",{className:"col-md-12 mb-3",children:[e.jsx("label",{className:"form-label",children:"Other Allergies"}),e.jsx("textarea",{className:"form-control",rows:"2",placeholder:"Please specify...",value:i.allergic_others||"",onChange:x=>g("allergic_others",x.target.value)})]})]})})]}),i.sex==="female"&&e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-info text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-gender-female me-2"}),"For Women Only"]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.is_pregnant||!1,onChange:x=>_("is_pregnant",x.target.checked)}),"Are you pregnant?"]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.is_nursing||!1,onChange:x=>_("is_nursing",x.target.checked)}),"Are you nursing?"]})}),e.jsx("div",{className:"mb-3",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i.taking_birth_control||!1,onChange:x=>_("taking_birth_control",x.target.checked)}),"Are you taking birth control pills?"]})})]})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-success text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-clipboard-pulse me-2"}),"Vital Information"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("label",{className:"form-label",children:"Blood Type"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"e.g., O+, A-, etc.",value:i.blood_type||"",onChange:x=>g("blood_type",x.target.value)})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("label",{className:"form-label",children:"Blood Pressure"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"e.g., 120/80",value:i.blood_pressure||"",onChange:x=>g("blood_pressure",x.target.value)})]}),e.jsxs("div",{className:"col-md-4 mb-3",children:[e.jsx("label",{className:"form-label",children:"Bleeding Time"}),e.jsx("input",{type:"text",className:"form-control",value:i.bleeding_time||"",onChange:x=>g("bleeding_time",x.target.value)})]})]})})]}),e.jsxs("div",{className:"card mb-4",children:[e.jsx("div",{className:"card-header bg-warning text-dark",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-clipboard2-pulse me-2"}),"Medical Conditions"]})}),e.jsxs("div",{className:"card-body",children:[e.jsx("div",{className:"row",children:["high_blood_pressure","low_blood_pressure","heart_disease","heart_murmur","chest_pain","stroke","diabetes","hepatitis","tuberculosis","kidney_disease","cancer","asthma","anemia","arthritis","epilepsy","aids_hiv","stomach_troubles","thyroid_problems","hay_fever","head_injuries","rapid_weight_loss","joint_replacement","radiation_therapy","swollen_ankles"].map(x=>e.jsx("div",{className:"col-md-6 mb-2",children:e.jsxs("label",{className:"form-check-label",children:[e.jsx("input",{type:"checkbox",className:"form-check-input me-2",checked:i[x]||!1,onChange:p=>_(x,p.target.checked)}),x.split("_").map(p=>p.charAt(0).toUpperCase()+p.slice(1)).join(" ")]})},x))}),e.jsxs("div",{className:"mt-3",children:[e.jsx("label",{className:"form-label",children:"Other Conditions"}),e.jsx("textarea",{className:"form-control",rows:"3",placeholder:"Please specify any other medical conditions...",value:i.other_conditions||"",onChange:x=>g("other_conditions",x.target.value)})]})]})]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:l,disabled:c,children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Submitting..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Submit Medical History"]})})]})]})]})})})}function Ti({show:s,onClose:l}){const[a,i]=t.useState(!1),[n,o]=t.useState(null);t.useEffect(()=>{s&&r()},[s]);const r=async()=>{i(!0);try{const c=await M.get("/api/staff/today-time-blocks");o(c.data)}catch(c){console.error("Failed to fetch time blocks:",c),alert("Failed to load time blocks")}finally{i(!1)}};return s?e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-xl modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-primary text-white",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Today's Appointment Schedule"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:l})]}),e.jsx("div",{className:"modal-body",children:a?e.jsx("div",{className:"text-center py-5",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):n!=null&&n.is_open?e.jsxs("div",{children:[e.jsxs("div",{className:"alert alert-info mb-4",children:[e.jsx("strong",{children:"Clinic Hours:"})," ",n.open_time," - ",n.close_time," |",e.jsx("strong",{className:"ms-3",children:"Capacity:"})," ",n.capacity," per slot"]}),e.jsx("div",{className:"time-block-container",children:n.blocks.map(c=>e.jsxs("div",{className:`card mb-3 ${c.count>0?"border-primary":"border-secondary"}`,children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-clock me-2"}),c.time]}),e.jsxs("span",{className:`badge ${c.count>0?"bg-primary":"bg-secondary"}`,children:[c.count," appointment",c.count!==1?"s":""]})]}),c.count>0&&e.jsx("div",{className:"card-body",children:e.jsx("div",{className:"list-group list-group-flush",children:c.appointments.map(m=>e.jsx("div",{className:"list-group-item",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:m.patient_name}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-bandaid me-1"}),m.service_name]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-tag me-1"}),"Ref: ",m.reference_code]})]}),e.jsx("span",{className:`badge ${m.status==="completed"?"bg-success":"bg-info"}`,children:m.status})]})},m.id))})})]},c.time))})]}):e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Clinic is closed today"]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:l,children:"Close"}),e.jsxs("button",{type:"button",className:"btn btn-primary",onClick:r,disabled:a,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh"]})]})]})})}):null}function Ia(){const[s,l]=t.useState([]),[a,i]=t.useState(!1),[n,o]=t.useState(!1),[r,c]=t.useState("walkin"),[m,b]=t.useState(""),[f,y]=t.useState(null),[h,j]=t.useState(!1),[u,P]=t.useState(""),[g,_]=t.useState(!1),[N,x]=t.useState(null),[p,C]=t.useState(""),[v,A]=t.useState(!1),[z,T]=t.useState(null),[S,d]=t.useState({first_name:"",last_name:"",contact:"",service_id:""}),[R,H]=t.useState([]),[G,$]=t.useState(!1),[L,E]=t.useState(""),[I,W]=t.useState([]),[B,Z]=t.useState(null),[te,ne]=t.useState(!1),[be,oe]=t.useState(null),[Y,F]=t.useState(null),[q,X]=t.useState(null),[re,V]=t.useState(null),[ce,he]=t.useState([]),[le,U]=t.useState(!1),[k,K]=t.useState(!1),[J,ue]=t.useState(!1),[ve,Ce]=t.useState(null),[Ae,rs]=t.useState(!1),[D,Q]=t.useState({patient_id:"",first_name:"",last_name:"",contact_number:"",email:"",birthdate:"",service_id:"",date:"",start_time:"",payment_method:"cash",patient_hmo_id:"",teeth_count:"",linkToExisting:!1}),[ae,me]=t.useState([]),[xe,de]=t.useState(!1),[ke,Le]=t.useState(!1),[Ne,$e]=t.useState(null),[Fe,Te]=t.useState([]),[We,Ve]=t.useState(!1);t.useEffect(()=>{Pe()},[]),t.useEffect(()=>{console.log("ðŸ”„ Visits state updated:",s),console.log("ðŸ“Š Visit counts:",{total:s.length,pending:s.filter(w=>w.status==="pending").length,completed:s.filter(w=>w.status==="completed").length,rejected:s.filter(w=>w.status==="rejected").length})},[s]);const Pe=async()=>{i(!0);try{console.log("ðŸŒ Fetching visits from API...");const w=await M.get("/api/visits");console.log("ðŸ“¥ API response received:",w.data),console.log("ðŸ“ˆ Number of visits received:",w.data.length),console.log("â³ Visits with pending status:",w.data.filter(O=>O.status==="pending")),console.log("ðŸ” Visit IDs:",w.data.map(O=>{var se,ie;return{id:O.id,status:O.status,patient:((se=O.patient)==null?void 0:se.first_name)+" "+((ie=O.patient)==null?void 0:ie.last_name)}})),l(w.data)}catch(w){console.error("âŒ Failed to load visits",w)}finally{i(!1)}},Be=async()=>{var w,O;o(!0);try{let se;if(r==="walkin")se={visit_type:"walkin"};else if(r==="appointment"){if(!f){alert("Search and select a valid appointment first."),o(!1);return}se={visit_type:"appointment",reference_code:(m||"").toUpperCase().replace(/[^A-Z0-9]/g,"")}}console.log("ðŸš€ Creating visit with payload:",se);const ie=await M.post("/api/visits",se),pe=ie.data.visit||ie.data;console.log("âœ… Visit created successfully:",pe),console.log("ðŸ“‹ Visit details:",{id:pe.id,status:pe.status,visit_code:pe.visit_code,patient_id:pe.patient_id,patient_name:((w=pe.patient)==null?void 0:w.first_name)+" "+((O=pe.patient)==null?void 0:O.last_name),start_time:pe.start_time}),ie.data.requires_medical_history?alert("Visit created. Please complete the medical history form before sending the visit code to the dentist."):pe.visit_code&&alert(`Visit started successfully!

Visit Code: ${pe.visit_code}

Share this code with the dentist to begin consultation.`),console.log("âž• Adding new visit to state:",pe),l(Ee=>{const fe=[pe,...Ee];return console.log("ðŸ”„ Updated visits state with new visit:",fe),console.log("ðŸŽ¯ New visit should now be visible in the list"),fe}),b(""),y(null),console.log("ðŸ”„ Fetching visits after creation to ensure consistency..."),await new Promise(Ee=>setTimeout(Ee,200)),await Pe(),console.log("âœ… Visit creation process completed")}catch(se){console.error("Error creating visit:",se),alert("Failed to start visit.")}finally{o(!1)}},Oe=async(w,O)=>{{const se=s.find(ie=>ie.id===w);if(!se.service_id){alert("Please select a service for this patient before finishing the visit. Use the 'Edit' button to assign a service.");return}oe(se);return}},qe=async()=>{await Pe()},Xe=async w=>{var O,se;X(w);try{const ie=await M.post(`/api/receipts/visit/${w}/email`,{},{skip401Handler:!0});ie.data.note?alert(`${ie.data.message}

${ie.data.note}`):alert(`Receipt sent successfully to ${ie.data.email}`)}catch(ie){console.error("Failed to send receipt email",ie);const pe=((se=(O=ie.response)==null?void 0:O.data)==null?void 0:se.message)||"Failed to send receipt email. Please try again.";alert(pe)}finally{X(null)}},Qe=async()=>{j(!0),y(null),P("");try{const w=(m||"").toUpperCase().replace(/[^A-Z0-9]/g,"");if(w.length!==8){P("Enter the full 8-character code.");return}const O=await M.get(`/api/appointment/resolve/${w}`);y(O.data)}catch{P("Invalid or used reference code.")}finally{j(!1)}},Je=async w=>{var O,se,ie;T(w),d({first_name:((O=w.patient)==null?void 0:O.first_name)||"",last_name:((se=w.patient)==null?void 0:se.last_name)||"",contact:((ie=w.patient)==null?void 0:ie.contact)||"",service_id:w.service_id||""});try{const pe=new Date().toISOString().slice(0,10),Ee=await M.get(`/api/appointment/available-services?date=${pe}`);H(Array.isArray(Ee.data)?Ee.data:Ee.data.data||[])}catch{alert("Failed to load services.")}},Ze=async()=>{var w;try{const O=await M.put(`/api/visits/${z.id}/update-patient`,{first_name:S.first_name,last_name:S.last_name,contact_number:S.contact.trim()!==""?S.contact.trim():(w=z.patient)==null?void 0:w.contact_number,service_id:S.service_id||null});if(O.data.potential_matches&&O.data.potential_matches.length>0)he(O.data.potential_matches),U(!0);else{const se=z;if(T(null),await Pe(),!se.appointment_id&&S.service_id)try{const ie=await M.get(`/api/visits/${se.id}`);ie.data.medical_history_status==="pending"&&(Ce(ie.data),ue(!0))}catch(ie){console.error("Failed to fetch updated visit for medical history:",ie)}}}catch{alert("Failed to update patient.")}},Ie=w=>{Ce(w),ue(!0)},cs=async w=>{await Pe(),ue(!1),Ce(null)},ds=async()=>{Q({patient_id:"",first_name:"",last_name:"",contact_number:"",email:"",birthdate:"",service_id:"",date:"",start_time:"",payment_method:"cash",patient_hmo_id:"",teeth_count:"",linkToExisting:!1}),$e(null),me([]),Te([]),H([]),K(!0)},os=async w=>{if(Q(O=>({...O,date:w,start_time:"",service_id:""})),me([]),$e(null),w){Ve(!0);try{const O=await M.get(`/api/dentists/available-for-date?date=${w}`);Te(O.data.dentists||[])}catch(O){console.error("Failed to load dentists for date:",O),Te([])}finally{Ve(!1)}try{const O=await M.get(`/api/appointment/available-services?date=${w}`);H(Array.isArray(O.data)?O.data:O.data.data||[])}catch(O){console.error("Failed to load services for new date:",O),H([])}}else Te([]),H([])},ms=async w=>{const O=R.find(se=>se.id==w);$e(O),Q(se=>({...se,service_id:w,start_time:"",teeth_count:""})),me([]),w&&D.date&&O&&!O.per_teeth_service&&await ts(D.date,w,D.teeth_count)},as=async w=>{Q(O=>({...O,teeth_count:w,start_time:""})),me([]),D.date&&D.service_id&&w&&w>0&&await ts(D.date,D.service_id,w)},ts=async(w,O,se=null)=>{de(!0);try{const ie={date:w,service_id:O};se&&(ie.teeth_count=se);const pe=await M.get("/api/appointment/available-slots",{params:ie});me(pe.data.slots||pe.data)}catch(ie){console.error("Failed to fetch available slots:",ie),me([])}finally{de(!1)}},is=w=>{if(!w)return null;const O=new Date(w),se=new Date,ie=new Date;return ie.setFullYear(se.getFullYear()-4),O>se?"Birthdate cannot be in the future.":O>ie?"Patient must be at least 4 years old.":null},ls=()=>{const w=new Date;return w.setFullYear(w.getFullYear()-4),w.toISOString().split("T")[0]},hs=async()=>{var O,se;if(!D.service_id||!D.date||!D.start_time){alert("Please select service, date, and time.");return}if(Ne&&Ne.per_teeth_service&&!D.teeth_count){alert("Please enter the number of teeth for this per-teeth service.");return}const w=is(D.birthdate);if(w){alert(w);return}if(!D.linkToExisting&&(!D.first_name||!D.last_name||!D.contact_number)){alert("Please fill in patient details including contact number (required for SMS reminders) or link to existing patient.");return}if(D.linkToExisting&&!D.patient_id){alert("Please select an existing patient.");return}Le(!0);try{const ie={service_id:D.service_id,date:D.date,start_time:D.start_time,payment_method:D.payment_method};D.linkToExisting?ie.patient_id=D.patient_id:(ie.first_name=D.first_name,ie.last_name=D.last_name,ie.contact_number=D.contact_number,D.email&&(ie.email=D.email),D.birthdate&&(ie.birthdate=D.birthdate)),D.payment_method==="hmo"&&D.patient_hmo_id&&(ie.patient_hmo_id=D.patient_hmo_id),D.teeth_count&&(ie.teeth_count=parseInt(D.teeth_count));const pe=await M.post("/api/appointments/staff-create",ie);alert(`Appointment created successfully!
Reference Code: ${pe.data.appointment.reference_code}`),K(!1)}catch(ie){const pe=((se=(O=ie.response)==null?void 0:O.data)==null?void 0:se.message)||"Failed to create appointment.";alert(pe)}finally{Le(!1)}};return e.jsxs("div",{className:"h-100 d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h3",{children:"ðŸ“ Patient Visit Tracker"}),e.jsxs("button",{className:"btn btn-outline-primary",onClick:()=>rs(!0),children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"View Today's Schedule"]})]}),e.jsxs("div",{className:"card p-3 mb-4",children:[e.jsx("label",{children:"Visit Type"}),e.jsxs("select",{className:"form-select mb-2",value:r,onChange:w=>{c(w.target.value),y(null),b(""),P("")},children:[e.jsx("option",{value:"walkin",children:"Walk-in"}),e.jsx("option",{value:"appointment",children:"Appointment"})]}),r==="appointment"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"input-group mb-2",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Enter Appointment Reference Code",value:m,onChange:w=>b(w.target.value.toUpperCase())}),e.jsx("button",{className:"btn btn-outline-primary",onClick:Qe,disabled:h||!m,children:h?"Searching...":"Search"})]}),u&&e.jsx("div",{className:"text-danger",children:u}),f&&e.jsxs("div",{className:"alert alert-success",children:[e.jsxs("div",{className:"mb-2",children:[e.jsx("strong",{children:f.patient_name})," â€”"," ",f.service_name," @ ",f.date," /"," ",f.time_slot]}),f.last_visit&&e.jsxs("div",{className:"mt-2 p-2 bg-light rounded",children:[e.jsx("small",{className:"text-muted",children:"ðŸ“‹ Last Visit:"}),e.jsxs("div",{className:"small",children:[e.jsx("strong",{children:"Date:"})," ",new Date(f.last_visit.visit_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})," |"," ",e.jsx("strong",{children:"Service:"})," ",f.last_visit.service_name||"N/A",f.last_visit.teeth_treated&&e.jsxs(e.Fragment,{children:[" | ",e.jsx("strong",{children:"Teeth Treated:"})," ",f.last_visit.teeth_treated]})]})]}),!f.last_visit&&e.jsx("div",{className:"mt-2 p-2 bg-light rounded",children:e.jsx("small",{className:"text-muted",children:"ðŸ“‹ No previous visits found"})})]})]}),e.jsxs("div",{className:"d-flex gap-2 mt-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:Be,disabled:n,children:n?"Saving...":"Start Visit"}),e.jsx("button",{className:"btn btn-success",onClick:ds,children:"ðŸ“… Make Appointment"})]})]}),e.jsxs("div",{className:"flex-grow-1 d-flex flex-column",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("h5",{className:"mb-0",children:["Ongoing Visits (",s.length," total, ",s.filter(w=>w.status==="pending").length," pending)"]}),a&&e.jsxs("div",{className:"d-flex align-items-center text-muted ms-3",children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("small",{children:"Loading visits..."})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:Pe,children:"ðŸ”„ Refresh"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>ne(w=>!w),children:te?"ðŸ”½ Hide Completed/Rejected":"ðŸ”¼ Show All Today's Visits"})]})]}),e.jsx("div",{className:"table-responsive flex-grow-1",children:e.jsxs("table",{className:"table table-bordered table-hover mb-0",children:[e.jsx("thead",{className:"table-light sticky-top",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Visit Code"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Note"}),e.jsx("th",{children:"Started At"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Medical History"}),e.jsx("th",{style:{minWidth:"200px"},children:"Actions"})]})}),e.jsx("tbody",{children:(()=>{const w=s.filter(O=>te||O.status==="pending");return console.log("All visits:",s),console.log("Show all visits:",te),console.log("Filtered visits:",w),w})().map(w=>{var O,se,ie;return console.log("Rendering visit:",w.id,"Patient:",w.patient),e.jsxs("tr",{children:[e.jsxs("td",{children:[(O=w.patient)==null?void 0:O.first_name," ",(se=w.patient)==null?void 0:se.last_name]}),e.jsx("td",{children:((ie=w.patient)==null?void 0:ie.contact_number)||"â€”"}),e.jsx("td",{children:w.visit_code?e.jsx("span",{className:"badge bg-primary",children:w.visit_code}):"â€”"}),e.jsx("td",{children:w.service?e.jsx("span",{className:"badge bg-info",children:w.service.name}):e.jsxs("span",{className:"badge bg-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"No Service"]})}),e.jsx("td",{children:w.status==="completed"&&w.visit_notes?e.jsx("button",{className:"btn btn-sm btn-outline-info",onClick:()=>F(w),children:"ðŸ”’ View Notes"}):"â€”"}),e.jsx("td",{children:w.start_time?new Date(w.start_time).toLocaleString("en-PH",{dateStyle:"medium",timeStyle:"short"}):"â€”"}),e.jsx("td",{children:w.status}),e.jsx("td",{children:w.medical_history_status==="completed"?e.jsxs("span",{className:"badge bg-success",children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),"Completed"]}):e.jsxs("span",{className:"badge bg-warning text-dark",children:[e.jsx("i",{className:"bi bi-clock me-1"}),"Pending"]})}),e.jsxs("td",{children:[w.status==="pending"&&e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[e.jsx("button",{className:"btn btn-warning btn-sm",onClick:()=>Je(w),children:"Edit"}),e.jsxs("button",{className:`btn btn-sm ${w.medical_history_status==="completed"?"btn-success":"btn-info"}`,onClick:()=>Ie(w),title:w.medical_history_status==="completed"?"View/Edit Medical History":"Complete Medical History",children:[e.jsx("i",{className:`bi ${w.medical_history_status==="completed"?"bi-check-circle":"bi-file-medical"} me-1`}),"Medical History"]}),w.visit_code?e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>V(w),disabled:w.medical_history_status==="pending",title:w.medical_history_status==="pending"?"Complete medical history first":"Send visit code to dentist",children:[e.jsx("i",{className:"bi bi-send me-1"}),"Send Visit Code to Dentist"]}):e.jsxs("span",{className:"badge bg-warning text-dark",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"Medical History Required"]}),e.jsx("button",{className:`btn btn-sm ${w.service_id?"btn-success":"btn-outline-secondary"}`,onClick:()=>Oe(w.id),disabled:!w.service_id,title:w.service_id?"Complete this visit":"Please select a service first",children:w.service_id?"Finish":e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),"Finish"]})}),e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>{x(w.id),C(""),A(!1),_(!0)},children:"Reject"})]}),w.status==="completed"&&e.jsx("div",{className:"d-flex gap-1 flex-wrap",children:e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>Xe(w.id),disabled:q===w.id,title:"Send Receipt Email",children:q===w.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-envelope me-1"}),"Send Receipt"]})})})]})]},w.id)})})]})})]}),g&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:p==="inquiry_only"?"Mark as Inquiry":"Reject Visit"}),e.jsx("button",{className:"btn-close",onClick:()=>_(!1)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("label",{className:"form-label",children:p==="inquiry_only"?"Reason for inquiry:":"Reason for rejection:"}),e.jsxs("select",{className:"form-select",value:p,onChange:w=>C(w.target.value),children:[e.jsx("option",{value:"",children:"Select reason"}),e.jsx("option",{value:"human_error",children:"Human Error"}),e.jsx("option",{value:"left",children:"Patient Left"}),e.jsx("option",{value:"line_too_long",children:"Line Too Long"}),e.jsx("option",{value:"inquiry_only",children:"Inquiry Only"})]}),p==="line_too_long"&&e.jsxs("div",{className:"form-check mt-2",children:[e.jsx("input",{type:"checkbox",className:"form-check-input",checked:v,onChange:w=>A(w.target.checked),id:"offerAppt"}),e.jsx("label",{htmlFor:"offerAppt",className:"form-check-label",children:"Patient was offered an appointment"})]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>_(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-danger",disabled:!p,onClick:async()=>{await M.post(`/api/visits/${N}/reject`,{reason:p,offered_appointment:v}),_(!1),x(null),await Pe()},children:p==="inquiry_only"?"Mark as Inquiry":"Confirm Reject"})]})]})})}),z&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Edit Patient Info"}),e.jsx("button",{className:"btn-close",onClick:()=>T(null)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("label",{className:"form-label",children:"First Name"}),e.jsx("input",{className:"form-control mb-2",value:S.first_name,onChange:w=>d({...S,first_name:w.target.value})}),e.jsx("label",{className:"form-label",children:"Last Name"}),e.jsx("input",{className:"form-control mb-2",value:S.last_name,onChange:w=>d({...S,last_name:w.target.value})}),e.jsx("label",{className:"form-label",children:"Contact"}),e.jsx("input",{className:"form-control mb-2",value:S.contact,onChange:w=>d({...S,contact:w.target.value})}),e.jsx("label",{className:"form-label",children:"Service"}),e.jsxs("select",{className:"form-select",value:S.service_id,onChange:w=>d({...S,service_id:w.target.value}),children:[e.jsx("option",{value:"",children:"â€” Select â€”"}),R.map(w=>e.jsxs("option",{value:w.id,children:[w.name," â€“"," ",w.type==="promo"?`â‚±${Number(w.promo_price).toLocaleString()} (${w.discount_percent}% off)`:w.type==="special"?`â‚±${Number(w.price).toLocaleString()} Special Service`:`â‚±${Number(w.price).toLocaleString()}`]},w.id))]}),e.jsx("hr",{}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>{$(!0),E(""),W([]),Z(null)},children:"ðŸ”— Link to Existing Patient"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>T(null),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:Ze,children:"Save"})]})]})})}),G&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Link to Existing Patient"}),e.jsx("button",{className:"btn-close",onClick:()=>$(!1)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("input",{className:"form-control mb-2",placeholder:"Search by name or contact (min 2 characters)",value:L,onChange:async w=>{const O=w.target.value;if(E(O),W([]),Z(null),O.length>=2)try{const se=await M.get("/api/patients/search",{params:{q:O.trim()}});W(se.data)}catch{alert("Search failed.")}}}),I.filter(w=>{var O;return w.id!==((O=z==null?void 0:z.patient)==null?void 0:O.id)}).length>0?e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Birthdate"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:I.filter(w=>{var O;return w.id!==((O=z==null?void 0:z.patient)==null?void 0:O.id)}).map(w=>e.jsxs("tr",{children:[e.jsxs("td",{children:[w.first_name," ",w.last_name]}),e.jsx("td",{children:w.contact_number||"â€”"}),e.jsx("td",{children:w.birthdate?new Date(w.birthdate).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):"â€”"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>Z(w),children:"Select"})})]},w.id))})]}):e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Birthdate"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-muted text-center",children:"No matching patients found."})})})]}),B&&e.jsxs("div",{className:"alert alert-info mt-3",children:["Link current visit to"," ",e.jsxs("strong",{children:[B.first_name," ",B.last_name]}),"?"]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>$(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",disabled:!B,onClick:async()=>{try{const w={target_patient_id:B.id};S.service_id&&(w.service_id=S.service_id),await M.post(`/api/visits/${z.id}/link-existing`,w),$(!1),T(null),await Pe()}catch{alert("Failed to link to patient.")}},children:"Confirm Link"})]})]})})}),le&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-warning",children:[e.jsx("h5",{className:"modal-title",children:"âš ï¸ Potential Duplicate Patient Found"}),e.jsx("button",{className:"btn-close",onClick:()=>{U(!1),T(null)}})]}),e.jsxs("div",{className:"modal-body",children:[e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("strong",{children:"Warning:"})," We found existing patient(s) with the same name. This might be a duplicate entry. Please review and link if this is the same patient."]}),e.jsx("h6",{children:"Matching Patients:"}),ce.map(w=>e.jsx("div",{className:"card mb-2 p-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[w.first_name," ",w.last_name]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["Contact: ",w.contact_number||"N/A",e.jsx("br",{}),"Birthdate: ",w.birthdate?new Date(w.birthdate).toLocaleDateString("en-US",{month:"2-digit",day:"2-digit",year:"numeric"}):"N/A",e.jsx("br",{}),w.has_user_account&&e.jsxs("span",{className:"badge bg-success",children:["Has Online Account (",w.user_email,")"]})]})]}),e.jsx("button",{className:"btn btn-primary",onClick:async()=>{if(window.confirm(`Link this visit to ${w.first_name} ${w.last_name}?`))try{const O={target_patient_id:w.id};S.service_id&&(O.service_id=S.service_id),await M.post(`/api/visits/${z.id}/link-existing`,O),U(!1),T(null),await Pe(),alert("Visit successfully linked to existing patient!")}catch{alert("Failed to link visit to patient.")}},children:"Link to This Patient"})]})},w.id)),e.jsx("hr",{}),e.jsx("p",{className:"text-muted",children:e.jsx("small",{children:"If none of these patients match, you can close this dialog and the walk-in patient record will remain separate."})})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{className:"btn btn-secondary",onClick:()=>{U(!1),T(null)},children:"Keep as Separate Patient"})})]})})}),be&&e.jsx(Mi,{visit:be,onClose:()=>oe(null),onComplete:qe}),Y&&e.jsx(Li,{visit:Y,onClose:()=>F(null)}),re&&e.jsx(Fi,{visit:re,onClose:()=>V(null),onSuccess:w=>{console.log(`Visit code sent to Dr. ${w.dentist_name||w.dentist_code}`)}}),J&&ve&&e.jsx(zi,{visit:ve,onClose:()=>{ue(!1),Ce(null)},onSuccess:cs}),k&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"ðŸ“… Create Appointment for Walk-in Patient"}),e.jsx("button",{className:"btn-close",onClick:()=>K(!1)})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Patient Information"}),e.jsxs("div",{className:"form-check mb-3",children:[e.jsx("input",{className:"form-check-input",type:"checkbox",id:"linkToExisting",checked:D.linkToExisting,onChange:w=>Q(O=>({...O,linkToExisting:w.target.checked,patient_id:w.target.checked?O.patient_id:"",first_name:w.target.checked?"":O.first_name,last_name:w.target.checked?"":O.last_name,contact_number:w.target.checked?"":O.contact_number,email:w.target.checked?"":O.email,birthdate:w.target.checked?"":O.birthdate}))}),e.jsx("label",{className:"form-check-label",htmlFor:"linkToExisting",children:"Link to existing patient"})]}),D.linkToExisting?e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Search Existing Patient"}),e.jsx("input",{className:"form-control",placeholder:"Search by name or contact (min 2 characters)",value:L,onChange:async w=>{const O=w.target.value;if(E(O),W([]),Z(null),O.length>=2)try{const se=await M.get("/api/patients/search",{params:{q:O.trim()}});W(se.data)}catch{alert("Search failed.")}}}),I.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Select a patient:"}),I.map(w=>e.jsx("div",{className:"card p-2 mb-1 cursor-pointer",onClick:()=>{Q(O=>({...O,patient_id:w.id})),Z(w)},style:{cursor:"pointer",backgroundColor:D.patient_id===w.id?"#e3f2fd":"white"},children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs("div",{children:[e.jsxs("strong",{children:[w.first_name," ",w.last_name]}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:["Contact: ",w.contact_number||"N/A"," | Birthdate: ",w.birthdate?new Date(w.birthdate).toLocaleDateString():"N/A"]})]}),D.patient_id===w.id&&e.jsx("span",{className:"badge bg-primary",children:"Selected"})]})},w.id))]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"First Name *"}),e.jsx("input",{className:"form-control",value:D.first_name,onChange:w=>Q(O=>({...O,first_name:w.target.value}))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Last Name *"}),e.jsx("input",{className:"form-control",value:D.last_name,onChange:w=>Q(O=>({...O,last_name:w.target.value}))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Contact Number *"}),e.jsx("input",{className:"form-control",value:D.contact_number,onChange:w=>Q(O=>({...O,contact_number:w.target.value})),placeholder:"Required for SMS reminders"}),e.jsxs("div",{className:"form-text",children:[e.jsx("i",{className:"bi bi-phone me-1"}),"Required for SMS appointment reminders"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Email (Optional)"}),e.jsx("input",{type:"email",className:"form-control",value:D.email,onChange:w=>Q(O=>({...O,email:w.target.value}))})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Birthdate (Optional)"}),e.jsx("input",{type:"date",className:"form-control",value:D.birthdate,onChange:w=>{const O=w.target.value;Q(ie=>({...ie,birthdate:O}));const se=is(O);se&&alert(se)},max:ls()}),e.jsxs("div",{className:"form-text",children:["Must be at least 4 years old (dates after ",ls()," are not selectable)."]})]})]})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Appointment Details"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Date *"}),e.jsx("input",{type:"date",className:"form-control",value:D.date,onChange:w=>os(w.target.value),min:new Date().toISOString().slice(0,10),max:new Date(Date.now()+7*24*60*60*1e3).toISOString().slice(0,10),placeholder:"Select a date"}),e.jsxs("div",{className:"form-text",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),D.date?"You can only select dates up to 7 days from today":"Please select a date first to see available dentists and services"]})]}),D.date&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Available Dentists"}),We?e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-hourglass-split me-1"}),"Loading available dentists..."]}):Fe.length>0?e.jsxs("div",{className:"alert alert-info border-0 shadow-sm",children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("i",{className:"bi bi-person-check me-2"}),e.jsxs("strong",{children:[Fe.length," dentist",Fe.length!==1?"s":""," available"]})]}),e.jsx("span",{className:"badge bg-primary",children:Fe.length})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Available dentists:"}),e.jsx("div",{className:"mt-1",children:Fe.map((w,O)=>e.jsxs("span",{className:"badge bg-light text-dark me-1 mb-1",children:[w.dentist_name," (",w.dentist_code,")"]},O))})]})]}):e.jsxs("div",{className:"alert alert-warning border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No dentists available on this date"]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Service *"}),e.jsxs("select",{className:"form-select",value:D.service_id,onChange:w=>ms(w.target.value),disabled:!D.date,children:[e.jsx("option",{value:"",children:D.date?"Select a service":"Please select a date first"}),R.map(w=>e.jsxs("option",{value:w.id,children:[w.name," â€“"," ",w.type==="promo"?`â‚±${Number(w.promo_price).toLocaleString()} (${w.discount_percent}% off)`:w.type==="special"?`â‚±${Number(w.price).toLocaleString()} Special Service`:`â‚±${Number(w.price).toLocaleString()}`,w.per_teeth_service?" per tooth":""]},w.id))]}),!D.date&&e.jsxs("div",{className:"form-text text-muted",children:[e.jsx("i",{className:"bi bi-lock me-1"}),"Please select a date first to enable service selection"]})]}),Ne&&e.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",role:"alert",children:e.jsx("div",{className:"d-flex align-items-center justify-content-between flex-wrap",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service Selected:"}),e.jsx("br",{}),e.jsx("span",{className:"fs-5",children:Ne.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-info fw-semibold",children:["â‚±",Number(Ne.price||Ne.promo_price).toLocaleString(),Ne.per_teeth_service?" per tooth":""]}),Ne.per_teeth_service&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})})]})]})})}),Ne&&Ne.per_teeth_service&&e.jsx("div",{className:"alert alert-warning border-0 shadow-sm mb-4",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-lightbulb me-3 fs-4 text-warning"}),e.jsxs("div",{children:[e.jsxs("h6",{className:"alert-heading text-warning mb-2",children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Per-Teeth Service Information"]}),e.jsx("p",{className:"mb-2",children:"For per-teeth services, please enter the number of teeth that need treatment. This will determine:"}),e.jsxs("ul",{className:"mb-2 ps-3",children:[e.jsx("li",{children:"Appointment duration"}),e.jsx("li",{children:"Available time slots"}),e.jsx("li",{children:"Accurate cost calculation"})]})]})]})}),Ne&&Ne.per_teeth_service&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label",children:["Number of Teeth to be Treated *",e.jsx("span",{className:"text-muted ms-1",children:"(Required for per-teeth services)"})]}),e.jsxs("div",{className:"position-relative",children:[e.jsx("input",{type:"number",min:"1",max:"32",className:"form-control",value:D.teeth_count,onChange:w=>{const O=w.target.value;(O===""||parseInt(O)>=1&&parseInt(O)<=32)&&as(O)},placeholder:"Select or enter number of teeth",style:{paddingRight:"60px"}}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary position-absolute top-50 end-0 translate-middle-y me-2",onClick:()=>{const w=document.getElementById("teethCountModal");w&&(new bootstrap.Modal(w).show(),setTimeout(()=>{const se=w.querySelector(".teeth-roulette"),ie=w.querySelector(`[data-teeth="${D.teeth_count}"]`);if(se&&ie&&D.teeth_count){const pe=ie.offsetTop,Ee=se.clientHeight,fe=ie.clientHeight;se.scrollTop=pe-Ee/2+fe/2}},300))},style:{height:"32px",width:"40px",padding:"0"},children:e.jsx("i",{className:"bi bi-chevron-down"})})]}),e.jsx("div",{className:"modal fade",id:"teethCountModal",tabIndex:"-1","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Select Number of Teeth"]}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal"})]}),e.jsx("div",{className:"modal-body p-0",children:e.jsx("div",{className:"teeth-roulette",style:{height:"200px",overflowY:"auto",padding:"10px",scrollBehavior:"smooth",touchAction:"pan-y",WebkitOverflowScrolling:"touch"},onScroll:w=>{w.target.scrollTop=Math.round(w.target.scrollTop/50)*50},onTouchStart:w=>{w.target.style.backgroundColor="#f8f9fa"},onTouchEnd:w=>{setTimeout(()=>{w.target.style.backgroundColor="transparent"},150)},children:Array.from({length:32},(w,O)=>O+1).map(w=>e.jsx("div",{"data-teeth":w,className:`teeth-option d-flex align-items-center justify-content-center p-3 border-bottom cursor-pointer ${D.teeth_count==w?"bg-primary text-white":"bg-light"}`,onClick:()=>{as(w.toString());const O=document.getElementById("teethCountModal");O&&bootstrap.Modal.getInstance(O).hide()},style:{minHeight:"50px",cursor:"pointer",transition:"all 0.2s ease",userSelect:"none"},onMouseEnter:O=>{D.teeth_count!=w&&(O.target.style.backgroundColor="#e9ecef")},onMouseLeave:O=>{D.teeth_count!=w&&(O.target.style.backgroundColor="#f8f9fa")},children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"fs-4 fw-bold",children:w}),e.jsx("div",{className:"small",children:w===1?"tooth":"teeth"}),D.teeth_count==w&&e.jsx("div",{className:"small",children:e.jsx("i",{className:"bi bi-check-circle-fill"})})]})},w))})}),e.jsx("div",{className:"modal-footer",children:e.jsx("div",{className:"w-100 text-center",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Swipe to scroll â€¢ Tap to select â€¢ Max 32 teeth"]})})})]})})}),e.jsxs("div",{className:"form-text",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Enter the number of teeth that need treatment. Time slots will be calculated based on this.",D.teeth_count&&e.jsxs("div",{className:"mt-1",children:[e.jsx("strong",{children:"Estimated cost:"})," â‚±",Number(Ne.price||Ne.promo_price)*parseInt(D.teeth_count||0).toLocaleString()]})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Time Slot *"}),xe?e.jsx("div",{className:"text-muted",children:"Loading available slots..."}):ae.length>0?e.jsxs("select",{className:"form-select",value:D.start_time,onChange:w=>Q(O=>({...O,start_time:w.target.value})),children:[e.jsx("option",{value:"",children:"Select time slot"}),ae.map(w=>e.jsx("option",{value:w,children:w},w))]}):D.service_id&&D.date?e.jsx("div",{className:"text-muted",children:Ne&&Ne.per_teeth_service&&!D.teeth_count?"Please enter number of teeth first to see available time slots.":"No available slots for this service on this date."}):e.jsx("div",{className:"text-muted",children:D.date?D.service_id?"Please select service and date first.":"Please select a service first.":"Please select a date first."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Payment Method *"}),e.jsxs("select",{className:"form-select",value:D.payment_method,onChange:w=>Q(O=>({...O,payment_method:w.target.value})),disabled:!D.date||!D.service_id,children:[e.jsx("option",{value:"cash",children:"Cash"}),e.jsx("option",{value:"maya",children:"Maya Payment"}),e.jsx("option",{value:"hmo",children:"HMO"})]}),(!D.date||!D.service_id)&&e.jsxs("div",{className:"form-text text-muted",children:[e.jsx("i",{className:"bi bi-lock me-1"}),"Please select date and service first to enable payment method selection"]})]}),D.payment_method==="hmo"&&e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"HMO (Optional)"}),e.jsx("select",{className:"form-select",value:D.patient_hmo_id,onChange:w=>Q(O=>({...O,patient_hmo_id:w.target.value})),children:e.jsx("option",{value:"",children:"No HMO selected"})})]})]})]})}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{className:"btn btn-secondary",onClick:()=>K(!1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:hs,disabled:ke,children:ke?"Creating...":"Create Appointment"})]})]})})}),e.jsx(Ti,{show:Ae,onClose:()=>rs(!1)})]})}const Ei=Object.freeze(Object.defineProperty({__proto__:null,default:Ia},Symbol.toStringTag,{value:"Module"}));function $i(){const s=Se(),[l,a]=t.useState(null),{logout:i}=Me();t.useEffect(()=>{M.get("/api/user").then(o=>a(o.data)).catch(()=>a(null))},[]);const n=async()=>{await i(),s("/")};return e.jsx(e.Fragment,{children:e.jsx("nav",{className:"navbar navbar-expand-lg navbar-light shadow-sm px-3",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)"},children:e.jsxs("div",{className:"container-fluid",children:[e.jsxs(ye,{className:"navbar-brand d-flex align-items-center",to:"/patient",children:[e.jsx("img",{src:us,alt:"Kreative Dental Clinic",style:{height:"32px",width:"32px",objectFit:"contain",marginRight:"8px"}}),e.jsx("span",{className:"fst-bold",style:{color:"white"},children:"Kreative Dental & Orthodontics"})]}),e.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#patientNavbarNav","aria-controls":"patientNavbarNav","aria-expanded":"false","aria-label":"Toggle navigation",children:e.jsx("span",{className:"navbar-toggler-icon"})}),e.jsx("div",{className:"collapse navbar-collapse",id:"patientNavbarNav",children:e.jsxs("div",{className:"navbar-nav ms-auto align-items-lg-center",children:[e.jsxs(ye,{to:"/patient",className:"nav-link",style:{color:"white"},children:[e.jsx("i",{className:"bi bi-house me-1"}),e.jsx("span",{children:"Home"})]}),l&&e.jsx(Fs,{}),l&&e.jsxs("button",{onClick:n,className:"btn btn-sm ms-lg-3 mt-2 mt-lg-0 d-flex align-items-center",style:{background:"linear-gradient(90deg, #0077b6 0%, #00b4d8 100%)",color:"white",border:"none",fontWeight:"600",padding:"0.5rem 1.2rem",borderRadius:"50px",boxShadow:"0 4px 12px rgba(0, 119, 182, 0.3)",transition:"all 0.3s ease",fontSize:"0.9rem",letterSpacing:"0.5px"},onMouseEnter:o=>{o.target.style.background="linear-gradient(90deg, #0056b3 0%, #0096c7 100%)",o.target.style.transform="translateY(-2px)",o.target.style.boxShadow="0 6px 16px rgba(0, 119, 182, 0.4)"},onMouseLeave:o=>{o.target.style.background="linear-gradient(90deg, #0077b6 0%, #00b4d8 100%)",o.target.style.transform="translateY(0)",o.target.style.boxShadow="0 4px 12px rgba(0, 119, 182, 0.3)"},children:[e.jsx("i",{className:"bi bi-lock-fill me-2",style:{fontSize:"0.9rem",color:"#dc3545"}}),e.jsx("span",{children:"LOG OUT"})]})]})})]})})})}function Ii({show:s}){const{user:l,setUser:a}=Me(),[i,n]=t.useState(""),[o,r]=t.useState(!1),[c,m]=t.useState(null);if(t.useEffect(()=>{s&&(n(""),m(null))},[s,l==null?void 0:l.email]),!s||!l)return null;const b=l.email||"",f=async y=>{var u,P,g,_,N,x,p;if(y.preventDefault(),o)return;r(!0),m(null);const h=i.trim(),j=h?{email:h}:{};try{await M.get("/sanctum/csrf-cookie");const{data:C}=await M.post("/api/patient/verification/resend",j);Ge.success(C.message||"Verification email sent!",{style:{background:"#0d6efd",color:"#fff",borderRadius:"8px",padding:"14px"}}),a(v=>v&&{...v,email:C.email??v.email,email_verified_at:null}),h&&n("")}catch(C){if(((u=C.response)==null?void 0:u.status)===422){const v=(N=(_=(g=(P=C.response)==null?void 0:P.data)==null?void 0:g.errors)==null?void 0:_.email)==null?void 0:N[0];m(v||"Please enter a valid email address.")}else m(((p=(x=C.response)==null?void 0:x.data)==null?void 0:p.message)||"We couldn't send the verification email. Please try again.")}finally{r(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"modal show fade",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.65)"},tabIndex:"-1","aria-modal":"true",role:"dialog",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsx("div",{className:"modal-header bg-warning text-dark",children:e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-envelope-check"}),"Verify Your Email"]})}),e.jsxs("div",{className:"modal-body",children:[e.jsx("p",{className:"text-muted",children:"We sent a verification link to your email. Please verify your email address to continue booking appointments and accessing your records."}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Current email on file"}),e.jsxs("div",{className:"input-group",children:[e.jsx("span",{className:"input-group-text",children:e.jsx("i",{className:"bi bi-at"})}),e.jsx("input",{type:"email",className:"form-control",value:b,readOnly:!0})]})]}),e.jsxs("form",{onSubmit:f,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"newEmail",className:"form-label fw-semibold",children:"Update email (optional)"}),e.jsx("input",{id:"newEmail",type:"email",className:`form-control ${c?"is-invalid":""}`,placeholder:"Enter a new email address",value:i,onChange:y=>n(y.target.value)}),e.jsx("div",{className:"form-text",children:"Leave blank to resend the link to your current email."}),c&&e.jsx("div",{className:"invalid-feedback",children:c})]}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",disabled:o,children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Sending..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-send me-2"}),"Send Verification Email"]})}),e.jsxs("p",{className:"small text-muted text-center mb-0",children:["Need help? Contact us at"," ",e.jsx("a",{href:"mailto:kreativedent@gmail.com",children:"kreativedent@gmail.com"})]})]})]})]})]})})}),e.jsx("div",{className:"modal-backdrop fade show"})]})}function Vi(){const s=ss(),l=Se(),{user:a}=Me(),{loading:i,accepting:n,error:o,policy:r,shouldShowModal:c,accept:m,dismissModal:b}=Ca();t.useEffect(()=>{if(a&&a.role!=="patient"){const h=a.role==="admin"?"/admin":a.role==="staff"?"/staff":a.role==="dentist"?"/dentist":"/";l(h,{replace:!0})}},[a,l]);const f=s.pathname==="/patient"||s.pathname==="/patient/",y=a&&a.role==="patient"&&!a.email_verified_at;return e.jsxs("div",{className:"d-flex flex-column min-vh-100 bg-light patient-layout",children:[e.jsx(ks,{position:"top-center"}),e.jsx($i,{}),f?e.jsx("main",{className:"flex-grow-1",children:e.jsx(fs,{})}):e.jsx("main",{className:"flex-grow-1 py-4",children:e.jsx("div",{className:"container-fluid px-2 px-md-3 px-lg-4",children:e.jsx(fs,{})})}),c&&e.jsx("div",{className:"modal show fade",style:{display:"block",backgroundColor:"rgba(0, 0, 0, 0.5)"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header bg-primary text-white",children:[e.jsxs("h5",{className:"modal-title d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-shield-lock"}),"Updated Terms & Privacy Policy"]}),e.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:b,disabled:n})]}),e.jsxs("div",{className:"modal-body",children:[o&&e.jsx("div",{className:"alert alert-danger",role:"alert",children:o}),i?e.jsx("div",{className:"text-center py-4",children:e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-muted mb-3",children:["Weâ€™ve updated our Terms & Conditions and Privacy Policy. Please review the latest version and click ",e.jsx("strong",{children:"Accept & Agree"})," to continue booking new appointments."]}),(r==null?void 0:r.effective_date)&&e.jsxs("p",{className:"small text-muted",children:[e.jsx("strong",{children:"Effective Date:"})," ",new Date(r.effective_date).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"fw-bold mb-2 d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-shield-check text-primary"}),"Privacy Policy"]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"220px",overflowY:"auto",whiteSpace:"pre-wrap"},children:(r==null?void 0:r.privacy_policy)||"No privacy policy content available."})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"fw-bold mb-2 d-flex align-items-center gap-2",children:[e.jsx("i",{className:"bi bi-file-earmark-text text-primary"}),"Terms and Conditions"]}),e.jsx("div",{className:"border rounded p-3 bg-light",style:{maxHeight:"220px",overflowY:"auto",whiteSpace:"pre-wrap"},children:(r==null?void 0:r.terms_conditions)||"No terms and conditions content available."})]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("strong",{children:"Need help?"})," If you have any questions, you can reach us at"," ",e.jsx("a",{href:`mailto:${(r==null?void 0:r.contact_email)||"kreativedent@gmail.com"}`,children:(r==null?void 0:r.contact_email)||"kreativedent@gmail.com"})," ","or call"," ",e.jsx("a",{href:`tel:${(r==null?void 0:r.contact_phone)||"09277592845"}`,children:(r==null?void 0:r.contact_phone)||"0927 759 2845"}),"."]})]})]}),e.jsxs("div",{className:"modal-footer d-flex justify-content-between",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:b,disabled:n,children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:m,disabled:n||i,children:n?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check2-circle me-2"}),"Accept & Agree"]})})]})]})})}),c&&e.jsx("div",{className:"modal-backdrop fade show"}),e.jsx(Ii,{show:y})]})}function Bs({show:s,onConfirm:l,onCancel:a,title:i,message:n,confirmText:o="Confirm",cancelText:r="Cancel",variant:c="danger"}){return s?e.jsx("div",{className:"confirmation-modal-overlay",onClick:a,children:e.jsxs("div",{className:"confirmation-modal-content",onClick:m=>m.stopPropagation(),children:[e.jsxs("div",{className:"confirmation-modal-header",children:[e.jsx("i",{className:`bi bi-exclamation-triangle-fill text-${c} me-2`}),e.jsx("h5",{className:"confirmation-modal-title",children:i||"Confirm Action"})]}),e.jsx("div",{className:"confirmation-modal-body",children:e.jsx("p",{children:n})}),e.jsxs("div",{className:"confirmation-modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-outline-secondary",onClick:a,children:r}),e.jsx("button",{type:"button",className:`btn btn-${c}`,onClick:l,children:o})]})]})}):null}function Hi(){var I;const{user:s,authLoading:l}=Me(),[a,i]=t.useState([]),[n,o]=t.useState(!0),[r,c]=t.useState(null),[m,b]=t.useState(null),[f,y]=t.useState(!1),[h,j]=t.useState(null),[u,P]=t.useState([]),[g,_]=t.useState(!1),[N,x]=t.useState(null),[p,C]=t.useState(null),v=!!(s!=null&&s.email_verified_at);if(t.useEffect(()=>{if(!l){if(!s||!v){i([]),P([]),o(!1);return}o(!0),A(),z()}},[l,v]),l)return e.jsx(ze,{message:"Loading dashboard..."});const A=async()=>{var W;try{const B=await M.get("/api/user-appointments?page=1&limit=3");i(B.data.data||[])}catch(B){((W=B.response)==null?void 0:W.status)!==403&&console.error("Failed to fetch appointments",B)}finally{o(!1)}},z=async()=>{var W,B;try{const Z=await M.get("/api/refunds/pending-claims");P(((W=Z.data)==null?void 0:W.data)||[])}catch(Z){((B=Z.response)==null?void 0:B.status)!==403&&console.error("Failed to fetch pending refunds",Z)}},T=u.length?[...u].sort((W,B)=>W.deadline_at?B.deadline_at?new Date(W.deadline_at)-new Date(B.deadline_at):-1:1)[0]:null,S=()=>{const W=new Date().getHours();return W<12?"Good Morning":W<18?"Good Afternoon":"Good Evening"},d=W=>({approved:"success",pending:"warning",rejected:"danger",cancelled:"secondary",completed:"primary"})[W]||"secondary",R=W=>({paid:"success",awaiting_payment:"warning",failed:"danger",refunded:"info"})[W]||"secondary",H=async W=>{var B,Z,te,ne,be;try{c(W),await M.get("/sanctum/csrf-cookie");const{data:oe}=await M.post("/api/maya/payments",{appointment_id:W},{skip401Handler:!0});oe!=null&&oe.redirect_url?window.location.href=oe.redirect_url:Ge.error("Payment link not available. Please try again.",{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}catch(oe){console.error("Create Maya payment failed",oe);const Y=((Z=(B=oe.response)==null?void 0:B.data)==null?void 0:Z.message)||((be=(ne=(te=oe.response)==null?void 0:te.data)==null?void 0:ne.maya)==null?void 0:be.message)||"Unable to start payment. Please try again.";Ge.error(Y,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}finally{c(null)}},G=W=>{j(W),y(!0)},$=async()=>{var W,B;if(h)try{b(h),y(!1),await M.get("/sanctum/csrf-cookie"),await M.post(`/api/appointment/${h}/cancel`),Ge.success("Appointment cancelled successfully!",{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px"},duration:4e3}),A(),j(null)}catch(Z){console.error("Cancel appointment failed",Z);const te=((B=(W=Z.response)==null?void 0:W.data)==null?void 0:B.message)||"Unable to cancel appointment. Please try again.";Ge.error(te,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}finally{b(null)}},L=W=>{x(W),_(!0)},E=async()=>{var W,B;if(!(!N||p))try{C(N.id),await M.get("/sanctum/csrf-cookie"),await M.post(`/api/refunds/${N.id}/confirm`),Ge.success("Thanks! We've marked your refund as claimed.",{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px"},duration:4e3}),await z(),P(Z=>Z.filter(te=>te.id!==N.id)),_(!1),x(null)}catch(Z){console.error("Confirm refund failed",Z);const te=((B=(W=Z.response)==null?void 0:W.data)==null?void 0:B.message)||"Unable to confirm refund right now. Please try again.";Ge.error(te,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}finally{C(null)}};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx(ks,{position:"top-center"}),s&&!v&&e.jsxs("div",{className:"alert alert-warning d-flex align-items-center gap-2 mb-4",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill fs-4"}),e.jsx("div",{children:"Please verify your email address to unlock full access. A verification modal is displayed with options to resend or update your email."})]}),e.jsx(Bs,{show:f,onConfirm:$,onCancel:()=>{y(!1),j(null)},title:"Cancel Appointment",message:"Are you sure you want to cancel this appointment?",confirmText:"Yes, Cancel",cancelText:"No, Keep It",variant:"danger"}),e.jsx(Bs,{show:g,onConfirm:E,onCancel:()=>{_(!1),x(null)},title:"Confirm Refund Received",message:"This action cannot be undone. Please confirm only if you have already received your refund.",confirmText:p?"Confirming...":"Yes, I picked it up",cancelText:"Not yet",variant:"primary"}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white"},children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h1",{className:"h3 mb-2",children:[S(),", ",((I=s==null?void 0:s.name)==null?void 0:I.split(" ")[0])||"Patient","! ðŸ‘‹"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Welcome to your dental care dashboard. Manage your appointments, view your profile, and stay updated with your dental health journey."}),T&&e.jsx("div",{className:"alert alert-warning bg-white text-dark mt-3 mb-0 shadow-sm border-0",children:e.jsxs("div",{className:"d-flex align-items-start gap-3",children:[e.jsx("i",{className:"bi bi-cash-coin fs-3 text-warning"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Refund waiting for pickup!"}),e.jsxs("div",{children:["Please visit the clinic to claim â‚±",Number(T.refund_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})," ","on or before"," ",T.formatted_deadline||(T.deadline_at?new Date(T.deadline_at).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"N/A"),". Tap the â€œRefundedâ€ button below once you've picked it up so we can update our records."]}),T.service_name&&e.jsxs("small",{className:"text-muted",children:["Service: ",T.service_name]})]})]})})]}),e.jsx("div",{className:"col-md-4 text-md-end",children:e.jsxs("div",{className:"d-flex flex-column align-items-md-end",children:[e.jsx("div",{className:"mb-2",children:e.jsx("i",{className:"bi bi-calendar-check fs-1 opacity-50"})}),e.jsxs("small",{className:"opacity-75",children:["Last login: ",new Date().toLocaleDateString()]})]})})]})})})})}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-12",children:e.jsx("h2",{className:"h4 mb-3",children:"Quick Actions"})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(ye,{to:"/patient/appointment",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar-plus fs-1 text-primary"})}),e.jsx("h5",{className:"card-title text-dark",children:"Book Appointment"}),e.jsx("p",{className:"card-text text-muted",children:"Schedule your next dental visit with our experienced team"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-plus-circle me-2"}),"Book Now"]})]})})})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(ye,{to:"/patient/appointments",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar3 fs-1 text-success"})}),e.jsx("h5",{className:"card-title text-dark",children:"My Appointments"}),e.jsx("p",{className:"card-text text-muted",children:"View and manage your upcoming and past appointments"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-list-ul me-2"}),"View All"]})]})})})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(ye,{to:"/patient/profile",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-person-circle fs-1 text-info"})}),e.jsx("h5",{className:"card-title text-dark",children:"My Profile"}),e.jsx("p",{className:"card-text text-muted",children:"Update your personal information and HMO details"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Manage"]})]})})})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-white border-0 pb-0",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h3",{className:"h5 mb-0",children:"Recent Appointments"}),e.jsx(ye,{to:"/patient/appointments",className:"btn btn-sm",style:{border:"2px solid #00b4d8",color:"#00b4d8",background:"transparent"},children:"View All"})]})}),e.jsx("div",{className:"card-body",children:n?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"mt-2 text-muted",children:"Loading appointments..."})]}):a.length===0?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"bi bi-calendar-x fs-1 text-muted"}),e.jsx("p",{className:"mt-2 text-muted",children:"No appointments yet"}),e.jsx(ye,{to:"/patient/appointment",className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:"Book Your First Appointment"})]}):e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Appointment Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:a.map(W=>{var Z,te;const B=u.find(ne=>ne.appointment_id===W.id);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:W.date}),e.jsx("small",{className:"text-muted",children:W.start_time})]})}),e.jsxs("td",{children:[e.jsx("div",{className:"fw-medium",children:((Z=W.service)==null?void 0:Z.name)||"â€”"}),e.jsx("small",{className:"text-muted",children:W.payment_method})]}),e.jsx("td",{children:e.jsx("span",{className:`badge bg-${R(W.payment_status)}`,children:((te=W.payment_status)==null?void 0:te.replace("_"," "))||"â€”"})}),e.jsx("td",{children:e.jsx("span",{className:`badge bg-${d(W.status)}`,children:W.status})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-2",children:[W.payment_method==="maya"&&W.payment_status==="awaiting_payment"&&W.status==="approved"&&e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>H(W.id),disabled:r===W.id||m===W.id,children:r===W.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Redirecting..."]}):"Pay Now"}),W.payment_method==="maya"&&W.payment_status==="refunded"&&B&&e.jsx("button",{className:"btn btn-sm btn-outline-info",onClick:()=>L(B),disabled:p===B.id,children:p===B.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check2-circle me-1"}),"Refunded"]})}),(W.status==="pending"||W.status==="approved"&&(W.payment_status==="unpaid"||W.payment_status==="awaiting_payment"))&&e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>G(W.id),disabled:m===W.id||r===W.id,children:m===W.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Canceling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})})]})})]},W.id)})})]})})})]})})}),e.jsx("div",{className:"row mt-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm bg-light",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h4",{className:"h5 mb-2",children:[e.jsx("i",{className:"bi bi-lightbulb text-warning me-2"}),"Dental Health Tip"]}),e.jsx("p",{className:"mb-0 text-muted",children:"Remember to brush your teeth twice daily and floss regularly. Regular dental check-ups help maintain optimal oral health!"})]}),e.jsx("div",{className:"col-md-4 text-md-end",children:e.jsx("i",{className:"bi bi-tooth fs-1 opacity-25",style:{color:"#00b4d8"}})})]})})})})}),e.jsx("style",{jsx:!0,children:`
        .hover-lift {
          transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .hover-lift:hover {
          transform: translateY(-5px);
          box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
      `})]})}function Wi({patientId:s,value:l,onChange:a,disabled:i=!1,required:n=!1}){const[o,r]=t.useState([]),[c,m]=t.useState(!1),[b,f]=t.useState("");t.useEffect(()=>{if(!s)return;let h=!0;return(async()=>{m(!0),f("");try{const{data:j}=await M.get(`/api/patients/${s}/hmos`);h&&r(Array.isArray(j)?j:[])}catch(j){h&&f(Bi(j))}finally{h&&m(!1)}})(),()=>{h=!1}},[s]);const y=t.useMemo(()=>(Array.isArray(o)?o:[]).sort((j,u)=>j.is_primary&&!u.is_primary?-1:!j.is_primary&&u.is_primary?1:(j.provider_name||"").localeCompare(u.provider_name||"")),[o]);return e.jsxs("div",{children:[e.jsxs("label",{className:"text-sm text-zinc-700 dark:text-zinc-200",children:["HMO to use ",n&&e.jsx("span",{className:"text-red-600",children:"*"})]}),e.jsxs("div",{className:"mt-1",children:[c?e.jsx("div",{className:"text-sm text-zinc-500",children:"Loading HMOsâ€¦"}):b?e.jsx("div",{className:"text-sm text-red-600",children:b}):e.jsxs("select",{className:"w-full rounded-xl border border-zinc-300 dark:border-zinc-700 bg-transparent p-2 text-sm focus:outline-none focus:ring-2 focus:ring-zinc-400",value:l??"",onChange:h=>a(h.target.value?Number(h.target.value):null),disabled:i||y.length===0,children:[e.jsx("option",{value:"",children:"â€” Self-pay / No HMO â€”"}),y.map(h=>e.jsxs("option",{value:h.id,children:[h.provider_name," - ",h.hmo_number,h.is_primary?" (Primary)":"",h.patient_fullname_on_card?` - ${h.patient_fullname_on_card}`:""]},h.id))]}),y.length===0&&!c&&!b&&e.jsx("div",{className:"text-xs mt-1 text-zinc-500",children:"No HMO available. Add or update HMO in profile first."})]})]})}function Bi(s){var l,a;return((a=(l=s==null?void 0:s.response)==null?void 0:l.data)==null?void 0:a.message)||(s==null?void 0:s.message)||"Request failed"}function Oi({isOpen:s,onClose:l,services:a,loading:i,error:n,onServiceSelect:o,selectedDate:r,selectedService:c}){const[m,b]=t.useState(""),[f,y]=t.useState("grid"),[h,j]=t.useState(null),u=p=>p?new Date(p).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}):"",P=t.useMemo(()=>!m.trim()||m.length<2?a:a.filter(p=>p.name.toLowerCase().includes(m.toLowerCase())),[a,m]),g=p=>{const C=p.target.value;b(C),h&&clearTimeout(h),C.length===0||C.length>=2},_=()=>{b("")},N=p=>{c&&c.id===p.id?y("grid"):(o(p),y("single"))},x=()=>{y("grid")};return e.jsxs(bs,{open:s,onClose:l,title:e.jsxs("div",{className:"d-flex flex-column",children:[e.jsx("span",{className:"h3 mb-1 fw-bold",children:"Available Services"}),e.jsx("small",{className:"text-muted fs-6",children:u(r)})]}),maxWidth:"xl",children:[e.jsxs("div",{className:"container-fluid px-0",children:[i&&e.jsx("div",{className:"text-center py-5",children:e.jsx(ze,{message:"Loading available services..."})}),n&&e.jsx("div",{className:"alert alert-danger border-0 rounded-3 shadow-sm",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-3 fs-5"}),e.jsxs("div",{children:[e.jsx("h6",{className:"alert-heading mb-1",children:"Error Loading Services"}),e.jsx("p",{className:"mb-0",children:n})]})]})}),!i&&!n&&a.length===0&&e.jsx("div",{className:"text-center py-5",children:e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar-x display-1 d-block mb-3 text-muted"}),e.jsx("h4",{className:"fw-normal",children:"No services available"}),e.jsx("p",{className:"lead",children:"There are no available services for the selected date."})]})}),!i&&!n&&a.length>0&&e.jsx(e.Fragment,{children:f==="single"&&c?e.jsxs("div",{className:"single-service-view",children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex align-items-center gap-3",children:[e.jsxs("button",{className:"btn btn-outline-primary",onClick:x,children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to All Services"]}),e.jsx("div",{className:"alert alert-success border-0 rounded-3 shadow-sm mb-0 flex-grow-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle-fill text-success me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("h5",{className:"alert-heading mb-1 text-success",children:"Selected Service"}),e.jsx("p",{className:"mb-0 text-muted",children:"Click to change or confirm selection"})]})]})})]})})}),e.jsx("div",{className:"row justify-content-center",children:e.jsx("div",{className:"col-12 col-md-10 col-lg-8 col-xl-6",children:e.jsx("div",{className:"card border-0 shadow-lg selected-service-card",children:e.jsxs("div",{className:"card-body p-4 p-md-5 text-center",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h2",{className:"card-title fw-bold text-dark mb-4",style:{fontSize:"clamp(1.5rem, 4vw, 2.5rem)",lineHeight:"1.3",wordWrap:"break-word",overflowWrap:"break-word"},children:c.name}),c.type==="promo"&&e.jsxs("div",{className:"pricing-section-large",children:[e.jsxs("div",{className:"d-flex justify-content-center align-items-center mb-3",children:[e.jsxs("span",{className:"text-muted text-decoration-line-through me-3 fs-5",children:["â‚±",Number(c.original_price).toLocaleString(),c.per_teeth_service?" per tooth":""]}),e.jsxs("span",{className:"badge bg-danger fs-6",children:[c.discount_percent,"% OFF"]})]}),e.jsxs("div",{className:"display-6 text-success fw-bold mb-0",style:{fontSize:"clamp(2rem, 5vw, 3rem)",lineHeight:"1.2",wordWrap:"break-word"},children:["â‚±",Number(c.promo_price).toLocaleString(),c.per_teeth_service?" per tooth":""]}),c.per_teeth_service&&e.jsx("div",{className:"text-center mt-2",children:e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})})]}),c.type==="special"&&e.jsxs("div",{className:"pricing-section-large",children:[e.jsxs("div",{className:"display-6 text-info fw-bold mb-3",style:{fontSize:"clamp(2rem, 5vw, 3rem)",lineHeight:"1.2",wordWrap:"break-word"},children:["â‚±",Number(c.price).toLocaleString(),c.per_teeth_service?" per tooth":""]}),e.jsx("span",{className:"badge bg-info fs-6",children:"Special Service"}),c.per_teeth_service&&e.jsx("div",{className:"text-center mt-2",children:e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})})]}),c.type==="regular"&&e.jsxs("div",{className:"pricing-section-large",children:[e.jsxs("div",{className:"display-6 text-dark fw-bold mb-0",style:{fontSize:"clamp(2rem, 5vw, 3rem)",lineHeight:"1.2",wordWrap:"break-word"},children:["â‚±",Number(c.price).toLocaleString(),c.per_teeth_service?" per tooth":""]}),c.per_teeth_service&&e.jsx("div",{className:"text-center mt-2",children:e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})})]})]}),e.jsxs("div",{className:"d-grid gap-3",children:[e.jsxs("button",{className:"btn btn-success btn-lg fw-bold",onClick:()=>{o(c),l()},style:{padding:"1rem 2rem",fontSize:"1.1rem",borderRadius:"12px",whiteSpace:"nowrap"},children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Confirm Selection"]}),e.jsxs("button",{className:"btn btn-outline-primary btn-lg",onClick:x,style:{padding:"0.8rem 1.5rem",fontSize:"1rem",borderRadius:"12px",whiteSpace:"nowrap"},children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Choose Different Service"]})]})]})})})})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center gap-3",children:e.jsx("div",{className:"alert alert-light border-0 rounded-3 shadow-sm mb-0 flex-grow-1",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-info-circle-fill text-primary me-3 fs-4"}),e.jsxs("div",{children:[e.jsxs("h5",{className:"alert-heading mb-1 text-primary",children:[P.length," of ",a.length," services available"]}),e.jsxs("p",{className:"mb-0 text-muted",children:["For ",u(r)]})]})]})})})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"position-relative",children:e.jsxs("div",{className:"input-group input-group-lg",children:[e.jsx("span",{className:"input-group-text bg-light border-end-0",children:e.jsx("i",{className:"bi bi-search text-muted"})}),e.jsx("input",{type:"text",className:"form-control border-start-0 ps-0",placeholder:"Search services by name... (min 2 characters)",value:m,onChange:g,style:{fontSize:"1.1rem"}}),m&&e.jsx("button",{className:"btn btn-outline-secondary border-start-0",type:"button",onClick:_,title:"Clear search",children:e.jsx("i",{className:"bi bi-x-lg"})})]})})})}),m.length>0&&m.length<2?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-info-circle display-4 text-warning d-block mb-3"}),e.jsx("h4",{className:"text-warning",children:"Please enter at least 2 characters"}),e.jsx("p",{className:"text-muted fs-5",children:"Type more characters to search for services"}),e.jsx("button",{className:"btn btn-outline-primary btn-lg",onClick:_,children:"Clear Search"})]}):P.length===0&&m?e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-search display-4 text-muted d-block mb-3"}),e.jsx("h4",{className:"text-muted",children:"No services found"}),e.jsx("p",{className:"text-muted fs-5",children:"Try adjusting your search terms"}),e.jsx("button",{className:"btn btn-outline-primary btn-lg",onClick:_,children:"Clear Search"})]}):e.jsx("div",{className:"row g-3",children:P.map(p=>e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm service-card",children:e.jsxs("div",{className:"card-body d-flex align-items-center p-4",children:[e.jsxs("div",{className:"flex-grow-1 me-4",children:[e.jsx("h4",{className:"card-title fw-bold text-dark mb-2",children:p.name}),p.type==="promo"&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("span",{className:"text-muted text-decoration-line-through me-3",children:["â‚±",Number(p.original_price).toLocaleString(),p.per_teeth_service?" per tooth":""]}),e.jsxs("span",{className:"badge bg-danger me-3",children:[p.discount_percent,"% OFF"]}),e.jsxs("div",{className:"h4 text-success fw-bold mb-0",children:["â‚±",Number(p.promo_price).toLocaleString(),p.per_teeth_service?" per tooth":""]})]}),p.type==="special"&&e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"h4 text-info fw-bold me-3",children:["â‚±",Number(p.price).toLocaleString(),p.per_teeth_service?" per tooth":""]}),e.jsx("span",{className:"badge bg-info",children:"Special Service"})]}),p.type==="regular"&&e.jsxs("div",{className:"h4 text-dark fw-bold mb-0",children:["â‚±",Number(p.price).toLocaleString(),p.per_teeth_service?" per tooth":""]})]}),e.jsx("div",{className:"flex-shrink-0",children:e.jsxs("button",{className:"btn btn-primary btn-lg fw-semibold px-4",onClick:()=>N(p),children:[e.jsx("i",{className:"bi bi-check-circle-fill me-2"}),"Select Service"]})})]})})},`${p.id}-${p.type}`))}),e.jsx("div",{className:"row mt-5 pt-4 border-top",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{className:"text-muted",children:["Showing ",P.length," of ",a.length," services"]}),e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-lg",onClick:l,children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"Close"]})]})})})]})})]}),e.jsx("style",{jsx:!0,children:`
        .service-card {
          transition: all 0.3s ease-in-out;
          border-radius: 16px;
          overflow: hidden;
          cursor: pointer;
          min-height: 100px;
        }
        
        .service-card:hover {
          transform: translateY(-4px);
          box-shadow: 0 12px 40px rgba(0,0,0,0.15) !important;
        }
        
        .selected-service-card {
          border-radius: 20px;
          background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
        }
        
        .pricing-section {
          min-height: 60px;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
        
        .pricing-section-large {
          min-height: 120px;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
        
        .card-title {
          font-size: 1.3rem;
          line-height: 1.4;
          margin-bottom: 0.5rem;
        }
        
        .btn-primary {
          background: linear-gradient(135deg, #0d6efd 0%, #0b5ed7 100%);
          border: none;
          border-radius: 12px;
          padding: 14px 28px;
          font-weight: 600;
          letter-spacing: 0.5px;
          font-size: 1rem;
        }
        
        .btn-primary:hover {
          background: linear-gradient(135deg, #0b5ed7 0%, #0a58ca 100%);
          transform: translateY(-2px);
        }
        
        .btn-lg {
          padding: 16px 32px;
          font-size: 1.1rem;
          border-radius: 14px;
        }
        
        .input-group-lg .form-control {
          border-radius: 14px;
          border: 2px solid #e9ecef;
          transition: all 0.3s ease;
          font-size: 1.1rem;
          padding: 16px 20px;
        }
        
        .input-group-lg .form-control:focus {
          border-color: #0d6efd;
          box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }
        
        .input-group-text {
          border-radius: 14px 0 0 14px;
          border: 2px solid #e9ecef;
          border-right: none;
          background: #f8f9fa;
          padding: 16px 20px;
        }
        
        .alert-light {
          background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        
        .badge {
          font-size: 0.8rem;
          padding: 0.6rem 0.9rem;
          border-radius: 10px;
          font-weight: 600;
        }
        
        /* Dynamic sizing based on screen width */
        @media (max-width: 576px) {
          .service-card .card-body {
            padding: 1.5rem;
            flex-direction: column;
            align-items: flex-start;
          }
          
          .service-card .flex-grow-1 {
            margin-right: 0;
            margin-bottom: 1rem;
          }
          
          .card-title {
            font-size: 1.1rem;
          }
          
          .h4 {
            font-size: 1.2rem;
          }
          
          .btn-lg {
            padding: 12px 24px;
            font-size: 0.95rem;
            width: 100%;
          }
          
          .input-group-lg .form-control {
            font-size: 1rem;
            padding: 14px 18px;
          }
          
          .input-group-text {
            padding: 14px 18px;
          }
        }
        
        @media (min-width: 577px) and (max-width: 768px) {
          .service-card .card-body {
            padding: 1.75rem;
          }
          
          .card-title {
            font-size: 1.2rem;
          }
          
          .h4 {
            font-size: 1.3rem;
          }
        }
        
        @media (min-width: 769px) and (max-width: 992px) {
          .service-card .card-body {
            padding: 2rem;
          }
          
          .card-title {
            font-size: 1.3rem;
          }
          
          .h4 {
            font-size: 1.4rem;
          }
        }
        
        @media (min-width: 993px) and (max-width: 1199px) {
          .service-card .card-body {
            padding: 2.25rem;
          }
          
          .card-title {
            font-size: 1.4rem;
          }
          
          .h4 {
            font-size: 1.5rem;
          }
        }
        
        @media (min-width: 1200px) {
          .service-card .card-body {
            padding: 2.5rem;
          }
          
          .card-title {
            font-size: 1.5rem;
          }
          
          .h4 {
            font-size: 1.6rem;
          }
          
          .btn-lg {
            padding: 18px 36px;
            font-size: 1.15rem;
          }
        }
        
        @media (min-width: 1400px) {
          .service-card .card-body {
            padding: 3rem;
          }
          
          .card-title {
            font-size: 1.6rem;
          }
          
          .h4 {
            font-size: 1.7rem;
          }
          
          .btn-lg {
            padding: 20px 40px;
            font-size: 1.2rem;
          }
        }
        
        /* Single service view responsive */
        .single-service-view .selected-service-card {
          max-width: 700px;
          margin: 0 auto;
          min-height: 400px;
        }
        
        .selected-service-card .card-body {
          min-height: 350px;
          display: flex;
          flex-direction: column;
          justify-content: center;
        }
        
        .pricing-section-large {
          min-height: 100px;
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
        }
        
        @media (max-width: 576px) {
          .single-service-view .selected-service-card .card-body {
            padding: 1.5rem !important;
            min-height: 300px;
          }
          
          .single-service-view h2 {
            font-size: 1.3rem !important;
            line-height: 1.4 !important;
          }
          
          .single-service-view .display-6 {
            font-size: 1.8rem !important;
            line-height: 1.3 !important;
          }
          
          .pricing-section-large {
            min-height: 80px;
          }
        }
        
        @media (min-width: 577px) and (max-width: 768px) {
          .single-service-view .selected-service-card .card-body {
            padding: 2rem !important;
            min-height: 350px;
          }
          
          .single-service-view h2 {
            font-size: 1.6rem !important;
            line-height: 1.3 !important;
          }
          
          .single-service-view .display-6 {
            font-size: 2.2rem !important;
            line-height: 1.2 !important;
          }
        }
        
        @media (min-width: 769px) {
          .single-service-view .selected-service-card .card-body {
            padding: 3rem !important;
            min-height: 400px;
          }
          
          .single-service-view h2 {
            font-size: 2rem !important;
            line-height: 1.3 !important;
          }
          
          .single-service-view .display-6 {
            font-size: 2.8rem !important;
            line-height: 1.2 !important;
          }
        }
      `})]})}function qi(){const s=new Date;return s.setDate(s.getDate()+1),s.toISOString().slice(0,10)}function Ui(){const s=new Date;return s.setDate(s.getDate()+7),s.toISOString().slice(0,10)}function Yi(s){return s===!0||s===1||s==="1"}function Ki(){const s=Se(),{needsAcceptance:l,reopenModal:a,loading:i}=Ca(),[n,o]=t.useState(""),[r,c]=t.useState([]),[m,b]=t.useState(!1),[f,y]=t.useState(""),[h,j]=t.useState(!1),[u,P]=t.useState(!1),[g,_]=t.useState(null),[N,x]=t.useState([]),[p,C]=t.useState(""),[v,A]=t.useState("cash"),[z,T]=t.useState(""),[S,d]=t.useState(""),[R,H]=t.useState(null),[G,$]=t.useState(null),[L,E]=t.useState(!1),[I,W]=t.useState(null),B=Yi(g==null?void 0:g.per_teeth_service);t.useEffect(()=>{let F=!0;return(async()=>{var q;E(!0);try{const{data:X}=await M.get("/api/user"),re=((q=X==null?void 0:X.patient)==null?void 0:q.id)??null;F&&re&&H(Number(re)),F&&(X!=null&&X.warning_status)&&(W({under_warning:!0,allowed_payment_methods:["maya"]}),A("maya"))}catch{}finally{F&&E(!1)}})(),()=>F=!1},[]),t.useEffect(()=>{l||T("")},[l]);const Z=async F=>{var q,X;b(!0),y("");try{const re=await M.get(`/api/appointment/available-services?date=${F}`);c(re.data)}catch(re){c([]),y(((X=(q=re==null?void 0:re.response)==null?void 0:q.data)==null?void 0:X.message)||"Something went wrong.")}finally{b(!1)}},te=async F=>{x([]);try{const q=await M.get(`/api/appointment/available-slots?date=${n}&service_id=${F}`);x(q.data.slots)}catch{x([])}},ne=F=>{if(l){T("Please accept the updated Terms & Privacy Policy before booking an appointment.");return}const q=F.target.value;o(q),c([]),_(null),x([]),C(""),A("cash"),$(null),T(""),d(""),j(!1),q&&(Z(q),j(!0))},be=F=>{_(F),te(F.id),C(""),T(""),d(""),j(!1)},oe=F=>{const q=F.target.value;if(I!=null&&I.under_warning&&q!=="maya"){T(`âš ï¸ PAYMENT RESTRICTION

Your account is under warning due to previous no-shows. You can only book appointments using Maya (online payment) at this time.`);return}A(q),q!=="hmo"&&$(null)},Y=async()=>{var F;if(l){T("Please accept the updated Terms & Privacy Policy before booking an appointment.");return}if(!u){if(!n||!g||!p||!v){T("Please complete all booking fields.");return}if(v==="hmo"&&!G){T("Please select an HMO for this appointment.");return}P(!0),T("");try{const q={service_id:g.id,date:n,start_time:p,payment_method:v};v==="hmo"&&(q.patient_hmo_id=G),B&&S&&(q.teeth_count=parseInt(S)),await M.post("/api/appointment",q),T("âœ… Appointment successfully booked! Redirecting..."),setTimeout(()=>{s("/patient")},2e3)}catch(q){const X=(F=q==null?void 0:q.response)==null?void 0:F.data;X!=null&&X.blocked||X!=null&&X.warning_status?T(X.message):T((X==null?void 0:X.message)||"Booking failed.")}finally{P(!1)}}};return e.jsxs("div",{className:"w-100",children:[e.jsxs("div",{className:"card border-0 shadow-lg w-100 patient-page-card",children:[e.jsxs("div",{className:"card-header bg-gradient bg-primary text-white text-center py-4",children:[e.jsxs("h2",{className:"h3 mb-2",children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book an Appointment"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Schedule your dental visit with ease"})]}),e.jsxs("div",{className:"card-body p-5",children:[l&&e.jsxs("div",{className:"alert alert-warning d-flex flex-column flex-md-row align-items-start align-items-md-center justify-content-between gap-3",children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Action required:"})," Please review and accept the updated Terms & Privacy Policy before booking a new appointment."]}),e.jsx("div",{className:"d-flex align-items-center gap-2",children:e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:a,disabled:i,children:[e.jsx("i",{className:"bi bi-shield-lock me-1"}),"Review Policy"]})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-5 mb-3",children:[e.jsx("i",{className:"bi bi-calendar3 me-2 text-primary"}),"Select a Date"]}),e.jsx("input",{type:"date",className:"form-control form-control-lg border-2",value:n,onChange:ne,min:qi(),max:Ui(),disabled:l,style:{fontSize:"1.1rem"}}),e.jsxs("div",{className:"form-text mt-2",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Appointments can be booked from tomorrow up to 7 days in advance"]})]}),n&&!g&&e.jsxs("div",{className:"mt-5",children:[e.jsx("div",{className:"alert alert-info border-0 shadow-sm",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-calendar-check me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Date Selected:"}),e.jsx("br",{}),e.jsx("span",{className:"fs-5",children:new Date(n).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]})]})}),e.jsx("div",{className:"text-center mt-4",children:e.jsx("button",{className:"btn btn-primary btn-lg px-5 py-3",onClick:()=>j(!0),disabled:m||l,style:{fontSize:"1.1rem",borderRadius:"10px"},children:m?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Loading Services..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-list-ul me-2"}),"View Available Services"]})})})]}),g&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"alert alert-success border-0 shadow-sm",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between flex-wrap",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-check-circle me-3 fs-4"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Service Selected:"}),e.jsx("br",{}),e.jsx("span",{className:"fs-5",children:g.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-success fw-semibold",children:["â‚±",Number(g.price||g.promo_price).toLocaleString(),B?" per tooth":""]}),B&&e.jsx("div",{className:"mt-2",children:e.jsxs("small",{className:"text-info",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Total cost depends on number of teeth treated"]})})]})]}),e.jsxs("button",{className:"btn btn-outline-success btn-sm mt-3 mt-md-0",onClick:()=>j(!0),children:[e.jsx("i",{className:"bi bi-pencil me-1"}),"Change Service"]})]})})}),g&&e.jsxs("div",{className:"mt-5",children:[B&&e.jsx("div",{className:"alert alert-info border-0 shadow-sm mb-4",role:"alert",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{className:"bi bi-lightbulb me-3 fs-4 text-info"}),e.jsxs("div",{children:[e.jsxs("h6",{className:"alert-heading text-info mb-2",children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Per-Teeth Service Recommendation"]}),e.jsxs("p",{className:"mb-2",children:["For per-teeth services, we recommend scheduling a ",e.jsx("strong",{children:"consultation first"})," to determine:"]}),e.jsxs("ul",{className:"mb-2 ps-3",children:[e.jsx("li",{children:"How many teeth need treatment"}),e.jsx("li",{children:"The appropriate procedure for each tooth"}),e.jsx("li",{children:"Accurate cost estimation"})]}),e.jsx("p",{className:"mb-0",children:e.jsx("strong",{children:"If you already know the details, please proceed with booking."})})]})]})}),e.jsxs("div",{className:"border-top pt-4",children:[e.jsxs("h4",{className:"h5 mb-4",children:[e.jsx("i",{className:"bi bi-clock me-2 text-primary"}),"Complete Your Booking"]}),N.length===0&&e.jsxs("div",{className:"alert alert-warning border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No available slots for this date and service. Please select a different date or service."]}),N.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-6 mb-3",children:[e.jsx("i",{className:"bi bi-clock me-2 text-primary"}),"Available Time Slots"]}),e.jsxs("select",{className:"form-select form-select-lg border-2",value:p,onChange:F=>C(F.target.value),disabled:l,style:{fontSize:"1.1rem"},children:[e.jsx("option",{value:"",children:"-- Select Time Slot --"}),N.map(F=>e.jsx("option",{value:F,children:F},F))]}),e.jsxs("div",{className:"form-text mt-2",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Time slots that overlap with your existing appointments are automatically excluded"]})]}),B&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-6 mb-3",children:[e.jsx("i",{className:"bi bi-tooth me-2 text-primary"}),"Number of Teeth to be Treated ",e.jsx("span",{className:"text-muted",children:"(optional)"})]}),e.jsx("input",{type:"number",className:"form-control form-control-lg border-2",placeholder:"e.g., 3",value:S,onChange:F=>d(F.target.value),min:"1",max:"32",disabled:l,style:{fontSize:"1.1rem"}}),e.jsxs("div",{className:"form-text mt-2",children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Enter the number of teeth that need treatment. Leave blank if you're unsure - we'll determine this during your visit.",S&&e.jsxs("div",{className:"mt-2",children:[e.jsx("strong",{children:"Estimated cost:"})," â‚±",Number(g.price||g.promo_price)*parseInt(S||0).toLocaleString()]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-6 mb-3",children:[e.jsx("i",{className:"bi bi-credit-card me-2 text-primary"}),"Payment Method"]}),e.jsxs("select",{className:"form-select form-select-lg border-2",value:v,onChange:oe,disabled:l,style:{fontSize:"1.1rem"},children:[e.jsxs("option",{value:"cash",disabled:I==null?void 0:I.under_warning,children:["ðŸ’µ Cash (on-site payment)",(I==null?void 0:I.under_warning)&&" - Not available"]}),e.jsx("option",{value:"maya",children:"ðŸ’³ Maya (online payment)"}),e.jsxs("option",{value:"hmo",disabled:I==null?void 0:I.under_warning,children:["ðŸ¥ HMO (insurance)",(I==null?void 0:I.under_warning)&&" - Not available"]})]}),(I==null?void 0:I.under_warning)&&e.jsxs("div",{className:"alert alert-warning mt-3 border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Payment Restriction:"})," Your account is under warning due to previous no-shows. You can only book appointments using Maya (online payment) at this time."]})]}),v==="hmo"&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"form-label fw-semibold fs-6 mb-3",children:[e.jsx("i",{className:"bi bi-hospital me-2 text-primary"}),"Choose HMO Provider"]}),L?e.jsxs("div",{className:"text-muted p-3 border rounded",children:[e.jsx("i",{className:"bi bi-hourglass-split me-2"}),"Loading HMO listâ€¦"]}):R?e.jsx(Wi,{patientId:R,value:G,onChange:$,disabled:l,required:!0}):e.jsxs("div",{className:"alert alert-warning border-0 shadow-sm",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"We couldn't load your patient profile. You may need to link your account at the clinic, or try again later."]})]}),e.jsx("div",{className:"d-grid mt-5",children:e.jsx("button",{className:"btn btn-success btn-lg py-3",onClick:Y,disabled:u||l,style:{fontSize:"1.2rem",borderRadius:"10px"},children:u?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-hourglass-split me-2"}),"Booking in Progress..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Confirm Appointment"]})})}),z&&e.jsxs("div",{className:`alert mt-4 border-0 shadow-sm ${z.includes("âœ…")?"alert-success":z.includes("blocked")||z.includes("mistake")?"alert-danger":"alert-info"}`,children:[e.jsx("i",{className:`bi ${z.includes("âœ…")?"bi-check-circle":z.includes("blocked")||z.includes("mistake")?"bi-exclamation-triangle":"bi-info-circle"} me-2`}),e.jsx("div",{style:{whiteSpace:"pre-line"},children:z})]})]})]})]})]})]}),e.jsx(Oi,{isOpen:h,onClose:()=>j(!1),services:r,loading:m,error:f,onServiceSelect:be,selectedDate:n,selectedService:g})]})}function Gi({patientId:s,currentUserRole:l,currentUserPatientId:a=null,compact:i=!1,onChange:n}){const[o,r]=t.useState([]),[c,m]=t.useState(!1),[b,f]=t.useState(""),[y,h]=t.useState(!1),[j,u]=t.useState(null),[P,g]=t.useState(null),_=t.useMemo(()=>l==="admin"||l==="staff"?!0:l==="patient"?Number(s)===Number(a):!1,[l,s,a]);t.useEffect(()=>{let v=!0;return(async()=>{m(!0),f("");try{const{data:A}=await M.get(`/api/patients/${s}/hmos`);v&&(r(A||[]),n&&n(A||[]))}catch(A){v&&f(Os(A))}finally{v&&m(!1)}})(),()=>v=!1},[s]);const N=()=>{u(null),h(!0)},x=v=>{u(v),h(!0)},p=(v,A)=>{h(!1),u(null),r(z=>{const T=la(A==="create"?[v,...z]:z.map(S=>S.id===v.id?v:S));return n&&n(T),T})},C=async()=>{if(P)try{await M.delete(`/api/patients/${s}/hmos/${P.id}`),r(v=>{const A=v.filter(z=>z.id!==P.id);return n&&n(A),A})}catch(v){alert(Os(v))}finally{g(null)}};return e.jsxs("div",{className:`w-full ${i?"p-3":"p-4"} rounded-2xl shadow-sm border hmo-card`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("h3",{className:"text-lg font-semibold hmo-title",children:"HMO"}),_&&e.jsx("button",{onClick:N,className:"px-3 py-1.5 rounded-xl text-sm font-medium text-white transition-colors duration-200",style:{backgroundColor:"#2563eb"},onMouseEnter:v=>v.target.style.backgroundColor="#1d4ed8",onMouseLeave:v=>v.target.style.backgroundColor="#2563eb",children:"+ Add HMO"})]}),c&&e.jsx("div",{className:"text-sm text-muted",children:"Loading HMOsâ€¦"}),b&&e.jsx("div",{className:"text-sm text-red-600",children:b}),!c&&!(o!=null&&o.length)&&e.jsx("div",{className:"text-sm text-muted",children:"No HMO on file."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:o==null?void 0:o.map(v=>e.jsx(Xi,{item:v,onEdit:()=>x(v),onAskDelete:()=>g(v),canManage:_},v.id))}),y&&e.jsx(Qi,{onClose:()=>h(!1),onSaved:p,patientId:s,initial:j}),P&&e.jsx(Ji,{title:"Delete HMO?",message:`This will remove ${P.provider_name} from this patient. You can restore from audit logs in backend if implemented.`,onCancel:()=>g(null),onConfirm:C})]})}function Xi({item:s,onEdit:l,onAskDelete:a,canManage:i}){return e.jsx("div",{className:"rounded-xl border p-3 hmo-card",style:{backgroundColor:"var(--card-bg)",borderColor:"var(--border-color)"},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium hmo-provider-name",children:s.provider_name}),s.is_primary?e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-300",children:"Primary"}):null]}),e.jsxs("div",{className:"text-sm mt-2 space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"hmo-label",children:"HMO Number:"})," ",e.jsx("span",{className:"hmo-value",children:s.hmo_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"hmo-label",children:"Name on Card:"})," ",e.jsx("span",{className:"hmo-value",children:s.patient_fullname_on_card})]})]})]}),i&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:l,className:"px-2.5 py-1 text-xs rounded-lg text-white transition-colors duration-200",style:{backgroundColor:"#2563eb"},onMouseEnter:n=>n.target.style.backgroundColor="#1d4ed8",onMouseLeave:n=>n.target.style.backgroundColor="#2563eb",children:"Edit"}),e.jsx("button",{onClick:a,className:"px-2.5 py-1 text-xs rounded-lg text-white transition-colors duration-200",style:{backgroundColor:"#dc2626"},onMouseEnter:n=>n.target.style.backgroundColor="#b91c1c",onMouseLeave:n=>n.target.style.backgroundColor="#dc2626",children:"Delete"})]})]})})}function Qi({onClose:s,onSaved:l,patientId:a,initial:i}){const n=!!i,[o,r]=t.useState(()=>({provider_name:(i==null?void 0:i.provider_name)||"",hmo_number:(i==null?void 0:i.hmo_number)||"",patient_fullname_on_card:(i==null?void 0:i.patient_fullname_on_card)||"",is_primary:!!(i!=null&&i.is_primary)})),[c,m]=t.useState(!1),[b,f]=t.useState(""),y=async()=>{m(!0),f("");try{let h;const j={provider_name:o.provider_name,hmo_number:o.hmo_number,patient_fullname_on_card:o.patient_fullname_on_card,is_primary:o.is_primary};n?(h=await M.put(`/api/patients/${a}/hmos/${i.id}`,j),l(h.data,"update")):(h=await M.post(`/api/patients/${a}/hmos`,j),l(h.data,"create"))}catch(h){f(Os(h))}finally{m(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:s}),e.jsxs("div",{className:"relative w-full max-w-xl rounded-2xl shadow-xl border p-4 hmo-card",style:{backgroundColor:"var(--card-bg)",borderColor:"var(--border-color)"},children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-base font-semibold hmo-title",children:n?"Edit HMO":"Add HMO"}),e.jsx("button",{onClick:s,className:"w-8 h-8 rounded-full button-close transition-colors duration-200 flex items-center justify-center",children:"âœ•"})]}),b&&e.jsx("div",{className:"mb-3 text-sm text-red-600",children:b}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsx(Vs,{label:"Provider Name",required:!0,value:o.provider_name,onChange:h=>r({...o,provider_name:h})}),e.jsx(Vs,{label:"HMO Number",required:!0,value:o.hmo_number,onChange:h=>r({...o,hmo_number:h})}),e.jsx(Vs,{label:"Patient Full Name on Card",required:!0,value:o.patient_fullname_on_card,onChange:h=>r({...o,patient_fullname_on_card:h})}),e.jsxs("div",{className:"flex items-center gap-2 pt-2",children:[e.jsx("input",{id:"is_primary",type:"checkbox",className:"h-4 w-4 text-blue-600 focus:ring-blue-500 border rounded",style:{borderColor:"var(--input-border)",backgroundColor:"var(--input-bg)"},checked:o.is_primary,onChange:h=>r({...o,is_primary:h.target.checked})}),e.jsx("label",{htmlFor:"is_primary",className:"text-sm hmo-form-label",children:"Mark as Primary"})]})]}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-4",children:[e.jsx("button",{onClick:s,className:"px-3 py-1.5 text-sm rounded-xl text-white transition-colors duration-200",style:{backgroundColor:"#6b7280"},onMouseEnter:h=>h.target.style.backgroundColor="#4b5563",onMouseLeave:h=>h.target.style.backgroundColor="#6b7280",children:"Cancel"}),e.jsx("button",{onClick:y,disabled:c||!o.provider_name||!o.hmo_number||!o.patient_fullname_on_card,className:"px-3 py-1.5 text-sm rounded-xl text-white transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed",style:{backgroundColor:c||!o.provider_name||!o.hmo_number||!o.patient_fullname_on_card?"#9ca3af":"#2563eb"},onMouseEnter:h=>{!c&&o.provider_name&&o.hmo_number&&o.patient_fullname_on_card&&(h.target.style.backgroundColor="#1d4ed8")},onMouseLeave:h=>{!c&&o.provider_name&&o.hmo_number&&o.patient_fullname_on_card&&(h.target.style.backgroundColor="#2563eb")},children:c?"Savingâ€¦":n?"Save Changes":"Create"})]})]})]})}function Ji({title:s,message:l,onCancel:a,onConfirm:i}){return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:a}),e.jsxs("div",{className:"relative w-full max-w-md rounded-2xl shadow-xl border p-4 hmo-card",style:{backgroundColor:"var(--card-bg)",borderColor:"var(--border-color)"},children:[e.jsx("h4",{className:"text-base font-semibold mb-2 hmo-title",children:s}),e.jsx("p",{className:"text-sm text-secondary mb-4",children:l}),e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:a,className:"px-3 py-1.5 text-sm rounded-xl text-white transition-colors duration-200",style:{backgroundColor:"#6b7280"},onMouseEnter:n=>n.target.style.backgroundColor="#4b5563",onMouseLeave:n=>n.target.style.backgroundColor="#6b7280",children:"Cancel"}),e.jsx("button",{onClick:i,className:"px-3 py-1.5 text-sm rounded-xl text-white transition-colors duration-200",style:{backgroundColor:"#dc2626"},onMouseEnter:n=>n.target.style.backgroundColor="#b91c1c",onMouseLeave:n=>n.target.style.backgroundColor="#dc2626",children:"Delete"})]})]})]})}function Vs({label:s,value:l,onChange:a,required:i}){return e.jsxs("div",{children:[e.jsx(Zi,{required:i,children:s}),e.jsx("input",{type:"text",className:"w-full mt-1 rounded-xl border p-2 text-sm input-field focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500",style:{backgroundColor:"var(--input-bg)",borderColor:"var(--input-border)",color:"var(--input-text)"},value:l,onChange:n=>a(n.target.value)})]})}function Zi({children:s,required:l=!1}){return e.jsxs("label",{className:"text-sm hmo-form-label",children:[s," ",l&&e.jsx("span",{className:"text-red-600",children:"*"})]})}function Os(s){var i,n,o,r;const l=((n=(i=s==null?void 0:s.response)==null?void 0:i.data)==null?void 0:n.message)||(s==null?void 0:s.message)||"Request failed",a=(r=(o=s==null?void 0:s.response)==null?void 0:o.data)==null?void 0:r.errors;if(a)try{const c=Object.values(a)[0];if(Array.isArray(c)&&c.length)return`${l}: ${c[0]}`}catch{}return l}function la(s){return Array.isArray(s)?[...s].sort((l,a)=>{if(l.is_primary&&!a.is_primary)return-1;if(!l.is_primary&&a.is_primary)return 1;const i=(l.provider_name||"").toLowerCase(),n=(a.provider_name||"").toLowerCase();return i.localeCompare(n)}):[]}const el=()=>{var G;const[s,l]=t.useState(null),[a,i]=t.useState(!1),[n,o]=t.useState(""),[r,c]=t.useState(""),[m,b]=t.useState(""),[f,y]=t.useState(""),[h,j]=t.useState(""),[u,P]=t.useState(""),[g,_]=t.useState({}),[N,x]=t.useState(""),[p,C]=t.useState(!1);Se();const v=async()=>{try{const $=await M.get("/api/user");l($.data),console.log($.data)}catch($){console.error("Failed to fetch user info",$)}};t.useEffect(()=>{v()},[]);const A=async()=>{var $,L;x(""),_({}),C(!0);try{const E=await M.post("/api/send-password-reset");x(E.data.message||"Password reset link sent to your email!")}catch(E){const I=((L=($=E.response)==null?void 0:$.data)==null?void 0:L.message)||"Failed to send reset link";x("âŒ "+I)}finally{C(!1)}},z=$=>{if(!$)return"Birthdate is required.";const L=new Date($),E=new Date,I=new Date;return I.setFullYear(E.getFullYear()-4),L>E?"Birthdate cannot be in the future.":L>I?"You must be at least 4 years old.":null},T=()=>{const $=new Date;return $.setFullYear($.getFullYear()-4),$.toISOString().split("T")[0]},S=async()=>{var L,E;C(!0),_({});const $=z(h);if($){_({birthdate:[$]}),C(!1);return}try{await M.post("/api/patients/link-self",{contact_number:n,first_name:r,middle_name:m,last_name:f,birthdate:h,sex:u}),x("âœ… Profile linked successfully."),await v(),i(!1)}catch(I){(E=(L=I.response)==null?void 0:L.data)!=null&&E.errors?_(I.response.data.errors):x("âŒ Failed to link profile.")}finally{C(!1)}};if(!s)return e.jsx("p",{children:"Loading your profile..."});const d=!!s.patient&&s.patient.is_linked,R=s.role,H=(G=s.patient)==null?void 0:G.id;return e.jsx("div",{className:"w-100",children:e.jsxs("div",{className:"card border-0 shadow-lg w-100 patient-page-card",children:[e.jsxs("div",{className:"card-header bg-gradient bg-primary text-white text-center py-4",children:[e.jsxs("h2",{className:"h3 mb-2",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"My Account"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Manage your personal information and preferences"})]}),e.jsxs("div",{className:"card-body p-5",children:[e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"h5 mb-3",children:[e.jsx("i",{className:"bi bi-person me-2 text-primary"}),"Personal Information"]}),e.jsx("div",{className:"card border-0 bg-light shadow-sm",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-person-fill me-3 text-primary fs-5"}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Full Name"}),e.jsx("span",{className:"fw-semibold",children:s.name})]})]})}),e.jsx("div",{className:"col-12 col-md-6",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-envelope-fill me-3 text-primary fs-5"}),e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Email Address"}),e.jsx("span",{className:"fw-semibold",children:s.email})]})]})})]})})})]}),e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"h5 mb-3",children:[e.jsx("i",{className:"bi bi-shield-lock me-2 text-primary"}),"Account Security"]}),e.jsx("div",{className:"card border-0 bg-light shadow-sm",children:e.jsxs("div",{className:"card-body p-4",children:[e.jsx("p",{className:"text-muted mb-3",children:"Need to change your password? We'll send a secure reset link to your email address."}),N&&e.jsx("div",{className:"alert alert-success mb-3",children:N}),e.jsxs("button",{className:"btn btn-primary btn-lg",onClick:A,disabled:p,children:[e.jsx("i",{className:"bi bi-envelope me-2"}),p?"Sending...":"Send Password Reset Link"]})]})})]}),!d&&e.jsxs("div",{className:"mb-5",children:[e.jsxs("h4",{className:"h5 mb-3",children:[e.jsx("i",{className:"bi bi-person-plus me-2 text-primary"}),"Link Patient Profile"]}),e.jsxs("div",{className:"card border-warning shadow-sm",children:[e.jsxs("div",{className:"card-header bg-warning-subtle border-warning",children:[e.jsxs("h5",{className:"h6 mb-1",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Profile Not Linked"]}),e.jsx("p",{className:"mb-0 text-muted",children:"You're not yet linked to a patient profile."})]}),e.jsxs("div",{className:"card-body",children:[e.jsx("p",{className:"mb-3",children:"Have you visited the clinic before?"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"alert alert-info border-0 shadow-sm mb-3",children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),e.jsx("strong",{children:"Yes"})," â€“ Please visit the clinic for assistance with linking your profile"]}),e.jsxs("button",{className:"btn btn-outline-primary btn-lg w-100",onClick:()=>{s!=null&&s.contact_number&&o(s.contact_number),i(!0)},children:[e.jsx("i",{className:"bi bi-x-circle me-2"}),"No â€“ I haven't visited before"]})]}),a&&e.jsxs("div",{className:"border-top pt-4",children:[e.jsxs("h6",{className:"mb-3",children:[e.jsx("i",{className:"bi bi-person-check me-2"}),"Verify Your Information"]}),e.jsx("p",{className:"text-muted mb-4",children:"Please confirm your details to create your patient profile. This information will be used for senior discounts and VAT exemptions."}),e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"First Name *"}),e.jsx("input",{className:`form-control form-control-lg border-2 ${g.first_name?"is-invalid":""}`,placeholder:"e.g. Juan",value:r,onChange:$=>c($.target.value),style:{fontSize:"1.1rem"}}),g.first_name&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),g.first_name[0]]})]}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Middle Name"}),e.jsx("input",{className:`form-control form-control-lg border-2 ${g.middle_name?"is-invalid":""}`,placeholder:"e.g. Santos (optional)",value:m,onChange:$=>b($.target.value),style:{fontSize:"1.1rem"}}),g.middle_name&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),g.middle_name[0]]})]}),e.jsxs("div",{className:"col-12 col-md-4",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Last Name *"}),e.jsx("input",{className:`form-control form-control-lg border-2 ${g.last_name?"is-invalid":""}`,placeholder:"e.g. Dela Cruz",value:f,onChange:$=>y($.target.value),style:{fontSize:"1.1rem"}}),g.last_name&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),g.last_name[0]]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Number *"}),e.jsx("input",{className:`form-control form-control-lg border-2 ${g.contact_number?"is-invalid":""}`,placeholder:"e.g. 09123456789",value:n,onChange:$=>o($.target.value),style:{fontSize:"1.1rem"}}),g.contact_number&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),g.contact_number[0]]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Birthdate *"}),e.jsx("input",{type:"date",className:`form-control form-control-lg border-2 ${g.birthdate?"is-invalid":""}`,value:h,onChange:$=>{const L=$.target.value;j(L);const E=z(L);_(E?I=>({...I,birthdate:[E]}):I=>({...I,birthdate:null}))},max:T(),min:new Date(new Date().setFullYear(new Date().getFullYear()-120)).toISOString().split("T")[0],style:{fontSize:"1.1rem"}}),g.birthdate&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),Array.isArray(g.birthdate)?g.birthdate[0]:g.birthdate]})]}),e.jsxs("div",{className:"col-12 col-md-6",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Sex *"}),e.jsxs("select",{className:`form-control form-control-lg border-2 ${g.sex?"is-invalid":""}`,value:u,onChange:$=>P($.target.value),style:{fontSize:"1.1rem"},children:[e.jsx("option",{value:"",children:"Select your sex"}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]}),g.sex&&e.jsxs("div",{className:"text-danger mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-1"}),g.sex[0]]})]})]}),e.jsx("div",{className:"mt-4",children:e.jsx("button",{className:"btn btn-success btn-lg w-100",onClick:S,disabled:p||!r||!f||!n||!h||!u,children:p?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Linking Profile..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-link me-2"}),"Link My Profile"]})})})]}),N&&e.jsxs("div",{className:`alert mt-4 border-0 shadow-sm ${N.includes("âœ…")?"alert-success":"alert-danger"}`,children:[e.jsx("i",{className:`bi ${N.includes("âœ…")?"bi-check-circle":"bi-exclamation-triangle"} me-2`}),N]})]})]})]}),d&&H&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"h5 mb-3",children:[e.jsx("i",{className:"bi bi-hospital me-2 text-primary"}),"Health Maintenance Organization (HMO)"]}),e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsx("div",{className:"card-body p-0",children:e.jsx(Gi,{patientId:H,currentUserRole:R,currentUserPatientId:H,compact:!1,onChange:$=>{}})})})]})]})]})})},Va="/assets/Teeth_Chart-BMsV1YlE.png",sl=()=>{const[s,l]=t.useState([]),[a,i]=t.useState(!1),[n,o]=t.useState(1),[r,c]=t.useState({}),[m,b]=t.useState(!1),[f,y]=t.useState(""),[h,j]=t.useState("");t.useEffect(()=>{u(n)},[n]);const u=async(p=1)=>{try{i(!0);const C=new URLSearchParams({page:p.toString()});f&&C.append("start_date",f),h&&C.append("end_date",h);const v=await M.get(`/api/user-visit-history?${C.toString()}`,{skip401Handler:!0});l(v.data.data),c({current_page:v.data.meta.current_page,last_page:v.data.meta.last_page,per_page:v.data.meta.per_page,total:v.data.meta.total})}catch(C){console.error("Failed to fetch visit history",C)}finally{i(!1)}},P=()=>{o(1),u(1)},g=()=>{y(""),j(""),o(1),_(1)},_=async(p=1)=>{try{i(!0);const C=await M.get(`/api/user-visit-history?page=${p}`,{skip401Handler:!0});l(C.data.data),c({current_page:C.data.meta.current_page,last_page:C.data.meta.last_page,per_page:C.data.meta.per_page,total:C.data.meta.total})}catch(C){console.error("Failed to fetch visit history",C)}finally{i(!1)}},N=p=>{if(!p)return"â€”";const C=p.split(",").map(v=>v.trim()).filter(v=>v);return C.length===0?"â€”":C.join(", ")},x=p=>p?p.split(",").map(v=>v.trim()).filter(v=>v).length:0;return e.jsxs("div",{className:"card border-0 shadow-sm",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h6",{className:"card-title mb-0",children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),"Service History"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs("button",{className:"btn btn-sm btn-outline-light",onClick:()=>b(!m),title:"Tooth Chart Reference",children:[e.jsx("i",{className:"bi bi-tooth me-1"}),"Chart"]}),e.jsxs("button",{className:"btn btn-sm btn-outline-light",onClick:()=>u(n),disabled:a,children:[a?e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}):e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})]})]})}),e.jsxs("div",{className:"card-body border-bottom bg-light",children:[e.jsxs("div",{className:"row g-3 align-items-end",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{htmlFor:"historyStartDate",className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-check me-2 text-primary"}),"Start Date"]}),e.jsx("input",{id:"historyStartDate",type:"date",className:"form-control",value:f,onChange:p=>y(p.target.value),placeholder:"Select start date"}),e.jsx("small",{className:"text-muted",children:"Filter from this date"})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{htmlFor:"historyEndDate",className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-x me-2 text-primary"}),"End Date"]}),e.jsx("input",{id:"historyEndDate",type:"date",className:"form-control",value:h,onChange:p=>j(p.target.value),min:f||void 0,placeholder:"Select end date",disabled:!f}),e.jsx("small",{className:"text-muted",children:f?"Filter up to this date":"Select start date first"})]}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary flex-fill",onClick:P,disabled:!f||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-funnel me-1"}),"Apply Filter"]})}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:g,disabled:!f&&!h||a,title:"Clear filters",children:e.jsx("i",{className:"bi bi-x-circle"})})]})})]}),(f||h)&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"alert alert-info mb-0 d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsxs("span",{children:[f&&!h&&`Showing visits on ${f}`,f&&h&&`Showing visits from ${f} to ${h}`]})]})})]}),m&&e.jsx("div",{className:"border-bottom",style:{backgroundColor:"rgba(248, 249, 250, 0.95)",opacity:.95,padding:"15px",border:"1px solid #e5e7eb",borderRadius:"0"},children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:Va,alt:"Dental Chart Reference",className:"img-fluid",style:{maxWidth:"250px",height:"auto",border:"1px solid #dee2e6",borderRadius:"8px",backgroundColor:"#f8f9fa"}}),e.jsx("small",{className:"text-muted d-block mt-2",children:"Reference Chart"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h6",{className:"text-primary mb-3",children:"Universal Numbering System"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("small",{className:"text-muted d-block mb-2",children:"UPPER TEETH (1-16)"}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-1",children:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].map(p=>e.jsx("span",{className:"badge bg-light text-dark border",style:{width:"18px",height:"18px",fontSize:"9px",display:"flex",alignItems:"center",justifyContent:"center"},children:p},p))})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("small",{className:"text-muted d-block mb-2",children:"LOWER TEETH (32-17)"}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-1",children:[32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17].map(p=>e.jsx("span",{className:"badge bg-light text-dark border",style:{width:"18px",height:"18px",fontSize:"9px",display:"flex",alignItems:"center",justifyContent:"center"},children:p},p))})]}),e.jsxs("div",{className:"alert alert-info py-2 mb-0",style:{fontSize:"11px"},children:[e.jsx("i",{className:"bi bi-info-circle me-1"}),"Use this chart to understand which teeth were treated"]})]})})]})}),e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Teeth Done"}),e.jsx("th",{children:"Details"})]})}),e.jsx("tbody",{children:a?e.jsx("tr",{children:e.jsxs("td",{colSpan:"4",className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Loading service history..."})]})}):s.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"4",className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-calendar-x display-4 text-muted"}),e.jsx("h6",{className:"mt-3 text-muted",children:"No completed visits yet"}),e.jsx("p",{className:"text-muted mb-0",children:"Your completed dental visits will appear here."})]})}):s.map(p=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"fw-medium",children:new Date(p.visit_date).toLocaleDateString()}),e.jsx("small",{className:"text-muted",children:new Date(p.visit_date).toLocaleDateString("en-US",{weekday:"long"})})]}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary",children:p.service_name||"Not specified"})}),e.jsx("td",{children:p.teeth_treated?e.jsxs("div",{children:[e.jsx("span",{className:"badge bg-info",children:N(p.teeth_treated)}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[x(p.teeth_treated)," tooth",x(p.teeth_treated)!==1?"s":""]})]}):e.jsx("span",{className:"text-muted",children:"â€”"})}),e.jsx("td",{children:p.has_notes?e.jsxs("span",{className:"badge bg-success",children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),"Has Notes"]}):e.jsxs("span",{className:"badge bg-secondary",children:[e.jsx("i",{className:"bi bi-dash-circle me-1"}),"No Notes"]})})]},p.id))})]})})}),r.last_page>1&&e.jsx("div",{className:"card-footer bg-light",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",disabled:n===1,onClick:()=>o(n-1),children:[e.jsx("i",{className:"bi bi-chevron-left me-1"}),"Previous"]}),e.jsxs("span",{className:"text-muted",children:["Page ",r.current_page," of ",r.last_page]}),e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",disabled:n===r.last_page,onClick:()=>o(n+1),children:["Next",e.jsx("i",{className:"bi bi-chevron-right ms-1"})]})]})})]})};function al(){var U;const[s,l]=t.useState([]),[a,i]=t.useState(!1),[n,o]=t.useState(1),[r,c]=t.useState({}),[m,b]=t.useState(null),[f,y]=t.useState(null),[h,j]=t.useState(null),[u,P]=t.useState(null),[g,_]=t.useState(!1),[N,x]=t.useState(null),[p,C]=t.useState(""),[v,A]=t.useState([]),[z,T]=t.useState(""),[S,d]=t.useState(!1),[R,H]=t.useState("appointments"),[G,$]=t.useState(""),[L,E]=t.useState(""),I=t.useRef({appointments:!1,history:!1}),W=t.useRef(!1);t.useEffect(()=>{(async()=>{try{await M.get("/sanctum/csrf-cookie"),W.current=!0,B(n)}catch(K){console.warn("CSRF prime failed (will retry later)",K),B(n)}})()},[]),t.useEffect(()=>{R==="appointments"&&W.current&&I.current.appointments&&B(n)},[n,R]),t.useEffect(()=>{const k=()=>{R==="appointments"&&(console.log("Page focused, refreshing appointments..."),B(n))},K=()=>{!document.hidden&&R==="appointments"&&(console.log("Page visible, refreshing appointments..."),B(n))};return window.addEventListener("focus",k),document.addEventListener("visibilitychange",K),()=>{window.removeEventListener("focus",k),document.removeEventListener("visibilitychange",K)}},[n,R]);const B=async(k=1)=>{try{i(!0);const K=new URLSearchParams({page:k.toString()});G&&K.append("start_date",G),L&&K.append("end_date",L);const J=await M.get(`/api/user-appointments?${K.toString()}`,{skip401Handler:!0});console.log("Appointments API Response:",J.data.data),l(J.data.data),c({current_page:J.data.current_page,last_page:J.data.last_page,per_page:J.data.per_page,total:J.data.total}),I.current.appointments=!0}catch(K){console.error("Failed to fetch appointments",K)}finally{i(!1)}},Z=k=>{x(k),_(!0)},te=async()=>{var k,K,J;if(N)try{j(N),_(!1),await M.get("/sanctum/csrf-cookie");const ue=await M.post(`/api/appointment/${N}/cancel`),ve=(k=ue==null?void 0:ue.data)!=null&&k.refund_request_created?" A refund request has been created and will be processed shortly.":"";Ge.success("Appointment cancelled successfully!"+ve,{style:{background:"#28a745",color:"#fff",borderRadius:"8px",padding:"16px",fontSize:"16px"},duration:4e3}),B(n),x(null)}catch(ue){console.error("Cancel failed",ue);const ve=((J=(K=ue.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to cancel appointment. Please try again.";Ge.error(ve,{style:{background:"#dc3545",color:"#fff",borderRadius:"8px",padding:"16px"}})}finally{j(null)}},ne=async k=>{var K,J,ue,ve,Ce;try{b(k),await M.get("/sanctum/csrf-cookie");const{data:Ae}=await M.post("/api/maya/payments",{appointment_id:k},{skip401Handler:!0});Ae!=null&&Ae.redirect_url?window.location.href=Ae.redirect_url:alert("Payment link not available. Please try again.")}catch(Ae){console.error("Create Maya payment failed",Ae);const rs=((J=(K=Ae.response)==null?void 0:K.data)==null?void 0:J.message)||((Ce=(ve=(ue=Ae.response)==null?void 0:ue.data)==null?void 0:ve.maya)==null?void 0:Ce.message)||"Unable to start payment. Please try again.";alert(rs)}finally{b(null)}},be=async k=>{var K,J;try{y(k);const ue=await M.get(`/api/receipts/appointment/${k}`,{responseType:"blob",skip401Handler:!0}),ve=new Blob([ue.data],{type:"application/pdf"}),Ce=window.URL.createObjectURL(ve),Ae=document.createElement("a");Ae.href=Ce,Ae.download=`receipt-${k}.pdf`,document.body.appendChild(Ae),Ae.click(),document.body.removeChild(Ae),window.URL.revokeObjectURL(Ce)}catch(ue){console.error("Failed to generate receipt",ue);const ve=((J=(K=ue.response)==null?void 0:K.data)==null?void 0:J.message)||"Failed to generate receipt. Please try again.";alert(ve)}finally{y(null)}},oe=k=>{P(k),C(""),A([]),T("")},Y=async k=>{const K=k.target.value;if(C(K),A([]),T(""),K&&u)try{const J=await M.get(`/api/appointment/available-slots?date=${K}&service_id=${u.service.id}`);A(J.data.slots)}catch(J){console.error("Failed to fetch available slots",J),A([])}},F=async()=>{var k;if(!p||!z||!u){alert("Please select both date and time slot.");return}try{d(!0),await M.post(`/api/appointments/${u.id}/reschedule`,{date:p,start_time:z}),alert("Appointment rescheduled successfully! It will need staff approval."),P(null),C(""),A([]),T(""),B(n)}catch(K){console.error("Reschedule failed",K);const J=(k=K.response)==null?void 0:k.data;if(J!=null&&J.blocked)alert(J.message);else{const ue=(J==null?void 0:J.message)||"Failed to reschedule appointment.";alert(ue)}}finally{d(!1)}},q=()=>{P(null),C(""),A([]),T("")},X=()=>{o(1),B(1)},re=()=>{$(""),E(""),o(1),V(1)},V=async(k=1)=>{try{i(!0);const K=await M.get(`/api/user-appointments?page=${k}`,{skip401Handler:!0});console.log("Appointments API Response:",K.data.data),l(K.data.data),c({current_page:K.data.current_page,last_page:K.data.last_page,per_page:K.data.per_page,total:K.data.total}),I.current.appointments=!0}catch(K){console.error("Failed to fetch appointments",K)}finally{i(!1)}},ce=()=>{const k=new Date;return k.setDate(k.getDate()+1),k.toISOString().slice(0,10)},he=()=>{const k=new Date;return k.setDate(k.getDate()+7),k.toISOString().slice(0,10)},le=k=>{const K={approved:"bg-success",pending:"bg-warning text-dark",rejected:"bg-danger",cancelled:"bg-secondary text-white fw-semibold",completed:"bg-primary"};return e.jsx("span",{className:`badge ${K[k]||"bg-secondary"}`,children:k})};return e.jsxs(e.Fragment,{children:[e.jsx(ks,{position:"top-center"}),e.jsx(Bs,{show:g,onConfirm:te,onCancel:()=>{_(!1),x(null)},title:"Cancel Appointment",message:"Are you sure you want to cancel this appointment?",confirmText:"Yes, Cancel",cancelText:"No, Keep It",variant:"danger"}),e.jsxs("div",{className:"w-100",children:[e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4",children:[e.jsxs("h2",{className:"h4 mb-3 mb-md-0",children:[e.jsx("i",{className:"bi bi-calendar3 me-2"}),"My Appointments & History"]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsx("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>B(n),disabled:a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Refreshing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Refresh"]})})})]}),e.jsxs("div",{className:"d-flex gap-2 mb-4",role:"group","aria-label":"Content tabs",children:[e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${R==="appointments"?"":"btn-outline-primary"}`,onClick:()=>H("appointments"),type:"button",style:{background:R==="appointments"?"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)":"transparent",color:R==="appointments"?"white":"#3b82f6",border:R==="appointments"?"none":"1px solid #3b82f6",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:"bi bi-calendar3 me-2"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Appointments"}),e.jsx("span",{className:"d-sm-none",children:"Appts"})]}),e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${R==="history"?"":"btn-outline-primary"}`,onClick:()=>H("history"),type:"button",style:{background:R==="history"?"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)":"transparent",color:R==="history"?"white":"#3b82f6",border:R==="history"?"none":"1px solid #3b82f6",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:"bi bi-clock-history me-2"}),e.jsx("span",{className:"d-none d-sm-inline",children:"Service History"}),e.jsx("span",{className:"d-sm-none",children:"History"})]})]}),R==="appointments"&&e.jsx("div",{className:"card border-0 shadow-sm mb-4",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-3 align-items-end",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{htmlFor:"startDate",className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-check me-2 text-primary"}),"Start Date"]}),e.jsx("input",{id:"startDate",type:"date",className:"form-control",value:G,onChange:k=>$(k.target.value),placeholder:"Select start date"}),e.jsx("small",{className:"text-muted",children:"Filter from this date"})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsxs("label",{htmlFor:"endDate",className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar-x me-2 text-primary"}),"End Date"]}),e.jsx("input",{id:"endDate",type:"date",className:"form-control",value:L,onChange:k=>E(k.target.value),min:G||void 0,placeholder:"Select end date",disabled:!G}),e.jsx("small",{className:"text-muted",children:G?"Filter up to this date":"Select start date first"})]}),e.jsx("div",{className:"col-md-4",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary flex-fill",onClick:X,disabled:!G||a,children:a?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-funnel me-1"}),"Apply Filter"]})}),e.jsx("button",{className:"btn btn-outline-secondary",onClick:re,disabled:!G&&!L||a,title:"Clear filters",children:e.jsx("i",{className:"bi bi-x-circle"})})]})})]}),(G||L)&&e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"alert alert-info mb-0 d-flex align-items-center",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsxs("span",{children:[G&&!L&&`Showing appointments on ${G}`,G&&L&&`Showing appointments from ${G} to ${L}`]})]})})]})}),e.jsxs("div",{className:"tab-content",children:[R==="appointments"&&e.jsxs("div",{className:"tab-pane fade show active",children:[e.jsx("div",{className:"d-none d-lg-block",children:e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsx("div",{className:"card-body p-0",children:e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover mb-0",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date & Time"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Payment Method"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Appointment Status"}),e.jsx("th",{children:"Notes"}),e.jsx("th",{style:{width:160},children:"Actions"})]})}),e.jsx("tbody",{children:a?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Loading appointments..."})]})}):s.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:"7",className:"text-center py-5",children:[e.jsx("i",{className:"bi bi-calendar-x display-4 text-muted"}),e.jsx("h6",{className:"mt-3 text-muted",children:"No appointments yet"}),e.jsx("p",{className:"text-muted mb-3",children:"You haven't booked any appointments yet."}),e.jsxs("a",{href:"/patient/appointment",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book Your First Appointment"]})]})}):s.map(k=>{var ve,Ce;const K=k.payment_method==="maya"&&k.payment_status==="awaiting_payment"&&k.status==="approved",J=k.status==="completed"&&k.payment_status==="paid",ue=k.payment_method==="maya"&&k.payment_status==="paid"&&(k.status==="approved"||k.status==="pending");return e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("div",{className:"fw-medium",children:k.date}),e.jsx("small",{className:"text-muted",children:k.start_time})]}),e.jsx("td",{children:e.jsx("div",{className:"fw-medium",children:((ve=k.service)==null?void 0:ve.name)||"â€”"})}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-light text-dark text-capitalize",children:k.payment_method})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${k.payment_status==="paid"?"bg-success":k.payment_status==="awaiting_payment"?"bg-warning text-dark":"bg-secondary"}`,children:(Ce=k.payment_status)==null?void 0:Ce.replace("_"," ")})}),e.jsxs("td",{children:[le(k.status),k.status==="cancelled"&&k.refund_request&&e.jsx("div",{className:"mt-1",children:e.jsxs("small",{className:`badge ${k.refund_request.status==="pending"?"bg-warning text-dark":k.refund_request.status==="approved"?"bg-info":k.refund_request.status==="processed"?"bg-success":k.refund_request.status==="completed"?"bg-primary":k.refund_request.status==="rejected"?"bg-danger":"bg-secondary"}`,children:["Refund: ",k.refund_request.status,k.refund_request.refund_amount>0&&` (â‚±${Number(k.refund_request.refund_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})})`]})})]}),e.jsx("td",{className:"text-muted small",children:k.notes||"â€”"}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex gap-1 flex-wrap",children:[K&&e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>ne(k.id),disabled:m===k.id,children:m===k.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Redirecting..."]}):"Pay now"}),J&&e.jsx("button",{className:"btn btn-success btn-sm",onClick:()=>be(k.id),disabled:f===k.id,title:"Download Receipt",children:f===k.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-receipt me-1"}),"Receipt"]})}),ue&&e.jsxs("button",{className:"btn btn-warning btn-sm",onClick:()=>oe(k),title:"Reschedule Appointment",children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Reschedule"]}),(k.status==="pending"||k.status==="approved"&&(k.payment_status==="unpaid"||k.payment_status==="awaiting_payment"||k.payment_method==="maya"&&k.payment_status==="paid"))&&e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>Z(k.id),disabled:h===k.id||m===k.id||f===k.id,children:h===k.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Canceling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})})]})})]},k.id)})})]})})})})}),e.jsx("div",{className:"d-lg-none",children:a?e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("p",{className:"text-muted mt-2 mb-0",children:"Loading appointments..."})]})}):s.length===0?e.jsx("div",{className:"card border-0 shadow-sm",children:e.jsxs("div",{className:"card-body text-center py-5",children:[e.jsx("i",{className:"bi bi-calendar-x display-4 text-muted"}),e.jsx("h6",{className:"mt-3 text-muted",children:"No appointments yet"}),e.jsx("p",{className:"text-muted mb-3",children:"You haven't booked any appointments yet."}),e.jsxs("a",{href:"/patient/appointment",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-calendar-plus me-2"}),"Book Your First Appointment"]})]})}):s.map(k=>{var ve,Ce;const K=k.payment_method==="maya"&&k.payment_status==="awaiting_payment"&&k.status==="approved",J=k.status==="completed"&&k.payment_status==="paid",ue=k.payment_method==="maya"&&k.payment_status==="paid"&&(k.status==="approved"||k.status==="pending");return e.jsx("div",{className:"card mb-3 border-0 shadow-sm",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-8",children:[e.jsx("h6",{className:"card-title mb-1",children:((ve=k.service)==null?void 0:ve.name)||"â€”"}),e.jsxs("p",{className:"card-text text-muted mb-2",children:[e.jsx("i",{className:"bi bi-calendar me-1"}),k.date," at ",k.start_time]})]}),e.jsx("div",{className:"col-4 text-end",children:le(k.status)})]}),e.jsxs("div",{className:"row mt-2",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Payment Method:"}),e.jsx("div",{className:"badge bg-light text-dark text-capitalize",children:k.payment_method})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("small",{className:"text-muted",children:"Payment Status:"}),e.jsx("div",{children:e.jsx("span",{className:`badge ${k.payment_status==="paid"?"bg-success":k.payment_status==="awaiting_payment"?"bg-warning text-dark":"bg-secondary"}`,children:(Ce=k.payment_status)==null?void 0:Ce.replace("_"," ")})})]})]}),k.status==="cancelled"&&k.refund_request&&e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Refund Status:"}),e.jsx("div",{children:e.jsxs("small",{className:`badge ${k.refund_request.status==="pending"?"bg-warning text-dark":k.refund_request.status==="approved"?"bg-info":k.refund_request.status==="processed"?"bg-success":k.refund_request.status==="rejected"?"bg-danger":"bg-secondary"}`,children:[k.refund_request.status,k.refund_request.refund_amount>0&&` - â‚±${Number(k.refund_request.refund_amount).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`]})})]}),k.notes&&e.jsxs("div",{className:"mt-2",children:[e.jsx("small",{className:"text-muted",children:"Notes:"}),e.jsx("p",{className:"small mb-0",children:k.notes})]}),e.jsxs("div",{className:"d-flex gap-2 mt-3",children:[K&&e.jsx("button",{className:"btn btn-primary btn-sm flex-fill",onClick:()=>ne(k.id),disabled:m===k.id,children:m===k.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Redirecting..."]}):"Pay now"}),J&&e.jsx("button",{className:"btn btn-success btn-sm flex-fill",onClick:()=>be(k.id),disabled:f===k.id,children:f===k.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Generating..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-receipt me-1"}),"Receipt"]})}),ue&&e.jsxs("button",{className:"btn btn-warning btn-sm flex-fill",onClick:()=>oe(k),children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Reschedule"]}),(k.status==="pending"||k.status==="approved"&&(k.payment_status==="unpaid"||k.payment_status==="awaiting_payment"||k.payment_method==="maya"&&k.payment_status==="paid"))&&e.jsx("button",{className:"btn btn-outline-danger btn-sm flex-fill",onClick:()=>Z(k.id),disabled:h===k.id||m===k.id||f===k.id,children:h===k.id?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Canceling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})})]})]})},k.id)})}),!a&&r.last_page>1&&e.jsxs("div",{className:"d-flex justify-content-between align-items-center mt-4",children:[e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",disabled:n===1,onClick:()=>o(n-1),children:[e.jsx("i",{className:"bi bi-chevron-left me-1"}),"Previous"]}),e.jsxs("span",{className:"text-muted",children:["Page ",r.current_page," of ",r.last_page]}),e.jsxs("button",{className:"btn btn-outline-secondary btn-sm",disabled:n===r.last_page,onClick:()=>o(n+1),children:["Next",e.jsx("i",{className:"bi bi-chevron-right ms-1"})]})]})]}),R==="history"&&e.jsx("div",{className:"tab-pane fade show active",children:e.jsx(sl,{})})]}),u&&e.jsx("div",{className:"modal show d-block",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},tabIndex:"-1",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-calendar-event me-2"}),"Reschedule Appointment"]}),e.jsx("button",{type:"button",className:"btn-close",onClick:q,disabled:S})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[e.jsxs("div",{className:"alert alert-info border-0",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"Service:"})," ",(U=u.service)==null?void 0:U.name,e.jsx("br",{}),e.jsx("strong",{children:"Current Date:"})," ",u.date," at ",u.start_time,e.jsx("br",{}),e.jsx("small",{children:"All other details (payment method, service, etc.) will remain the same."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-calendar3 me-2 text-primary"}),"Select New Date"]}),e.jsx("input",{type:"date",className:"form-control",value:p,onChange:Y,min:ce(),max:he(),disabled:S}),e.jsx("div",{className:"form-text",children:"Appointments can be rescheduled from tomorrow up to 7 days in advance"})]}),p&&v.length>0&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{className:"form-label fw-semibold",children:[e.jsx("i",{className:"bi bi-clock me-2 text-primary"}),"Available Time Slots"]}),e.jsxs("select",{className:"form-select",value:z,onChange:k=>T(k.target.value),disabled:S,children:[e.jsx("option",{value:"",children:"-- Select Time Slot --"}),v.map(k=>e.jsx("option",{value:k,children:k},k))]})]}),p&&v.length===0&&e.jsxs("div",{className:"alert alert-warning border-0",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No available slots for this date. Please select a different date."]})]}),e.jsxs("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:q,disabled:S,children:"Cancel"}),e.jsx("button",{type:"button",className:"btn btn-warning",onClick:F,disabled:!p||!z||S,children:S?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),"Rescheduling..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-calendar-event me-1"}),"Reschedule Appointment"]})})]})]})})})]})]})}function tl(){const s=Se(),[l,a]=t.useState(null),{logout:i}=Me();t.useEffect(()=>{M.get("/api/user").then(o=>a(o.data)).catch(()=>a(null))},[]);const n=async()=>{await i(),s("/")};return e.jsx(e.Fragment,{children:e.jsx("nav",{className:"navbar navbar-expand-lg navbar-light shadow-sm px-3",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)"},children:e.jsxs("div",{className:"container-fluid",children:[e.jsxs(ye,{className:"navbar-brand d-flex align-items-center",to:"/dentist",children:[e.jsx("img",{src:us,alt:"Kreative Dental Clinic",style:{height:"32px",width:"32px",objectFit:"contain",marginRight:"8px"}}),e.jsx("span",{className:"fst-bold",style:{color:"white"},children:"Kreative Dental & Orthodontics"})]}),e.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#dentistNavbarNav","aria-controls":"dentistNavbarNav","aria-expanded":"false","aria-label":"Toggle navigation",children:e.jsx("span",{className:"navbar-toggler-icon"})}),e.jsx("div",{className:"collapse navbar-collapse",id:"dentistNavbarNav",children:e.jsxs("ul",{className:"navbar-nav ms-auto d-flex align-items-center",children:[e.jsx("li",{className:"nav-item",children:e.jsxs(ye,{className:"nav-link",to:"/dentist",style:{fontWeight:"500",color:"white"},children:[e.jsx("i",{className:"bi bi-house-door me-1"}),"Home"]})}),e.jsx("li",{className:"nav-item",children:e.jsx("div",{className:"notification-bell",children:e.jsx(Fs,{})})}),e.jsx("li",{className:"nav-item",children:e.jsx("div",{className:"d-flex align-items-center",children:e.jsxs("button",{onClick:n,className:"btn btn-sm d-flex align-items-center",style:{background:"linear-gradient(90deg, #0077b6 0%, #00b4d8 100%)",color:"white",border:"none",fontWeight:"600",padding:"0.5rem 1.2rem",borderRadius:"50px",boxShadow:"0 4px 12px rgba(0, 119, 182, 0.3)",transition:"all 0.3s ease",fontSize:"0.9rem",letterSpacing:"0.5px"},onMouseEnter:o=>{o.target.style.background="linear-gradient(90deg, #0056b3 0%, #0096c7 100%)",o.target.style.transform="translateY(-2px)",o.target.style.boxShadow="0 6px 16px rgba(0, 119, 182, 0.4)"},onMouseLeave:o=>{o.target.style.background="linear-gradient(90deg, #0077b6 0%, #00b4d8 100%)",o.target.style.transform="translateY(0)",o.target.style.boxShadow="0 4px 12px rgba(0, 119, 182, 0.3)"},children:[e.jsx("i",{className:"bi bi-lock-fill me-2",style:{fontSize:"0.9rem",color:"#dc3545"}}),"LOG OUT"]})})})]})})]})})})}function na({children:s}){const[l,a]=t.useState(!0),[i,n]=t.useState(!1),[o,r]=t.useState(""),[c,m]=t.useState(""),[b,f]=t.useState("");t.useEffect(()=>{let h=!0;return(async()=>{var j;try{const u=await M.get("/api/dentist/password-status");if(!h)return;const P=!((j=u==null?void 0:u.data)!=null&&j.password_changed);n(P)}catch(u){console.error("DentistPasswordGate - API Error:",u),n(!1)}finally{a(!1)}})(),()=>{h=!1}},[]);const y=async()=>{var h,j;if(f(""),!o||o.length<8){f("Password must be at least 8 characters.");return}if(o!==c){f("Passwords do not match.");return}try{await M.post("/api/dentist/change-password",{password:o}),n(!1),r(""),m("")}catch(u){f(((j=(h=u==null?void 0:u.response)==null?void 0:h.data)==null?void 0:j.message)||"Failed to change password")}};return l?e.jsx("div",{className:"p-4",children:"Checking accountâ€¦"}):i?e.jsxs("div",{className:"position-relative",children:[e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.7)",zIndex:1050,backdropFilter:"blur(2px)"}}),e.jsx("div",{style:{position:"fixed",inset:0,display:"flex",alignItems:"center",justifyContent:"center",zIndex:1060},children:e.jsxs("div",{className:"card shadow-lg border-warning",style:{width:450,maxWidth:"90vw"},children:[e.jsx("div",{className:"card-header bg-warning text-dark text-center",children:e.jsxs("h4",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-shield-exclamation me-2"}),"Account Security Required"]})}),e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"alert alert-warning mb-3",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"You must change your temporary password to continue."}),e.jsx("br",{}),e.jsx("small",{children:"This is required for account security and cannot be skipped."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"New Password:"}),e.jsx("input",{type:"password",className:"form-control",value:o,onChange:h=>r(h.target.value),placeholder:"Enter your new password",autoFocus:!0})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Confirm Password:"}),e.jsx("input",{type:"password",className:"form-control",value:c,onChange:h=>m(h.target.value),placeholder:"Confirm your new password"})]}),b&&e.jsxs("div",{className:"alert alert-danger mb-3",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),b]}),e.jsx("div",{className:"d-grid",children:e.jsxs("button",{className:"btn btn-primary btn-lg",onClick:y,disabled:!o||!c,children:[e.jsx("i",{className:"bi bi-shield-check me-2"}),"Secure My Account"]})})]})]})})]}):s}function il(){const s=ss(),l=Se(),{user:a}=Me();t.useEffect(()=>{if(a&&a.role!=="dentist"){const n=a.role==="admin"?"/admin":a.role==="staff"?"/staff":a.role==="patient"?"/patient":"/";l(n,{replace:!0})}},[a,l]);const i=s.pathname==="/dentist"||s.pathname==="/dentist/";return e.jsxs("div",{className:"d-flex flex-column min-vh-100 bg-light dentist-layout",children:[e.jsx(tl,{}),i?e.jsx("main",{className:"flex-grow-1",children:e.jsx(na,{children:e.jsx(fs,{})})}):e.jsx("main",{className:"flex-grow-1",children:e.jsx(na,{children:e.jsx(fs,{})})})]})}function ll(){var a;const{user:s}=Me(),l=()=>{const i=new Date().getHours();return i<12?"Good Morning":i<18?"Good Afternoon":"Good Evening"};return e.jsxs("div",{className:"container-fluid py-4",children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white"},children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h1",{className:"h3 mb-2",children:[l(),", Dr. ",((a=s==null?void 0:s.name)==null?void 0:a.split(" ")[0])||"Dentist","! ðŸ‘‹"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Welcome to your dental practice dashboard. Manage patient visits, view your schedule, and stay updated with your clinic operations."})]}),e.jsx("div",{className:"col-md-4 text-md-end",children:e.jsxs("div",{className:"d-flex flex-column align-items-md-end",children:[e.jsx("div",{className:"mb-2",children:e.jsx("i",{className:"bi bi-calendar-check fs-1 opacity-50"})}),e.jsxs("small",{className:"opacity-75",children:["Last login: ",new Date().toLocaleDateString()]})]})})]})})})})}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-12",children:e.jsx("h2",{className:"h4 mb-3",children:"Quick Actions"})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(ye,{to:"/dentist/dashboard",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-key fs-1 text-primary"})}),e.jsx("h5",{className:"card-title text-dark",children:"Process Visit"}),e.jsx("p",{className:"card-text text-muted",children:"Enter visit codes to start patient consultations"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-qr-code me-2"}),"Visit Codes"]})]})})})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(ye,{to:"/dentist/schedule",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar3 fs-1 text-success"})}),e.jsx("h5",{className:"card-title text-dark",children:"View Schedule"}),e.jsx("p",{className:"card-text text-muted",children:"View your clinic schedule and working hours"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"View Schedule"]})]})})})}),e.jsx("div",{className:"col-md-4 mb-3",children:e.jsx(ye,{to:"/dentist/profile",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-person-circle fs-1 text-info"})}),e.jsx("h5",{className:"card-title text-dark",children:"My Profile"}),e.jsx("p",{className:"card-text text-muted",children:"Update your personal information and preferences"}),e.jsxs("div",{className:"btn",style:{background:"linear-gradient(135deg, #00b4d8 0%, #0077b6 100%)",color:"white",border:"none"},children:[e.jsx("i",{className:"bi bi-gear me-2"}),"Manage"]})]})})})})]}),e.jsx("div",{className:"row mt-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-sm bg-light",children:e.jsx("div",{className:"card-body p-4",children:e.jsxs("div",{className:"row align-items-center",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsxs("h4",{className:"h5 mb-2",children:[e.jsx("i",{className:"bi bi-lightbulb text-warning me-2"}),"Practice Management Tip"]}),e.jsx("p",{className:"mb-0 text-muted",children:"Keep your schedule updated and maintain clear communication with patients. Regular follow-ups and efficient visit processing enhance patient satisfaction!"})]}),e.jsx("div",{className:"col-md-4 text-md-end",children:e.jsx("i",{className:"bi bi-tooth fs-1 opacity-25",style:{color:"#00b4d8"}})})]})})})})}),e.jsx("style",{jsx:!0,children:`
        .hover-lift {
          transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .hover-lift:hover {
          transform: translateY(-5px);
          box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
        }
      `})]})}const nl=()=>{const[s,l]=t.useState(null),[a,i]=t.useState(!1),[n,o]=t.useState(""),[r,c]=t.useState(""),[m,b]=t.useState({}),[f,y]=t.useState(""),[h,j]=t.useState(!1);Se();const u=async()=>{try{const N=await M.get("/api/user");l(N.data),console.log(N.data)}catch(N){console.error("Failed to fetch user info",N)}};t.useEffect(()=>{u()},[]);const P=async()=>{var N,x,p,C;if(y(""),b({}),j(!0),!n){b({newPassword:"New password is required"}),j(!1);return}if(n.length<8){b({newPassword:"Password must be at least 8 characters"}),j(!1);return}if(n!==r){b({confirmPassword:"Passwords do not match"}),j(!1);return}try{const v=await M.post("/api/dentist/change-password",{password:n});y("âœ… Password changed successfully!"),i(!1),o(""),c("")}catch(v){(x=(N=v.response)==null?void 0:N.data)!=null&&x.errors?b(v.response.data.errors):y("âŒ "+(((C=(p=v.response)==null?void 0:p.data)==null?void 0:C.message)||"Failed to change password"))}finally{j(!1)}},g=async()=>{var N,x;y(""),b({}),j(!0);try{const p=await M.post("/api/send-password-reset");y(p.data.message||"Password reset link sent to your email!")}catch(p){const C=((x=(N=p.response)==null?void 0:N.data)==null?void 0:x.message)||"Failed to send reset link";y("âŒ "+C)}finally{j(!1)}};if(!s)return e.jsx("p",{children:"Loading your profile..."});const _=s.role;return e.jsx("div",{className:"w-100",children:e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsxs("div",{className:"card border-0 shadow-lg w-100 dentist-page-card",children:[e.jsxs("div",{className:"card-header bg-gradient bg-primary text-white text-center py-4",children:[e.jsxs("h2",{className:"h3 mb-2",children:[e.jsx("i",{className:"bi bi-person-circle me-2"}),"My Account"]}),e.jsx("p",{className:"mb-0 opacity-75",children:"Manage your personal information and account settings"})]}),e.jsxs("div",{className:"card-body p-5",children:[e.jsxs("div",{className:"row mb-5",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h4",{className:"h5 mb-3 text-primary",children:[e.jsx("i",{className:"bi bi-person me-2"}),"Personal Information"]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Full Name"}),e.jsx("div",{className:"form-control-plaintext bg-light p-3 rounded",children:s.name||"Not provided"})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Email Address"}),e.jsxs("div",{className:"form-control-plaintext bg-light p-3 rounded",children:[s.email||"Not provided",s.email_verified_at&&e.jsxs("span",{className:"badge bg-success ms-2",children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),"Verified"]})]})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Role"}),e.jsx("div",{className:"form-control-plaintext bg-light p-3 rounded",children:e.jsx("span",{className:"badge bg-primary text-capitalize",children:_})})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label fw-semibold",children:"Contact Number"}),e.jsx("div",{className:"form-control-plaintext bg-light p-3 rounded",children:s.contact_number||"Not provided"})]})})]}),e.jsxs("div",{className:"row mb-5",children:[e.jsx("div",{className:"col-12",children:e.jsxs("h4",{className:"h5 mb-3 text-primary",children:[e.jsx("i",{className:"bi bi-shield-lock me-2"}),"Account Security"]})}),e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 bg-light",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h6",{className:"mb-1",children:"Password"}),e.jsx("p",{className:"text-muted mb-0",children:"Last updated: Recently"})]}),e.jsxs("div",{children:[e.jsxs("button",{className:"btn btn-outline-primary me-2",onClick:()=>i(!a),children:[e.jsx("i",{className:"bi bi-key me-1"}),"Change Password"]}),e.jsxs("button",{className:"btn btn-outline-secondary",onClick:g,disabled:h,children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-1"}),"Reset Password"]})]})]})})})})]}),a&&e.jsx("div",{className:"row mb-5",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card border-warning",children:[e.jsx("div",{className:"card-header bg-warning text-dark",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-key me-2"}),"Change Password"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"New Password"}),e.jsx("input",{type:"password",className:`form-control ${m.newPassword?"is-invalid":""}`,value:n,onChange:N=>o(N.target.value),placeholder:"Enter new password"}),m.newPassword&&e.jsx("div",{className:"invalid-feedback",children:m.newPassword})]})}),e.jsx("div",{className:"col-md-6",children:e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"form-label",children:"Confirm New Password"}),e.jsx("input",{type:"password",className:`form-control ${m.confirmPassword?"is-invalid":""}`,value:r,onChange:N=>c(N.target.value),placeholder:"Confirm new password"}),m.confirmPassword&&e.jsx("div",{className:"invalid-feedback",children:m.confirmPassword})]})}),e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-primary",onClick:P,disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"}),"Changing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-check-circle me-1"}),"Change Password"]})}),e.jsxs("button",{className:"btn btn-secondary",onClick:()=>{i(!1),o(""),c(""),b({})},children:[e.jsx("i",{className:"bi bi-x-circle me-1"}),"Cancel"]})]})})]})})]})})}),f&&e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:`alert ${f.includes("âœ…")?"alert-success":"alert-danger"} alert-dismissible fade show`,children:[f,e.jsx("button",{type:"button",className:"btn-close",onClick:()=>y("")})]})})})]})]})})})},rl=()=>{const{user:s}=Me();return e.jsx("div",{className:"w-100",children:e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{children:"ðŸ¦· Dentist Dashboard"}),e.jsxs("div",{className:"text-muted",children:["Welcome, Dr. ",(s==null?void 0:s.name)||"Dentist"]})]}),e.jsxs("div",{className:"row mb-4",children:[e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx(ye,{to:"/dentist/visit-manager",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-key fs-1 text-primary"})}),e.jsx("h5",{className:"card-title text-dark",children:"Visit Manager"}),e.jsx("p",{className:"card-text text-muted",children:"Enter visit codes to manage patient consultations, notes, and history"}),e.jsxs("div",{className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-key me-2"}),"Start Visit"]})]})})})}),e.jsx("div",{className:"col-md-6 mb-3",children:e.jsx(ye,{to:"/dentist/schedule-view",className:"text-decoration-none",children:e.jsx("div",{className:"card h-100 border-0 shadow-sm hover-lift",children:e.jsxs("div",{className:"card-body text-center p-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("i",{className:"bi bi-calendar-check fs-1 text-info"})}),e.jsx("h5",{className:"card-title text-dark",children:"Clinic Schedule"}),e.jsx("p",{className:"card-text text-muted",children:"View clinic operating hours and capacity settings"}),e.jsxs("div",{className:"btn btn-info",children:[e.jsx("i",{className:"bi bi-calendar me-2"}),"View Schedule"]})]})})})})]}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("h5",{children:"How to use the Visit Manager:"}),e.jsxs("ol",{children:[e.jsx("li",{children:'Click "Start Visit" to access the Visit Manager'}),e.jsx("li",{children:"Enter the 6-character visit code provided by staff"}),e.jsx("li",{children:'Switch between "Enter Notes" and "Patient History" tabs'}),e.jsx("li",{children:"Enter your notes, findings, treatment plan, and teeth treated"}),e.jsx("li",{children:"View complete patient history for better context"}),e.jsx("li",{children:"Save your notes - staff can access them during completion"})]})]})]})})})})};function cl(){const{user:s}=Me(),[l,a]=t.useState(null),[i,n]=t.useState([]),[o,r]=t.useState(!0),[c,m]=t.useState(""),b=[{key:"sun",label:"Sunday"},{key:"mon",label:"Monday"},{key:"tue",label:"Tuesday"},{key:"wed",label:"Wednesday"},{key:"thu",label:"Thursday"},{key:"fri",label:"Friday"},{key:"sat",label:"Saturday"}];t.useEffect(()=>{f()},[]);const f=async()=>{try{r(!0),m("");const u=await M.get("/api/dentist/clinic-schedule");n(u.data);const P=await M.get("/api/dentist/my-schedule");a(P.data)}catch(u){console.error("Failed to fetch schedules",u),m("Failed to load schedule information. Please try again.")}finally{r(!1)}},y=()=>l?b.filter(u=>l[u.key]):[],h=u=>i.find(P=>P.weekday===u),j=u=>u?new Date(`2000-01-01T${u}`).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0}):"Closed";return o?e.jsx(ze,{message:"Loading schedule..."}):c?e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),c]})}):e.jsx("div",{className:"dentist-schedule w-100",children:e.jsxs("div",{className:"container-fluid px-4 py-4",children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{className:"h3 mb-0",children:"ðŸ“… My Schedule"}),e.jsxs("div",{className:"text-muted",children:["Dr. ",(s==null?void 0:s.name)||(l==null?void 0:l.dentist_name)||(l==null?void 0:l.dentist_code)||"Dentist"]})]})})}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-lg-6 mb-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person-check me-2"}),"My Working Days"]})}),e.jsx("div",{className:"card-body",children:l?e.jsxs("div",{children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Dentist Code:"})," ",l.dentist_code]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Employment Type:"}),e.jsx("span",{className:`badge ms-2 ${l.employment_type==="full_time"?"bg-success":l.employment_type==="part_time"?"bg-warning":"bg-info"}`,children:l.employment_type.replace("_"," ").toUpperCase()})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("strong",{children:"Status:"}),e.jsx("span",{className:`badge ms-2 ${l.status==="active"?"bg-success":"bg-secondary"}`,children:l.status.toUpperCase()})]}),e.jsx("hr",{}),e.jsx("h6",{children:"Working Days:"}),e.jsx("div",{className:"row",children:b.map(u=>e.jsx("div",{className:"col-6 col-md-4 mb-2",children:e.jsxs("div",{className:`d-flex align-items-center ${l[u.key]?"text-success":"text-muted"}`,children:[e.jsx("i",{className:`bi ${l[u.key]?"bi-check-circle-fill":"bi-x-circle"} me-2`}),u.label]})},u.key))})]}):e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"No dentist schedule information available."]})})]})}),e.jsx("div",{className:"col-lg-6 mb-4",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-success text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-building me-2"}),"Clinic Operating Hours"]})}),e.jsx("div",{className:"card-body",children:i.length>0?e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Day"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Hours"}),e.jsx("th",{children:"Note"})]})}),e.jsx("tbody",{children:b.map((u,P)=>{const g=h(P);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("strong",{children:u.label})}),e.jsx("td",{children:g?g.is_open?e.jsx("span",{className:"badge bg-success",children:"Open"}):e.jsx("span",{className:"badge bg-secondary",children:"Closed"}):e.jsx("span",{className:"badge bg-secondary",children:"Closed"})}),e.jsx("td",{children:g&&g.is_open?`${j(g.open_time)} - ${j(g.close_time)}`:"Closed"}),e.jsx("td",{children:g&&g.note&&e.jsx("small",{className:"text-muted",children:g.note})})]},u.key)})})]})}):e.jsxs("div",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"No clinic schedule information available."]})})]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"card",children:[e.jsx("div",{className:"card-header bg-info text-white",children:e.jsxs("h5",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-calendar-check me-2"}),"Schedule Summary"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Your Working Days:"}),e.jsx("p",{className:"text-muted",children:l?y().length>0?y().map(u=>u.label).join(", "):"No working days assigned":"Schedule information not available"})]}),e.jsxs("div",{className:"col-md-6",children:[e.jsx("h6",{children:"Clinic Status:"}),e.jsx("p",{className:"text-muted",children:i.filter(u=>u.is_open).length>0?`Open ${i.filter(u=>u.is_open).length} days per week`:"Clinic schedule not available"})]})]})})]})})})]})})}const dl="/assets/Primary_Teeth_Chart-ZBPnKwPo.png",ol=({selectedTeeth:s=[],onTeethChange:l,showChart:a=!1,onToggleChart:i,maxSelection:n=null})=>{const[o,r]=t.useState("adult"),c=[{number:1,name:"Third Molar",quadrant:"Upper Right"},{number:2,name:"Second Molar",quadrant:"Upper Right"},{number:3,name:"First Molar",quadrant:"Upper Right"},{number:4,name:"Second Premolar",quadrant:"Upper Right"},{number:5,name:"First Premolar",quadrant:"Upper Right"},{number:6,name:"Canine",quadrant:"Upper Right"},{number:7,name:"Lateral Incisor",quadrant:"Upper Right"},{number:8,name:"Central Incisor",quadrant:"Upper Right"},{number:9,name:"Central Incisor",quadrant:"Upper Left"},{number:10,name:"Lateral Incisor",quadrant:"Upper Left"},{number:11,name:"Canine",quadrant:"Upper Left"},{number:12,name:"First Premolar",quadrant:"Upper Left"},{number:13,name:"Second Premolar",quadrant:"Upper Left"},{number:14,name:"First Molar",quadrant:"Upper Left"},{number:15,name:"Second Molar",quadrant:"Upper Left"},{number:16,name:"Third Molar",quadrant:"Upper Left"},{number:17,name:"Third Molar",quadrant:"Lower Left"},{number:18,name:"Second Molar",quadrant:"Lower Left"},{number:19,name:"First Molar",quadrant:"Lower Left"},{number:20,name:"Second Premolar",quadrant:"Lower Left"},{number:21,name:"First Premolar",quadrant:"Lower Left"},{number:22,name:"Canine",quadrant:"Lower Left"},{number:23,name:"Lateral Incisor",quadrant:"Lower Left"},{number:24,name:"Central Incisor",quadrant:"Lower Left"},{number:25,name:"Central Incisor",quadrant:"Lower Right"},{number:26,name:"Lateral Incisor",quadrant:"Lower Right"},{number:27,name:"Canine",quadrant:"Lower Right"},{number:28,name:"First Premolar",quadrant:"Lower Right"},{number:29,name:"Second Premolar",quadrant:"Lower Right"},{number:30,name:"First Molar",quadrant:"Lower Right"},{number:31,name:"Second Molar",quadrant:"Lower Right"},{number:32,name:"Third Molar",quadrant:"Lower Right"}],m=[{letter:"A",name:"Second Molar",quadrant:"Upper Right"},{letter:"B",name:"First Molar",quadrant:"Upper Right"},{letter:"C",name:"Canine",quadrant:"Upper Right"},{letter:"D",name:"Lateral Incisor",quadrant:"Upper Right"},{letter:"E",name:"Central Incisor",quadrant:"Upper Right"},{letter:"F",name:"Central Incisor",quadrant:"Upper Left"},{letter:"G",name:"Lateral Incisor",quadrant:"Upper Left"},{letter:"H",name:"Canine",quadrant:"Upper Left"},{letter:"I",name:"First Molar",quadrant:"Upper Left"},{letter:"J",name:"Second Molar",quadrant:"Upper Left"},{letter:"K",name:"Second Molar",quadrant:"Lower Left"},{letter:"L",name:"First Molar",quadrant:"Lower Left"},{letter:"M",name:"Canine",quadrant:"Lower Left"},{letter:"N",name:"Lateral Incisor",quadrant:"Lower Left"},{letter:"O",name:"Central Incisor",quadrant:"Lower Left"},{letter:"P",name:"Central Incisor",quadrant:"Lower Right"},{letter:"Q",name:"Lateral Incisor",quadrant:"Lower Right"},{letter:"R",name:"Canine",quadrant:"Lower Right"},{letter:"S",name:"First Molar",quadrant:"Lower Right"},{letter:"T",name:"Second Molar",quadrant:"Lower Right"}],b=j=>{const u=j.toString();let P=[...s];if(P.includes(u))P=P.filter(g=>g!==u);else{if(n&&P.length>=n){alert(`You can only select up to ${n} teeth as specified in the appointment.`);return}P.push(u)}o==="adult"?P.sort((g,_)=>parseInt(g)-parseInt(_)):P.sort(),l(P.join(","))},f=()=>{l("")},y=()=>{let j;o==="adult"?j=c.map(u=>u.number.toString()):j=m.map(u=>u.letter),n&&j.length>n&&(j=j.slice(0,n),alert(`Selection limited to ${n} teeth as specified in the appointment.`)),l(j.join(","))},h=j=>{j!==o&&(r(j),l(""))};return a?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-diagram-3 me-2"}),"Tooth Chart Reference"]}),e.jsxs("button",{type:"button",className:"btn btn-outline-secondary btn-sm",onClick:i,children:[e.jsx("i",{className:"bi bi-x-lg me-1"}),"Hide Chart"]})]}),e.jsx("div",{className:"card",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"text-center mb-3",children:[e.jsx("h6",{className:"text-muted",children:"Universal Numbering System"}),e.jsx("p",{className:"text-muted small mb-0",children:"Click on tooth numbers/letters below to select/deselect"})]}),e.jsx("div",{className:"d-flex justify-content-center mb-4",children:e.jsxs("div",{className:"btn-group",role:"group","aria-label":"Tooth chart tabs",children:[e.jsxs("button",{type:"button",className:`btn ${o==="adult"?"btn-primary":"btn-outline-primary"}`,onClick:()=>h("adult"),children:[e.jsx("i",{className:"bi bi-person me-1"}),"Adult Teeth (1-32)"]}),e.jsxs("button",{type:"button",className:`btn ${o==="primary"?"btn-primary":"btn-outline-primary"}`,onClick:()=>h("primary"),children:[e.jsx("i",{className:"bi bi-person-heart me-1"}),"Primary Teeth (A-T)"]})]})}),e.jsxs("div",{className:"alert alert-info mb-4",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),e.jsx("strong",{children:"Note:"})," If the teeth done is in letters (A-T), it's primary teeth. If it's in numbers (1-32), it's adult teeth.",n&&e.jsxs("div",{className:"mt-2",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),e.jsx("strong",{children:"Selection Limit:"})," You can select up to ",n," teeth as specified in the appointment."]})]}),e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-5 mb-3",children:e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:o==="adult"?Va:dl,alt:o==="adult"?"Adult Dental Chart Reference":"Primary Teeth Chart Reference",className:"img-fluid",style:{maxWidth:"300px",height:"auto",border:"1px solid #dee2e6",borderRadius:"8px",backgroundColor:"#f8f9fa"}}),e.jsx("small",{className:"text-muted d-block mt-2",children:o==="adult"?"Adult Teeth Reference Chart":"Primary Teeth Reference Chart"})]})}),e.jsxs("div",{className:"col-md-7",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsxs("h6",{className:"text-primary",children:[e.jsx("i",{className:"bi bi-mouse me-2"}),"Click to Select Teeth"]})}),o==="adult"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsx("strong",{className:"text-primary",children:"UPPER TEETH (1-16)"})}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16].map(j=>{const u=c.find(P=>P.number===j);return e.jsx("button",{type:"button",className:`btn ${s.includes(j.toString())?"btn-warning":"btn-outline-primary"}`,style:{width:j>=10?"50px":"45px",height:"45px",fontSize:"1rem",fontWeight:"bold",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(j),title:`Tooth ${j}: ${u==null?void 0:u.name}`,children:j},j)})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsx("strong",{className:"text-primary",children:"LOWER TEETH (32-17)"})}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:[32,31,30,29,28,27,26,25,24,23,22,21,20,19,18,17].map(j=>{const u=c.find(P=>P.number===j);return e.jsx("button",{type:"button",className:`btn ${s.includes(j.toString())?"btn-warning":"btn-outline-primary"}`,style:{width:j>=10?"50px":"45px",height:"45px",fontSize:"1rem",fontWeight:"bold",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(j),title:`Tooth ${j}: ${u==null?void 0:u.name}`,children:j},j)})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsx("strong",{className:"text-primary",children:"UPPER TEETH (A-J)"})}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:["A","B","C","D","E","F","G","H","I","J"].map(j=>{const u=m.find(P=>P.letter===j);return e.jsx("button",{type:"button",className:`btn ${s.includes(j)?"btn-warning":"btn-outline-primary"}`,style:{width:"45px",height:"45px",fontSize:"1rem",fontWeight:"bold",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(j),title:`Tooth ${j}: ${u==null?void 0:u.name}`,children:j},j)})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("div",{className:"text-center mb-3",children:e.jsx("strong",{className:"text-primary",children:"LOWER TEETH (K-T)"})}),e.jsx("div",{className:"d-flex justify-content-center flex-wrap gap-2",children:["K","L","M","N","O","P","Q","R","S","T"].map(j=>{const u=m.find(P=>P.letter===j);return e.jsx("button",{type:"button",className:`btn ${s.includes(j)?"btn-warning":"btn-outline-primary"}`,style:{width:"45px",height:"45px",fontSize:"1rem",fontWeight:"bold",whiteSpace:"nowrap",display:"flex",alignItems:"center",justifyContent:"center"},onClick:()=>b(j),title:`Tooth ${j}: ${u==null?void 0:u.name}`,children:j},j)})})]})]})]})]}),e.jsxs("div",{className:"d-flex justify-content-center gap-2 mt-3",children:[e.jsxs("button",{type:"button",className:"btn btn-outline-success btn-sm",onClick:y,children:[e.jsx("i",{className:"bi bi-check-all me-1"}),"Select All"]}),e.jsxs("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:f,children:[e.jsx("i",{className:"bi bi-x-lg me-1"}),"Clear All"]})]}),s.length>0&&e.jsx("div",{className:"mt-3 p-3 bg-light rounded border",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsxs("div",{children:[e.jsx("small",{className:"text-muted d-block",children:"Selected teeth:"}),e.jsx("strong",{className:"text-primary fs-6",children:s.join(", ")})]}),e.jsxs("div",{className:"text-end",children:[e.jsx("small",{className:"text-muted d-block",children:"Total count:"}),e.jsxs("strong",{className:"text-success",children:[s.length," tooth",s.length!==1?"s":""]})]})]})})]})})]}):e.jsx("div",{className:"mb-3",children:e.jsxs("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:i,children:[e.jsx("i",{className:"bi bi-diagram-3 me-1"}),"Show Tooth Chart"]})})};function ml({medicalHistory:s}){if(!s)return e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{className:"bi bi-info-circle me-2"}),"Medical history has not been completed for this visit."]});const l=i=>{if(!i)return"N/A";try{return new Date(i).toLocaleDateString()}catch{return i}},a=i=>i==null?"Not specified":i?"Yes":"No";return e.jsxs("div",{className:"medical-history-view",style:{maxHeight:"70vh",overflowY:"auto"},children:[e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-primary text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-person me-2"}),"Patient Information"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Full Name:"})," ",s.full_name||"N/A"]}),e.jsxs("div",{className:"col-md-3 mb-2",children:[e.jsx("strong",{children:"Age:"})," ",s.age||"N/A"]}),e.jsxs("div",{className:"col-md-3 mb-2",children:[e.jsx("strong",{children:"Sex:"})," ",s.sex?s.sex.charAt(0).toUpperCase()+s.sex.slice(1):"N/A"]}),e.jsxs("div",{className:"col-md-12 mb-2",children:[e.jsx("strong",{children:"Address:"})," ",s.address||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Contact Number:"})," ",s.contact_number||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Email:"})," ",s.email||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Occupation:"})," ",s.occupation||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Date of Birth:"})," ",l(s.date_of_birth)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Previous Dentist:"})," ",s.previous_dentist||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Last Dental Visit:"})," ",l(s.last_dental_visit)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Physician Name:"})," ",s.physician_name||"N/A"]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Physician Address:"})," ",s.physician_address||"N/A"]})]})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-info text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-heart-pulse me-2"}),"Health Questions"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"In good health:"})," ",a(s.in_good_health)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Under medical treatment:"})," ",a(s.under_medical_treatment)]}),s.under_medical_treatment&&s.medical_treatment_details&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Treatment Details:"})," ",s.medical_treatment_details]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Serious illness or surgery:"})," ",a(s.serious_illness_surgery)]}),s.serious_illness_surgery&&s.illness_surgery_details&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Illness/Surgery Details:"})," ",s.illness_surgery_details]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Hospitalized:"})," ",a(s.hospitalized)]}),s.hospitalized&&s.hospitalization_details&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Hospitalization Details:"})," ",s.hospitalization_details]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Taking medications:"})," ",a(s.taking_medications)]}),s.taking_medications&&s.medications_list&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Medications List:"})," ",s.medications_list]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Uses tobacco:"})," ",a(s.uses_tobacco)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Uses alcohol/drugs:"})," ",a(s.uses_alcohol_drugs)]})]})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-warning text-dark",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"Allergies"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Local Anesthetic:"})," ",a(s.allergic_local_anesthetic)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Penicillin:"})," ",a(s.allergic_penicillin)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Sulfa:"})," ",a(s.allergic_sulfa)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Aspirin:"})," ",a(s.allergic_aspirin)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Latex:"})," ",a(s.allergic_latex)]}),s.allergic_others&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Other Allergies:"})," ",s.allergic_others]})]})})]}),s.sex==="female"&&e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-secondary text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-gender-female me-2"}),"For Women Only"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Pregnant:"})," ",a(s.is_pregnant)]}),e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Nursing:"})," ",a(s.is_nursing)]}),e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Taking Birth Control:"})," ",a(s.taking_birth_control)]})]})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-danger text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-heartbeat me-2"}),"Vital Information"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Blood Type:"})," ",s.blood_type||"N/A"]}),e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Blood Pressure:"})," ",s.blood_pressure||"N/A"]}),e.jsxs("div",{className:"col-md-4 mb-2",children:[e.jsx("strong",{children:"Bleeding Time:"})," ",s.bleeding_time||"N/A"]})]})})]}),e.jsxs("div",{className:"card mb-3",children:[e.jsx("div",{className:"card-header bg-dark text-white",children:e.jsxs("h6",{className:"mb-0",children:[e.jsx("i",{className:"bi bi-file-medical me-2"}),"Medical Conditions"]})}),e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"High Blood Pressure:"})," ",a(s.high_blood_pressure)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Low Blood Pressure:"})," ",a(s.low_blood_pressure)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Heart Disease:"})," ",a(s.heart_disease)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Heart Murmur:"})," ",a(s.heart_murmur)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Chest Pain:"})," ",a(s.chest_pain)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Stroke:"})," ",a(s.stroke)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Diabetes:"})," ",a(s.diabetes)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Hepatitis:"})," ",a(s.hepatitis)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Tuberculosis:"})," ",a(s.tuberculosis)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Kidney Disease:"})," ",a(s.kidney_disease)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Cancer:"})," ",a(s.cancer)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Asthma:"})," ",a(s.asthma)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Anemia:"})," ",a(s.anemia)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Arthritis:"})," ",a(s.arthritis)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Epilepsy:"})," ",a(s.epilepsy)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"AIDS/HIV:"})," ",a(s.aids_hiv)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Stomach Troubles:"})," ",a(s.stomach_troubles)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Thyroid Problems:"})," ",a(s.thyroid_problems)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Hay Fever:"})," ",a(s.hay_fever)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Head Injuries:"})," ",a(s.head_injuries)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Rapid Weight Loss:"})," ",a(s.rapid_weight_loss)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Joint Replacement:"})," ",a(s.joint_replacement)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Radiation Therapy:"})," ",a(s.radiation_therapy)]}),e.jsxs("div",{className:"col-md-6 mb-2",children:[e.jsx("strong",{children:"Swollen Ankles:"})," ",a(s.swollen_ankles)]}),s.other_conditions&&e.jsxs("div",{className:"col-12 mb-2",children:[e.jsx("strong",{children:"Other Conditions:"})," ",s.other_conditions]})]})})]}),s.completed_at&&e.jsx("div",{className:"alert alert-success",children:e.jsxs("small",{children:[e.jsx("i",{className:"bi bi-check-circle me-2"}),"Completed on ",l(s.completed_at),s.completedBy&&` by ${s.completedBy.name||"Staff"}`]})})]})}function ra(){var G,$;const s=Se(),{visitCode:l}=Ms(),[a,i]=t.useState(l||""),[n,o]=t.useState(!1),[r,c]=t.useState(""),[m,b]=t.useState(null),[f,y]=t.useState("notes"),[h,j]=t.useState({dentist_notes:"",findings:"",treatment_plan:"",teeth_treated:""}),[u,P]=t.useState(!1),[g,_]=t.useState(!1),[N,x]=t.useState(null),[p,C]=t.useState(null),[v,A]=t.useState("");t.useEffect(()=>{l&&!m&&!n&&(async()=>{var E,I;o(!0),c("");try{const W=await M.get(`/api/visits/resolve/${l.trim()}`);if(b(W.data),W.data.has_existing_notes){const B=await M.get(`/api/visits/${W.data.visit.id}/dentist-notes`);j({dentist_notes:B.data.dentist_notes||"",findings:B.data.findings||"",treatment_plan:B.data.treatment_plan||"",teeth_treated:B.data.teeth_treated||""})}}catch(W){c(((I=(E=W.response)==null?void 0:E.data)==null?void 0:I.message)||"Failed to resolve visit code"),b(null)}finally{o(!1)}})()},[l]);const z=({id:L,icon:E,label:I})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${f===L?"":"btn-outline-primary"}`,onClick:()=>y(L),type:"button",style:{background:f===L?"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)":"transparent",color:f===L?"white":"#3b82f6",border:f===L?"none":"1px solid #3b82f6",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${E==="ðŸ“"?"pencil-square":E==="ðŸ¥"?"file-medical":"clock-history"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:I}),e.jsx("span",{className:"d-sm-none",children:I.split(" ")[0]})]}),T=async L=>{var E,I;if(L.preventDefault(),!!a.trim()){o(!0),c("");try{const W=await M.get(`/api/visits/resolve/${a.trim()}`);if(b(W.data),W.data.has_existing_notes){const B=await M.get(`/api/visits/${W.data.visit.id}/dentist-notes`);j({dentist_notes:B.data.dentist_notes||"",findings:B.data.findings||"",treatment_plan:B.data.treatment_plan||"",teeth_treated:B.data.teeth_treated||""})}}catch(W){c(((I=(E=W.response)==null?void 0:E.data)==null?void 0:I.message)||"Failed to resolve visit code"),b(null)}finally{o(!1)}}},S=async()=>{var L,E;if(m){P(!0);try{await M.post(`/api/visits/${m.visit.id}/save-dentist-notes`,h),confirm(`Notes saved successfully!

Do you want to finish this consultation and return to the main page?`)&&(H(),s("/dentist/dashboard"))}catch(I){alert("Failed to save notes: "+(((E=(L=I.response)==null?void 0:L.data)==null?void 0:E.message)||"Unknown error"))}finally{P(!1)}}},d=async L=>{var E,I;x(L),A("");try{const W=await M.get(`/api/visits/${L}/dentist-notes`);C({visitId:L,...W.data})}catch(W){A(((I=(E=W.response)==null?void 0:E.data)==null?void 0:I.message)||"Failed to fetch visit notes")}finally{x(null)}},R=()=>{C(null),A("")},H=()=>{i(""),b(null),j({dentist_notes:"",findings:"",treatment_plan:"",teeth_treated:""}),c(""),C(null),A(""),_(!1),y("notes")};return e.jsxs("div",{className:"w-100",children:[e.jsx("div",{className:"container-fluid px-4 py-4",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("h2",{children:"ðŸ¦· Dentist Visit Manager"}),e.jsxs("button",{className:"btn btn-outline-secondary",onClick:()=>s("/dentist/dashboard"),children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back to Dashboard"]})]}),e.jsxs("div",{className:"card border-0 shadow-lg",style:{borderRadius:"16px"},children:[e.jsxs("div",{className:"card-header bg-primary text-white border-0",style:{borderRadius:"16px 16px 0 0"},children:[e.jsxs("h4",{className:"card-title mb-0 fw-bold",children:[e.jsx("i",{className:"bi bi-key me-2"}),"Dentist Visit Code"]}),e.jsx("p",{className:"mb-0 mt-2 opacity-75",children:"Enter visit code to access patient information and notes"})]}),e.jsx("div",{className:"card-body p-4",children:m?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"alert alert-info",children:[e.jsx("h5",{children:"Patient Information"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Name:"})," ",m.patient.first_name," ",m.patient.last_name]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Contact:"})," ",m.patient.contact_number||"Not provided"]}),m.service&&e.jsxs("p",{children:[e.jsx("strong",{children:"Service:"})," ",m.service.name]}),m.appointment&&m.appointment.teeth_count&&e.jsxs("p",{children:[e.jsx("strong",{children:"Number of Teeth to be Treated:"})," ",m.appointment.teeth_count]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Visit Date:"})," ",new Date(m.visit.visit_date).toLocaleDateString()]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Consultation Started:"})," ",new Date(m.visit.consultation_started_at).toLocaleString()]})]}),e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2 mb-4",role:"group","aria-label":"Visit tabs",children:[e.jsx(z,{id:"notes",icon:"ðŸ“",label:"Enter Notes"}),e.jsx(z,{id:"medical-history",icon:"ðŸ¥",label:"Medical History"}),e.jsx(z,{id:"history",icon:"ðŸ“‹",label:"Patient History"})]}),e.jsxs("div",{className:"tab-content",children:[f==="notes"&&e.jsxs("div",{className:"tab-pane fade show active",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Dentist Notes"}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"dentistNotes",className:"form-label",children:"Dentist Notes"}),e.jsx("textarea",{className:"form-control",id:"dentistNotes",rows:"4",value:h.dentist_notes,onChange:L=>j({...h,dentist_notes:L.target.value}),placeholder:"Enter consultation notes..."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"findings",className:"form-label",children:"Findings"}),e.jsx("textarea",{className:"form-control",id:"findings",rows:"3",value:h.findings,onChange:L=>j({...h,findings:L.target.value}),placeholder:"Enter clinical findings..."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"treatmentPlan",className:"form-label",children:"Treatment Plan"}),e.jsx("textarea",{className:"form-control",id:"treatmentPlan",rows:"3",value:h.treatment_plan,onChange:L=>j({...h,treatment_plan:L.target.value}),placeholder:"Enter treatment plan..."})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"teethTreated",className:"form-label",children:"Teeth Treated"}),e.jsx("input",{type:"text",className:"form-control",id:"teethTreated",value:h.teeth_treated,onChange:L=>j({...h,teeth_treated:L.target.value}),placeholder:"e.g., 1,2,3,4,5 or leave blank if not applicable"}),e.jsx("div",{className:"form-text",children:"Enter tooth numbers separated by commas (e.g., 1,2,3,4,5) or use the interactive tooth chart below for visual selection."}),e.jsx(ol,{selectedTeeth:h.teeth_treated?h.teeth_treated.split(",").map(L=>L.trim()):[],onTeethChange:L=>j({...h,teeth_treated:L}),showChart:g,onToggleChart:()=>_(!g),maxSelection:((G=m.appointment)==null?void 0:G.teeth_count)||null})]})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsx("button",{className:"btn btn-success",onClick:S,disabled:u,children:u?"Saving...":"Save Notes"}),e.jsx("button",{className:"btn btn-secondary",onClick:H,children:"New Code"})]})]}),f==="medical-history"&&e.jsx("div",{className:"tab-pane fade show active",children:e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Medical and Dental History"}),e.jsx(ml,{medicalHistory:m.medical_history})]})}),f==="history"&&e.jsx("div",{className:"tab-pane fade show active",children:m.patient_history&&m.patient_history.length>0?e.jsxs("div",{className:"mb-4",children:[e.jsx("h6",{children:"Complete Visit History"}),e.jsx("div",{className:"table-responsive",children:e.jsxs("table",{className:"table table-hover",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"Service"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Teeth Treated"}),e.jsx("th",{children:"Notes"})]})}),e.jsx("tbody",{children:m.patient_history.map(L=>e.jsxs("tr",{children:[e.jsxs("td",{children:[e.jsx("strong",{children:new Date(L.visit_date).toLocaleDateString()}),e.jsx("br",{}),e.jsx("small",{className:"text-muted",children:new Date(L.visit_date).toLocaleDateString("en-US",{weekday:"long"})})]}),e.jsx("td",{children:e.jsx("span",{className:"badge bg-primary",children:L.service_name||"Not specified"})}),e.jsx("td",{children:e.jsx("span",{className:`badge ${L.status==="completed"?"bg-success":L.status==="pending"?"bg-warning":"bg-secondary"}`,children:L.status})}),e.jsx("td",{children:L.teeth_treated?e.jsxs("div",{children:[e.jsx("span",{className:"badge bg-info",children:L.teeth_treated}),e.jsx("br",{}),e.jsxs("small",{className:"text-muted",children:[L.teeth_treated.split(",").length," tooth",L.teeth_treated.split(",").length!==1?"s":""]})]}):e.jsx("span",{className:"text-muted",children:"-"})}),e.jsx("td",{children:L.has_notes?e.jsxs("div",{className:"d-flex gap-2 align-items-center",children:[e.jsx("span",{className:"badge bg-success",children:"Has Notes"}),e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>d(L.id),disabled:N===L.id,children:N===L.id?e.jsx("span",{className:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"bi bi-eye me-1"}),"View Notes"]})})]}):e.jsx("span",{className:"badge bg-secondary",children:"No Notes"})})]},L.id))})]})})]}):e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),"No previous visit history found for this patient."]})})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{onSubmit:T,children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"visitCode",className:"form-label",children:"Enter Visit Code"}),e.jsx("input",{type:"text",className:"form-control form-control-lg text-center",id:"visitCode",value:a,onChange:L=>i(L.target.value.toUpperCase()),placeholder:"Enter 6-character code",maxLength:"10",disabled:n})]}),e.jsx("div",{className:"d-grid",children:e.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",disabled:n||!a.trim(),children:n?e.jsx(ze,{message:"Resolving..."}):"Start Consultation"})})]}),r&&e.jsx("div",{className:"alert alert-danger mt-3",children:r})]})})]})]})})}),p&&e.jsx("div",{className:"modal show d-block",tabIndex:"-1",style:{backgroundColor:"rgba(0,0,0,0.5)",position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:1050,overflowY:"auto",display:"flex",alignItems:"center",justifyContent:"center",padding:"1rem"},children:e.jsx("div",{className:"modal-dialog modal-lg",style:{margin:"0 auto",maxHeight:"calc(100vh - 2rem)",width:"100%"},children:e.jsxs("div",{className:"modal-content",style:{display:"flex",flexDirection:"column",maxHeight:"calc(100vh - 2rem)",overflow:"hidden"},children:[e.jsxs("div",{className:"modal-header flex-shrink-0",style:{position:"sticky",top:0,zIndex:1,backgroundColor:"#fff",borderBottom:"1px solid #dee2e6"},children:[e.jsxs("h5",{className:"modal-title",children:[e.jsx("i",{className:"bi bi-file-text me-2"}),"Visit Notes - ",new Date(($=m.patient_history.find(L=>L.id===p.visitId))==null?void 0:$.visit_date).toLocaleDateString()]}),e.jsx("button",{type:"button",className:"btn-close",onClick:R})]}),e.jsxs("div",{className:"modal-body flex-grow-1",style:{overflowY:"auto",overflowX:"hidden",flex:"1 1 auto",minHeight:0},children:[p.dentist_notes&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-primary",children:[e.jsx("i",{className:"bi bi-sticky me-2"}),"Dentist Notes"]}),e.jsx("div",{className:"bg-light p-3 rounded border",children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:p.dentist_notes})})]}),p.findings&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-success",children:[e.jsx("i",{className:"bi bi-search me-2"}),"Clinical Findings"]}),e.jsx("div",{className:"bg-light p-3 rounded border",children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:p.findings})})]}),p.treatment_plan&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-info",children:[e.jsx("i",{className:"bi bi-clipboard-check me-2"}),"Treatment Plan"]}),e.jsx("div",{className:"bg-light p-3 rounded border",children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:p.treatment_plan})})]}),p.teeth_treated&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h6",{className:"text-warning",children:[e.jsx("i",{className:"bi bi-tooth me-2"}),"Teeth Treated"]}),e.jsx("div",{className:"bg-light p-3 rounded border",children:e.jsx("p",{className:"mb-0",children:p.teeth_treated})})]}),p.created_by&&e.jsxs("div",{className:"text-muted small border-top pt-3",children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Created by:"})," ",p.created_by]}),e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Created at:"})," ",new Date(p.created_at).toLocaleString()]}),p.updated_by&&e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"mb-1",children:[e.jsx("strong",{children:"Last updated by:"})," ",p.updated_by]}),e.jsxs("p",{className:"mb-0",children:[e.jsx("strong",{children:"Last updated at:"})," ",new Date(p.updated_at).toLocaleString()]})]})]}),!p.dentist_notes&&!p.findings&&!p.treatment_plan&&!p.teeth_treated&&e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{className:"bi bi-file-text fs-1 text-muted"}),e.jsx("p",{className:"mt-2 text-muted",children:"No detailed notes available for this visit."})]})]}),e.jsx("div",{className:"modal-footer flex-shrink-0",style:{position:"sticky",bottom:0,zIndex:1,backgroundColor:"#fff",borderTop:"1px solid #dee2e6"},children:e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:R,children:"Close"})})]})})}),v&&e.jsxs("div",{className:"alert alert-danger mt-3",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle me-2"}),v]})]})}function hl(){const[s,l]=t.useState("calendar"),a=({id:i,icon:n,label:o})=>e.jsxs("button",{className:`btn flex-fill flex-sm-grow-0 border-0 shadow-sm ${s===i?"":"btn-outline-primary"}`,onClick:()=>l(i),type:"button",style:{background:s===i?"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)":"transparent",color:s===i?"white":"#3b82f6",border:s===i?"none":"1px solid #3b82f6",borderRadius:"8px",padding:"12px 16px",fontWeight:"600",transition:"all 0.3s ease",minWidth:"140px"},children:[e.jsx("i",{className:`bi bi-${n==="ðŸ“…"?"calendar":n==="ðŸ”"?"arrow-repeat":"bar-chart"} me-2`}),e.jsx("span",{className:"d-none d-sm-inline",children:o}),e.jsx("span",{className:"d-sm-none",children:o.split(" ")[0]})]});return e.jsx("div",{className:"schedule-manager-page",style:{background:"linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%)",minHeight:"100vh",padding:"2rem 0"},children:e.jsxs("div",{className:"container-fluid px-4",children:[e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"h3 mb-1 fw-bold text-dark",children:[e.jsx("i",{className:"bi bi-calendar-check me-2 text-primary"}),"Clinic Schedule"]}),e.jsx("p",{className:"text-muted mb-0",children:"View clinic operating hours and capacity settings"})]})})})}),e.jsx("div",{className:"row mb-4",children:e.jsx("div",{className:"col-12",children:e.jsxs("div",{className:"d-flex flex-column flex-sm-row gap-2",children:[e.jsx(a,{id:"calendar",icon:"ðŸ“…",label:"Calendar Overrides"}),e.jsx(a,{id:"weekly",icon:"ðŸ”",label:"Weekly Defaults"}),e.jsx(a,{id:"capacity",icon:"ðŸ“Š",label:"Capacity (14 days)"})]})})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"card border-0 shadow-lg",style:{borderRadius:"16px"},children:e.jsxs("div",{className:"card-body p-4",children:[s==="calendar"&&e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx("div",{className:"bg-primary rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx("i",{className:"bi bi-calendar text-white fs-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-1 fw-bold text-dark",children:"Calendar Overrides"}),e.jsx("p",{className:"text-muted mb-0",children:"Manage specific date exceptions and holidays"})]})]}),e.jsx(Gs,{})]}),s==="weekly"&&e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx("div",{className:"bg-success rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx("i",{className:"bi bi-arrow-repeat text-white fs-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-1 fw-bold text-dark",children:"Weekly Defaults"}),e.jsx("p",{className:"text-muted mb-0",children:"Set regular operating hours for each day of the week"})]})]}),e.jsx(Pa,{})]}),s==="capacity"&&e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsx("div",{className:"bg-info rounded-circle me-3 d-flex align-items-center justify-content-center",style:{width:"48px",height:"48px"},children:e.jsx("i",{className:"bi bi-bar-chart text-white fs-5"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"mb-1 fw-bold text-dark",children:"Capacity Planner"}),e.jsx("p",{className:"text-muted mb-0",children:"Adjust appointment capacity for the next 14 days"})]})]}),e.jsx(Ra,{})]})]})})})})]})})}function xl(){const{items:s,loading:l,error:a,loadList:i}=Sa(),n=Se();t.useEffect(()=>{s.length===0&&i()},[s.length,i]);const o=c=>{var m,b,f,y,h;return(m=c.title)!=null&&m.toLowerCase().includes("appointment")?"bi-calendar-check":(b=c.title)!=null&&b.toLowerCase().includes("payment")?"bi-credit-card":(f=c.title)!=null&&f.toLowerCase().includes("reminder")?"bi-bell":(y=c.title)!=null&&y.toLowerCase().includes("update")?"bi-arrow-clockwise":(h=c.title)!=null&&h.toLowerCase().includes("welcome")?"bi-person-plus":"bi-info-circle"},r=c=>{if(!c)return"";const m=new Date,b=new Date(c),f=Math.floor((m-b)/1e3);return f<60?"Just now":f<3600?`${Math.floor(f/60)}m ago`:f<86400?`${Math.floor(f/3600)}h ago`:f<604800?`${Math.floor(f/86400)}d ago`:`${Math.floor(f/86400)}d ago`};return e.jsxs("div",{className:"notifications-page",children:[e.jsx("div",{className:"notifications-header",children:e.jsxs("div",{className:"d-flex align-items-center mb-4",children:[e.jsxs("button",{onClick:()=>n(-1),className:"btn btn-outline-secondary btn-sm d-flex align-items-center me-3 notifications-back-btn",title:"Go back","aria-label":"Go back",children:[e.jsx("i",{className:"bi bi-arrow-left me-2"}),"Back"]}),e.jsxs("div",{className:"notifications-title-section",children:[e.jsx("h2",{className:"notifications-title mb-1",children:"All Notifications"}),e.jsx("p",{className:"notifications-subtitle mb-0",children:s.length>0?`${s.length} notification${s.length===1?"":"s"}`:"No notifications yet"})]})]})}),e.jsxs("div",{className:"notifications-content",children:[l&&e.jsx("div",{className:"notifications-loading",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary me-3",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),e.jsx("span",{className:"text-muted",children:"Loading notifications..."})]})}),a&&e.jsx("div",{className:"notifications-error",children:e.jsxs("div",{className:"alert alert-danger d-flex align-items-center",role:"alert",children:[e.jsx("i",{className:"bi bi-exclamation-triangle-fill me-3"}),e.jsxs("div",{children:[e.jsx("strong",{children:"Error loading notifications"}),e.jsx("div",{className:"small",children:a})]})]})}),!l&&!a&&s.length===0&&e.jsx("div",{className:"notifications-empty",children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"notifications-empty-icon mb-4",children:e.jsx("i",{className:"bi bi-bell"})}),e.jsx("h4",{className:"notifications-empty-title mb-3",children:"No notifications yet"}),e.jsx("p",{className:"notifications-empty-description text-muted mb-4",children:"You'll see important updates, reminders, and announcements here when they arrive."}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>i(),children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh"]})]})}),!l&&!a&&s.length>0&&e.jsx("div",{className:"notifications-list",children:s.map((c,m)=>{var b;return e.jsxs("div",{className:"notification-item",children:[e.jsx("div",{className:"notification-icon",children:e.jsx("i",{className:`bi ${o(c)}`})}),e.jsxs("div",{className:"notification-content",children:[e.jsxs("div",{className:"notification-header",children:[e.jsx("h6",{className:"notification-title mb-1",children:c.title||"Notification"}),e.jsx("small",{className:"notification-time text-muted",children:r(c.created_at)})]}),c.body&&e.jsx("p",{className:"notification-body mb-2",children:c.body}),((b=c.data)==null?void 0:b.date)&&e.jsx("div",{className:"notification-meta",children:e.jsxs("small",{className:"text-muted",children:[e.jsx("i",{className:"bi bi-calendar3 me-1"}),c.data.date]})})]})]},c.id)})})]}),!l&&!a&&s.length>0&&e.jsx("div",{className:"notifications-footer",children:e.jsx("div",{className:"text-center",children:e.jsxs("button",{className:"btn btn-outline-primary btn-sm",onClick:()=>i(),children:[e.jsx("i",{className:"bi bi-arrow-clockwise me-2"}),"Refresh Notifications"]})})})]})}function ul(){const[s]=qs(),[l,a]=t.useState("Finalizing paymentâ€¦"),i=Se(),n=s.get("paymentId"),o=s.get("requestReferenceNumber")||"";return t.useEffect(()=>{(async()=>{try{n&&await M.get(`/api/maya/payments/${n}/status`),a("Thanks! If not yet marked paid, it will update shortly.")}catch{a("Payment completed. Weâ€™re syncing the statusâ€¦")}})()},[n]),e.jsxs("div",{className:"container py-5",children:[e.jsx("h3",{children:"âœ… Payment Success"}),e.jsx("p",{className:"text-muted",children:l}),o&&e.jsxs("p",{className:"small text-muted",children:["Ref: ",o]}),e.jsx("button",{className:"btn btn-primary",onClick:()=>i("/patient/appointments"),children:"Back to My Appointments"})]})}function pl(){const[s]=qs(),l=Se(),a=s.get("reason")||"Payment failed.";return e.jsxs("div",{className:"container py-5",children:[e.jsx("h3",{children:"âŒ Payment Failed"}),e.jsx("p",{className:"text-muted",children:a}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>l("/patient/appointments"),children:"Back to My Appointments"})]})}function bl(){const s=Se();return e.jsxs("div",{className:"container py-5",children:[e.jsx("h3",{children:"ðŸš« Payment Cancelled"}),e.jsx("p",{className:"text-muted",children:"You cancelled the payment. You can try again anytime."}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>s("/patient/appointments"),children:"Back to My Appointments"})]})}const fl=t.lazy(()=>Ke(()=>import("./DentistScheduleManager-uRJQXa5X.js"),__vite__mapDeps([10,1,2,3,4,5,6,7,8]))),gl=t.lazy(()=>Ke(()=>import("./StaffAppointmentManager-tQSv9cXv.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]))),jl=t.lazy(()=>Ke(()=>import("./AppointmentFinder-BO-cDC1V.js"),__vite__mapDeps([9,1,2,3,4,5,6,7,8])));function vl(){return e.jsxs(Ba,{basename:"/",children:[e.jsx(it,{})," ",e.jsxs(Oa,{children:[e.jsx(ee,{path:"/",element:e.jsx(nt,{})}),e.jsx(ee,{path:"/login",element:e.jsx(gt,{})}),e.jsx(ee,{path:"/register",element:e.jsx(jt,{})}),e.jsx(ee,{path:"/forgot-password",element:e.jsx(vt,{})}),e.jsx(ee,{path:"/password-reset/:token",element:e.jsx(Nt,{})}),e.jsx(ee,{path:"/verify-email",element:e.jsx(yt,{})}),e.jsx(ee,{path:"/verify-success",element:e.jsx(wt,{})}),e.jsx(ee,{path:"/verify-email/:id/:hash",element:e.jsx(_t,{})}),e.jsx(ee,{path:"/notifications",element:e.jsx(xl,{})}),e.jsxs(ee,{path:"/admin",element:e.jsx(kt,{}),children:[e.jsx(ee,{index:!0,element:e.jsx(Ct,{})}),e.jsx(ee,{path:"devices",element:e.jsx(Dt,{})}),e.jsx(ee,{path:"staff-register",element:e.jsx(At,{})}),e.jsx(ee,{path:"profile",element:e.jsx(Mt,{})}),e.jsx(ee,{path:"services",element:e.jsx(Ft,{})}),e.jsx(ee,{path:"service-discounts",element:e.jsx(Et,{})}),e.jsx(ee,{path:"promo-archive",element:e.jsx(It,{})}),e.jsx(ee,{path:"schedule",element:e.jsx(Wt,{})}),e.jsx(ee,{path:"clinic-calendar",element:e.jsx(Gs,{})}),e.jsx(ee,{path:"monthly-report",element:e.jsx(mi,{})}),e.jsx(ee,{path:"analytics",element:e.jsx(ui,{})}),e.jsx(ee,{path:"goals",element:e.jsx(hi,{})}),e.jsx(ee,{path:"dentists",element:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loadingâ€¦"}),children:e.jsx(fl,{})})}),e.jsx(ee,{path:"inventory",element:e.jsx($s,{allow:({user:s})=>(s==null?void 0:s.role)==="admin",to:"/admin",children:e.jsx(ea,{})})}),e.jsx(ee,{path:"appointments",element:e.jsx(Ci,{})}),e.jsx(ee,{path:"patient-manager",element:e.jsx(pi,{})}),e.jsx(ee,{path:"payment-records",element:e.jsx(fi,{})}),e.jsx(ee,{path:"system-logs",element:e.jsx(xi,{})}),e.jsx(ee,{path:"time-blocks",element:e.jsx(bi,{})}),e.jsx(ee,{path:"patient-binding",element:e.jsx(gi,{})}),e.jsx(ee,{path:"refund-requests",element:e.jsx(ia,{})}),e.jsx(ee,{path:"refund-settings",element:e.jsx(ji,{})}),e.jsx(ee,{path:"policy-settings",element:e.jsx(vi,{})})]}),e.jsxs(ee,{path:"/staff",element:e.jsx(Ni,{}),children:[e.jsx(ee,{index:!0,element:e.jsx(yi,{})}),e.jsx(ee,{path:"profile",element:e.jsx(wi,{})}),e.jsx(ee,{path:"appointments",element:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loading appointments..."}),children:e.jsx(gl,{})})}),e.jsx(ee,{path:"appointment-finder",element:e.jsx(t.Suspense,{fallback:e.jsx("div",{children:"Loading appointment finder..."}),children:e.jsx(jl,{})})}),e.jsx(ee,{path:"appointment-reminders",element:e.jsx(Pi,{})}),e.jsx(ee,{path:"payment-records",element:e.jsx(Di,{})}),e.jsx(ee,{path:"refund-requests",element:e.jsx(ia,{})}),e.jsx(ee,{path:"patient-binding",element:e.jsx(Ai,{})}),e.jsx(ee,{path:"visit-tracker",element:e.jsx(Ia,{})}),e.jsx(ee,{path:"inventory",element:e.jsx($s,{allow:bt,to:"/staff",children:e.jsx(ea,{})})}),e.jsx(ee,{path:"visits/:id/consume",element:e.jsx($s,{allow:({user:s,settings:l})=>ft({user:s,settings:l,visitFinished:!0}),to:"/staff",children:e.jsx(Ri,{})})})]}),e.jsxs(ee,{path:"/patient",element:e.jsx(Vi,{}),children:[e.jsx(ee,{index:!0,element:e.jsx(Hi,{})}),e.jsx(ee,{path:"appointment",element:e.jsx(Ki,{})}),e.jsx(ee,{path:"profile",element:e.jsx(el,{})}),e.jsx(ee,{path:"appointments",element:e.jsx(al,{})})]}),e.jsxs(ee,{path:"/dentist",element:e.jsx(il,{}),children:[e.jsx(ee,{index:!0,element:e.jsx(ll,{})}),e.jsx(ee,{path:"dashboard",element:e.jsx(rl,{})}),e.jsx(ee,{path:"profile",element:e.jsx(nl,{})}),e.jsx(ee,{path:"schedule",element:e.jsx(cl,{})}),e.jsx(ee,{path:"visit-manager",element:e.jsx(ra,{})}),e.jsx(ee,{path:"visit/:visitCode",element:e.jsx(ra,{})}),e.jsx(ee,{path:"schedule-view",element:e.jsx(hl,{})})]}),e.jsx(ee,{path:"/pay/success",element:e.jsx(ul,{})}),e.jsx(ee,{path:"/pay/failure",element:e.jsx(pl,{})}),e.jsx(ee,{path:"/pay/cancel",element:e.jsx(bl,{})}),e.jsx(ee,{path:"*",element:e.jsx(St,{})})]})]})}function Nl(){const{authLoading:s}=Me();return t.useEffect(()=>{Cs()},[]),s?e.jsx(ze,{message:"Checking session..."}):e.jsx(vl,{})}const ca=document.getElementById("root");ca?(console.log("React app starting..."),qa.createRoot(ca).render(e.jsx(t.StrictMode,{children:e.jsx(tt,{children:e.jsx(et,{children:e.jsx(at,{children:e.jsx(st,{children:e.jsx(Nl,{})})})})})})),console.log("React app rendered successfully")):console.error("Root element not found! Make sure there's a <div id='root'></div> in index.html");export{ze as L,M as a};
